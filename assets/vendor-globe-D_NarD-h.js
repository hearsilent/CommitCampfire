import{r as mi,R as xR,g as Zv,c as TR}from"./vendor-react-OXzYy3Vh.js";import{O as Zh,V as _t,M as dn,a as ge,C as Ug,G as Ls,b as gn,S as Zo,c as ds,F as Jv,d as co,T as qg,e as HA,B as $r,f as Ns,g as Hi,I as Vo,h as ex,i as Uo,j as wR,k as d_,l as SR,w as De,H as or,N as Pa,P as ER,m as Jh,n as fn,o as Be,p as Sn,R as Jo,L as Xi,q as zi,r as $t,s as RR,t as yr,u as oA,D as vi,W as G0,v as gs,x as NR,y as tx,z as CR,A as Gg,E as nx,J as MR,K as PR,Q as BR,U as DR,X as LR,Y as OR,Z as FR,_ as IR,$ as ef,a0 as Vg,a1 as Wi,a2 as zg,a3 as p_,a4 as $n,a5 as vA,a6 as kR,a7 as UR,a8 as ri,a9 as zo,aa as Un,ab as jo,ac as $o,ad as aA,ae as js,af as Po,ag as rx,ah as Ql,ai as qR,aj as jg,ak as $g,al as Gp,am as Hg,an as Wg,ao as Ba,ap as ft,aq as WA,ar as Qg,as as tf,at as Wo,au as GR,av as V0,aw as Sr,ax as nf,ay as xA,az as rf,aA as Ua,aB as Vp,aC as TA,aD as ix,aE as qi,aF as sx,aG as ox,aH as ax,aI as lx,aJ as ux,aK as sf,aL as Ax,aM as cx,aN as m_,aO as Xl,aP as gi,aQ as VR,aR as hx,aS as fx,aT as dx,aU as px,aV as mx,aW as gx,aX as yx,aY as _x,aZ as bx,a_ as vx,a$ as xx,b0 as Tx,b1 as zR,b2 as jR,b3 as $R,b4 as Yl,b5 as z0,b6 as j0,b7 as $0,b8 as Xs,b9 as wx,ba as Sx,bb as Ex,bc as Rx,bd as Nx,be as Cx,bf as Mx,bg as Px,bh as HR,bi as WR,bj as Bx,bk as Dx,bl as lA,bm as uA,bn as Bl,bo as QR,bp as Xg,bq as Yg,br as Kg,bs as Ws,bt as Zg,bu as Jg,bv as y0,bw as _0,bx as b0,by as v0,bz as g_,bA as y_,bB as __,bC as b_,bD as zp,bE as jp,bF as $p,bG as Hp,bH as Wp,bI as H0,bJ as Qp,bK as Xp,bL as Yp,bM as Kp,bN as Zp,bO as Jp,bP as em,bQ as tm,bR as nm,bS as rm,bT as im,bU as sm,bV as om,bW as am,bX as lm,bY as um,bZ as Am,b_ as cm,b$ as W0,c0 as hm,c1 as Lx,c2 as Ox,c3 as XR,c4 as YR,c5 as KR,c6 as ZR,c7 as JR,c8 as of,c9 as eN,ca as Fx,cb as tN,cc as nN,cd as rN,ce as iN,cf as sN,cg as oN,ch as Ix,ci as Kl,cj as aN,ck as lN,cl as uN,cm as AN,cn as cN,co as hN,cp as fN,cq as dN,cr as pN,cs as mN,ct as gN,cu as yN,cv as _N,cw as bN,cx as vN,cy as xN,cz as TN,cA as wN,cB as kx,cC as SN,cD as EN,cE as RN,cF as NN,cG as CN,cH as MN,cI as Ux,cJ as PN,cK as wA,cL as BN,cM as e1,cN as DN,cO as x0,cP as t1,cQ as Q0,cR as X0,cS as Dd,cT as Ld,cU as LN,cV as ON,cW as Y0,cX as n1,cY as FN,cZ as qx,c_ as IN,c$ as kN,d0 as UN,d1 as qN,d2 as af,d3 as Zl,d4 as T0,d5 as r1,d6 as w0,d7 as GN,d8 as VN,d9 as zN,da as i1,db as jN,dc as Gx,dd as Vx,de as $N,df as HN,dg as WN,dh as Eu,di as s1,dj as xi,dk as Dl,dl as v_,dm as QN,dn as XN,dp as zx,dq as wi,dr as YN,ds as KN}from"./vendor-three-Cd3Jw7uJ.js";function ZN(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function JN(n,e,t){return e=aC(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function x_(n,e){return nC(n)||ZN(n,e)||jx(n,e)||sC()}function eC(n){return tC(n)||rC(n)||jx(n)||iC()}function tC(n){if(Array.isArray(n))return fm(n)}function nC(n){if(Array.isArray(n))return n}function rC(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function jx(n,e){if(n){if(typeof n=="string")return fm(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fm(n,e)}}function fm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function iC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oC(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function aC(n){var e=oC(n,"string");return typeof e=="symbol"?e:String(e)}var lC=function(e,t){var r=new Set(t);return Object.assign.apply(Object,[{}].concat(eC(Object.entries(e).filter(function(i){var s=x_(i,1),o=s[0];return!r.has(o)}).map(function(i){var s=x_(i,2),o=s[0],a=s[1];return JN({},o,a)}))))};function dm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function uC(n){if(Array.isArray(n))return n}function AC(n){if(Array.isArray(n))return dm(n)}function cC(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function hC(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function fC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dC(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pC(n,e){return uC(n)||hC(n,e)||$x(n,e)||fC()}function T_(n){return AC(n)||cC(n)||$x(n)||dC()}function $x(n,e){if(n){if(typeof n=="string")return dm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?dm(n,e):void 0}}function mC(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.wrapperElementType,r=t===void 0?"div":t,i=e.nodeMapper,s=i===void 0?function(p){return p}:i,o=e.methodNames,a=o===void 0?[]:o,c=e.initPropNames,f=c===void 0?[]:c;return mi.forwardRef(function(p,g){var b=mi.useRef(),x=mi.useMemo(function(){var E=Object.fromEntries(f.filter(function(C){return p.hasOwnProperty(C)}).map(function(C){return[C,p[C]]}));return n(E)},[]);w_(function(){x(s(b.current))},mi.useLayoutEffect),w_(function(){return x._destructor instanceof Function?x._destructor:void 0});var T=mi.useCallback(function(E){for(var C=arguments.length,P=new Array(C>1?C-1:0),D=1;D<C;D++)P[D-1]=arguments[D];return x[E]instanceof Function?x[E].apply(x,P):void 0},[x]),S=mi.useRef({});return Object.keys(lC(p,[].concat(T_(a),T_(f)))).filter(function(E){return S.current[E]!==p[E]}).forEach(function(E){return T(E,p[E])}),S.current=p,mi.useImperativeHandle(g,function(){return Object.fromEntries(a.map(function(E){return[E,function(){for(var C=arguments.length,P=new Array(C),D=0;D<C;D++)P[D]=arguments[D];return T.apply(void 0,[E].concat(P))}]}))},[T]),xR.createElement(r,{ref:b})})}function w_(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:mi.useEffect,t=mi.useRef(),r=mi.useRef(!1),i=mi.useRef(!1),s=mi.useState(0),o=pC(s,2);o[0];var a=o[1];r.current&&(i.current=!0),e(function(){return r.current||(t.current=n(),r.current=!0),a(function(c){return c+1}),function(){i.current&&t.current&&t.current()}},[])}class gC extends Zh{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new _t(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element&&t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Al=new ge,S_=new dn,E_=new dn,R_=new ge,N_=new ge;class yC{constructor(e={}){const t=this;let r,i,s,o;const a={objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.sortObjects=!0,this.getSize=function(){return{width:r,height:i}},this.render=function(T,S){T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),S.parent===null&&S.matrixWorldAutoUpdate===!0&&S.updateMatrixWorld(),S_.copy(S.matrixWorldInverse),E_.multiplyMatrices(S.projectionMatrix,S_),p(T,T,S),this.sortObjects&&x(T)},this.setSize=function(T,S){r=T,i=S,s=r/2,o=i/2,c.style.width=T+"px",c.style.height=S+"px"};function f(T){T.isCSS2DObject&&(T.element.style.display="none");for(let S=0,E=T.children.length;S<E;S++)f(T.children[S])}function p(T,S,E){if(T.visible===!1){f(T);return}if(T.isCSS2DObject){Al.setFromMatrixPosition(T.matrixWorld),Al.applyMatrix4(E_);const C=Al.z>=-1&&Al.z<=1&&T.layers.test(E.layers)===!0,P=T.element;P.style.display=C===!0?"":"none",C===!0&&(T.onBeforeRender(t,S,E),P.style.transform="translate("+-100*T.center.x+"%,"+-100*T.center.y+"%)translate("+(Al.x*s+s)+"px,"+(-Al.y*o+o)+"px)",P.parentNode!==c&&c.appendChild(P),T.onAfterRender(t,S,E));const D={distanceToCameraSquared:g(E,T)};a.objects.set(T,D)}for(let C=0,P=T.children.length;C<P;C++)p(T.children[C],S,E)}function g(T,S){return R_.setFromMatrixPosition(T.matrixWorld),N_.setFromMatrixPosition(S.matrixWorld),R_.distanceToSquared(N_)}function b(T){const S=[];return T.traverseVisible(function(E){E.isCSS2DObject&&S.push(E)}),S}function x(T){const S=b(T).sort(function(C,P){if(C.renderOrder!==P.renderOrder)return P.renderOrder-C.renderOrder;const D=a.objects.get(C).distanceToCameraSquared,L=a.objects.get(P).distanceToCameraSquared;return D-L}),E=S.length;for(let C=0,P=S.length;C<P;C++)S[C].element.style.zIndex=E-C}}}function pm(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var _C=typeof global=="object"&&global&&global.Object===Object&&global,bC=typeof self=="object"&&self&&self.Object===Object&&self,Hx=_C||bC||Function("return this")(),Od=function(){return Hx.Date.now()},vC=/\s/;function xC(n){for(var e=n.length;e--&&vC.test(n.charAt(e)););return e}var TC=/^\s+/;function wC(n){return n&&n.slice(0,xC(n)+1).replace(TC,"")}var K0=Hx.Symbol,Wx=Object.prototype,SC=Wx.hasOwnProperty,EC=Wx.toString,Ru=K0?K0.toStringTag:void 0;function RC(n){var e=SC.call(n,Ru),t=n[Ru];try{n[Ru]=void 0;var r=!0}catch{}var i=EC.call(n);return r&&(e?n[Ru]=t:delete n[Ru]),i}var NC=Object.prototype,CC=NC.toString;function MC(n){return CC.call(n)}var PC="[object Null]",BC="[object Undefined]",C_=K0?K0.toStringTag:void 0;function DC(n){return n==null?n===void 0?BC:PC:C_&&C_ in Object(n)?RC(n):MC(n)}function LC(n){return n!=null&&typeof n=="object"}var OC="[object Symbol]";function FC(n){return typeof n=="symbol"||LC(n)&&DC(n)==OC}var M_=NaN,IC=/^[-+]0x[0-9a-f]+$/i,kC=/^0b[01]+$/i,UC=/^0o[0-7]+$/i,qC=parseInt;function P_(n){if(typeof n=="number")return n;if(FC(n))return M_;if(pm(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=pm(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=wC(n);var t=kC.test(n);return t||UC.test(n)?qC(n.slice(2),t?2:8):IC.test(n)?M_:+n}var GC="Expected a function",VC=Math.max,zC=Math.min;function jC(n,e,t){var r,i,s,o,a,c,f=0,p=!1,g=!1,b=!0;if(typeof n!="function")throw new TypeError(GC);e=P_(e)||0,pm(t)&&(p=!!t.leading,g="maxWait"in t,s=g?VC(P_(t.maxWait)||0,e):s,b="trailing"in t?!!t.trailing:b);function x(q){var I=r,U=i;return r=i=void 0,f=q,o=n.apply(U,I),o}function T(q){return f=q,a=setTimeout(C,e),p?x(q):o}function S(q){var I=q-c,U=q-f,j=e-I;return g?zC(j,s-U):j}function E(q){var I=q-c,U=q-f;return c===void 0||I>=e||I<0||g&&U>=s}function C(){var q=Od();if(E(q))return P(q);a=setTimeout(C,S(q))}function P(q){return a=void 0,b&&r?x(q):(r=i=void 0,o)}function D(){a!==void 0&&clearTimeout(a),f=0,r=c=i=a=void 0}function L(){return a===void 0?o:P(Od())}function k(){var q=Od(),I=E(q);if(r=arguments,i=this,c=q,I){if(a===void 0)return T(c);if(g)return clearTimeout(a),a=setTimeout(C,e),x(c)}return a===void 0&&(a=setTimeout(C,e)),o}return k.cancel=D,k.flush=L,k}function B_(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function $C(n){if(Array.isArray(n))return n}function HC(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function WC(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function QC(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function XC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YC(n,e){return $C(n)||QC(n,e)||KC(n,e)||XC()}function KC(n,e){if(n){if(typeof n=="string")return B_(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?B_(n,e):void 0}}var ZC=WC(function n(e,t){var r=t.default,i=r===void 0?null:r,s=t.triggerUpdate,o=s===void 0?!0:s,a=t.onChange,c=a===void 0?function(f,p){}:a;HC(this,n),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=c});function Hn(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,r=n.props,i=r===void 0?{}:r,s=n.methods,o=s===void 0?{}:s,a=n.aliases,c=a===void 0?{}:a,f=n.init,p=f===void 0?function(){}:f,g=n.update,b=g===void 0?function(){}:g,x=Object.keys(i).map(function(T){return new ZC(T,i[T])});return function T(){for(var S=arguments.length,E=new Array(S),C=0;C<S;C++)E[C]=arguments[C];var P=!!(this instanceof T&&this.constructor),D=P?E.shift():void 0,L=E[0],k=L===void 0?{}:L,q=Object.assign({},t instanceof Function?t(k):t,{initialised:!1}),I={};function U(Q){return j(Q,k),J(),U}var j=function(K,te){p.call(U,K,q,te),q.initialised=!0},J=jC(function(){q.initialised&&(b.call(U,q,I),I={})},1);return x.forEach(function(Q){U[Q.name]=K(Q);function K(te){var oe=te.name,Y=te.triggerUpdate,ae=Y===void 0?!1:Y,he=te.onChange,xe=he===void 0?function(ke,Ke){}:he,me=te.defaultVal,Oe=me===void 0?null:me;return function(ke){var Ke=q[oe];if(!arguments.length)return Ke;var Ye=ke===void 0?Oe:ke;return q[oe]=Ye,xe.call(U,Ye,q,Ke),!I.hasOwnProperty(oe)&&(I[oe]=Ke),ae&&J(),U}}}),Object.keys(o).forEach(function(Q){U[Q]=function(){for(var K,te=arguments.length,oe=new Array(te),Y=0;Y<te;Y++)oe[Y]=arguments[Y];return(K=o[Q]).call.apply(K,[U,q].concat(oe))}}),Object.entries(c).forEach(function(Q){var K=YC(Q,2),te=K[0],oe=K[1];return U[te]=U[oe]}),U.resetProps=function(){return x.forEach(function(Q){U[Q.name](Q.defaultVal)}),U},U.resetProps(),q._rerender=J,P&&D&&U(D),U}}var qn=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-qn.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?qn.Bounce.In(n*2)*.5:qn.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Ku=function(){return performance.now()},lf=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,t){e===void 0&&(e=Ku()),t===void 0&&(t=!1);var r=Object.keys(this._tweens);if(r.length===0)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],o=!t;s&&s.update(e,o)===!1&&!t&&delete this._tweens[r[i]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),mm={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=mm.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},Qx=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),gm=new lf,br=function(){function n(e,t){t===void 0&&(t=gm),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=qn.Linear.None,this._interpolationFunction=mm.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Qx.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Ku()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var s in this._valuesEnd)i[s]=this._valuesEnd[s];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,i,s){for(var o in r){var a=e[o],c=Array.isArray(a),f=c?"array":typeof a,p=!c&&Array.isArray(r[o]);if(!(f==="undefined"||f==="function")){if(p){var g=r[o];if(g.length===0)continue;for(var b=[a],x=0,T=g.length;x<T;x+=1){var S=this._handleRelativeValue(a,g[x]);if(isNaN(S)){p=!1,console.warn("Found invalid interpolation list. Skipping.");break}b.push(S)}p&&(r[o]=b)}if((f==="object"||c)&&a&&!p){t[o]=c?[]:{};var E=a;for(var C in E)t[o][C]=E[C];i[o]=c?[]:{};var g=r[o];if(!this._isDynamic){var P={};for(var C in g)P[C]=g[C];r[o]=g=P}this._setupProperties(E,t[o],g,i[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),c||(t[o]*=1),p?i[o]=r[o].slice().reverse():i[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=Ku()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=Ku()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e===void 0&&(e=gm),this._group=e,this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=qn.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=mm.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,i;if(e===void 0&&(e=Ku()),t===void 0&&(t=!0),this._isPaused)return!0;var s,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,c=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),f=this._duration+this._repeat*c,p=function(){if(r._duration===0||a>f)return 1;var E=Math.trunc(a/c),C=a-E*c,P=Math.min(C/r._duration,1);return P===0&&a===r._duration?1:P},g=p(),b=this._easingFunction(g);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,b),this._onUpdateCallback&&this._onUpdateCallback(this._object,g),this._duration===0||a>=this._duration)if(this._repeat>0){var x=Math.min(Math.trunc((a-this._duration)/c)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=x);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=c*x,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var T=0,S=this._chainedTweens.length;T<S;T++)this._chainedTweens[T].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var o=t[s]||0,a=r[s],c=Array.isArray(e[s]),f=Array.isArray(a),p=!c&&f;p?e[s]=this._interpolationFunction(a,i):typeof a=="object"&&a?this._updateProperties(e[s],o,a,i):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n}();Qx.nextId;var Cs=gm;Cs.getAll.bind(Cs);Cs.removeAll.bind(Cs);Cs.add.bind(Cs);Cs.remove.bind(Cs);Cs.update.bind(Cs);function JC(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),r=+this._z.call(null,n);return Xx(this.cover(e,t,r),e,t,r,n)}function Xx(n,e,t,r,i){if(isNaN(e)||isNaN(t)||isNaN(r))return n;var s,o=n._root,a={data:i},c=n._x0,f=n._y0,p=n._z0,g=n._x1,b=n._y1,x=n._z1,T,S,E,C,P,D,L,k,q,I,U;if(!o)return n._root=a,n;for(;o.length;)if((L=e>=(T=(c+g)/2))?c=T:g=T,(k=t>=(S=(f+b)/2))?f=S:b=S,(q=r>=(E=(p+x)/2))?p=E:x=E,s=o,!(o=o[I=q<<2|k<<1|L]))return s[I]=a,n;if(C=+n._x.call(null,o.data),P=+n._y.call(null,o.data),D=+n._z.call(null,o.data),e===C&&t===P&&r===D)return a.next=o,s?s[I]=a:n._root=a,n;do s=s?s[I]=new Array(8):n._root=new Array(8),(L=e>=(T=(c+g)/2))?c=T:g=T,(k=t>=(S=(f+b)/2))?f=S:b=S,(q=r>=(E=(p+x)/2))?p=E:x=E;while((I=q<<2|k<<1|L)===(U=(D>=E)<<2|(P>=S)<<1|C>=T));return s[U]=o,s[I]=a,n}function eM(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,c=-1/0,f=-1/0,p=-1/0;for(let g=0,b,x,T,S;g<e;++g)isNaN(x=+this._x.call(null,b=n[g]))||isNaN(T=+this._y.call(null,b))||isNaN(S=+this._z.call(null,b))||(t[g]=x,r[g]=T,i[g]=S,x<s&&(s=x),x>c&&(c=x),T<o&&(o=T),T>f&&(f=T),S<a&&(a=S),S>p&&(p=S));if(s>c||o>f||a>p)return this;this.cover(s,o,a).cover(c,f,p);for(let g=0;g<e;++g)Xx(this,t[g],r[g],i[g],n[g]);return this}function tM(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,c=this._z1;if(isNaN(r))o=(r=Math.floor(n))+1,a=(i=Math.floor(e))+1,c=(s=Math.floor(t))+1;else{for(var f=o-r||1,p=this._root,g,b;r>n||n>=o||i>e||e>=a||s>t||t>=c;)switch(b=(t<s)<<2|(e<i)<<1|n<r,g=new Array(8),g[b]=p,p=g,f*=2,b){case 0:o=r+f,a=i+f,c=s+f;break;case 1:r=o-f,a=i+f,c=s+f;break;case 2:o=r+f,i=a-f,c=s+f;break;case 3:r=o-f,i=a-f,c=s+f;break;case 4:o=r+f,a=i+f,s=c-f;break;case 5:r=o-f,a=i+f,s=c-f;break;case 6:o=r+f,i=a-f,s=c-f;break;case 7:r=o-f,i=a-f,s=c-f;break}this._root&&this._root.length&&(this._root=p)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this}function nM(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function rM(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function sn(n,e,t,r,i,s,o){this.node=n,this.x0=e,this.y0=t,this.z0=r,this.x1=i,this.y1=s,this.z1=o}function iM(n,e,t,r){var i,s=this._x0,o=this._y0,a=this._z0,c,f,p,g,b,x,T=this._x1,S=this._y1,E=this._z1,C=[],P=this._root,D,L;for(P&&C.push(new sn(P,s,o,a,T,S,E)),r==null?r=1/0:(s=n-r,o=e-r,a=t-r,T=n+r,S=e+r,E=t+r,r*=r);D=C.pop();)if(!(!(P=D.node)||(c=D.x0)>T||(f=D.y0)>S||(p=D.z0)>E||(g=D.x1)<s||(b=D.y1)<o||(x=D.z1)<a))if(P.length){var k=(c+g)/2,q=(f+b)/2,I=(p+x)/2;C.push(new sn(P[7],k,q,I,g,b,x),new sn(P[6],c,q,I,k,b,x),new sn(P[5],k,f,I,g,q,x),new sn(P[4],c,f,I,k,q,x),new sn(P[3],k,q,p,g,b,I),new sn(P[2],c,q,p,k,b,I),new sn(P[1],k,f,p,g,q,I),new sn(P[0],c,f,p,k,q,I)),(L=(t>=I)<<2|(e>=q)<<1|n>=k)&&(D=C[C.length-1],C[C.length-1]=C[C.length-1-L],C[C.length-1-L]=D)}else{var U=n-+this._x.call(null,P.data),j=e-+this._y.call(null,P.data),J=t-+this._z.call(null,P.data),Q=U*U+j*j+J*J;if(Q<r){var K=Math.sqrt(r=Q);s=n-K,o=e-K,a=t-K,T=n+K,S=e+K,E=t+K,i=P.data}}return i}const sM=(n,e,t,r,i,s)=>Math.sqrt((n-r)**2+(e-i)**2+(t-s)**2);function oM(n,e,t,r){const i=[],s=n-r,o=e-r,a=t-r,c=n+r,f=e+r,p=t+r;return this.visit((g,b,x,T,S,E,C)=>{if(!g.length)do{const P=g.data;sM(n,e,t,this._x(P),this._y(P),this._z(P))<=r&&i.push(P)}while(g=g.next);return b>c||x>f||T>p||S<s||E<o||C<a}),i}function aM(n){if(isNaN(b=+this._x.call(null,n))||isNaN(x=+this._y.call(null,n))||isNaN(T=+this._z.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,a=this._y0,c=this._z0,f=this._x1,p=this._y1,g=this._z1,b,x,T,S,E,C,P,D,L,k,q;if(!t)return this;if(t.length)for(;;){if((P=b>=(S=(o+f)/2))?o=S:f=S,(D=x>=(E=(a+p)/2))?a=E:p=E,(L=T>=(C=(c+g)/2))?c=C:g=C,e=t,!(t=t[k=L<<2|D<<1|P]))return this;if(!t.length)break;(e[k+1&7]||e[k+2&7]||e[k+3&7]||e[k+4&7]||e[k+5&7]||e[k+6&7]||e[k+7&7])&&(r=e,q=k)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[k]=s:delete e[k],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[q]=t:this._root=t),this):(this._root=s,this)}function lM(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function uM(){return this._root}function AM(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function cM(n){var e=[],t,r=this._root,i,s,o,a,c,f,p;for(r&&e.push(new sn(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.y0,a=t.z0,c=t.x1,f=t.y1,p=t.z1)&&r.length){var g=(s+c)/2,b=(o+f)/2,x=(a+p)/2;(i=r[7])&&e.push(new sn(i,g,b,x,c,f,p)),(i=r[6])&&e.push(new sn(i,s,b,x,g,f,p)),(i=r[5])&&e.push(new sn(i,g,o,x,c,b,p)),(i=r[4])&&e.push(new sn(i,s,o,x,g,b,p)),(i=r[3])&&e.push(new sn(i,g,b,a,c,f,x)),(i=r[2])&&e.push(new sn(i,s,b,a,g,f,x)),(i=r[1])&&e.push(new sn(i,g,o,a,c,b,x)),(i=r[0])&&e.push(new sn(i,s,o,a,g,b,x))}return this}function hM(n){var e=[],t=[],r;for(this._root&&e.push(new sn(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,c=r.z0,f=r.x1,p=r.y1,g=r.z1,b=(o+f)/2,x=(a+p)/2,T=(c+g)/2;(s=i[0])&&e.push(new sn(s,o,a,c,b,x,T)),(s=i[1])&&e.push(new sn(s,b,a,c,f,x,T)),(s=i[2])&&e.push(new sn(s,o,x,c,b,p,T)),(s=i[3])&&e.push(new sn(s,b,x,c,f,p,T)),(s=i[4])&&e.push(new sn(s,o,a,T,b,x,g)),(s=i[5])&&e.push(new sn(s,b,a,T,f,x,g)),(s=i[6])&&e.push(new sn(s,o,x,T,b,p,g)),(s=i[7])&&e.push(new sn(s,b,x,T,f,p,g))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function fM(n){return n[0]}function dM(n){return arguments.length?(this._x=n,this):this._x}function pM(n){return n[1]}function mM(n){return arguments.length?(this._y=n,this):this._y}function gM(n){return n[2]}function yM(n){return arguments.length?(this._z=n,this):this._z}function Yx(n,e,t,r){var i=new o1(e??fM,t??pM,r??gM,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function o1(n,e,t,r,i,s,o,a,c){this._x=n,this._y=e,this._z=t,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this._root=void 0}function D_(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var Ar=Yx.prototype=o1.prototype;Ar.copy=function(){var n=new o1(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=D_(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(8)}):e.target[i]=D_(r));return n};Ar.add=JC;Ar.addAll=eM;Ar.cover=tM;Ar.data=nM;Ar.extent=rM;Ar.find=iM;Ar.findAllWithinRadius=oM;Ar.remove=aM;Ar.removeAll=lM;Ar.root=uM;Ar.size=AM;Ar.visit=cM;Ar.visitAfter=hM;Ar.x=dM;Ar.y=mM;Ar.z=yM;function S0(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function _M(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Kx(n){let e,t,r;n.length!==2?(e=S0,t=(a,c)=>S0(n(a),c),r=(a,c)=>n(a)-c):(e=n===S0||n===_M?n:bM,t=n,r=n);function i(a,c,f=0,p=a.length){if(f<p){if(e(c,c)!==0)return p;do{const g=f+p>>>1;t(a[g],c)<0?f=g+1:p=g}while(f<p)}return f}function s(a,c,f=0,p=a.length){if(f<p){if(e(c,c)!==0)return p;do{const g=f+p>>>1;t(a[g],c)<=0?f=g+1:p=g}while(f<p)}return f}function o(a,c,f=0,p=a.length){const g=i(a,c,f,p-1);return g>f&&r(a[g-1],c)>-r(a[g],c)?g-1:g}return{left:i,center:o,right:s}}function bM(){return 0}function vM(n){return n===null?NaN:+n}const xM=Kx(S0),Zx=xM.right;Kx(vM).center;function Z0(n,e){let t,r;if(e===void 0)for(const i of n)i!=null&&(t===void 0?i>=i&&(t=r=i):(t>i&&(t=i),r<i&&(r=i)));else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(t===void 0?s>=s&&(t=r=s):(t>s&&(t=s),r<s&&(r=s)))}return[t,r]}class Ys{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=t[i],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(t[r++]=a),e=o}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,i,s,o=0;if(t>0){for(o=e[--t];t>0&&(r=o,i=e[--t],o=r+i,s=i-(o-r),!s););t>0&&(s<0&&e[t-1]<0||s>0&&e[t-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}const TM=Math.sqrt(50),wM=Math.sqrt(10),SM=Math.sqrt(2);function J0(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=TM?10:s>=wM?5:s>=SM?2:1;let a,c,f;return i<0?(f=Math.pow(10,-i)/o,a=Math.round(n*f),c=Math.round(e*f),a/f<n&&++a,c/f>e&&--c,f=-f):(f=Math.pow(10,i)*o,a=Math.round(n/f),c=Math.round(e/f),a*f<n&&++a,c*f>e&&--c),c<a&&.5<=t&&t<2?J0(n,e,t*2):[a,c,f]}function EM(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,s,o]=r?J0(e,n,t):J0(n,e,t);if(!(s>=i))return[];const a=s-i+1,c=new Array(a);if(r)if(o<0)for(let f=0;f<a;++f)c[f]=(s-f)/-o;else for(let f=0;f<a;++f)c[f]=(s-f)*o;else if(o<0)for(let f=0;f<a;++f)c[f]=(i+f)/-o;else for(let f=0;f<a;++f)c[f]=(i+f)*o;return c}function ym(n,e,t){return e=+e,n=+n,t=+t,J0(n,e,t)[2]}function RM(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?ym(e,n,t):ym(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function NM(n,e){let t;for(const r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);return t}function CM(n,e){let t=0,r=0;if(e===void 0)for(let i of n)i!=null&&(i=+i)>=i&&(++t,r+=i);else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(s=+s)>=s&&(++t,r+=s)}if(t)return r/t}function*MM(n){for(const e of n)yield*e}function SA(n){return Array.from(MM(n))}function Ll(n,e,t){n=+n,e=+e,t=(i=arguments.length)<2?(e=n,n=0,1):i<3?1:+t;for(var r=-1,i=Math.max(0,Math.ceil((e-n)/t))|0,s=new Array(i);++r<i;)s[r]=n+r*t;return s}function PM(n,e){let t=0;for(let r of n)(r=+r)&&(t+=r);return t}function Jx(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function a1(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function e4(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function QA(){}var EA=.7,eh=1/EA,ql="\\s*([+-]?\\d+)\\s*",RA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",bs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",BM=/^#([0-9a-f]{3,8})$/,DM=new RegExp(`^rgb\\(${ql},${ql},${ql}\\)$`),LM=new RegExp(`^rgb\\(${bs},${bs},${bs}\\)$`),OM=new RegExp(`^rgba\\(${ql},${ql},${ql},${RA}\\)$`),FM=new RegExp(`^rgba\\(${bs},${bs},${bs},${RA}\\)$`),IM=new RegExp(`^hsl\\(${RA},${bs},${bs}\\)$`),kM=new RegExp(`^hsla\\(${RA},${bs},${bs},${RA}\\)$`),L_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};a1(QA,ja,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:O_,formatHex:O_,formatHex8:UM,formatHsl:qM,formatRgb:F_,toString:F_});function O_(){return this.rgb().formatHex()}function UM(){return this.rgb().formatHex8()}function qM(){return t4(this).formatHsl()}function F_(){return this.rgb().formatRgb()}function ja(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=BM.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?I_(e):t===3?new Ir(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?vc(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?vc(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=DM.exec(n))?new Ir(e[1],e[2],e[3],1):(e=LM.exec(n))?new Ir(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=OM.exec(n))?vc(e[1],e[2],e[3],e[4]):(e=FM.exec(n))?vc(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=IM.exec(n))?q_(e[1],e[2]/100,e[3]/100,1):(e=kM.exec(n))?q_(e[1],e[2]/100,e[3]/100,e[4]):L_.hasOwnProperty(n)?I_(L_[n]):n==="transparent"?new Ir(NaN,NaN,NaN,0):null}function I_(n){return new Ir(n>>16&255,n>>8&255,n&255,1)}function vc(n,e,t,r){return r<=0&&(n=e=t=NaN),new Ir(n,e,t,r)}function GM(n){return n instanceof QA||(n=ja(n)),n?(n=n.rgb(),new Ir(n.r,n.g,n.b,n.opacity)):new Ir}function _m(n,e,t,r){return arguments.length===1?GM(n):new Ir(n,e,t,r??1)}function Ir(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}a1(Ir,_m,e4(QA,{brighter(n){return n=n==null?eh:Math.pow(eh,n),new Ir(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?EA:Math.pow(EA,n),new Ir(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ir(qa(this.r),qa(this.g),qa(this.b),th(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:k_,formatHex:k_,formatHex8:VM,formatRgb:U_,toString:U_}));function k_(){return`#${Da(this.r)}${Da(this.g)}${Da(this.b)}`}function VM(){return`#${Da(this.r)}${Da(this.g)}${Da(this.b)}${Da((isNaN(this.opacity)?1:this.opacity)*255)}`}function U_(){const n=th(this.opacity);return`${n===1?"rgb(":"rgba("}${qa(this.r)}, ${qa(this.g)}, ${qa(this.b)}${n===1?")":`, ${n})`}`}function th(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function qa(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Da(n){return n=qa(n),(n<16?"0":"")+n.toString(16)}function q_(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Gi(n,e,t,r)}function t4(n){if(n instanceof Gi)return new Gi(n.h,n.s,n.l,n.opacity);if(n instanceof QA||(n=ja(n)),!n)return new Gi;if(n instanceof Gi)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,a=s-i,c=(s+i)/2;return a?(e===s?o=(t-r)/a+(t<r)*6:t===s?o=(r-e)/a+2:o=(e-t)/a+4,a/=c<.5?s+i:2-s-i,o*=60):a=c>0&&c<1?0:o,new Gi(o,a,c,n.opacity)}function zM(n,e,t,r){return arguments.length===1?t4(n):new Gi(n,e,t,r??1)}function Gi(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}a1(Gi,zM,e4(QA,{brighter(n){return n=n==null?eh:Math.pow(eh,n),new Gi(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?EA:Math.pow(EA,n),new Gi(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Ir(Fd(n>=240?n-240:n+120,i,r),Fd(n,i,r),Fd(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Gi(G_(this.h),xc(this.s),xc(this.l),th(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=th(this.opacity);return`${n===1?"hsl(":"hsla("}${G_(this.h)}, ${xc(this.s)*100}%, ${xc(this.l)*100}%${n===1?")":`, ${n})`}`}}));function G_(n){return n=(n||0)%360,n<0?n+360:n}function xc(n){return Math.max(0,Math.min(1,n||0))}function Fd(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const l1=n=>()=>n;function jM(n,e){return function(t){return n+t*e}}function $M(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function HM(n){return(n=+n)==1?n4:function(e,t){return t-e?$M(e,t,n):l1(isNaN(e)?t:e)}}function n4(n,e){var t=e-n;return t?jM(n,t):l1(isNaN(n)?e:n)}const V_=function n(e){var t=HM(e);function r(i,s){var o=t((i=_m(i)).r,(s=_m(s)).r),a=t(i.g,s.g),c=t(i.b,s.b),f=n4(i.opacity,s.opacity);return function(p){return i.r=o(p),i.g=a(p),i.b=c(p),i.opacity=f(p),i+""}}return r.gamma=n,r}(1);function r4(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(s){for(i=0;i<t;++i)r[i]=n[i]*(1-s)+e[i]*s;return r}}function i4(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function WM(n,e){return(i4(e)?r4:s4)(n,e)}function s4(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),s=new Array(t),o;for(o=0;o<r;++o)i[o]=u1(n[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function QM(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function NA(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function XM(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=u1(n[i],e[i]):r[i]=e[i];return function(s){for(i in t)r[i]=t[i](s);return r}}var bm=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Id=new RegExp(bm.source,"g");function YM(n){return function(){return n}}function KM(n){return function(e){return n(e)+""}}function ZM(n,e){var t=bm.lastIndex=Id.lastIndex=0,r,i,s,o=-1,a=[],c=[];for(n=n+"",e=e+"";(r=bm.exec(n))&&(i=Id.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:NA(r,i)})),t=Id.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?KM(c[0].x):YM(e):(e=c.length,function(f){for(var p=0,g;p<e;++p)a[(g=c[p]).i]=g.x(f);return a.join("")})}function u1(n,e){var t=typeof e,r;return e==null||t==="boolean"?l1(e):(t==="number"?NA:t==="string"?(r=ja(e))?(e=r,V_):ZM:e instanceof ja?V_:e instanceof Date?QM:i4(e)?r4:Array.isArray(e)?s4:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?XM:NA)(n,e)}function JM(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function e9(n){return function(){return n}}function t9(n){return+n}var z_=[0,1];function Ol(n){return n}function vm(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:e9(isNaN(e)?NaN:.5)}function n9(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function r9(n,e,t){var r=n[0],i=n[1],s=e[0],o=e[1];return i<r?(r=vm(i,r),s=t(o,s)):(r=vm(r,i),s=t(s,o)),function(a){return s(r(a))}}function i9(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=vm(n[o],n[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var c=Zx(n,a,1,r)-1;return s[c](i[c](a))}}function s9(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function o9(){var n=z_,e=z_,t=u1,r,i,s,o=Ol,a,c,f;function p(){var b=Math.min(n.length,e.length);return o!==Ol&&(o=n9(n[0],n[b-1])),a=b>2?i9:r9,c=f=null,g}function g(b){return b==null||isNaN(b=+b)?s:(c||(c=a(n.map(r),e,t)))(r(o(b)))}return g.invert=function(b){return o(i((f||(f=a(e,n.map(r),NA)))(b)))},g.domain=function(b){return arguments.length?(n=Array.from(b,t9),p()):n.slice()},g.range=function(b){return arguments.length?(e=Array.from(b),p()):e.slice()},g.rangeRound=function(b){return e=Array.from(b),t=JM,p()},g.clamp=function(b){return arguments.length?(o=b?!0:Ol,p()):o!==Ol},g.interpolate=function(b){return arguments.length?(t=b,p()):t},g.unknown=function(b){return arguments.length?(s=b,g):s},function(b,x){return r=b,i=x,p()}}function a9(){return o9()(Ol,Ol)}function l9(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function nh(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function Jl(n){return n=nh(Math.abs(n)),n?n[1]:NaN}function u9(n,e){return function(t,r){for(var i=t.length,s=[],o=0,a=n[0],c=0;i>0&&a>0&&(c+a+1>r&&(a=Math.max(1,r-c)),s.push(t.substring(i-=a,i+a)),!((c+=a+1)>r));)a=n[o=(o+1)%n.length];return s.reverse().join(e)}}function A9(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var c9=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function rh(n){if(!(e=c9.exec(n)))throw new Error("invalid format: "+n);var e;return new A1({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}rh.prototype=A1.prototype;function A1(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}A1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function h9(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var o4;function f9(n,e){var t=nh(n,e);if(!t)return n+"";var r=t[0],i=t[1],s=i-(o4=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+nh(n,Math.max(0,e+s-1))[0]}function j_(n,e){var t=nh(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const $_={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:l9,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>j_(n*100,e),r:j_,s:f9,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function H_(n){return n}var W_=Array.prototype.map,Q_=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function d9(n){var e=n.grouping===void 0||n.thousands===void 0?H_:u9(W_.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",s=n.numerals===void 0?H_:A9(W_.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"":n.minus+"",c=n.nan===void 0?"NaN":n.nan+"";function f(g){g=rh(g);var b=g.fill,x=g.align,T=g.sign,S=g.symbol,E=g.zero,C=g.width,P=g.comma,D=g.precision,L=g.trim,k=g.type;k==="n"?(P=!0,k="g"):$_[k]||(D===void 0&&(D=12),L=!0,k="g"),(E||b==="0"&&x==="=")&&(E=!0,b="0",x="=");var q=S==="$"?t:S==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",I=S==="$"?r:/[%p]/.test(k)?o:"",U=$_[k],j=/[defgprs%]/.test(k);D=D===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,D)):Math.max(0,Math.min(20,D));function J(Q){var K=q,te=I,oe,Y,ae;if(k==="c")te=U(Q)+te,Q="";else{Q=+Q;var he=Q<0||1/Q<0;if(Q=isNaN(Q)?c:U(Math.abs(Q),D),L&&(Q=h9(Q)),he&&+Q==0&&T!=="+"&&(he=!1),K=(he?T==="("?T:a:T==="-"||T==="("?"":T)+K,te=(k==="s"?Q_[8+o4/3]:"")+te+(he&&T==="("?")":""),j){for(oe=-1,Y=Q.length;++oe<Y;)if(ae=Q.charCodeAt(oe),48>ae||ae>57){te=(ae===46?i+Q.slice(oe+1):Q.slice(oe))+te,Q=Q.slice(0,oe);break}}}P&&!E&&(Q=e(Q,1/0));var xe=K.length+Q.length+te.length,me=xe<C?new Array(C-xe+1).join(b):"";switch(P&&E&&(Q=e(me+Q,me.length?C-te.length:1/0),me=""),x){case"<":Q=K+Q+te+me;break;case"=":Q=K+me+Q+te;break;case"^":Q=me.slice(0,xe=me.length>>1)+K+Q+te+me.slice(xe);break;default:Q=me+K+Q+te;break}return s(Q)}return J.toString=function(){return g+""},J}function p(g,b){var x=f((g=rh(g),g.type="f",g)),T=Math.max(-8,Math.min(8,Math.floor(Jl(b)/3)))*3,S=Math.pow(10,-T),E=Q_[8+T/3];return function(C){return x(S*C)+E}}return{format:f,formatPrefix:p}}var Tc,a4,l4;p9({thousands:",",grouping:[3],currency:["$",""]});function p9(n){return Tc=d9(n),a4=Tc.format,l4=Tc.formatPrefix,Tc}function m9(n){return Math.max(0,-Jl(Math.abs(n)))}function g9(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Jl(e)/3)))*3-Jl(Math.abs(n)))}function y9(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Jl(e)-Jl(n))+1}function _9(n,e,t,r){var i=RM(n,e,t),s;switch(r=rh(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(s=g9(i,o))&&(r.precision=s),l4(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=y9(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=m9(i))&&(r.precision=s-(r.type==="%")*2);break}}return a4(r)}function u4(n){var e=n.domain;return n.ticks=function(t){var r=e();return EM(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return _9(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],c,f,p=10;for(a<o&&(f=o,o=a,a=f,f=i,i=s,s=f);p-- >0;){if(f=ym(o,a,t),f===c)return r[i]=o,r[s]=a,e(r);if(f>0)o=Math.floor(o/f)*f,a=Math.ceil(a/f)*f;else if(f<0)o=Math.ceil(o*f)/f,a=Math.floor(a*f)/f;else break;c=f}return n},n}function ro(){var n=a9();return n.copy=function(){return s9(n,ro())},Jx.apply(n,arguments),u4(n)}function A4(){var n=0,e=1,t=1,r=[.5],i=[0,1],s;function o(c){return c!=null&&c<=c?i[Zx(r,c,0,t)]:s}function a(){var c=-1;for(r=new Array(t);++c<t;)r[c]=((c+1)*e-(c-t)*n)/(t+1);return o}return o.domain=function(c){return arguments.length?([n,e]=c,n=+n,e=+e,a()):[n,e]},o.range=function(c){return arguments.length?(t=(i=Array.from(c)).length-1,a()):i.slice()},o.invertExtent=function(c){var f=i.indexOf(c);return f<0?[NaN,NaN]:f<1?[n,r[0]]:f>=t?[r[t-1],e]:[r[f-1],r[f]]},o.unknown=function(c){return arguments.length&&(s=c),o},o.thresholds=function(){return r.slice()},o.copy=function(){return A4().domain([n,e]).range(i).unknown(s)},Jx.apply(u4(o),arguments)}var wt=1e-6,ih=1e-12,Bt=Math.PI,kr=Bt/2,sh=Bt/4,si=Bt*2,Cn=180/Bt,ct=Bt/180,nn=Math.abs,c1=Math.atan,Si=Math.atan2,dt=Math.cos,wc=Math.ceil,b9=Math.exp,xm=Math.hypot,v9=Math.log,at=Math.sin,x9=Math.sign||function(n){return n>0?1:n<0?-1:0},io=Math.sqrt,T9=Math.tan;function w9(n){return n>1?0:n<-1?Bt:Math.acos(n)}function so(n){return n>1?kr:n<-1?-kr:Math.asin(n)}function X_(n){return(n=at(n/2))*n}function pr(){}function oh(n,e){n&&K_.hasOwnProperty(n.type)&&K_[n.type](n,e)}var Y_={Feature:function(n,e){oh(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)oh(t[r].geometry,e)}},K_={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){Tm(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)Tm(t[r],e,0)},Polygon:function(n,e){Z_(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)Z_(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)oh(t[r],e)}};function Tm(n,e,t){var r=-1,i=n.length-t,s;for(e.lineStart();++r<i;)s=n[r],e.point(s[0],s[1],s[2]);e.lineEnd()}function Z_(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)Tm(n[t],e,1);e.polygonEnd()}function uf(n,e){n&&Y_.hasOwnProperty(n.type)?Y_[n.type](n,e):oh(n,e)}var ah=new Ys,J_=new Ys,c4,h4,wm,Sm,Em,oo={point:pr,lineStart:pr,lineEnd:pr,polygonStart:function(){ah=new Ys,oo.lineStart=S9,oo.lineEnd=E9},polygonEnd:function(){var n=+ah;J_.add(n<0?si+n:n),this.lineStart=this.lineEnd=this.point=pr},sphere:function(){J_.add(si)}};function S9(){oo.point=R9}function E9(){f4(c4,h4)}function R9(n,e){oo.point=f4,c4=n,h4=e,n*=ct,e*=ct,wm=n,Sm=dt(e=e/2+sh),Em=at(e)}function f4(n,e){n*=ct,e*=ct,e=e/2+sh;var t=n-wm,r=t>=0?1:-1,i=r*t,s=dt(e),o=at(e),a=Em*o,c=Sm*s+a*dt(i),f=a*r*at(i);ah.add(Si(f,c)),wm=n,Sm=s,Em=o}function lh(n){return[Si(n[1],n[0]),so(n[2])]}function $a(n){var e=n[0],t=n[1],r=dt(t);return[r*dt(e),r*at(e),at(t)]}function Sc(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function eu(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function kd(n,e){n[0]+=e[0],n[1]+=e[1],n[2]+=e[2]}function Ec(n,e){return[n[0]*e,n[1]*e,n[2]*e]}function uh(n){var e=io(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var Tn,Fr,Nn,ni,Ta,d4,p4,Gl,AA,Bo,ao,Vs={point:Rm,lineStart:e3,lineEnd:t3,polygonStart:function(){Vs.point=g4,Vs.lineStart=N9,Vs.lineEnd=C9,AA=new Ys,oo.polygonStart()},polygonEnd:function(){oo.polygonEnd(),Vs.point=Rm,Vs.lineStart=e3,Vs.lineEnd=t3,ah<0?(Tn=-(Nn=180),Fr=-(ni=90)):AA>wt?ni=90:AA<-wt&&(Fr=-90),ao[0]=Tn,ao[1]=Nn},sphere:function(){Tn=-(Nn=180),Fr=-(ni=90)}};function Rm(n,e){Bo.push(ao=[Tn=n,Nn=n]),e<Fr&&(Fr=e),e>ni&&(ni=e)}function m4(n,e){var t=$a([n*ct,e*ct]);if(Gl){var r=eu(Gl,t),i=[r[1],-r[0],0],s=eu(i,r);uh(s),s=lh(s);var o=n-Ta,a=o>0?1:-1,c=s[0]*Cn*a,f,p=nn(o)>180;p^(a*Ta<c&&c<a*n)?(f=s[1]*Cn,f>ni&&(ni=f)):(c=(c+360)%360-180,p^(a*Ta<c&&c<a*n)?(f=-s[1]*Cn,f<Fr&&(Fr=f)):(e<Fr&&(Fr=e),e>ni&&(ni=e))),p?n<Ta?Jr(Tn,n)>Jr(Tn,Nn)&&(Nn=n):Jr(n,Nn)>Jr(Tn,Nn)&&(Tn=n):Nn>=Tn?(n<Tn&&(Tn=n),n>Nn&&(Nn=n)):n>Ta?Jr(Tn,n)>Jr(Tn,Nn)&&(Nn=n):Jr(n,Nn)>Jr(Tn,Nn)&&(Tn=n)}else Bo.push(ao=[Tn=n,Nn=n]);e<Fr&&(Fr=e),e>ni&&(ni=e),Gl=t,Ta=n}function e3(){Vs.point=m4}function t3(){ao[0]=Tn,ao[1]=Nn,Vs.point=Rm,Gl=null}function g4(n,e){if(Gl){var t=n-Ta;AA.add(nn(t)>180?t+(t>0?360:-360):t)}else d4=n,p4=e;oo.point(n,e),m4(n,e)}function N9(){oo.lineStart()}function C9(){g4(d4,p4),oo.lineEnd(),nn(AA)>wt&&(Tn=-(Nn=180)),ao[0]=Tn,ao[1]=Nn,Gl=null}function Jr(n,e){return(e-=n)<0?e+360:e}function M9(n,e){return n[0]-e[0]}function n3(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function y4(n){var e,t,r,i,s,o,a;if(ni=Nn=-(Tn=Fr=1/0),Bo=[],uf(n,Vs),t=Bo.length){for(Bo.sort(M9),e=1,r=Bo[0],s=[r];e<t;++e)i=Bo[e],n3(r,i[0])||n3(r,i[1])?(Jr(r[0],i[1])>Jr(r[0],r[1])&&(r[1]=i[1]),Jr(i[0],r[1])>Jr(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,t=s.length-1,e=0,r=s[t];e<=t;r=i,++e)i=s[e],(a=Jr(r[1],i[0]))>o&&(o=a,Tn=i[0],Nn=r[1])}return Bo=ao=null,Tn===1/0||Fr===1/0?[[NaN,NaN],[NaN,NaN]]:[[Tn,Fr],[Nn,ni]]}var Zu,Ah,ch,hh,fh,dh,ph,mh,Nm,Cm,Mm,_4,b4,Er,Rr,Nr,ji={sphere:pr,point:h1,lineStart:r3,lineEnd:i3,polygonStart:function(){ji.lineStart=D9,ji.lineEnd=L9},polygonEnd:function(){ji.lineStart=r3,ji.lineEnd=i3}};function h1(n,e){n*=ct,e*=ct;var t=dt(e);XA(t*dt(n),t*at(n),at(e))}function XA(n,e,t){++Zu,ch+=(n-ch)/Zu,hh+=(e-hh)/Zu,fh+=(t-fh)/Zu}function r3(){ji.point=P9}function P9(n,e){n*=ct,e*=ct;var t=dt(e);Er=t*dt(n),Rr=t*at(n),Nr=at(e),ji.point=B9,XA(Er,Rr,Nr)}function B9(n,e){n*=ct,e*=ct;var t=dt(e),r=t*dt(n),i=t*at(n),s=at(e),o=Si(io((o=Rr*s-Nr*i)*o+(o=Nr*r-Er*s)*o+(o=Er*i-Rr*r)*o),Er*r+Rr*i+Nr*s);Ah+=o,dh+=o*(Er+(Er=r)),ph+=o*(Rr+(Rr=i)),mh+=o*(Nr+(Nr=s)),XA(Er,Rr,Nr)}function i3(){ji.point=h1}function D9(){ji.point=O9}function L9(){v4(_4,b4),ji.point=h1}function O9(n,e){_4=n,b4=e,n*=ct,e*=ct,ji.point=v4;var t=dt(e);Er=t*dt(n),Rr=t*at(n),Nr=at(e),XA(Er,Rr,Nr)}function v4(n,e){n*=ct,e*=ct;var t=dt(e),r=t*dt(n),i=t*at(n),s=at(e),o=Rr*s-Nr*i,a=Nr*r-Er*s,c=Er*i-Rr*r,f=xm(o,a,c),p=so(f),g=f&&-p/f;Nm.add(g*o),Cm.add(g*a),Mm.add(g*c),Ah+=p,dh+=p*(Er+(Er=r)),ph+=p*(Rr+(Rr=i)),mh+=p*(Nr+(Nr=s)),XA(Er,Rr,Nr)}function s3(n){Zu=Ah=ch=hh=fh=dh=ph=mh=0,Nm=new Ys,Cm=new Ys,Mm=new Ys,uf(n,ji);var e=+Nm,t=+Cm,r=+Mm,i=xm(e,t,r);return i<ih&&(e=dh,t=ph,r=mh,Ah<wt&&(e=ch,t=hh,r=fh),i=xm(e,t,r),i<ih)?[NaN,NaN]:[Si(t,e)*Cn,so(r/i)*Cn]}function Pm(n,e){function t(r,i){return r=n(r,i),e(r[0],r[1])}return n.invert&&e.invert&&(t.invert=function(r,i){return r=e.invert(r,i),r&&n.invert(r[0],r[1])}),t}function Bm(n,e){return nn(n)>Bt&&(n-=Math.round(n/si)*si),[n,e]}Bm.invert=Bm;function x4(n,e,t){return(n%=si)?e||t?Pm(a3(n),l3(e,t)):a3(n):e||t?l3(e,t):Bm}function o3(n){return function(e,t){return e+=n,nn(e)>Bt&&(e-=Math.round(e/si)*si),[e,t]}}function a3(n){var e=o3(n);return e.invert=o3(-n),e}function l3(n,e){var t=dt(n),r=at(n),i=dt(e),s=at(e);function o(a,c){var f=dt(c),p=dt(a)*f,g=at(a)*f,b=at(c),x=b*t+p*r;return[Si(g*i-x*s,p*t-b*r),so(x*i+g*s)]}return o.invert=function(a,c){var f=dt(c),p=dt(a)*f,g=at(a)*f,b=at(c),x=b*i-g*s;return[Si(g*i+b*s,p*t+x*r),so(x*t-p*r)]},o}function F9(n){n=x4(n[0]*ct,n[1]*ct,n.length>2?n[2]*ct:0);function e(t){return t=n(t[0]*ct,t[1]*ct),t[0]*=Cn,t[1]*=Cn,t}return e.invert=function(t){return t=n.invert(t[0]*ct,t[1]*ct),t[0]*=Cn,t[1]*=Cn,t},e}function I9(n,e,t,r,i,s){if(t){var o=dt(e),a=at(e),c=r*t;i==null?(i=e+r*si,s=e-c/2):(i=u3(o,i),s=u3(o,s),(r>0?i<s:i>s)&&(i+=r*si));for(var f,p=i;r>0?p>s:p<s;p-=c)f=lh([o,-a*dt(p),-a*at(p)]),n.point(f[0],f[1])}}function u3(n,e){e=$a(e),e[0]-=n,uh(e);var t=w9(-e[1]);return((-e[2]<0?-t:t)+si-wt)%si}function T4(){var n=[],e;return{point:function(t,r,i){e.push([t,r,i])},lineStart:function(){n.push(e=[])},lineEnd:pr,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var t=n;return n=[],e=null,t}}}function E0(n,e){return nn(n[0]-e[0])<wt&&nn(n[1]-e[1])<wt}function Rc(n,e,t,r){this.x=n,this.z=e,this.o=t,this.e=r,this.v=!1,this.n=this.p=null}function w4(n,e,t,r,i){var s=[],o=[],a,c;if(n.forEach(function(T){if(!((S=T.length-1)<=0)){var S,E=T[0],C=T[S],P;if(E0(E,C)){if(!E[2]&&!C[2]){for(i.lineStart(),a=0;a<S;++a)i.point((E=T[a])[0],E[1]);i.lineEnd();return}C[0]+=2*wt}s.push(P=new Rc(E,T,null,!0)),o.push(P.o=new Rc(E,null,P,!1)),s.push(P=new Rc(C,T,null,!1)),o.push(P.o=new Rc(C,null,P,!0))}}),!!s.length){for(o.sort(e),A3(s),A3(o),a=0,c=o.length;a<c;++a)o[a].e=t=!t;for(var f=s[0],p,g;;){for(var b=f,x=!0;b.v;)if((b=b.n)===f)return;p=b.z,i.lineStart();do{if(b.v=b.o.v=!0,b.e){if(x)for(a=0,c=p.length;a<c;++a)i.point((g=p[a])[0],g[1]);else r(b.x,b.n.x,1,i);b=b.n}else{if(x)for(p=b.p.z,a=p.length-1;a>=0;--a)i.point((g=p[a])[0],g[1]);else r(b.x,b.p.x,-1,i);b=b.p}b=b.o,p=b.z,x=!x}while(!b.v);i.lineEnd()}}}function A3(n){if(e=n.length){for(var e,t=0,r=n[0],i;++t<e;)r.n=i=n[t],i.p=r,r=i;r.n=i=n[0],i.p=r}}function Ud(n){return nn(n[0])<=Bt?n[0]:x9(n[0])*((nn(n[0])+Bt)%si-Bt)}function S4(n,e){var t=Ud(e),r=e[1],i=at(r),s=[at(t),-dt(t),0],o=0,a=0,c=new Ys;i===1?r=kr+wt:i===-1&&(r=-kr-wt);for(var f=0,p=n.length;f<p;++f)if(b=(g=n[f]).length)for(var g,b,x=g[b-1],T=Ud(x),S=x[1]/2+sh,E=at(S),C=dt(S),P=0;P<b;++P,T=L,E=q,C=I,x=D){var D=g[P],L=Ud(D),k=D[1]/2+sh,q=at(k),I=dt(k),U=L-T,j=U>=0?1:-1,J=j*U,Q=J>Bt,K=E*q;if(c.add(Si(K*j*at(J),C*I+K*dt(J))),o+=Q?U+j*si:U,Q^T>=t^L>=t){var te=eu($a(x),$a(D));uh(te);var oe=eu(s,te);uh(oe);var Y=(Q^U>=0?-1:1)*so(oe[2]);(r>Y||r===Y&&(te[0]||te[1]))&&(a+=Q^U>=0?1:-1)}}return(o<-wt||o<wt&&c<-ih)^a&1}function E4(n,e,t,r){return function(i){var s=e(i),o=T4(),a=e(o),c=!1,f,p,g,b={point:x,lineStart:S,lineEnd:E,polygonStart:function(){b.point=C,b.lineStart=P,b.lineEnd=D,p=[],f=[]},polygonEnd:function(){b.point=x,b.lineStart=S,b.lineEnd=E,p=SA(p);var L=S4(f,r);p.length?(c||(i.polygonStart(),c=!0),w4(p,U9,L,t,i)):L&&(c||(i.polygonStart(),c=!0),i.lineStart(),t(null,null,1,i),i.lineEnd()),c&&(i.polygonEnd(),c=!1),p=f=null},sphere:function(){i.polygonStart(),i.lineStart(),t(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function x(L,k){n(L,k)&&i.point(L,k)}function T(L,k){s.point(L,k)}function S(){b.point=T,s.lineStart()}function E(){b.point=x,s.lineEnd()}function C(L,k){g.push([L,k]),a.point(L,k)}function P(){a.lineStart(),g=[]}function D(){C(g[0][0],g[0][1]),a.lineEnd();var L=a.clean(),k=o.result(),q,I=k.length,U,j,J;if(g.pop(),f.push(g),g=null,!!I){if(L&1){if(j=k[0],(U=j.length-1)>0){for(c||(i.polygonStart(),c=!0),i.lineStart(),q=0;q<U;++q)i.point((J=j[q])[0],J[1]);i.lineEnd()}return}I>1&&L&2&&k.push(k.pop().concat(k.shift())),p.push(k.filter(k9))}}return b}}function k9(n){return n.length>1}function U9(n,e){return((n=n.x)[0]<0?n[1]-kr-wt:kr-n[1])-((e=e.x)[0]<0?e[1]-kr-wt:kr-e[1])}const c3=E4(function(){return!0},q9,V9,[-Bt,-kr]);function q9(n){var e=NaN,t=NaN,r=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(s,o){var a=s>0?Bt:-Bt,c=nn(s-e);nn(c-Bt)<wt?(n.point(e,t=(t+o)/2>0?kr:-kr),n.point(r,t),n.lineEnd(),n.lineStart(),n.point(a,t),n.point(s,t),i=0):r!==a&&c>=Bt&&(nn(e-r)<wt&&(e-=r*wt),nn(s-a)<wt&&(s-=a*wt),t=G9(e,t,s,o),n.point(r,t),n.lineEnd(),n.lineStart(),n.point(a,t),i=0),n.point(e=s,t=o),r=a},lineEnd:function(){n.lineEnd(),e=t=NaN},clean:function(){return 2-i}}}function G9(n,e,t,r){var i,s,o=at(n-t);return nn(o)>wt?c1((at(e)*(s=dt(r))*at(t)-at(r)*(i=dt(e))*at(n))/(i*s*o)):(e+r)/2}function V9(n,e,t,r){var i;if(n==null)i=t*kr,r.point(-Bt,i),r.point(0,i),r.point(Bt,i),r.point(Bt,0),r.point(Bt,-i),r.point(0,-i),r.point(-Bt,-i),r.point(-Bt,0),r.point(-Bt,i);else if(nn(n[0]-e[0])>wt){var s=n[0]<e[0]?Bt:-Bt;i=t*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(e[0],e[1])}function z9(n){var e=dt(n),t=2*ct,r=e>0,i=nn(e)>wt;function s(p,g,b,x){I9(x,n,t,b,p,g)}function o(p,g){return dt(p)*dt(g)>e}function a(p){var g,b,x,T,S;return{lineStart:function(){T=x=!1,S=1},point:function(E,C){var P=[E,C],D,L=o(E,C),k=r?L?0:f(E,C):L?f(E+(E<0?Bt:-Bt),C):0;if(!g&&(T=x=L)&&p.lineStart(),L!==x&&(D=c(g,P),(!D||E0(g,D)||E0(P,D))&&(P[2]=1)),L!==x)S=0,L?(p.lineStart(),D=c(P,g),p.point(D[0],D[1])):(D=c(g,P),p.point(D[0],D[1],2),p.lineEnd()),g=D;else if(i&&g&&r^L){var q;!(k&b)&&(q=c(P,g,!0))&&(S=0,r?(p.lineStart(),p.point(q[0][0],q[0][1]),p.point(q[1][0],q[1][1]),p.lineEnd()):(p.point(q[1][0],q[1][1]),p.lineEnd(),p.lineStart(),p.point(q[0][0],q[0][1],3)))}L&&(!g||!E0(g,P))&&p.point(P[0],P[1]),g=P,x=L,b=k},lineEnd:function(){x&&p.lineEnd(),g=null},clean:function(){return S|(T&&x)<<1}}}function c(p,g,b){var x=$a(p),T=$a(g),S=[1,0,0],E=eu(x,T),C=Sc(E,E),P=E[0],D=C-P*P;if(!D)return!b&&p;var L=e*C/D,k=-e*P/D,q=eu(S,E),I=Ec(S,L),U=Ec(E,k);kd(I,U);var j=q,J=Sc(I,j),Q=Sc(j,j),K=J*J-Q*(Sc(I,I)-1);if(!(K<0)){var te=io(K),oe=Ec(j,(-J-te)/Q);if(kd(oe,I),oe=lh(oe),!b)return oe;var Y=p[0],ae=g[0],he=p[1],xe=g[1],me;ae<Y&&(me=Y,Y=ae,ae=me);var Oe=ae-Y,ke=nn(Oe-Bt)<wt,Ke=ke||Oe<wt;if(!ke&&xe<he&&(me=he,he=xe,xe=me),Ke?ke?he+xe>0^oe[1]<(nn(oe[0]-Y)<wt?he:xe):he<=oe[1]&&oe[1]<=xe:Oe>Bt^(Y<=oe[0]&&oe[0]<=ae)){var Ye=Ec(j,(-J+te)/Q);return kd(Ye,I),[oe,lh(Ye)]}}}function f(p,g){var b=r?n:Bt-n,x=0;return p<-b?x|=1:p>b&&(x|=2),g<-b?x|=4:g>b&&(x|=8),x}return E4(o,a,s,r?[0,-n]:[-Bt,n-Bt])}function j9(n,e,t,r,i,s){var o=n[0],a=n[1],c=e[0],f=e[1],p=0,g=1,b=c-o,x=f-a,T;if(T=t-o,!(!b&&T>0)){if(T/=b,b<0){if(T<p)return;T<g&&(g=T)}else if(b>0){if(T>g)return;T>p&&(p=T)}if(T=i-o,!(!b&&T<0)){if(T/=b,b<0){if(T>g)return;T>p&&(p=T)}else if(b>0){if(T<p)return;T<g&&(g=T)}if(T=r-a,!(!x&&T>0)){if(T/=x,x<0){if(T<p)return;T<g&&(g=T)}else if(x>0){if(T>g)return;T>p&&(p=T)}if(T=s-a,!(!x&&T<0)){if(T/=x,x<0){if(T>g)return;T>p&&(p=T)}else if(x>0){if(T<p)return;T<g&&(g=T)}return p>0&&(n[0]=o+p*b,n[1]=a+p*x),g<1&&(e[0]=o+g*b,e[1]=a+g*x),!0}}}}}var Ju=1e9,Nc=-Ju;function $9(n,e,t,r){function i(f,p){return n<=f&&f<=t&&e<=p&&p<=r}function s(f,p,g,b){var x=0,T=0;if(f==null||(x=o(f,g))!==(T=o(p,g))||c(f,p)<0^g>0)do b.point(x===0||x===3?n:t,x>1?r:e);while((x=(x+g+4)%4)!==T);else b.point(p[0],p[1])}function o(f,p){return nn(f[0]-n)<wt?p>0?0:3:nn(f[0]-t)<wt?p>0?2:1:nn(f[1]-e)<wt?p>0?1:0:p>0?3:2}function a(f,p){return c(f.x,p.x)}function c(f,p){var g=o(f,1),b=o(p,1);return g!==b?g-b:g===0?p[1]-f[1]:g===1?f[0]-p[0]:g===2?f[1]-p[1]:p[0]-f[0]}return function(f){var p=f,g=T4(),b,x,T,S,E,C,P,D,L,k,q,I={point:U,lineStart:K,lineEnd:te,polygonStart:J,polygonEnd:Q};function U(Y,ae){i(Y,ae)&&p.point(Y,ae)}function j(){for(var Y=0,ae=0,he=x.length;ae<he;++ae)for(var xe=x[ae],me=1,Oe=xe.length,ke=xe[0],Ke,Ye,Ft=ke[0],mt=ke[1];me<Oe;++me)Ke=Ft,Ye=mt,ke=xe[me],Ft=ke[0],mt=ke[1],Ye<=r?mt>r&&(Ft-Ke)*(r-Ye)>(mt-Ye)*(n-Ke)&&++Y:mt<=r&&(Ft-Ke)*(r-Ye)<(mt-Ye)*(n-Ke)&&--Y;return Y}function J(){p=g,b=[],x=[],q=!0}function Q(){var Y=j(),ae=q&&Y,he=(b=SA(b)).length;(ae||he)&&(f.polygonStart(),ae&&(f.lineStart(),s(null,null,1,f),f.lineEnd()),he&&w4(b,a,Y,s,f),f.polygonEnd()),p=f,b=x=T=null}function K(){I.point=oe,x&&x.push(T=[]),k=!0,L=!1,P=D=NaN}function te(){b&&(oe(S,E),C&&L&&g.rejoin(),b.push(g.result())),I.point=U,L&&p.lineEnd()}function oe(Y,ae){var he=i(Y,ae);if(x&&T.push([Y,ae]),k)S=Y,E=ae,C=he,k=!1,he&&(p.lineStart(),p.point(Y,ae));else if(he&&L)p.point(Y,ae);else{var xe=[P=Math.max(Nc,Math.min(Ju,P)),D=Math.max(Nc,Math.min(Ju,D))],me=[Y=Math.max(Nc,Math.min(Ju,Y)),ae=Math.max(Nc,Math.min(Ju,ae))];j9(xe,me,n,e,t,r)?(L||(p.lineStart(),p.point(xe[0],xe[1])),p.point(me[0],me[1]),he||p.lineEnd(),q=!1):he&&(p.lineStart(),p.point(Y,ae),q=!1)}P=Y,D=ae,L=he}return I}}var Dm,Lm,R0,N0,tu={sphere:pr,point:pr,lineStart:H9,lineEnd:pr,polygonStart:pr,polygonEnd:pr};function H9(){tu.point=Q9,tu.lineEnd=W9}function W9(){tu.point=tu.lineEnd=pr}function Q9(n,e){n*=ct,e*=ct,Lm=n,R0=at(e),N0=dt(e),tu.point=X9}function X9(n,e){n*=ct,e*=ct;var t=at(e),r=dt(e),i=nn(n-Lm),s=dt(i),o=at(i),a=r*o,c=N0*t-R0*r*s,f=R0*t+N0*r*s;Dm.add(Si(io(a*a+c*c),f)),Lm=n,R0=t,N0=r}function Y9(n){return Dm=new Ys,uf(n,tu),+Dm}var Om=[null,null],K9={type:"LineString",coordinates:Om};function Qo(n,e){return Om[0]=n,Om[1]=e,Y9(K9)}var h3={Feature:function(n,e){return gh(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)if(gh(t[r].geometry,e))return!0;return!1}},f3={Sphere:function(){return!0},Point:function(n,e){return d3(n.coordinates,e)},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(d3(t[r],e))return!0;return!1},LineString:function(n,e){return p3(n.coordinates,e)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(p3(t[r],e))return!0;return!1},Polygon:function(n,e){return m3(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(m3(t[r],e))return!0;return!1},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)if(gh(t[r],e))return!0;return!1}};function gh(n,e){return n&&f3.hasOwnProperty(n.type)?f3[n.type](n,e):!1}function d3(n,e){return Qo(n,e)===0}function p3(n,e){for(var t,r,i,s=0,o=n.length;s<o;s++){if(r=Qo(n[s],e),r===0||s>0&&(i=Qo(n[s],n[s-1]),i>0&&t<=i&&r<=i&&(t+r-i)*(1-Math.pow((t-r)/i,2))<ih*i))return!0;t=r}return!1}function m3(n,e){return!!S4(n.map(Z9),R4(e))}function Z9(n){return n=n.map(R4),n.pop(),n}function R4(n){return[n[0]*ct,n[1]*ct]}function J9(n,e){return(n&&h3.hasOwnProperty(n.type)?h3[n.type]:gh)(n,e)}function g3(n,e,t){var r=Ll(n,e-wt,t).concat(e);return function(i){return r.map(function(s){return[i,s]})}}function y3(n,e,t){var r=Ll(n,e-wt,t).concat(e);return function(i){return r.map(function(s){return[s,i]})}}function eP(){var n,e,t,r,i,s,o,a,c=10,f=c,p=90,g=360,b,x,T,S,E=2.5;function C(){return{type:"MultiLineString",coordinates:P()}}function P(){return Ll(wc(r/p)*p,t,p).map(T).concat(Ll(wc(a/g)*g,o,g).map(S)).concat(Ll(wc(e/c)*c,n,c).filter(function(D){return nn(D%p)>wt}).map(b)).concat(Ll(wc(s/f)*f,i,f).filter(function(D){return nn(D%g)>wt}).map(x))}return C.lines=function(){return P().map(function(D){return{type:"LineString",coordinates:D}})},C.outline=function(){return{type:"Polygon",coordinates:[T(r).concat(S(o).slice(1),T(t).reverse().slice(1),S(a).reverse().slice(1))]}},C.extent=function(D){return arguments.length?C.extentMajor(D).extentMinor(D):C.extentMinor()},C.extentMajor=function(D){return arguments.length?(r=+D[0][0],t=+D[1][0],a=+D[0][1],o=+D[1][1],r>t&&(D=r,r=t,t=D),a>o&&(D=a,a=o,o=D),C.precision(E)):[[r,a],[t,o]]},C.extentMinor=function(D){return arguments.length?(e=+D[0][0],n=+D[1][0],s=+D[0][1],i=+D[1][1],e>n&&(D=e,e=n,n=D),s>i&&(D=s,s=i,i=D),C.precision(E)):[[e,s],[n,i]]},C.step=function(D){return arguments.length?C.stepMajor(D).stepMinor(D):C.stepMinor()},C.stepMajor=function(D){return arguments.length?(p=+D[0],g=+D[1],C):[p,g]},C.stepMinor=function(D){return arguments.length?(c=+D[0],f=+D[1],C):[c,f]},C.precision=function(D){return arguments.length?(E=+D,b=g3(s,i,90),x=y3(e,n,E),T=g3(a,o,90),S=y3(r,t,E),C):E},C.extentMajor([[-180,-90+wt],[180,90-wt]]).extentMinor([[-180,-80-wt],[180,80+wt]])}function tP(){return eP()()}function f1(n,e){var t=n[0]*ct,r=n[1]*ct,i=e[0]*ct,s=e[1]*ct,o=dt(r),a=at(r),c=dt(s),f=at(s),p=o*dt(t),g=o*at(t),b=c*dt(i),x=c*at(i),T=2*so(io(X_(s-r)+o*c*X_(i-t))),S=at(T),E=T?function(C){var P=at(C*=T)/S,D=at(T-C)/S,L=D*p+P*b,k=D*g+P*x,q=D*a+P*f;return[Si(k,L)*Cn,Si(q,io(L*L+k*k))*Cn]}:function(){return[t*Cn,r*Cn]};return E.distance=T,E}const _3=n=>n;var nu=1/0,yh=nu,CA=-nu,_h=CA,b3={point:nP,lineStart:pr,lineEnd:pr,polygonStart:pr,polygonEnd:pr,result:function(){var n=[[nu,yh],[CA,_h]];return CA=_h=-(yh=nu=1/0),n}};function nP(n,e){n<nu&&(nu=n),n>CA&&(CA=n),e<yh&&(yh=e),e>_h&&(_h=e)}function d1(n){return function(e){var t=new Fm;for(var r in n)t[r]=n[r];return t.stream=e,t}}function Fm(){}Fm.prototype={constructor:Fm,point:function(n,e){this.stream.point(n,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function p1(n,e,t){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),r!=null&&n.clipExtent(null),uf(t,n.stream(b3)),e(b3.result()),r!=null&&n.clipExtent(r),n}function N4(n,e,t){return p1(n,function(r){var i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+e[0][0]+(i-o*(r[1][0]+r[0][0]))/2,c=+e[0][1]+(s-o*(r[1][1]+r[0][1]))/2;n.scale(150*o).translate([a,c])},t)}function rP(n,e,t){return N4(n,[[0,0],e],t)}function iP(n,e,t){return p1(n,function(r){var i=+e,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];n.scale(150*s).translate([o,a])},t)}function sP(n,e,t){return p1(n,function(r){var i=+e,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;n.scale(150*s).translate([o,a])},t)}var v3=16,oP=dt(30*ct);function x3(n,e){return+e?lP(n,e):aP(n)}function aP(n){return d1({point:function(e,t){e=n(e,t),this.stream.point(e[0],e[1])}})}function lP(n,e){function t(r,i,s,o,a,c,f,p,g,b,x,T,S,E){var C=f-r,P=p-i,D=C*C+P*P;if(D>4*e&&S--){var L=o+b,k=a+x,q=c+T,I=io(L*L+k*k+q*q),U=so(q/=I),j=nn(nn(q)-1)<wt||nn(s-g)<wt?(s+g)/2:Si(k,L),J=n(j,U),Q=J[0],K=J[1],te=Q-r,oe=K-i,Y=P*te-C*oe;(Y*Y/D>e||nn((C*te+P*oe)/D-.5)>.3||o*b+a*x+c*T<oP)&&(t(r,i,s,o,a,c,Q,K,j,L/=I,k/=I,q,S,E),E.point(Q,K),t(Q,K,j,L,k,q,f,p,g,b,x,T,S,E))}}return function(r){var i,s,o,a,c,f,p,g,b,x,T,S,E={point:C,lineStart:P,lineEnd:L,polygonStart:function(){r.polygonStart(),E.lineStart=k},polygonEnd:function(){r.polygonEnd(),E.lineStart=P}};function C(U,j){U=n(U,j),r.point(U[0],U[1])}function P(){g=NaN,E.point=D,r.lineStart()}function D(U,j){var J=$a([U,j]),Q=n(U,j);t(g,b,p,x,T,S,g=Q[0],b=Q[1],p=U,x=J[0],T=J[1],S=J[2],v3,r),r.point(g,b)}function L(){E.point=C,r.lineEnd()}function k(){P(),E.point=q,E.lineEnd=I}function q(U,j){D(i=U,j),s=g,o=b,a=x,c=T,f=S,E.point=D}function I(){t(g,b,p,x,T,S,s,o,i,a,c,f,v3,r),E.lineEnd=L,L()}return E}}var uP=d1({point:function(n,e){this.stream.point(n*ct,e*ct)}});function AP(n){return d1({point:function(e,t){var r=n(e,t);return this.stream.point(r[0],r[1])}})}function cP(n,e,t,r,i){function s(o,a){return o*=r,a*=i,[e+n*o,t-n*a]}return s.invert=function(o,a){return[(o-e)/n*r,(t-a)/n*i]},s}function T3(n,e,t,r,i,s){if(!s)return cP(n,e,t,r,i);var o=dt(s),a=at(s),c=o*n,f=a*n,p=o/n,g=a/n,b=(a*t-o*e)/n,x=(a*e+o*t)/n;function T(S,E){return S*=r,E*=i,[c*S-f*E+e,t-f*S-c*E]}return T.invert=function(S,E){return[r*(p*S-g*E+b),i*(x-g*S-p*E)]},T}function hP(n){return fP(function(){return n})()}function fP(n){var e,t=150,r=480,i=250,s=0,o=0,a=0,c=0,f=0,p,g=0,b=1,x=1,T=null,S=c3,E=null,C,P,D,L=_3,k=.5,q,I,U,j,J;function Q(Y){return U(Y[0]*ct,Y[1]*ct)}function K(Y){return Y=U.invert(Y[0],Y[1]),Y&&[Y[0]*Cn,Y[1]*Cn]}Q.stream=function(Y){return j&&J===Y?j:j=uP(AP(p)(S(q(L(J=Y)))))},Q.preclip=function(Y){return arguments.length?(S=Y,T=void 0,oe()):S},Q.postclip=function(Y){return arguments.length?(L=Y,E=C=P=D=null,oe()):L},Q.clipAngle=function(Y){return arguments.length?(S=+Y?z9(T=Y*ct):(T=null,c3),oe()):T*Cn},Q.clipExtent=function(Y){return arguments.length?(L=Y==null?(E=C=P=D=null,_3):$9(E=+Y[0][0],C=+Y[0][1],P=+Y[1][0],D=+Y[1][1]),oe()):E==null?null:[[E,C],[P,D]]},Q.scale=function(Y){return arguments.length?(t=+Y,te()):t},Q.translate=function(Y){return arguments.length?(r=+Y[0],i=+Y[1],te()):[r,i]},Q.center=function(Y){return arguments.length?(s=Y[0]%360*ct,o=Y[1]%360*ct,te()):[s*Cn,o*Cn]},Q.rotate=function(Y){return arguments.length?(a=Y[0]%360*ct,c=Y[1]%360*ct,f=Y.length>2?Y[2]%360*ct:0,te()):[a*Cn,c*Cn,f*Cn]},Q.angle=function(Y){return arguments.length?(g=Y%360*ct,te()):g*Cn},Q.reflectX=function(Y){return arguments.length?(b=Y?-1:1,te()):b<0},Q.reflectY=function(Y){return arguments.length?(x=Y?-1:1,te()):x<0},Q.precision=function(Y){return arguments.length?(q=x3(I,k=Y*Y),oe()):io(k)},Q.fitExtent=function(Y,ae){return N4(Q,Y,ae)},Q.fitSize=function(Y,ae){return rP(Q,Y,ae)},Q.fitWidth=function(Y,ae){return iP(Q,Y,ae)},Q.fitHeight=function(Y,ae){return sP(Q,Y,ae)};function te(){var Y=T3(t,0,0,b,x,g).apply(null,e(s,o)),ae=T3(t,r-Y[0],i-Y[1],b,x,g);return p=x4(a,c,f),I=Pm(e,ae),U=Pm(p,I),q=x3(I,k),oe()}function oe(){return j=J=null,Q}return function(){return e=n.apply(this,arguments),Q.invert=e.invert&&K,te()}}function dP(n){return function(e,t){var r=io(e*e+t*t),i=n(r),s=at(i),o=dt(i);return[Si(e*s,r*o),so(r&&t*s/r)]}}function m1(n,e){return[n,v9(T9((kr+e)/2))]}m1.invert=function(n,e){return[n,2*c1(b9(e))-kr]};function C4(n,e){var t=dt(e),r=1+dt(n)*t;return[t*at(n)/r,at(e)/r]}C4.invert=dP(function(n){return 2*c1(n)});function pP(){return hP(C4).scale(250).clipAngle(142)}function Im(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function mP(n){if(Array.isArray(n))return n}function gP(n){if(Array.isArray(n))return Im(n)}function cA(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function yP(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _P(n,e,t){return e=bh(e),CP(n,P4()?Reflect.construct(e,[],bh(n).constructor):e.apply(n,t))}function M4(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bP(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(n,e){return n.get(cA(n,e))}function To(n,e,t){M4(n,e),e.set(n,t)}function wo(n,e,t){return n.set(cA(n,e),t),t}function vP(n,e){M4(n,e),e.add(n)}function xP(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,D4(r.key),r)}}function TP(n,e,t){return e&&xP(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function cl(n,e,t){return(e=D4(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function bh(n){return bh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bh(n)}function wP(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&km(n,e)}function P4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(P4=function(){return!!n})()}function SP(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function EP(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function RP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NP(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CP(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yP(n)}function km(n,e){return km=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},km(n,e)}function C0(n,e){return mP(n)||EP(n,e)||L4(n,e)||RP()}function B4(n){return gP(n)||SP(n)||L4(n)||NP()}function MP(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function D4(n){var e=MP(n,"string");return typeof e=="symbol"?e:e+""}function L4(n,e){if(n){if(typeof n=="string")return Im(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Im(n,e):void 0}}var O4=function(e){e instanceof Array?e.forEach(O4):(e.map&&e.map.dispose(),e.dispose())},F4=function(e){e.geometry&&e.geometry.dispose(),e.material&&O4(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(F4)},w3=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),F4(t)}};function I4(n,e,t){var r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return{x:t*Math.sin(r)*Math.cos(i),y:t*Math.cos(r),z:t*Math.sin(r)*Math.sin(i)}}function PP(n){var e=n.x,t=n.y,r=n.z,i=Math.sqrt(e*e+t*t+r*r),s=Math.acos(t/i),o=Math.atan2(r,e);return{lat:90-s*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),r:i}}function fa(n){return n*Math.PI/180}var k4=function(e){return 1-(m1(0,(.5-e)*Math.PI)[1]/Math.PI+1)/2},qd=function(e){return Math.max(0,Math.min(1,k4(e)))},S3=function(e){return .5-m1.invert(0,(2*(1-e)-1)*Math.PI)[1]/Math.PI},BP=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=ro().domain([1,0]).range([t,r]).clamp(!0),s=ro().domain([qd(t),qd(r)]).range([1,0]).clamp(!0),o=function(g){return s(qd(i(g)))},a=e.array,c=0,f=a.length;c<f;c+=2)a[c+1]=o(a[c+1]);e.needsUpdate=!0},E3=function(e,t,r,i){var s=Math.pow(2,e),o=Math.max(0,Math.min(s-1,Math.floor((r+180)*s/360))),a=(90-i)/180;t&&(a=Math.max(0,Math.min(1,k4(a))));var c=Math.floor(a*s);return[o,c]},Um=function(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=[],c=Math.pow(2,e),f=360/c,p=180/c,g=s===void 0?c-1:s,b=o===void 0?c-1:o,x=r,T=Math.min(c-1,g);x<=T;x++)for(var S=i,E=Math.min(c-1,b);S<=E;S++){var C=S,P=p;if(t){C=S===0?S:S3(S/c)*c;var D=S+1===c?S+1:S3((S+1)/c)*c;P=(D-C)*180/c}var L=-180+(x+.5)*f,k=90-(C*180/c+P/2),q=P;a.push({x,y:S,lng:L,lat:k,latLen:q})}return a},DP=6,LP=7,OP=3,FP=90,hs=new WeakMap,Lo=new WeakMap,Gd=new WeakMap,Cc=new WeakMap,fi=new WeakMap,vh=new WeakMap,Vl=new WeakMap,da=new WeakMap,Mc=new WeakSet,IP=function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.tileUrl,o=i.minLevel,a=o===void 0?0:o,c=i.maxLevel,f=c===void 0?17:c,p=i.mercatorProjection,g=p===void 0?!0:p;return bP(this,e),r=_P(this,e),vP(r,Mc),To(r,hs,void 0),To(r,Lo,void 0),To(r,Gd,void 0),To(r,Cc,void 0),To(r,fi,{}),To(r,vh,void 0),To(r,Vl,void 0),To(r,da,void 0),cl(r,"minLevel",void 0),cl(r,"maxLevel",void 0),cl(r,"thresholds",B4(new Array(30)).map(function(b,x){return 8/Math.pow(2,x)})),cl(r,"curvatureResolution",5),cl(r,"tileMargin",0),cl(r,"clearTiles",function(){Object.values(vt(fi,r)).forEach(function(b){b.forEach(function(x){x.obj&&(r.remove(x.obj),w3(x.obj),delete x.obj)})}),wo(fi,r,{})}),wo(hs,r,t),r.tileUrl=s,wo(Lo,r,g),r.minLevel=a,r.maxLevel=f,r.level=0,r.add(wo(da,r,new gn(new Zo(vt(hs,r)*.99,180,90),new ds({color:0})))),vt(da,r).visible=!1,vt(da,r).material.polygonOffset=!0,vt(da,r).material.polygonOffsetUnits=3,vt(da,r).material.polygonOffsetFactor=1,r}return wP(e,n),TP(e,[{key:"tileUrl",get:function(){return vt(Gd,this)},set:function(r){wo(Gd,this,r),this.updatePov(vt(Vl,this))}},{key:"level",get:function(){return vt(Cc,this)},set:function(r){var i,s=this;vt(fi,this)[r]||cA(Mc,this,kP).call(this,r);var o=vt(Cc,this);if(wo(Cc,this,r),!(r===o||o===void 0)){if(vt(da,this).visible=r>0,vt(fi,this)[r].forEach(function(c){return c.obj&&(c.obj.material.depthWrite=!0)}),o<r&&((i=vt(fi,this)[o])===null||i===void 0||i.forEach(function(c){return c.obj&&(c.obj.material.depthWrite=!1)})),o>r)for(var a=r+1;a<=o;a++)vt(fi,this)[a]&&vt(fi,this)[a].forEach(function(c){c.obj&&(s.remove(c.obj),w3(c.obj),delete c.obj)});cA(Mc,this,R3).call(this)}}},{key:"updatePov",value:function(r){var i=this;if(!(!r||!(r instanceof Ug))){wo(Vl,this,r);var s;if(wo(vh,this,function(p){if(!p.hullPnts){var g=360/Math.pow(2,i.level),b=p.lng,x=p.lat,T=p.latLen,S=b-g/2,E=b+g/2,C=x-T/2,P=x+T/2;p.hullPnts=[[x,b],[C,S],[P,S],[C,E],[P,E]].map(function(D){var L=C0(D,2),k=L[0],q=L[1];return I4(k,q,vt(hs,i))}).map(function(D){var L=D.x,k=D.y,q=D.z;return new ge(L,k,q)})}return s||(s=new Jv,r.updateMatrix(),r.updateMatrixWorld(),s.setFromProjectionMatrix(new dn().multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse))),p.hullPnts.some(function(D){return s.containsPoint(D.clone().applyMatrix4(i.matrixWorld))})}),this.tileUrl){var o=r.position.clone(),a=o.distanceTo(this.getWorldPosition(new ge)),c=(a-vt(hs,this))/vt(hs,this),f=this.thresholds.findIndex(function(p){return p&&p<=c});this.level=Math.min(this.maxLevel,Math.max(this.minLevel,f<0?this.thresholds.length:f)),cA(Mc,this,R3).call(this)}}}}])}(Ls);function kP(n){var e=this;if(n>LP){vt(fi,this)[n]=[];return}var t=vt(fi,this)[n]=Um(n,vt(Lo,this));t.forEach(function(r){return r.centroid=I4(r.lat,r.lng,vt(hs,e))}),t.octree=Yx().x(function(r){return r.centroid.x}).y(function(r){return r.centroid.y}).z(function(r){return r.centroid.z}).addAll(t)}function R3(){var n=this;if(!(!this.tileUrl||this.level===void 0||!vt(fi,this).hasOwnProperty(this.level))&&!(!vt(vh,this)&&this.level>DP)){var e=vt(fi,this)[this.level];if(vt(Vl,this)){var t=this.worldToLocal(vt(Vl,this).position.clone());if(e.octree){var r,i=this.worldToLocal(vt(Vl,this).position.clone()),s=(i.length()-vt(hs,this))*OP;e=(r=e.octree).findAllWithinRadius.apply(r,B4(i).concat([s]))}else{var o=PP(t),a=(o.r/vt(hs,this)-1)*FP,c=a/Math.cos(fa(o.lat)),f=[o.lng-c,o.lng+c],p=[o.lat+a,o.lat-a],g=E3(this.level,vt(Lo,this),f[0],p[0]),b=C0(g,2),x=b[0],T=b[1],S=E3(this.level,vt(Lo,this),f[1],p[1]),E=C0(S,2),C=E[0],P=E[1];!e.record&&(e.record={});var D=e.record;if(!D.hasOwnProperty("".concat(Math.round((x+C)/2),"_").concat(Math.round((T+P)/2))))e=Um(this.level,vt(Lo,this),x,T,C,P).map(function(U){var j="".concat(U.x,"_").concat(U.y);return D.hasOwnProperty(j)?D[j]:(D[j]=U,e.push(U),U)});else{for(var L=[],k=x;k<=C;k++)for(var q=T;q<=P;q++){var I="".concat(k,"_").concat(q);D.hasOwnProperty(I)||(D[I]=Um(this.level,vt(Lo,this),k,q,k,q)[0],e.push(D[I])),L.push(D[I])}e=L}}}e.filter(function(U){return!U.obj}).filter(vt(vh,this)||function(){return!0}).forEach(function(U){var j=U.x,J=U.y,Q=U.lng,K=U.lat,te=U.latLen,oe=360/Math.pow(2,n.level);if(!U.obj){var Y=oe*(1-n.tileMargin),ae=te*(1-n.tileMargin),he=fa(Q),xe=fa(-K),me=new gn(new Zo(vt(hs,n),Math.ceil(Y/n.curvatureResolution),Math.ceil(ae/n.curvatureResolution),fa(90-Y/2)+he,fa(Y),fa(90-ae/2)+xe,fa(ae)),new co);if(vt(Lo,n)){var Oe=[K+te/2,K-te/2].map(function(Ft){return .5-Ft/180}),ke=C0(Oe,2),Ke=ke[0],Ye=ke[1];BP(me.geometry.attributes.uv,Ke,Ye)}U.obj=me}U.loading||(U.loading=!0,new qg().load(n.tileUrl(j,J,n.level),function(Ft){var mt=U.obj;mt&&(Ft.colorSpace=HA,mt.material.map=Ft,mt.material.color=null,mt.material.needsUpdate=!0,n.add(mt)),U.loading=!1}))})}}function UP(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=U4(n,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,f;if(r&&(s=jP(n,e,s,t)),n.length>80*t){a=n[0],c=n[1];let p=a,g=c;for(let b=t;b<i;b+=t){const x=n[b],T=n[b+1];x<a&&(a=x),T<c&&(c=T),x>p&&(p=x),T>g&&(g=T)}f=Math.max(p-a,g-c),f=f!==0?32767/f:0}return MA(s,o,t,a,c,f,0),o}function U4(n,e,t,r,i){let s;if(i===tB(n,e,t,r)>0)for(let o=e;o<t;o+=r)s=N3(o/r|0,n[o],n[o+1],s);else for(let o=t-r;o>=e;o-=r)s=N3(o/r|0,n[o],n[o+1],s);return s&&ru(s,s.next)&&(BA(s),s=s.next),s}function Ha(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(ru(t,t.next)||En(t.prev,t,t.next)===0)){if(BA(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function MA(n,e,t,r,i,s,o){if(!n)return;!o&&s&&XP(n,r,i,s);let a=n;for(;n.prev!==n.next;){const c=n.prev,f=n.next;if(s?GP(n,r,i,s):qP(n)){e.push(c.i,n.i,f.i),BA(n),n=f.next,a=f.next;continue}if(n=f,n===a){o?o===1?(n=VP(Ha(n),e),MA(n,e,t,r,i,s,2)):o===2&&zP(n,e,t,r,i,s):MA(Ha(n),e,t,r,i,s,1);break}}}function qP(n){const e=n.prev,t=n,r=n.next;if(En(e,t,r)>=0)return!1;const i=e.x,s=t.x,o=r.x,a=e.y,c=t.y,f=r.y,p=Math.min(i,s,o),g=Math.min(a,c,f),b=Math.max(i,s,o),x=Math.max(a,c,f);let T=r.next;for(;T!==e;){if(T.x>=p&&T.x<=b&&T.y>=g&&T.y<=x&&eA(i,a,s,c,o,f,T.x,T.y)&&En(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function GP(n,e,t,r){const i=n.prev,s=n,o=n.next;if(En(i,s,o)>=0)return!1;const a=i.x,c=s.x,f=o.x,p=i.y,g=s.y,b=o.y,x=Math.min(a,c,f),T=Math.min(p,g,b),S=Math.max(a,c,f),E=Math.max(p,g,b),C=qm(x,T,e,t,r),P=qm(S,E,e,t,r);let D=n.prevZ,L=n.nextZ;for(;D&&D.z>=C&&L&&L.z<=P;){if(D.x>=x&&D.x<=S&&D.y>=T&&D.y<=E&&D!==i&&D!==o&&eA(a,p,c,g,f,b,D.x,D.y)&&En(D.prev,D,D.next)>=0||(D=D.prevZ,L.x>=x&&L.x<=S&&L.y>=T&&L.y<=E&&L!==i&&L!==o&&eA(a,p,c,g,f,b,L.x,L.y)&&En(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;D&&D.z>=C;){if(D.x>=x&&D.x<=S&&D.y>=T&&D.y<=E&&D!==i&&D!==o&&eA(a,p,c,g,f,b,D.x,D.y)&&En(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;L&&L.z<=P;){if(L.x>=x&&L.x<=S&&L.y>=T&&L.y<=E&&L!==i&&L!==o&&eA(a,p,c,g,f,b,L.x,L.y)&&En(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function VP(n,e){let t=n;do{const r=t.prev,i=t.next.next;!ru(r,i)&&G4(r,t,t.next,i)&&PA(r,i)&&PA(i,r)&&(e.push(r.i,t.i,i.i),BA(t),BA(t.next),t=n=i),t=t.next}while(t!==n);return Ha(t)}function zP(n,e,t,r,i,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&ZP(o,a)){let c=V4(o,a);o=Ha(o,o.next),c=Ha(c,c.next),MA(o,e,t,r,i,s,0),MA(c,e,t,r,i,s,0);return}a=a.next}o=o.next}while(o!==n)}function jP(n,e,t,r){const i=[];for(let s=0,o=e.length;s<o;s++){const a=e[s]*r,c=s<o-1?e[s+1]*r:n.length,f=U4(n,a,c,r,!1);f===f.next&&(f.steiner=!0),i.push(KP(f))}i.sort($P);for(let s=0;s<i.length;s++)t=HP(i[s],t);return t}function $P(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const r=(n.next.y-n.y)/(n.next.x-n.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=r-i}return t}function HP(n,e){const t=WP(n,e);if(!t)return e;const r=V4(t,n);return Ha(r,r.next),Ha(t,t.next)}function WP(n,e){let t=e;const r=n.x,i=n.y;let s=-1/0,o;if(ru(n,t))return t;do{if(ru(n,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const g=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(g<=r&&g>s&&(s=g,o=t.x<t.next.x?t:t.next,g===r))return o}t=t.next}while(t!==e);if(!o)return null;const a=o,c=o.x,f=o.y;let p=1/0;t=o;do{if(r>=t.x&&t.x>=c&&r!==t.x&&q4(i<f?r:s,i,c,f,i<f?s:r,i,t.x,t.y)){const g=Math.abs(i-t.y)/(r-t.x);PA(t,n)&&(g<p||g===p&&(t.x>o.x||t.x===o.x&&QP(o,t)))&&(o=t,p=g)}t=t.next}while(t!==a);return o}function QP(n,e){return En(n.prev,n,e.prev)<0&&En(e.next,n,n.next)<0}function XP(n,e,t,r){let i=n;do i.z===0&&(i.z=qm(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,YP(i)}function YP(n){let e,t=1;do{let r=n,i;n=null;let s=null;for(e=0;r;){e++;let o=r,a=0;for(let f=0;f<t&&(a++,o=o.nextZ,!!o);f++);let c=t;for(;a>0||c>0&&o;)a!==0&&(c===0||!o||r.z<=o.z)?(i=r,r=r.nextZ,a--):(i=o,o=o.nextZ,c--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;r=o}s.nextZ=null,t*=2}while(e>1);return n}function qm(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function KP(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function q4(n,e,t,r,i,s,o,a){return(i-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(r-a)}function eA(n,e,t,r,i,s,o,a){return!(n===o&&e===a)&&q4(n,e,t,r,i,s,o,a)}function ZP(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!JP(n,e)&&(PA(n,e)&&PA(e,n)&&eB(n,e)&&(En(n.prev,n,e.prev)||En(n,e.prev,e))||ru(n,e)&&En(n.prev,n,n.next)>0&&En(e.prev,e,e.next)>0)}function En(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function ru(n,e){return n.x===e.x&&n.y===e.y}function G4(n,e,t,r){const i=Bc(En(n,e,t)),s=Bc(En(n,e,r)),o=Bc(En(t,r,n)),a=Bc(En(t,r,e));return!!(i!==s&&o!==a||i===0&&Pc(n,t,e)||s===0&&Pc(n,r,e)||o===0&&Pc(t,n,r)||a===0&&Pc(t,e,r))}function Pc(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Bc(n){return n>0?1:n<0?-1:0}function JP(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&G4(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function PA(n,e){return En(n.prev,n,n.next)<0?En(n,e,n.next)>=0&&En(n,n.prev,e)>=0:En(n,e,n.prev)<0||En(n,n.next,e)<0}function eB(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function V4(n,e){const t=Gm(n.i,n.x,n.y),r=Gm(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function N3(n,e,t,r){const i=Gm(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function BA(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Gm(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function tB(n,e,t,r){let i=0;for(let s=e,o=t-r;s<t;s+=r)i+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return i}function xh(n){const e=[],t=[],r=n[0][0].length;let i=0,s=0;for(const o of n){for(const a of o)for(let c=0;c<r;c++)e.push(a[c]);s&&(i+=s,t.push(i)),s=o.length}return{vertices:e,holes:t,dimensions:r}}function Vm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function nB(n){if(Array.isArray(n))return n}function rB(n){if(Array.isArray(n))return Vm(n)}function iB(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function sB(n,e,t){return e=Th(e),dB(n,z4()?Reflect.construct(e,[],Th(n).constructor):e.apply(n,t))}function oB(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function aB(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function lB(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=g1(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){t=t.call(n)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||t.return==null||t.return()}finally{if(a)throw s}}}}function Th(n){return Th=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Th(n)}function uB(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&zm(n,e)}function z4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(z4=function(){return!!n})()}function AB(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function cB(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function hB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dB(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return iB(n)}function zm(n,e){return zm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},zm(n,e)}function Nu(n,e){return nB(n)||cB(n,e)||g1(n,e)||hB()}function pB(n){return rB(n)||AB(n)||g1(n)||fB()}function g1(n,e){if(n){if(typeof n=="string")return Vm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Vm(n,e):void 0}}var C3=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=[],i=null;return e.forEach(function(s){if(i){var o=Qo(s,i)*180/Math.PI;if(o>t)for(var a=f1(i,s),c=i.length>2||s.length>2?NA(i[2]||0,s[2]||0):null,f=c?function(b){return[].concat(pB(a(b)),[c(b)])}:a,p=1/Math.ceil(o/t),g=p;g<1;)r.push(f(g)),g+=p}r.push(i=s)}),r},jm=typeof window<"u"&&window.THREE?window.THREE:{BufferGeometry:$r,Float32BufferAttribute:Ns},mB=new jm.BufferGeometry().setAttribute?"setAttribute":"addAttribute",j4=function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5;oB(this,e),r=sB(this,e),r.type="GeoJsonGeometry",r.parameters={geoJson:t,radius:i,resolution:s};var o=({Point:p,MultiPoint:g,LineString:b,MultiLineString:x,Polygon:T,MultiPolygon:S}[t.type]||function(){return[]})(t.coordinates,i),a=[],c=[],f=0;o.forEach(function(E){var C=a.length;Cu({indices:a,vertices:c},E),r.addGroup(C,a.length-C,f++)}),a.length&&r.setIndex(a),c.length&&r[mB]("position",new jm.Float32BufferAttribute(c,3));function p(E,C){var P=Vd(E[1],E[0],C+(E[2]||0)),D=[];return[{vertices:P,indices:D}]}function g(E,C){var P={vertices:[],indices:[]};return E.map(function(D){return p(D,C)}).forEach(function(D){var L=Nu(D,1),k=L[0];Cu(P,k)}),[P]}function b(E,C){for(var P=C3(E,s).map(function(U){var j=Nu(U,3),J=j[0],Q=j[1],K=j[2],te=K===void 0?0:K;return Vd(Q,J,C+te)}),D=xh([P]),L=D.vertices,k=Math.round(L.length/3),q=[],I=1;I<k;I++)q.push(I-1,I);return[{vertices:L,indices:q}]}function x(E,C){var P={vertices:[],indices:[]};return E.map(function(D){return b(D,C)}).forEach(function(D){var L=Nu(D,1),k=L[0];Cu(P,k)}),[P]}function T(E,C){for(var P=E.map(function(Y){return C3(Y,s).map(function(ae){var he=Nu(ae,3),xe=he[0],me=he[1],Oe=he[2],ke=Oe===void 0?0:Oe;return Vd(me,xe,C+ke)})}),D=xh(P),L=D.vertices,k=D.holes,q=k[0]||1/0,I=L.slice(0,q*3),U=L.slice(q*3),j=new Set(k),J=Math.round(L.length/3),Q=[],K=[],te=1;te<J;te++)j.has(te)||(te<q?Q.push(te-1,te):K.push(te-1-q,te-q));var oe=[{indices:Q,vertices:I}];return k.length&&oe.push({indices:K,vertices:U}),oe}function S(E,C){var P={vertices:[],indices:[]},D={vertices:[],indices:[]};E.map(function(k){return T(k,C)}).forEach(function(k){var q=Nu(k,2),I=q[0],U=q[1];Cu(P,I),U&&Cu(D,U)});var L=[P];return D.vertices.length&&L.push(D),L}return r}return uB(e,n),aB(e)}(jm.BufferGeometry);function Cu(n,e){var t=Math.round(n.vertices.length/3);M3(n.vertices,e.vertices),M3(n.indices,e.indices.map(function(r){return r+t}))}function M3(n,e){var t=lB(e),r;try{for(t.s();!(r=t.n()).done;){var i=r.value;n.push(i)}}catch(s){t.e(s)}finally{t.f()}}function Vd(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return[t*Math.sin(r)*Math.cos(i),t*Math.cos(r),t*Math.sin(r)*Math.sin(i)]}function gB(n,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!n.hasAttribute("position")||!n.hasAttribute("normal")||!n.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(o){if(o.normalized||o.isInterleavedBufferAttribute){const a=new Float32Array(o.count*o.itemSize);for(let c=0,f=0;c<o.count;c++)a[f++]=o.getX(c),a[f++]=o.getY(c),o.itemSize>2&&(a[f++]=o.getZ(c));return a}return o.array instanceof Float32Array?o.array:new Float32Array(o.array)}const i=n.index?n.toNonIndexed():n,s=e.generateTangents(r(i.attributes.position),r(i.attributes.normal),r(i.attributes.uv));if(t)for(let o=3;o<s.length;o+=4)s[o]*=-1;return i.setAttribute("tangent",new Hi(s,4)),n!==i&&n.copy(i),n}function yB(n,e=!1){const t=n[0].index!==null,r=new Set(Object.keys(n[0].attributes)),i=new Set(Object.keys(n[0].morphAttributes)),s={},o={},a=n[0].morphTargetsRelative,c=new $r;let f=0;for(let p=0;p<n.length;++p){const g=n[p];let b=0;if(t!==(g.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const x in g.attributes){if(!r.has(x))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+'. All geometries must have compatible attributes; make sure "'+x+'" attribute exists among all geometries, or in none of them.'),null;s[x]===void 0&&(s[x]=[]),s[x].push(g.attributes[x]),b++}if(b!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". Make sure all geometries have the same number of attributes."),null;if(a!==g.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const x in g.morphAttributes){if(!i.has(x))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+".  .morphAttributes must be consistent throughout all geometries."),null;o[x]===void 0&&(o[x]=[]),o[x].push(g.morphAttributes[x])}if(e){let x;if(t)x=g.index.count;else if(g.attributes.position!==void 0)x=g.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". The geometry must have either an index or a position attribute"),null;c.addGroup(f,x,p),f+=x}}if(t){let p=0;const g=[];for(let b=0;b<n.length;++b){const x=n[b].index;for(let T=0;T<x.count;++T)g.push(x.getX(T)+p);p+=n[b].attributes.position.count}c.setIndex(g)}for(const p in s){const g=$m(s[p]);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" attribute."),null;c.setAttribute(p,g)}for(const p in o){const g=o[p][0].length;if(g===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[p]=[];for(let b=0;b<g;++b){const x=[];for(let S=0;S<o[p].length;++S)x.push(o[p][S][b]);const T=$m(x);if(!T)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" morphAttribute."),null;c.morphAttributes[p].push(T)}}return c}function $m(n){let e,t,r,i=-1,s=0;for(let f=0;f<n.length;++f){const p=n[f];if(e===void 0&&(e=p.array.constructor),e!==p.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=p.itemSize),t!==p.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=p.normalized),r!==p.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(i===-1&&(i=p.gpuType),i!==p.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=p.count*t}const o=new e(s),a=new Hi(o,t,r);let c=0;for(let f=0;f<n.length;++f){const p=n[f];if(p.isInterleavedBufferAttribute){const g=c/t;for(let b=0,x=p.count;b<x;b++)for(let T=0;T<t;T++){const S=p.getComponent(b,T);a.setComponent(b+g,T,S)}}else o.set(p.array,c);c+=p.count*t}return i!==void 0&&(a.gpuType=i),a}function _B(n){return n.isInstancedInterleavedBufferAttribute||n.isInterleavedBufferAttribute?wh(n):n.isInstancedBufferAttribute?new Vo().copy(n):new Hi().copy(n)}function bB(n){let e,t=0,r=0;for(let f=0,p=n.length;f<p;++f){const g=n[f];if(e===void 0&&(e=g.array.constructor),e!==g.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=g.array.length,r+=g.itemSize}const i=new ex(new e(t),r);let s=0;const o=[],a=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let f=0,p=n.length;f<p;f++){const g=n[f],b=g.itemSize,x=g.count,T=new Uo(i,b,s,g.normalized);o.push(T),s+=b;for(let S=0;S<x;S++)for(let E=0;E<b;E++)T[c[E]](S,g[a[E]](S))}return o}function wh(n){const e=n.data.array.constructor,t=n.count,r=n.itemSize,i=n.normalized,s=new e(t*r);let o;n.isInstancedInterleavedBufferAttribute?o=new Vo(s,r,i,n.meshPerAttribute):o=new Hi(s,r,i);for(let a=0;a<t;a++)o.setX(a,n.getX(a)),r>=2&&o.setY(a,n.getY(a)),r>=3&&o.setZ(a,n.getZ(a)),r>=4&&o.setW(a,n.getW(a));return o}function vB(n){const e=n.attributes,t=n.morphTargets,r=new Map;for(const i in e){const s=e[i];s.isInterleavedBufferAttribute&&(r.has(s)||r.set(s,wh(s)),e[i]=r.get(s))}for(const i in t){const s=t[i];s.isInterleavedBufferAttribute&&(r.has(s)||r.set(s,wh(s)),t[i]=r.get(s))}}function xB(n){let e=0;for(const r in n.attributes){const i=n.getAttribute(r);e+=i.count*i.itemSize*i.array.BYTES_PER_ELEMENT}const t=n.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function TB(n,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},r=n.getIndex(),i=n.getAttribute("position"),s=r?r.count:i.count;let o=0;const a=Object.keys(n.attributes),c={},f={},p=[],g=["getX","getY","getZ","getW"],b=["setX","setY","setZ","setW"];for(let P=0,D=a.length;P<D;P++){const L=a[P],k=n.attributes[L];c[L]=new k.constructor(new k.array.constructor(k.count*k.itemSize),k.itemSize,k.normalized);const q=n.morphAttributes[L];q&&(f[L]||(f[L]=[]),q.forEach((I,U)=>{const j=new I.array.constructor(I.count*I.itemSize);f[L][U]=new I.constructor(j,I.itemSize,I.normalized)}))}const x=e*.5,T=Math.log10(1/e),S=Math.pow(10,T),E=x*S;for(let P=0;P<s;P++){const D=r?r.getX(P):P;let L="";for(let k=0,q=a.length;k<q;k++){const I=a[k],U=n.getAttribute(I),j=U.itemSize;for(let J=0;J<j;J++)L+=`${~~(U[g[J]](D)*S+E)},`}if(L in t)p.push(t[L]);else{for(let k=0,q=a.length;k<q;k++){const I=a[k],U=n.getAttribute(I),j=n.morphAttributes[I],J=U.itemSize,Q=c[I],K=f[I];for(let te=0;te<J;te++){const oe=g[te],Y=b[te];if(Q[Y](o,U[oe](D)),j)for(let ae=0,he=j.length;ae<he;ae++)K[ae][Y](o,j[ae][oe](D))}}t[L]=o,p.push(o),o++}}const C=n.clone();for(const P in n.attributes){const D=c[P];if(C.setAttribute(P,new D.constructor(D.array.slice(0,o*D.itemSize),D.itemSize,D.normalized)),P in f)for(let L=0;L<f[P].length;L++){const k=f[P][L];C.morphAttributes[P][L]=new k.constructor(k.array.slice(0,o*k.itemSize),k.itemSize,k.normalized)}}return C.setIndex(p),C}function wB(n,e){if(e===wR)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===d_||e===SR){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=t.count-2,i=[];if(e===d_)for(let o=1;o<=r;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<r;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}function SB(n){const e=new ge,t=new ge,r=new ge,i=new ge,s=new ge,o=new ge,a=new ge,c=new ge,f=new ge;function p(me,Oe,ke,Ke,Ye,Ft,mt,Lt){e.fromBufferAttribute(Oe,Ye),t.fromBufferAttribute(Oe,Ft),r.fromBufferAttribute(Oe,mt);const Wt=me.morphTargetInfluences;if(ke&&Wt){a.set(0,0,0),c.set(0,0,0),f.set(0,0,0);for(let Pn=0,Vn=ke.length;Pn<Vn;Pn++){const vn=Wt[Pn],xn=ke[Pn];vn!==0&&(i.fromBufferAttribute(xn,Ye),s.fromBufferAttribute(xn,Ft),o.fromBufferAttribute(xn,mt),Ke?(a.addScaledVector(i,vn),c.addScaledVector(s,vn),f.addScaledVector(o,vn)):(a.addScaledVector(i.sub(e),vn),c.addScaledVector(s.sub(t),vn),f.addScaledVector(o.sub(r),vn)))}e.add(a),t.add(c),r.add(f)}me.isSkinnedMesh&&(me.applyBoneTransform(Ye,e),me.applyBoneTransform(Ft,t),me.applyBoneTransform(mt,r)),Lt[Ye*3+0]=e.x,Lt[Ye*3+1]=e.y,Lt[Ye*3+2]=e.z,Lt[Ft*3+0]=t.x,Lt[Ft*3+1]=t.y,Lt[Ft*3+2]=t.z,Lt[mt*3+0]=r.x,Lt[mt*3+1]=r.y,Lt[mt*3+2]=r.z}const g=n.geometry,b=n.material;let x,T,S;const E=g.index,C=g.attributes.position,P=g.morphAttributes.position,D=g.morphTargetsRelative,L=g.attributes.normal,k=g.morphAttributes.position,q=g.groups,I=g.drawRange;let U,j,J,Q,K,te,oe;const Y=new Float32Array(C.count*C.itemSize),ae=new Float32Array(L.count*L.itemSize);if(E!==null)if(Array.isArray(b))for(U=0,J=q.length;U<J;U++)for(K=q[U],te=Math.max(K.start,I.start),oe=Math.min(K.start+K.count,I.start+I.count),j=te,Q=oe;j<Q;j+=3)x=E.getX(j),T=E.getX(j+1),S=E.getX(j+2),p(n,C,P,D,x,T,S,Y),p(n,L,k,D,x,T,S,ae);else for(te=Math.max(0,I.start),oe=Math.min(E.count,I.start+I.count),U=te,J=oe;U<J;U+=3)x=E.getX(U),T=E.getX(U+1),S=E.getX(U+2),p(n,C,P,D,x,T,S,Y),p(n,L,k,D,x,T,S,ae);else if(Array.isArray(b))for(U=0,J=q.length;U<J;U++)for(K=q[U],te=Math.max(K.start,I.start),oe=Math.min(K.start+K.count,I.start+I.count),j=te,Q=oe;j<Q;j+=3)x=j,T=j+1,S=j+2,p(n,C,P,D,x,T,S,Y),p(n,L,k,D,x,T,S,ae);else for(te=Math.max(0,I.start),oe=Math.min(C.count,I.start+I.count),U=te,J=oe;U<J;U+=3)x=U,T=U+1,S=U+2,p(n,C,P,D,x,T,S,Y),p(n,L,k,D,x,T,S,ae);const he=new Ns(Y,3),xe=new Ns(ae,3);return{positionAttribute:C,normalAttribute:L,morphedPositionAttribute:he,morphedNormalAttribute:xe}}function EB(n){if(n.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),n;let e=n.groups;if(e=e.sort((o,a)=>o.materialIndex!==a.materialIndex?o.materialIndex-a.materialIndex:o.start-a.start),n.getIndex()===null){const o=n.getAttribute("position"),a=[];for(let c=0;c<o.count;c+=3)a.push(c,c+1,c+2);n.setIndex(a)}const t=n.getIndex(),r=[];for(let o=0;o<e.length;o++){const a=e[o],c=a.start,f=c+a.count;for(let p=c;p<f;p++)r.push(t.getX(p))}n.dispose(),n.setIndex(r);let i=0;for(let o=0;o<e.length;o++){const a=e[o];a.start=i,i+=a.count}let s=e[0];n.groups=[s];for(let o=1;o<e.length;o++){const a=e[o];s.materialIndex===a.materialIndex?s.count+=a.count:(s=a,n.groups.push(s))}return n}function RB(n,e=Math.PI/3){const t=Math.cos(e),r=(1+1e-10)*100,i=[new ge,new ge,new ge],s=new ge,o=new ge,a=new ge,c=new ge;function f(S){const E=~~(S.x*r),C=~~(S.y*r),P=~~(S.z*r);return`${E},${C},${P}`}const p=n.index?n.toNonIndexed():n,g=p.attributes.position,b={};for(let S=0,E=g.count/3;S<E;S++){const C=3*S,P=i[0].fromBufferAttribute(g,C+0),D=i[1].fromBufferAttribute(g,C+1),L=i[2].fromBufferAttribute(g,C+2);s.subVectors(L,D),o.subVectors(P,D);const k=new ge().crossVectors(s,o).normalize();for(let q=0;q<3;q++){const I=i[q],U=f(I);U in b||(b[U]=[]),b[U].push(k)}}const x=new Float32Array(g.count*3),T=new Hi(x,3,!1);for(let S=0,E=g.count/3;S<E;S++){const C=3*S,P=i[0].fromBufferAttribute(g,C+0),D=i[1].fromBufferAttribute(g,C+1),L=i[2].fromBufferAttribute(g,C+2);s.subVectors(L,D),o.subVectors(P,D),a.crossVectors(s,o).normalize();for(let k=0;k<3;k++){const q=i[k],I=f(q),U=b[I];c.set(0,0,0);for(let j=0,J=U.length;j<J;j++){const Q=U[j];a.dot(Q)>t&&c.add(Q)}c.normalize(),T.setXYZ(C+k,c.x,c.y,c.z)}}return p.setAttribute("normal",T),p}const y1=Object.freeze(Object.defineProperty({__proto__:null,computeMikkTSpaceTangents:gB,computeMorphedAttributes:SB,deepCloneAttribute:_B,deinterleaveAttribute:wh,deinterleaveGeometry:vB,estimateBytesUsed:xB,interleaveAttributes:bB,mergeAttributes:$m,mergeGeometries:yB,mergeGroups:EB,mergeVertices:TB,toCreasedNormals:RB,toTrianglesDrawMode:wB},Symbol.toStringTag,{value:"Module"}));var ve=function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}};function Sh(n){"@babel/helpers - typeof";return Sh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sh(n)}var NB=/^\s+/,CB=/\s+$/;function Xe(n,e){if(n=n||"",e=e||{},n instanceof Xe)return n;if(!(this instanceof Xe))return new Xe(n,e);var t=MB(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}Xe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,r,i,s,o,a;return t=e.r/255,r=e.g/255,i=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),i<=.03928?a=i/12.92:a=Math.pow((i+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a},setAlpha:function(e){return this._a=$4(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=B3(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=B3(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+i+"%)":"hsva("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=P3(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=P3(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+i+"%)":"hsla("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return D3(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return LB(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(hn(this._r,255)*100)+"%",g:Math.round(hn(this._g,255)*100)+"%",b:Math.round(hn(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(hn(this._r,255)*100)+"%, "+Math.round(hn(this._g,255)*100)+"%, "+Math.round(hn(this._b,255)*100)+"%)":"rgba("+Math.round(hn(this._r,255)*100)+"%, "+Math.round(hn(this._g,255)*100)+"%, "+Math.round(hn(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:HB[D3(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+L3(this._r,this._g,this._b,this._a),r=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var s=Xe(e);r="#"+L3(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,i=this._a<1&&this._a>=0,s=!t&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return Xe(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(kB,arguments)},brighten:function(){return this._applyModification(UB,arguments)},darken:function(){return this._applyModification(qB,arguments)},desaturate:function(){return this._applyModification(OB,arguments)},saturate:function(){return this._applyModification(FB,arguments)},greyscale:function(){return this._applyModification(IB,arguments)},spin:function(){return this._applyModification(GB,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(jB,arguments)},complement:function(){return this._applyCombination(VB,arguments)},monochromatic:function(){return this._applyCombination($B,arguments)},splitcomplement:function(){return this._applyCombination(zB,arguments)},triad:function(){return this._applyCombination(O3,[3])},tetrad:function(){return this._applyCombination(O3,[4])}};Xe.fromRatio=function(n,e){if(Sh(n)=="object"){var t={};for(var r in n)n.hasOwnProperty(r)&&(r==="a"?t[r]=n[r]:t[r]=tA(n[r]));n=t}return Xe(n,e)};function MB(n){var e={r:0,g:0,b:0},t=1,r=null,i=null,s=null,o=!1,a=!1;return typeof n=="string"&&(n=YB(n)),Sh(n)=="object"&&(qs(n.r)&&qs(n.g)&&qs(n.b)?(e=PB(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):qs(n.h)&&qs(n.s)&&qs(n.v)?(r=tA(n.s),i=tA(n.v),e=DB(n.h,r,i),o=!0,a="hsv"):qs(n.h)&&qs(n.s)&&qs(n.l)&&(r=tA(n.s),s=tA(n.l),e=BB(n.h,r,s),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=$4(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function PB(n,e,t){return{r:hn(n,255)*255,g:hn(e,255)*255,b:hn(t,255)*255}}function P3(n,e,t){n=hn(n,255),e=hn(e,255),t=hn(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=(r+i)/2;if(r==i)s=o=0;else{var c=r-i;switch(o=a>.5?c/(2-r-i):c/(r+i),r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,l:a}}function BB(n,e,t){var r,i,s;n=hn(n,360),e=hn(e,100),t=hn(t,100);function o(f,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?f+(p-f)*6*g:g<1/2?p:g<2/3?f+(p-f)*(2/3-g)*6:f}if(e===0)r=i=s=t;else{var a=t<.5?t*(1+e):t+e-t*e,c=2*t-a;r=o(c,a,n+1/3),i=o(c,a,n),s=o(c,a,n-1/3)}return{r:r*255,g:i*255,b:s*255}}function B3(n,e,t){n=hn(n,255),e=hn(e,255),t=hn(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=r,c=r-i;if(o=r===0?0:c/r,r==i)s=0;else{switch(r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,v:a}}function DB(n,e,t){n=hn(n,360)*6,e=hn(e,100),t=hn(t,100);var r=Math.floor(n),i=n-r,s=t*(1-e),o=t*(1-i*e),a=t*(1-(1-i)*e),c=r%6,f=[t,o,s,s,a,t][c],p=[a,t,t,o,s,s][c],g=[s,s,a,t,t,o][c];return{r:f*255,g:p*255,b:g*255}}function D3(n,e,t,r){var i=[$i(Math.round(n).toString(16)),$i(Math.round(e).toString(16)),$i(Math.round(t).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function LB(n,e,t,r,i){var s=[$i(Math.round(n).toString(16)),$i(Math.round(e).toString(16)),$i(Math.round(t).toString(16)),$i(H4(r))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function L3(n,e,t,r){var i=[$i(H4(r)),$i(Math.round(n).toString(16)),$i(Math.round(e).toString(16)),$i(Math.round(t).toString(16))];return i.join("")}Xe.equals=function(n,e){return!n||!e?!1:Xe(n).toRgbString()==Xe(e).toRgbString()};Xe.random=function(){return Xe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function OB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.s-=e/100,t.s=Af(t.s),Xe(t)}function FB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.s+=e/100,t.s=Af(t.s),Xe(t)}function IB(n){return Xe(n).desaturate(100)}function kB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.l+=e/100,t.l=Af(t.l),Xe(t)}function UB(n,e){e=e===0?0:e||10;var t=Xe(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),Xe(t)}function qB(n,e){e=e===0?0:e||10;var t=Xe(n).toHsl();return t.l-=e/100,t.l=Af(t.l),Xe(t)}function GB(n,e){var t=Xe(n).toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,Xe(t)}function VB(n){var e=Xe(n).toHsl();return e.h=(e.h+180)%360,Xe(e)}function O3(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=Xe(n).toHsl(),r=[Xe(n)],i=360/e,s=1;s<e;s++)r.push(Xe({h:(t.h+s*i)%360,s:t.s,l:t.l}));return r}function zB(n){var e=Xe(n).toHsl(),t=e.h;return[Xe(n),Xe({h:(t+72)%360,s:e.s,l:e.l}),Xe({h:(t+216)%360,s:e.s,l:e.l})]}function jB(n,e,t){e=e||6,t=t||30;var r=Xe(n).toHsl(),i=360/t,s=[Xe(n)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(Xe(r));return s}function $B(n,e){e=e||6;for(var t=Xe(n).toHsv(),r=t.h,i=t.s,s=t.v,o=[],a=1/e;e--;)o.push(Xe({h:r,s:i,v:s})),s=(s+a)%1;return o}Xe.mix=function(n,e,t){t=t===0?0:t||50;var r=Xe(n).toRgb(),i=Xe(e).toRgb(),s=t/100,o={r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a};return Xe(o)};Xe.readability=function(n,e){var t=Xe(n),r=Xe(e);return(Math.max(t.getLuminance(),r.getLuminance())+.05)/(Math.min(t.getLuminance(),r.getLuminance())+.05)};Xe.isReadable=function(n,e,t){var r=Xe.readability(n,e),i,s;switch(s=!1,i=KB(t),i.level+i.size){case"AAsmall":case"AAAlarge":s=r>=4.5;break;case"AAlarge":s=r>=3;break;case"AAAsmall":s=r>=7;break}return s};Xe.mostReadable=function(n,e,t){var r=null,i=0,s,o,a,c;t=t||{},o=t.includeFallbackColors,a=t.level,c=t.size;for(var f=0;f<e.length;f++)s=Xe.readability(n,e[f]),s>i&&(i=s,r=Xe(e[f]));return Xe.isReadable(n,r,{level:a,size:c})||!o?r:(t.includeFallbackColors=!1,Xe.mostReadable(n,["#fff","#000"],t))};var Hm=Xe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},HB=Xe.hexNames=WB(Hm);function WB(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function $4(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function hn(n,e){QB(n)&&(n="100%");var t=XB(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function Af(n){return Math.min(1,Math.max(0,n))}function Yr(n){return parseInt(n,16)}function QB(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function XB(n){return typeof n=="string"&&n.indexOf("%")!=-1}function $i(n){return n.length==1?"0"+n:""+n}function tA(n){return n<=1&&(n=n*100+"%"),n}function H4(n){return Math.round(parseFloat(n)*255).toString(16)}function F3(n){return Yr(n)/255}var ki=function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function qs(n){return!!ki.CSS_UNIT.exec(n)}function YB(n){n=n.replace(NB,"").replace(CB,"").toLowerCase();var e=!1;if(Hm[n])n=Hm[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=ki.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=ki.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=ki.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=ki.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=ki.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=ki.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=ki.hex8.exec(n))?{r:Yr(t[1]),g:Yr(t[2]),b:Yr(t[3]),a:F3(t[4]),format:e?"name":"hex8"}:(t=ki.hex6.exec(n))?{r:Yr(t[1]),g:Yr(t[2]),b:Yr(t[3]),format:e?"name":"hex"}:(t=ki.hex4.exec(n))?{r:Yr(t[1]+""+t[1]),g:Yr(t[2]+""+t[2]),b:Yr(t[3]+""+t[3]),a:F3(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=ki.hex3.exec(n))?{r:Yr(t[1]+""+t[1]),g:Yr(t[2]+""+t[2]),b:Yr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function KB(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Wm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function ZB(n){if(Array.isArray(n))return n}function JB(n){if(Array.isArray(n))return Wm(n)}function W4(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function eD(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function tD(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(n,e){return n.get(W4(n,e))}function hl(n,e,t){eD(n,e),e.set(n,t)}function Dc(n,e,t){return n.set(W4(n,e),t),t}function nD(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,cD(r.key),r)}}function rD(n,e,t){return e&&nD(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function iD(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function sD(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function oD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aD(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lD(n,e){return ZB(n)||sD(n,e)||Q4(n,e)||oD()}function uD(n){return JB(n)||iD(n)||Q4(n)||aD()}function AD(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function cD(n){var e=AD(n,"string");return typeof e=="symbol"?e:e+""}function Q4(n,e){if(n){if(typeof n=="string")return Wm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Wm(n,e):void 0}}var fl=new WeakMap,Mu=new WeakMap,dl=new WeakMap,zd=new WeakMap,jd=new WeakMap,$d=new WeakMap,hD=function(){function n(){tD(this,n),hl(this,fl,new Map),hl(this,Mu,new Map),hl(this,dl,function(e){return e}),hl(this,zd,function(){return{}}),hl(this,jd,function(){}),hl(this,$d,function(){})}return rD(n,[{key:"getObj",value:function(t){return fr(fl,this).get(fr(dl,this).call(this,t))}},{key:"getData",value:function(t){return fr(Mu,this).get(t)}},{key:"entries",value:function(){return uD(fr(Mu,this).entries()).map(function(t){var r=lD(t,2),i=r[0],s=r[1];return[s,i]})}},{key:"id",value:function(t){return Dc(dl,this,ve(t)),this}},{key:"onCreateObj",value:function(t){return Dc(zd,this,t),this}},{key:"onUpdateObj",value:function(t){return Dc(jd,this,t),this}},{key:"onRemoveObj",value:function(t){return Dc($d,this,t),this}},{key:"digest",value:function(t){var r=this;t.filter(function(s){return!fr(fl,r).has(fr(dl,r).call(r,s))}).forEach(function(s){var o=fr(zd,r).call(r,s);fr(fl,r).set(fr(dl,r).call(r,s),o),fr(Mu,r).set(o,s)});var i=new Map(t.map(function(s){return[fr(dl,r).call(r,s),s]}));return fr(fl,this).forEach(function(s,o){i.has(o)?fr(jd,r).call(r,s,i.get(o)):(fr($d,r).call(r,s,o),fr(fl,r).delete(o),fr(Mu,r).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}(),X4={exports:{}};(function(n,e){(function(t,r){n.exports=r()})(TR,function(){return function(t){function r(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var i={};return r.m=t,r.c=i,r.p="",r(0)}([function(t,r,i){var s=i(1),o=function(){function a(c,f,p){c===void 0&&(c=NaN),f===void 0&&(f=NaN),p===void 0&&(p=!1),this._minFPS=f,this._maxFPS=c,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._maxInterval=isNaN(this._minFPS)?NaN:1e3/this._minFPS,this._minInterval=isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=new s.default,this._onPause=new s.default,this._onTick=new s.default,this._onTickOncePerFrame=new s.default,p||this.resume()}return a.prototype.updateOnce=function(c){c(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},a.prototype.resume=function(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=this.getTimer(),this._onResume.dispatch(),this.animateOnce())},a.prototype.pause=function(){this._isRunning&&(this._isRunning=!1,this._onPause.dispatch(),window.cancelAnimationFrame(this._animationFrameHandle))},a.prototype.dispose=function(){this.pause(),this._onResume.removeAll(),this._onPause.removeAll(),this._onTick.removeAll()},Object.defineProperty(a.prototype,"currentTick",{get:function(){return this._currentTick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentTimeSeconds",{get:function(){return this._currentTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tickDeltaTimeSeconds",{get:function(){return this._tickDeltaTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeScale",{get:function(){return this._timeScale},set:function(c){this._timeScale!==c&&(this._timeScale=c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onResume",{get:function(){return this._onResume},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onPause",{get:function(){return this._onPause},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTick",{get:function(){return this._onTick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTickOncePerFrame",{get:function(){return this._onTickOncePerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),a.prototype.animateOnce=function(){var c=this;this._animationFrameHandle=window.requestAnimationFrame(function(){return c.onFrame()})},a.prototype.onFrame=function(){if(this._now=this.getTimer(),this._frameDeltaTime=this._now-this._lastTimeUpdated,isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)if(isNaN(this._maxInterval))this.update(this._frameDeltaTime*this._timeScale,!0),this._lastTimeUpdated=this._now;else for(this._interval=Math.min(this._frameDeltaTime,this._maxInterval);this._now>=this._lastTimeUpdated+this._interval;)this.update(this._interval*this._timeScale,this._now<=this._lastTimeUpdated+2*this._maxInterval),this._lastTimeUpdated+=this._interval;this._isRunning&&this.animateOnce()},a.prototype.update=function(c,f){f===void 0&&(f=!0),this._currentTick++,this._currentTime+=c,this._tickDeltaTime=c,this._onTick.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),f&&this._onTickOncePerFrame.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},a.prototype.getTimer=function(){return Date.now()},a}();Object.defineProperty(r,"__esModule",{value:!0}),r.default=o},function(t,r,i){(function(s,o){t.exports=o()})(this,function(){return function(s){function o(c){if(a[c])return a[c].exports;var f=a[c]={exports:{},id:c,loaded:!1};return s[c].call(f.exports,f,f.exports,o),f.loaded=!0,f.exports}var a={};return o.m=s,o.c=a,o.p="",o(0)}([function(s,o){var a=function(){function c(){this.functions=[]}return c.prototype.add=function(f){return this.functions.indexOf(f)===-1&&(this.functions.push(f),!0)},c.prototype.remove=function(f){var p=this.functions.indexOf(f);return p>-1&&(this.functions.splice(p,1),!0)},c.prototype.removeAll=function(){return this.functions.length>0&&(this.functions.length=0,!0)},c.prototype.dispatch=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];var g=this.functions.concat();g.forEach(function(b){b.apply(void 0,f)})},Object.defineProperty(c.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),c}();Object.defineProperty(o,"__esModule",{value:!0}),o.default=a}])})}])})})(X4);var fD=X4.exports;const iu=Zv(fD),Ks=11102230246251565e-32,dr=134217729,dD=(3+8*Ks)*Ks;function Hd(n,e,t,r,i){let s,o,a,c,f=e[0],p=r[0],g=0,b=0;p>f==p>-f?(s=f,f=e[++g]):(s=p,p=r[++b]);let x=0;if(g<n&&b<t)for(p>f==p>-f?(o=f+s,a=s-(o-f),f=e[++g]):(o=p+s,a=s-(o-p),p=r[++b]),s=o,a!==0&&(i[x++]=a);g<n&&b<t;)p>f==p>-f?(o=s+f,c=o-s,a=s-(o-c)+(f-c),f=e[++g]):(o=s+p,c=o-s,a=s-(o-c)+(p-c),p=r[++b]),s=o,a!==0&&(i[x++]=a);for(;g<n;)o=s+f,c=o-s,a=s-(o-c)+(f-c),f=e[++g],s=o,a!==0&&(i[x++]=a);for(;b<t;)o=s+p,c=o-s,a=s-(o-c)+(p-c),p=r[++b],s=o,a!==0&&(i[x++]=a);return(s!==0||x===0)&&(i[x++]=s),x}function pD(n,e){let t=e[0];for(let r=1;r<n;r++)t+=e[r];return t}function YA(n){return new Float64Array(n)}const mD=(3+16*Ks)*Ks,gD=(2+12*Ks)*Ks,yD=(9+64*Ks)*Ks*Ks,pl=YA(4),I3=YA(8),k3=YA(12),U3=YA(16),Tr=YA(4);function _D(n,e,t,r,i,s,o){let a,c,f,p,g,b,x,T,S,E,C,P,D,L,k,q,I,U;const j=n-i,J=t-i,Q=e-s,K=r-s;L=j*K,b=dr*j,x=b-(b-j),T=j-x,b=dr*K,S=b-(b-K),E=K-S,k=T*E-(L-x*S-T*S-x*E),q=Q*J,b=dr*Q,x=b-(b-Q),T=Q-x,b=dr*J,S=b-(b-J),E=J-S,I=T*E-(q-x*S-T*S-x*E),C=k-I,g=k-C,pl[0]=k-(C+g)+(g-I),P=L+C,g=P-L,D=L-(P-g)+(C-g),C=D-q,g=D-C,pl[1]=D-(C+g)+(g-q),U=P+C,g=U-P,pl[2]=P-(U-g)+(C-g),pl[3]=U;let te=pD(4,pl),oe=gD*o;if(te>=oe||-te>=oe||(g=n-j,a=n-(j+g)+(g-i),g=t-J,f=t-(J+g)+(g-i),g=e-Q,c=e-(Q+g)+(g-s),g=r-K,p=r-(K+g)+(g-s),a===0&&c===0&&f===0&&p===0)||(oe=yD*o+dD*Math.abs(te),te+=j*p+K*a-(Q*f+J*c),te>=oe||-te>=oe))return te;L=a*K,b=dr*a,x=b-(b-a),T=a-x,b=dr*K,S=b-(b-K),E=K-S,k=T*E-(L-x*S-T*S-x*E),q=c*J,b=dr*c,x=b-(b-c),T=c-x,b=dr*J,S=b-(b-J),E=J-S,I=T*E-(q-x*S-T*S-x*E),C=k-I,g=k-C,Tr[0]=k-(C+g)+(g-I),P=L+C,g=P-L,D=L-(P-g)+(C-g),C=D-q,g=D-C,Tr[1]=D-(C+g)+(g-q),U=P+C,g=U-P,Tr[2]=P-(U-g)+(C-g),Tr[3]=U;const Y=Hd(4,pl,4,Tr,I3);L=j*p,b=dr*j,x=b-(b-j),T=j-x,b=dr*p,S=b-(b-p),E=p-S,k=T*E-(L-x*S-T*S-x*E),q=Q*f,b=dr*Q,x=b-(b-Q),T=Q-x,b=dr*f,S=b-(b-f),E=f-S,I=T*E-(q-x*S-T*S-x*E),C=k-I,g=k-C,Tr[0]=k-(C+g)+(g-I),P=L+C,g=P-L,D=L-(P-g)+(C-g),C=D-q,g=D-C,Tr[1]=D-(C+g)+(g-q),U=P+C,g=U-P,Tr[2]=P-(U-g)+(C-g),Tr[3]=U;const ae=Hd(Y,I3,4,Tr,k3);L=a*p,b=dr*a,x=b-(b-a),T=a-x,b=dr*p,S=b-(b-p),E=p-S,k=T*E-(L-x*S-T*S-x*E),q=c*f,b=dr*c,x=b-(b-c),T=c-x,b=dr*f,S=b-(b-f),E=f-S,I=T*E-(q-x*S-T*S-x*E),C=k-I,g=k-C,Tr[0]=k-(C+g)+(g-I),P=L+C,g=P-L,D=L-(P-g)+(C-g),C=D-q,g=D-C,Tr[1]=D-(C+g)+(g-q),U=P+C,g=U-P,Tr[2]=P-(U-g)+(C-g),Tr[3]=U;const he=Hd(ae,k3,4,Tr,U3);return U3[he-1]}function nA(n,e,t,r,i,s){const o=(e-s)*(t-i),a=(n-i)*(r-s),c=o-a,f=Math.abs(o+a);return Math.abs(c)>=mD*f?c:-_D(n,e,t,r,i,s,f)}const q3=Math.pow(2,-52),Lc=new Uint32Array(512);class DA{static from(e,t=wD,r=SD){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=e[o];s[2*o]=t(a),s[2*o+1]=r(a)}return new DA(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=e.length>>1;let a=1/0,c=1/0,f=-1/0,p=-1/0;for(let j=0;j<o;j++){const J=e[2*j],Q=e[2*j+1];J<a&&(a=J),Q<c&&(c=Q),J>f&&(f=J),Q>p&&(p=Q),this._ids[j]=j}const g=(a+f)/2,b=(c+p)/2;let x,T,S;for(let j=0,J=1/0;j<o;j++){const Q=Wd(g,b,e[2*j],e[2*j+1]);Q<J&&(x=j,J=Q)}const E=e[2*x],C=e[2*x+1];for(let j=0,J=1/0;j<o;j++){if(j===x)continue;const Q=Wd(E,C,e[2*j],e[2*j+1]);Q<J&&Q>0&&(T=j,J=Q)}let P=e[2*T],D=e[2*T+1],L=1/0;for(let j=0;j<o;j++){if(j===x||j===T)continue;const J=xD(E,C,P,D,e[2*j],e[2*j+1]);J<L&&(S=j,L=J)}let k=e[2*S],q=e[2*S+1];if(L===1/0){for(let Q=0;Q<o;Q++)this._dists[Q]=e[2*Q]-e[0]||e[2*Q+1]-e[1];Fl(this._ids,this._dists,0,o-1);const j=new Uint32Array(o);let J=0;for(let Q=0,K=-1/0;Q<o;Q++){const te=this._ids[Q],oe=this._dists[te];oe>K&&(j[J++]=te,K=oe)}this.hull=j.subarray(0,J),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(nA(E,C,P,D,k,q)<0){const j=T,J=P,Q=D;T=S,P=k,D=q,S=j,k=J,q=Q}const I=TD(E,C,P,D,k,q);this._cx=I.x,this._cy=I.y;for(let j=0;j<o;j++)this._dists[j]=Wd(e[2*j],e[2*j+1],I.x,I.y);Fl(this._ids,this._dists,0,o-1),this._hullStart=x;let U=3;r[x]=t[S]=T,r[T]=t[x]=S,r[S]=t[T]=x,i[x]=0,i[T]=1,i[S]=2,s.fill(-1),s[this._hashKey(E,C)]=x,s[this._hashKey(P,D)]=T,s[this._hashKey(k,q)]=S,this.trianglesLen=0,this._addTriangle(x,T,S,-1,-1,-1);for(let j=0,J,Q;j<this._ids.length;j++){const K=this._ids[j],te=e[2*K],oe=e[2*K+1];if(j>0&&Math.abs(te-J)<=q3&&Math.abs(oe-Q)<=q3||(J=te,Q=oe,K===x||K===T||K===S))continue;let Y=0;for(let Oe=0,ke=this._hashKey(te,oe);Oe<this._hashSize&&(Y=s[(ke+Oe)%this._hashSize],!(Y!==-1&&Y!==r[Y]));Oe++);Y=t[Y];let ae=Y,he;for(;he=r[ae],nA(te,oe,e[2*ae],e[2*ae+1],e[2*he],e[2*he+1])>=0;)if(ae=he,ae===Y){ae=-1;break}if(ae===-1)continue;let xe=this._addTriangle(ae,K,r[ae],-1,-1,i[ae]);i[K]=this._legalize(xe+2),i[ae]=xe,U++;let me=r[ae];for(;he=r[me],nA(te,oe,e[2*me],e[2*me+1],e[2*he],e[2*he+1])<0;)xe=this._addTriangle(me,K,he,i[K],-1,i[me]),i[K]=this._legalize(xe+2),r[me]=me,U--,me=he;if(ae===Y)for(;he=t[ae],nA(te,oe,e[2*he],e[2*he+1],e[2*ae],e[2*ae+1])<0;)xe=this._addTriangle(he,K,ae,-1,i[ae],i[he]),this._legalize(xe+2),i[he]=xe,r[ae]=ae,U--,ae=he;this._hullStart=t[K]=ae,r[ae]=t[me]=K,r[K]=me,s[this._hashKey(te,oe)]=K,s[this._hashKey(e[2*ae],e[2*ae+1])]=ae}this.hull=new Uint32Array(U);for(let j=0,J=this._hullStart;j<U;j++)this.hull[j]=J,J=r[J];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(bD(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[e],c=e-e%3;if(o=c+(e+2)%3,a===-1){if(s===0)break;e=Lc[--s];continue}const f=a-a%3,p=c+(e+1)%3,g=f+(a+2)%3,b=t[o],x=t[e],T=t[p],S=t[g];if(vD(i[2*b],i[2*b+1],i[2*x],i[2*x+1],i[2*T],i[2*T+1],i[2*S],i[2*S+1])){t[e]=S,t[a]=b;const C=r[g];if(C===-1){let D=this._hullStart;do{if(this._hullTri[D]===g){this._hullTri[D]=e;break}D=this._hullPrev[D]}while(D!==this._hullStart)}this._link(e,C),this._link(a,r[o]),this._link(o,g);const P=f+(a+1)%3;s<Lc.length&&(Lc[s++]=P)}else{if(s===0)break;e=Lc[--s]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function bD(n,e){const t=n/(Math.abs(n)+Math.abs(e));return(e>0?3-t:1+t)/4}function Wd(n,e,t,r){const i=n-t,s=e-r;return i*i+s*s}function vD(n,e,t,r,i,s,o,a){const c=n-o,f=e-a,p=t-o,g=r-a,b=i-o,x=s-a,T=c*c+f*f,S=p*p+g*g,E=b*b+x*x;return c*(g*E-S*x)-f*(p*E-S*b)+T*(p*x-g*b)<0}function xD(n,e,t,r,i,s){const o=t-n,a=r-e,c=i-n,f=s-e,p=o*o+a*a,g=c*c+f*f,b=.5/(o*f-a*c),x=(f*p-a*g)*b,T=(o*g-c*p)*b;return x*x+T*T}function TD(n,e,t,r,i,s){const o=t-n,a=r-e,c=i-n,f=s-e,p=o*o+a*a,g=c*c+f*f,b=.5/(o*f-a*c),x=n+(f*p-a*g)*b,T=e+(o*g-c*p)*b;return{x,y:T}}function Fl(n,e,t,r){if(r-t<=20)for(let i=t+1;i<=r;i++){const s=n[i],o=e[s];let a=i-1;for(;a>=t&&e[n[a]]>o;)n[a+1]=n[a--];n[a+1]=s}else{const i=t+r>>1;let s=t+1,o=r;Pu(n,i,s),e[n[t]]>e[n[r]]&&Pu(n,t,r),e[n[s]]>e[n[r]]&&Pu(n,s,r),e[n[t]]>e[n[s]]&&Pu(n,t,s);const a=n[s],c=e[a];for(;;){do s++;while(e[n[s]]<c);do o--;while(e[n[o]]>c);if(o<s)break;Pu(n,s,o)}n[t+1]=n[o],n[o]=a,r-s+1>=o-t?(Fl(n,e,s,r),Fl(n,e,t,o-1)):(Fl(n,e,t,o-1),Fl(n,e,s,r))}}function Pu(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function wD(n){return n[0]}function SD(n){return n[1]}function ED(n,e){var t,r,i=0,s,o,a,c,f,p,g,b=n[0],x=n[1],T=e.length;for(t=0;t<T;t++){r=0;var S=e[t],E=S.length-1;if(p=S[0],p[0]!==S[E][0]&&p[1]!==S[E][1])throw new Error("First and last coordinates in a ring must be the same");for(o=p[0]-b,a=p[1]-x,r;r<E;r++){if(g=S[r+1],c=g[0]-b,f=g[1]-x,a===0&&f===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(f>=0&&a<=0||f<=0&&a>=0){if(s=nA(o,c,a,f,0,0),s===0)return 0;(s>0&&f>0&&a<=0||s<0&&f<=0&&a>0)&&i++}p=g,a=f,o=c}}return i%2!==0}function RD(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ND(n){return n.type==="Feature"?n.geometry:n}function CD(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=RD(n),i=ND(e),s=i.type,o=e.bbox;let a=i.coordinates;if(o&&MD(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);let c=!1;for(var f=0;f<a.length;++f){const p=ED(r,a[f]);if(p===0)return!t.ignoreBoundary;p&&(c=!0)}return c}function MD(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}var PD=CD;const G3=1e-6;class La{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){e=+e,t=+t,r=+r;const i=e+r,s=t;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>G3||Math.abs(this._y1-s)>G3)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(e,t,r,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class Qm{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class BD{constructor(e,[t,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let S=0,E=0,C=r.length,P,D;S<C;S+=3,E+=2){const L=r[S]*2,k=r[S+1]*2,q=r[S+2]*2,I=e[L],U=e[L+1],j=e[k],J=e[k+1],Q=e[q],K=e[q+1],te=j-I,oe=J-U,Y=Q-I,ae=K-U,he=(te*ae-oe*Y)*2;if(Math.abs(he)<1e-9){if(s===void 0){s=o=0;for(const me of t)s+=e[me*2],o+=e[me*2+1];s/=t.length,o/=t.length}const xe=1e9*Math.sign((s-I)*ae-(o-U)*Y);P=(I+Q)/2-xe*ae,D=(U+K)/2+xe*Y}else{const xe=1/he,me=te*te+oe*oe,Oe=Y*Y+ae*ae;P=I+(ae*me-oe*Oe)*xe,D=U+(te*Oe-Y*me)*xe}a[E]=P,a[E+1]=D}let c=t[t.length-1],f,p=c*4,g,b=e[2*c],x,T=e[2*c+1];i.fill(0);for(let S=0;S<t.length;++S)c=t[S],f=p,g=b,x=T,p=c*4,b=e[2*c],T=e[2*c+1],i[f+2]=i[p]=x-T,i[f+3]=i[p+1]=b-g}render(e){const t=e==null?e=new La:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let p=0,g=r.length;p<g;++p){const b=r[p];if(b<p)continue;const x=Math.floor(p/3)*2,T=Math.floor(b/3)*2,S=o[x],E=o[x+1],C=o[T],P=o[T+1];this._renderSegment(S,E,C,P,e)}let c,f=s[s.length-1];for(let p=0;p<s.length;++p){c=f,f=s[p];const g=Math.floor(i[f]/3)*2,b=o[g],x=o[g+1],T=c*4,S=this._project(b,x,a[T+2],a[T+3]);S&&this._renderSegment(b,x,S[0],S[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new La:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const r=t==null?t=new La:void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&t.lineTo(i[o],i[o+1]);return t.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new Qm;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,i,s){let o;const a=this._regioncode(e,t),c=this._regioncode(r,i);a===0&&c===0?(s.moveTo(e,t),s.lineTo(r,i)):(o=this._clipSegment(e,t,r,i,a,c))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,t,r){return t=+t,t!==t||(r=+r,r!==r)?!1:this.delaunay._step(e,t,r)===e}*neighbors(e){const t=this._clip(e);if(t)for(const r of this.delaunay.neighbors(e)){const i=this._clip(r);if(i){e:for(let s=0,o=t.length;s<o;s+=2)for(let a=0,c=i.length;a<c;a+=2)if(t[s]===i[a]&&t[s+1]===i[a+1]&&t[(s+2)%o]===i[(a+c-2)%c]&&t[(s+3)%o]===i[(a+c-1)%c]){yield r;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[e];if(o===-1)return null;const a=[];let c=o;do{const f=Math.floor(c/3);if(a.push(t[f*2],t[f*2+1]),c=c%3===2?c-2:c+1,s[c]!==e)break;c=i[c]}while(c!==o&&c!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:r}=this,i=e*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(e,t,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(e,t))}_clipFinite(e,t){const r=t.length;let i=null,s,o,a=t[r-2],c=t[r-1],f,p=this._regioncode(a,c),g,b=0;for(let x=0;x<r;x+=2)if(s=a,o=c,a=t[x],c=t[x+1],f=p,p=this._regioncode(a,c),f===0&&p===0)g=b,b=0,i?i.push(a,c):i=[a,c];else{let T,S,E,C,P;if(f===0){if((T=this._clipSegment(s,o,a,c,f,p))===null)continue;[S,E,C,P]=T}else{if((T=this._clipSegment(a,c,s,o,p,f))===null)continue;[C,P,S,E]=T,g=b,b=this._edgecode(S,E),g&&b&&this._edge(e,g,b,i,i.length),i?i.push(S,E):i=[S,E]}g=b,b=this._edgecode(C,P),g&&b&&this._edge(e,g,b,i,i.length),i?i.push(C,P):i=[C,P]}if(i)g=b,b=this._edgecode(i[0],i[1]),g&&b&&this._edge(e,g,b,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,r,i,s,o){const a=s<o;for(a&&([e,t,r,i,s,o]=[r,i,e,t,o,s]);;){if(s===0&&o===0)return a?[r,i,e,t]:[e,t,r,i];if(s&o)return null;let c,f,p=s||o;p&8?(c=e+(r-e)*(this.ymax-t)/(i-t),f=this.ymax):p&4?(c=e+(r-e)*(this.ymin-t)/(i-t),f=this.ymin):p&2?(f=t+(i-t)*(this.xmax-e)/(r-e),c=this.xmax):(f=t+(i-t)*(this.xmin-e)/(r-e),c=this.xmin),s?(e=c,t=f,s=this._regioncode(e,t)):(r=c,i=f,o=this._regioncode(r,i))}}_clipInfinite(e,t,r,i,s,o){let a=Array.from(t),c;if((c=this._project(a[0],a[1],r,i))&&a.unshift(c[0],c[1]),(c=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(c[0],c[1]),a=this._clipFinite(e,a))for(let f=0,p=a.length,g,b=this._edgecode(a[p-2],a[p-1]);f<p;f+=2)g=b,b=this._edgecode(a[f],a[f+1]),g&&b&&(f=this._edge(e,g,b,a,f),p=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,r,i,s){for(;t!==r;){let o,a;switch(t){case 5:t=4;continue;case 4:t=6,o=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,o=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,o=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(e,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(e,t,r,i){let s=1/0,o,a,c;if(i<0){if(t<=this.ymin)return null;(o=(this.ymin-t)/i)<s&&(c=this.ymin,a=e+(s=o)*r)}else if(i>0){if(t>=this.ymax)return null;(o=(this.ymax-t)/i)<s&&(c=this.ymax,a=e+(s=o)*r)}if(r>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/r)<s&&(a=this.xmax,c=t+(s=o)*i)}else if(r<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/r)<s&&(a=this.xmin,c=t+(s=o)*i)}return[a,c]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const r=(t+2)%e.length,i=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[i]||e[t+1]===e[r+1]&&e[r+1]===e[i+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}const DD=2*Math.PI,ml=Math.pow;function LD(n){return n[0]}function OD(n){return n[1]}function FD(n){const{triangles:e,coords:t}=n;for(let r=0;r<e.length;r+=3){const i=2*e[r],s=2*e[r+1],o=2*e[r+2];if((t[o]-t[i])*(t[s+1]-t[i+1])-(t[s]-t[i])*(t[o+1]-t[i+1])>1e-10)return!1}return!0}function ID(n,e,t){return[n+Math.sin(n+e)*t,e+Math.cos(n-e)*t]}class _1{static from(e,t=LD,r=OD,i){return new _1("length"in e?kD(e,t,r,i):Float64Array.from(UD(e,t,r,i)))}constructor(e){this._delaunator=new DA(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&FD(e)){this.collinear=Int32Array.from({length:t.length/2},(b,x)=>x).sort((b,x)=>t[2*b]-t[2*x]||t[2*b+1]-t[2*x+1]);const c=this.collinear[0],f=this.collinear[this.collinear.length-1],p=[t[2*c],t[2*c+1],t[2*f],t[2*f+1]],g=1e-8*Math.hypot(p[3]-p[1],p[2]-p[0]);for(let b=0,x=t.length/2;b<x;++b){const T=ID(t[2*b],t[2*b+1],g);t[2*b]=T[0],t[2*b+1]=T[1]}this._delaunator=new DA(t)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let c=0,f=r.length;c<f;++c){const p=s[c%3===2?c-2:c+1];(r[c]===-1||o[p]===-1)&&(o[p]=c)}for(let c=0,f=i.length;c<f;++c)a[i[c]]=c;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(e){return new BD(this,e)}*neighbors(e){const{inedges:t,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const g=a.indexOf(e);g>0&&(yield a[g-1]),g<a.length-1&&(yield a[g+1]);return}const c=t[e];if(c===-1)return;let f=c,p=-1;do{if(yield p=o[f],f=f%3===2?f-2:f+1,o[f]!==e)return;if(f=s[f],f===-1){const g=r[(i[e]+1)%r.length];g!==p&&(yield g);return}}while(f!==c)}find(e,t,r=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const i=r;let s;for(;(s=this._step(r,e,t))>=0&&s!==r&&s!==i;)r=s;return s}_step(e,t,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:c,points:f}=this;if(i[e]===-1||!f.length)return(e+1)%(f.length>>1);let p=e,g=ml(t-f[e*2],2)+ml(r-f[e*2+1],2);const b=i[e];let x=b;do{let T=c[x];const S=ml(t-f[T*2],2)+ml(r-f[T*2+1],2);if(S<g&&(g=S,p=T),x=x%3===2?x-2:x+1,c[x]!==e)break;if(x=a[x],x===-1){if(x=s[(o[e]+1)%s.length],x!==T&&ml(t-f[x*2],2)+ml(r-f[x*2+1],2)<g)return x;break}}while(x!==b);return p}render(e){const t=e==null?e=new La:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const c=i[o];if(c<o)continue;const f=s[o]*2,p=s[c]*2;e.moveTo(r[f],r[f+1]),e.lineTo(r[p],r[p+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const r=e==null?e=new La:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],c=i[s+1];e.moveTo(a+t,c),e.arc(a,c,t,0,DD)}return r&&r.value()}renderHull(e){const t=e==null?e=new La:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;e.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const c=2*r[a];e.lineTo(i[c],i[c+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new Qm;return this.renderHull(e),e.value()}renderTriangle(e,t){const r=t==null?t=new La:void 0,{points:i,triangles:s}=this,o=s[e*=3]*2,a=s[e+1]*2,c=s[e+2]*2;return t.moveTo(i[o],i[o+1]),t.lineTo(i[a],i[a+1]),t.lineTo(i[c],i[c+1]),t.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new Qm;return this.renderTriangle(e,t),t.value()}}function kD(n,e,t,r){const i=n.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=n[o];s[o*2]=e.call(r,a,o,n),s[o*2+1]=t.call(r,a,o,n)}return s}function*UD(n,e,t,r){let i=0;for(const s of n)yield e.call(r,s,i,n),yield t.call(r,s,i,n),++i}const b1=Math.PI,V3=b1/2,z3=180/b1,j3=b1/180,qD=Math.atan2,$3=Math.cos,GD=Math.max,VD=Math.min,H3=Math.sin,zD=Math.sign||function(n){return n>0?1:n<0?-1:0},Y4=Math.sqrt;function jD(n){return n>1?V3:n<-1?-V3:Math.asin(n)}function K4(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ei(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Eh(n,e){return[n[0]+e[0],n[1]+e[1],n[2]+e[2]]}function Rh(n){var e=Y4(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return[n[0]/e,n[1]/e,n[2]/e]}function v1(n){return[qD(n[1],n[0])*z3,jD(GD(-1,VD(1,n[2])))*z3]}function vs(n){const e=n[0]*j3,t=n[1]*j3,r=$3(t);return[r*$3(e),r*H3(e),H3(t)]}function x1(n){return n=n.map(e=>vs(e)),K4(n[0],ei(n[2],n[1]))}function $D(n){const e=WD(n),t=XD(e),r=QD(t,n),i=KD(t,n.length),s=HD(i,n),o=YD(t,n),{polygons:a,centers:c}=ZD(o,t,n),f=JD(a),p=tL(t,n),g=eL(r,t);return{delaunay:e,edges:r,triangles:t,centers:c,neighbors:i,polygons:a,mesh:f,hull:p,urquhart:g,find:s}}function HD(n,e){function t(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,c,f=o;const p=vs([i,s]);do a=o,o=null,c=t(p,vs(e[a])),n[a].forEach(g=>{let b=t(p,vs(e[g]));if(b<c){c=b,o=g,f=g;return}});while(o!==null);return f}}function WD(n){if(n.length<2)return{};let e=0;for(;isNaN(n[e][0]+n[e][1])&&e++<n.length;);const t=F9(n[e]),r=pP().translate([0,0]).scale(1).rotate(t.invert([180,0]));n=n.map(r);const i=[];let s=1;for(let g=0,b=n.length;g<b;g++){let x=n[g][0]**2+n[g][1]**2;!isFinite(x)||x>1e32?i.push(g):x>s&&(s=x)}const o=1e6*Y4(s);i.forEach(g=>n[g]=[o,0]),n.push([0,o]),n.push([-o,0]),n.push([0,-o]);const a=_1.from(n);a.projection=r;const{triangles:c,halfedges:f,inedges:p}=a;for(let g=0,b=f.length;g<b;g++)if(f[g]<0){const x=g%3==2?g-2:g+1,T=g%3==0?g+2:g-1,S=f[x],E=f[T];f[S]=E,f[E]=S,f[x]=f[T]=-1,c[g]=c[x]=c[T]=e,p[c[S]]=S%3==0?S+2:S-1,p[c[E]]=E%3==0?E+2:E-1,g+=2-g%3}else c[g]>n.length-3-1&&(c[g]=e);return a}function QD(n,e){const t=new Set;return e.length===2?[[0,1]]:(n.forEach(r=>{if(r[0]!==r[1]&&!(x1(r.map(i=>e[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,t.add(Z0([r[i],r[s]]).join("-"))}),Array.from(t,r=>r.split("-").map(Number)))}function XD(n){const{triangles:e}=n;if(!e)return[];const t=[];for(let r=0,i=e.length/3;r<i;r++){const s=e[3*r],o=e[3*r+1],a=e[3*r+2];s!==o&&o!==a&&t.push([s,a,o])}return t}function YD(n,e){return n.map(t=>{const r=t.map(s=>e[s]).map(vs),i=Eh(Eh(ei(r[1],r[0]),ei(r[2],r[1])),ei(r[0],r[2]));return v1(Rh(i))})}function KD(n,e){const t=[];return n.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];t[s]=t[s]||[],t[s].push(o)}}),n.length===0&&(e===2?(t[0]=[1],t[1]=[0]):e===1&&(t[0]=[])),t}function ZD(n,e,t){const r=[],i=n.slice();if(e.length===0){if(t.length<2)return{polygons:r,centers:i};if(t.length===2){const a=vs(t[0]),c=vs(t[1]),f=Rh(Eh(a,c)),p=Rh(ei(a,c)),g=ei(f,p),b=[f,ei(f,g),ei(ei(f,g),g),ei(ei(ei(f,g),g),g)].map(v1).map(o);return r.push(b),r.push(b.slice().reverse()),{polygons:r,centers:i}}}e.forEach((a,c)=>{for(let f=0;f<3;f++){const p=a[f],g=a[(f+1)%3],b=a[(f+2)%3];r[p]=r[p]||[],r[p].push([g,b,c,[p,g,b]])}});const s=r.map(a=>{const c=[a[0][2]];let f=a[0][1];for(let p=1;p<a.length;p++)for(let g=0;g<a.length;g++)if(a[g][0]==f){f=a[g][1],c.push(a[g][2]);break}if(c.length>2)return c;if(c.length==2){const p=W3(t[a[0][3][0]],t[a[0][3][1]],i[c[0]]),g=W3(t[a[0][3][2]],t[a[0][3][0]],i[c[0]]),b=o(p),x=o(g);return[c[0],x,c[1],b]}});function o(a){let c=-1;return i.slice(e.length,1/0).forEach((f,p)=>{f[0]===a[0]&&f[1]===a[1]&&(c=p+e.length)}),c<0&&(c=i.length,i.push(a)),c}return{polygons:s,centers:i}}function W3(n,e,t){n=vs(n),e=vs(e),t=vs(t);const r=zD(K4(ei(e,n),t));return v1(Rh(Eh(n,e)).map(i=>r*i))}function JD(n){const e=[];return n.forEach(t=>{if(!t)return;let r=t[t.length-1];for(let i of t)i>r&&e.push([r,i]),r=i}),e}function eL(n,e){return function(t){const r=new Map,i=new Map;return n.forEach((s,o)=>{const a=s.join("-");r.set(a,t[o]),i.set(a,!0)}),e.forEach(s=>{let o=0,a=-1;for(let c=0;c<3;c++){let f=Z0([s[c],s[(c+1)%3]]).join("-");r.get(f)>o&&(o=r.get(f),a=f)}i.set(a,!1)}),n.map(s=>i.get(s.join("-")))}}function tL(n,e){const t=new Set,r=[];n.map(a=>{if(!(x1(a.map(c=>e[c>e.length?0:c]))>1e-12))for(let c=0;c<3;c++){let f=[a[c],a[(c+1)%3]],p=`${f[0]}-${f[1]}`;t.has(p)?t.delete(p):t.add(`${f[1]}-${f[0]}`)}});const i=new Map;let s;if(t.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function nL(n){const e=function(t){if(e.delaunay=null,e._data=t,typeof e._data=="object"&&e._data.type==="FeatureCollection"&&(e._data=e._data.features),typeof e._data=="object"){const r=e._data.map(i=>[e._vx(i),e._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));e.points=r.map(i=>[i[0],i[1]]),e.valid=r.map(i=>i[2]),e.delaunay=$D(e.points)}return e};return e._vx=function(t){if(typeof t=="object"&&"type"in t)return s3(t)[0];if(0 in t)return t[0]},e._vy=function(t){if(typeof t=="object"&&"type"in t)return s3(t)[1];if(1 in t)return t[1]},e.x=function(t){return t?(e._vx=t,e):e._vx},e.y=function(t){return t?(e._vy=t,e):e._vy},e.polygons=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return e.valid.length===0||(e.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>e.delaunay.centers[o])]}:null,properties:{site:e.valid[s],sitecoordinates:e.points[s],neighbours:e.delaunay.neighbors[s]}})),e.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:e.valid[0],sitecoordinates:e.points[0],neighbours:[]}})),r},e.triangles=function(t){return t!==void 0&&e(t),e.delaunay?{type:"FeatureCollection",features:e.delaunay.triangles.map((r,i)=>(r=r.map(s=>e.points[s]),r.center=e.delaunay.centers[i],r)).filter(r=>x1(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},e.links=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const r=e.delaunay.edges.map(s=>Qo(e.points[s[0]],e.points[s[1]])),i=e.delaunay.urquhart(r);return{type:"FeatureCollection",features:e.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:e.valid[s[0]],target:e.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[e.points[s[0]],e.points[s[1]]]}}))}},e.mesh=function(t){return t!==void 0&&e(t),e.delaunay?{type:"MultiLineString",coordinates:e.delaunay.edges.map(r=>[e.points[r[0]],e.points[r[1]]])}:!1},e.cellMesh=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const{centers:r,polygons:i}=e.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,c=o[a-1],f=o[0],p=0;p<a;c=f,f=o[++p])f>c&&s.push([r[c],r[f]]);return{type:"MultiLineString",coordinates:s}},e._found=void 0,e.find=function(t,r,i){if(e._found=e.delaunay.find(t,r,e._found),!i||Qo([t,r],e.points[e._found])<i)return e._found},e.hull=function(t){t!==void 0&&e(t);const r=e.delaunay.hull,i=e.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},n?e(n):e}function Xm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function rL(n){if(Array.isArray(n))return n}function iL(n){if(Array.isArray(n))return Xm(n)}function sL(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function oL(n,e,t){return e=Nh(e),dL(n,Z4()?Reflect.construct(e,[],Nh(n).constructor):e.apply(n,t))}function aL(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function lL(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function Nh(n){return Nh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Nh(n)}function uL(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Ym(n,e)}function Z4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Z4=function(){return!!n})()}function AL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function cL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function hL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dL(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sL(n)}function Ym(n,e){return Ym=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Ym(n,e)}function fs(n,e){return rL(n)||cL(n,e)||J4(n,e)||hL()}function Qd(n){return iL(n)||AL(n)||J4(n)||fL()}function J4(n,e){if(n){if(typeof n=="string")return Xm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Xm(n,e):void 0}}function pL(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.resolution,r=t===void 0?1/0:t,i=mL(n,r),s=SA(i),o=gL(n,r),a=[].concat(Qd(s),Qd(o)),c={type:"Polygon",coordinates:n},f=y4(c),p=fs(f,2),g=fs(p[0],2),b=g[0],x=g[1],T=fs(p[1],2),S=T[0],E=T[1],C=b>S||E>=89||x<=-89,P=[];if(C){var D=nL(a).triangles(),L=new Map(a.map(function(he,xe){var me=fs(he,2),Oe=me[0],ke=me[1];return["".concat(Oe,"-").concat(ke),xe]}));D.features.forEach(function(he){var xe,me=he.geometry.coordinates[0].slice(0,3).reverse(),Oe=[];if(me.forEach(function(Ke){var Ye=fs(Ke,2),Ft=Ye[0],mt=Ye[1],Lt="".concat(Ft,"-").concat(mt);L.has(Lt)&&Oe.push(L.get(Lt))}),Oe.length===3){if(Oe.some(function(Ke){return Ke<s.length})){var ke=he.properties.circumcenter;if(!Km(ke,c,C))return}(xe=P).push.apply(xe,Oe)}})}else if(o.length)for(var j=DA.from(a),J=function(xe){var me,Oe=[2,1,0].map(function(Ye){return j.triangles[xe+Ye]}),ke=Oe.map(function(Ye){return a[Ye]});if(Oe.some(function(Ye){return Ye<s.length})){var Ke=[0,1].map(function(Ye){return CM(ke,function(Ft){return Ft[Ye]})});if(!Km(Ke,c,C))return 1}(me=P).push.apply(me,Qd(Oe))},Q=0,K=j.triangles.length;Q<K;Q+=3)J(Q);else{var k=xh(i),q=k.vertices,I=k.holes,U=I===void 0?[]:I;P=UP(q,U,2)}var te=ro(Z0(a,function(he){return he[0]}),[0,1]),oe=ro(Z0(a,function(he){return he[1]}),[0,1]),Y=a.map(function(he){var xe=fs(he,2),me=xe[0],Oe=xe[1];return[te(me),oe(Oe)]}),ae={points:a,indices:P,uvs:Y};return{contour:i,triangles:ae}}function mL(n,e){return n.map(function(t){var r=[],i;return t.forEach(function(s){if(i){var o=Qo(s,i)*180/Math.PI;if(o>e)for(var a=f1(i,s),c=1/Math.ceil(o/e),f=c;f<1;)r.push(a(f)),f+=c}r.push(i=s)}),r})}function gL(n,e){var t={type:"Polygon",coordinates:n},r=y4(t),i=fs(r,2),s=fs(i[0],2),o=s[0],a=s[1],c=fs(i[1],2),f=c[0],p=c[1];if(Math.min(Math.abs(f-o),Math.abs(p-a))<e)return[];var g=o>f||p>=89||a<=-89;return yL(e,{minLng:o,maxLng:f,minLat:a,maxLat:p}).filter(function(b){return Km(b,t,g)})}function yL(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.minLng,r=e.maxLng,i=e.minLat,s=e.maxLat,o=Math.round(Math.pow(360/n,2)/Math.PI),a=(1+Math.sqrt(5))/2,c=function(C){return C/a*360%360-180},f=function(C){return Math.acos(2*C/o-1)/Math.PI*180-90},p=function(C){return o*(Math.cos((C+90)*Math.PI/180)+1)/2},g=[s!==void 0?Math.ceil(p(s)):0,i!==void 0?Math.floor(p(i)):o-1],b=t===void 0&&r===void 0?function(){return!0}:t===void 0?function(E){return E<=r}:r===void 0?function(E){return E>=t}:r>=t?function(E){return E>=t&&E<=r}:function(E){return E>=t||E<=r},x=[],T=g[0];T<=g[1];T++){var S=c(T);b(S)&&x.push([S,f(T)])}return x}function Km(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?J9(e,n):PD(n,e)}var M0=window.THREE?window.THREE:{BufferGeometry:$r,Float32BufferAttribute:Ns},Q3=new M0.BufferGeometry().setAttribute?"setAttribute":"addAttribute",T1=function(n){function e(t,r,i,s,o,a,c){var f;aL(this,e),f=oL(this,e),f.type="ConicPolygonGeometry",f.parameters={polygonGeoJson:t,bottomHeight:r,topHeight:i,closedBottom:s,closedTop:o,includeSides:a,curvatureResolution:c},r=r||0,i=i||1,s=s!==void 0?s:!0,o=o!==void 0?o:!0,a=a!==void 0?a:!0,c=c||5;var p=pL(t,{resolution:c}),g=p.contour,b=p.triangles,x=SA(b.uvs),T=[],S=[],E=[],C=0,P=function(I){var U=Math.round(T.length/3),j=E.length;T=T.concat(I.vertices),S=S.concat(I.uvs),E=E.concat(U?I.indices.map(function(J){return J+U}):I.indices),f.addGroup(j,E.length-j,C++)};a&&P(L()),s&&P(k(r,!1)),o&&P(k(i,!0)),f.setIndex(E),f[Q3]("position",new M0.Float32BufferAttribute(T,3)),f[Q3]("uv",new M0.Float32BufferAttribute(S,2)),f.computeVertexNormals();function D(q,I){var U=typeof I=="function"?I:function(){return I},j=q.map(function(J){return J.map(function(Q){var K=fs(Q,2),te=K[0],oe=K[1];return _L(oe,te,U(te,oe))})});return xh(j)}function L(){for(var q=D(g,r),I=q.vertices,U=q.holes,j=D(g,i),J=j.vertices,Q=SA([J,I]),K=Math.round(J.length/3),te=new Set(U),oe=0,Y=[],ae=0;ae<K;ae++){var he=ae+1;if(he===K)he=oe;else if(te.has(he)){var xe=he;he=oe,oe=xe}Y.push(ae,ae+K,he+K),Y.push(he+K,he,ae)}for(var me=[],Oe=1;Oe>=0;Oe--)for(var ke=0;ke<K;ke+=1)me.push(ke/(K-1),Oe);return{indices:Y,vertices:Q,uvs:me}}function k(q){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return{indices:I?b.indices:b.indices.slice().reverse(),vertices:D([b.points],q).vertices,uvs:x}}return f}return uL(e,n),lL(e)}(M0.BufferGeometry);function _L(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return[t*Math.sin(r)*Math.cos(i),t*Math.cos(r),t*Math.sin(r)*Math.sin(i)]}function Zm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function bL(n){if(Array.isArray(n))return n}function vL(n){if(Array.isArray(n))return Zm(n)}function xL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function TL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function wL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EL(n,e){if(n==null)return{};var t,r,i=RL(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.includes(t)||{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function RL(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.includes(r))continue;t[r]=n[r]}return t}function NL(n,e){return bL(n)||TL(n,e)||eT(n,e)||wL()}function CL(n){return vL(n)||xL(n)||eT(n)||SL()}function ML(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function PL(n){var e=ML(n,"string");return typeof e=="symbol"?e:e+""}function eT(n,e){if(n){if(typeof n=="string")return Zm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Zm(n,e):void 0}}var BL=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(a){return{keyAccessor:a,isProp:!(a instanceof Function)}}),s=n.reduce(function(a,c){var f=a,p=c;return i.forEach(function(g,b){var x=g.keyAccessor,T=g.isProp,S;if(T){var E=p,C=E[x],P=EL(E,[x].map(PL));S=C,p=P}else S=x(p,b);b+1<i.length?(f.hasOwnProperty(S)||(f[S]={}),f=f[S]):t?(f.hasOwnProperty(S)||(f[S]=[]),f[S].push(p)):f[S]=p}),a},{});t instanceof Function&&function a(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;f===i.length?Object.keys(c).forEach(function(p){return c[p]=t(c[p])}):Object.values(c).forEach(function(p){return a(p,f+1)})}(s);var o=s;return r&&(o=[],function a(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];f.length===i.length?o.push({keys:f,vals:c}):Object.entries(c).forEach(function(p){var g=NL(p,2),b=g[0],x=g[1];return a(x,[].concat(CL(f),[b]))})}(s),e instanceof Array&&e.length===0&&o.length===1&&(o[0].keys=[])),o},Nt=function(n){n=n||{};var e=typeof n<"u"?n:{},t={},r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);var i="";function s(fe){return e.locateFile?e.locateFile(fe,i):i+fe}var o;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",o=function(be,Fe,Te){var A=new XMLHttpRequest;A.open("GET",be,!0),A.responseType="arraybuffer",A.onload=function(){if(A.status==200||A.status==0&&A.response){Fe(A.response);return}var Mt=nd(be);if(Mt){Fe(Mt.buffer);return}Te()},A.onerror=Te,A.send(null)};var a=e.print||console.log.bind(console),c=e.printErr||console.warn.bind(console);for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);t=null,e.arguments&&e.arguments;var f=0,p=function(fe){f=fe},g=function(){return f},b=8;function x(fe,be,Fe,Te){switch(Fe=Fe||"i8",Fe.charAt(Fe.length-1)==="*"&&(Fe="i32"),Fe){case"i1":K[fe>>0]=be;break;case"i8":K[fe>>0]=be;break;case"i16":oe[fe>>1]=be;break;case"i32":Y[fe>>2]=be;break;case"i64":td=[be>>>0,(el=be,+zn(el)>=1?el>0?(aa(+po(el/4294967296),4294967295)|0)>>>0:~~+Wr((el-+(~~el>>>0))/4294967296)>>>0:0)],Y[fe>>2]=td[0],Y[fe+4>>2]=td[1];break;case"float":ae[fe>>2]=be;break;case"double":he[fe>>3]=be;break;default:tl("invalid type for setValue: "+Fe)}}function T(fe,be,Fe){switch(be=be||"i8",be.charAt(be.length-1)==="*"&&(be="i32"),be){case"i1":return K[fe>>0];case"i8":return K[fe>>0];case"i16":return oe[fe>>1];case"i32":return Y[fe>>2];case"i64":return Y[fe>>2];case"float":return ae[fe>>2];case"double":return he[fe>>3];default:tl("invalid type for getValue: "+be)}return null}var S=!1;function E(fe,be){fe||tl("Assertion failed: "+be)}function C(fe){var be=e["_"+fe];return E(be,"Cannot call unknown function "+fe+", make sure it is exported"),be}function P(fe,be,Fe,Te,A){var O={string:function(yt){var ui=0;if(yt!=null&&yt!==0){var cc=(yt.length<<2)+1;ui=my(cc),U(yt,ui,cc)}return ui},array:function(yt){var ui=my(yt.length);return j(yt,ui),ui}};function Mt(yt){return be==="string"?q(yt):be==="boolean"?!!yt:yt}var Gt=C(fe),Qn=[],gt=0;if(Te)for(var Pt=0;Pt<Te.length;Pt++){var mo=O[Fe[Pt]];mo?(gt===0&&(gt=E7()),Qn[Pt]=mo(Te[Pt])):Qn[Pt]=Te[Pt]}var Ot=Gt.apply(null,Qn);return Ot=Mt(Ot),gt!==0&&S7(gt),Ot}function D(fe,be,Fe,Te){Fe=Fe||[];var A=Fe.every(function(Mt){return Mt==="number"}),O=be!=="string";return O&&A&&!Te?C(fe):function(){return P(fe,be,Fe,arguments)}}var L=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function k(fe,be,Fe){for(var Te=be+Fe,A=be;fe[A]&&!(A>=Te);)++A;if(A-be>16&&fe.subarray&&L)return L.decode(fe.subarray(be,A));for(var O="";be<A;){var Mt=fe[be++];if(!(Mt&128)){O+=String.fromCharCode(Mt);continue}var Gt=fe[be++]&63;if((Mt&224)==192){O+=String.fromCharCode((Mt&31)<<6|Gt);continue}var Qn=fe[be++]&63;if((Mt&240)==224?Mt=(Mt&15)<<12|Gt<<6|Qn:Mt=(Mt&7)<<18|Gt<<12|Qn<<6|fe[be++]&63,Mt<65536)O+=String.fromCharCode(Mt);else{var gt=Mt-65536;O+=String.fromCharCode(55296|gt>>10,56320|gt&1023)}}return O}function q(fe,be){return fe?k(te,fe,be):""}function I(fe,be,Fe,Te){if(!(Te>0))return 0;for(var A=Fe,O=Fe+Te-1,Mt=0;Mt<fe.length;++Mt){var Gt=fe.charCodeAt(Mt);if(Gt>=55296&&Gt<=57343){var Qn=fe.charCodeAt(++Mt);Gt=65536+((Gt&1023)<<10)|Qn&1023}if(Gt<=127){if(Fe>=O)break;be[Fe++]=Gt}else if(Gt<=2047){if(Fe+1>=O)break;be[Fe++]=192|Gt>>6,be[Fe++]=128|Gt&63}else if(Gt<=65535){if(Fe+2>=O)break;be[Fe++]=224|Gt>>12,be[Fe++]=128|Gt>>6&63,be[Fe++]=128|Gt&63}else{if(Fe+3>=O)break;be[Fe++]=240|Gt>>18,be[Fe++]=128|Gt>>12&63,be[Fe++]=128|Gt>>6&63,be[Fe++]=128|Gt&63}}return be[Fe]=0,Fe-A}function U(fe,be,Fe){return I(fe,te,be,Fe)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function j(fe,be){K.set(fe,be)}function J(fe,be){return fe%be>0&&(fe+=be-fe%be),fe}var Q,K,te,oe,Y,ae,he;function xe(fe){Q=fe,e.HEAP8=K=new Int8Array(fe),e.HEAP16=oe=new Int16Array(fe),e.HEAP32=Y=new Int32Array(fe),e.HEAPU8=te=new Uint8Array(fe),e.HEAPU16=new Uint16Array(fe),e.HEAPU32=new Uint32Array(fe),e.HEAPF32=ae=new Float32Array(fe),e.HEAPF64=he=new Float64Array(fe)}var me=5271536,Oe=28624,ke=e.TOTAL_MEMORY||33554432;e.buffer?Q=e.buffer:Q=new ArrayBuffer(ke),ke=Q.byteLength,xe(Q),Y[Oe>>2]=me;function Ke(fe){for(;fe.length>0;){var be=fe.shift();if(typeof be=="function"){be();continue}var Fe=be.func;typeof Fe=="number"?be.arg===void 0?e.dynCall_v(Fe):e.dynCall_vi(Fe,be.arg):Fe(be.arg===void 0?null:be.arg)}}var Ye=[],Ft=[],mt=[],Lt=[];function Wt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)xn(e.preRun.shift());Ke(Ye)}function Pn(){Ke(Ft)}function Vn(){Ke(mt)}function vn(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Bn(e.postRun.shift());Ke(Lt)}function xn(fe){Ye.unshift(fe)}function Bn(fe){Lt.unshift(fe)}var zn=Math.abs,Wr=Math.ceil,po=Math.floor,aa=Math.min,li=0,Di=null;function c7(fe){li++,e.monitorRunDependencies&&e.monitorRunDependencies(li)}function h7(fe){if(li--,e.monitorRunDependencies&&e.monitorRunDependencies(li),li==0&&Di){var be=Di;Di=null,be()}}e.preloadedImages={},e.preloadedAudios={};var Is=null,ed="data:application/octet-stream;base64,";function dy(fe){return String.prototype.startsWith?fe.startsWith(ed):fe.indexOf(ed)===0}var el,td;Is="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAdmVydGV4Um90YXRpb25zAGNlbGxUb1ZlcnRleABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var f7=28640;function d7(fe,be,Fe,Te){tl("Assertion failed: "+q(fe)+", at: "+[be?q(be):"unknown filename",Fe,Te?q(Te):"unknown function"])}function py(){return K.length}function p7(fe,be,Fe){te.set(te.subarray(be,be+Fe),fe)}function m7(fe){return e.___errno_location&&(Y[e.___errno_location()>>2]=fe),fe}function g7(fe){tl("OOM")}function y7(fe){try{var be=new ArrayBuffer(fe);return be.byteLength!=fe?void 0:(new Int8Array(be).set(K),w7(be),xe(be),1)}catch{}}function _7(fe){var be=py(),Fe=16777216,Te=2147483648-Fe;if(fe>Te)return!1;for(var A=16777216,O=Math.max(be,A);O<fe;)O<=536870912?O=J(2*O,Fe):O=Math.min(J((3*O+2147483648)/4,Fe),Te);var Mt=y7(O);return!!Mt}var b7=typeof atob=="function"?atob:function(fe){var be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Fe="",Te,A,O,Mt,Gt,Qn,gt,Pt=0;fe=fe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Mt=be.indexOf(fe.charAt(Pt++)),Gt=be.indexOf(fe.charAt(Pt++)),Qn=be.indexOf(fe.charAt(Pt++)),gt=be.indexOf(fe.charAt(Pt++)),Te=Mt<<2|Gt>>4,A=(Gt&15)<<4|Qn>>2,O=(Qn&3)<<6|gt,Fe=Fe+String.fromCharCode(Te),Qn!==64&&(Fe=Fe+String.fromCharCode(A)),gt!==64&&(Fe=Fe+String.fromCharCode(O));while(Pt<fe.length);return Fe};function v7(fe){try{for(var be=b7(fe),Fe=new Uint8Array(be.length),Te=0;Te<be.length;++Te)Fe[Te]=be.charCodeAt(Te);return Fe}catch{throw new Error("Converting base64 string to bytes failed.")}}function nd(fe){if(dy(fe))return v7(fe.slice(ed.length))}var x7={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},T7={b:p,c:g,d:d7,e:m7,f:py,g:p7,h:_7,i:g7,o:f7,p:Oe},Ee=function(fe,be,Fe){"almost asm";var Te=new fe.Int8Array(Fe),A=new fe.Int32Array(Fe);new fe.Uint8Array(Fe),new fe.Float32Array(Fe);var O=new fe.Float64Array(Fe),Mt=be.o|0,Gt=be.p|0,Qn=fe.Math.floor,gt=fe.Math.abs,Pt=fe.Math.sqrt,mo=fe.Math.pow,Ot=fe.Math.cos,yt=fe.Math.sin,ui=fe.Math.tan,cc=fe.Math.acos,R7=fe.Math.asin,sd=fe.Math.atan,Ai=fe.Math.atan2,nl=fe.Math.ceil,es=fe.Math.imul,od=fe.Math.min,N7=fe.Math.max,ks=fe.Math.clz32,ut=be.b,V=be.c,rt=be.d,by=be.e,C7=be.f,M7=be.g,P7=be.h,B7=be.i,F=28656;function D7(u){return Te=new Int8Array(u),A=new Int32Array(u),O=new Float64Array(u),Fe=u,!0}function L7(u){u=u|0;var l=0;return l=F,F=F+u|0,F=F+15&-16,l|0}function O7(){return F|0}function F7(u){u=u|0,F=u}function I7(u,l){u=u|0,F=u}function k7(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return(u|0)<0?(l=2,l|0):(u|0)>13780509?(l=mc(15,l)|0,l|0):(h=((u|0)<0)<<31>>31,m=Kn(u|0,h|0,3,0)|0,d=V()|0,h=We(u|0,h|0,1,0)|0,h=Kn(m|0,d|0,h|0,V()|0)|0,h=We(h|0,V()|0,1,0)|0,u=V()|0,A[l>>2]=h,A[l+4>>2]=u,l=0,l|0)}function vy(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,xy(u,l,h,d,0)|0}function xy(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0;if(w=F,F=F+16|0,_=w,!(Ty(u,l,h,d,m)|0))return d=0,F=w,d|0;do if((h|0)>=0){if((h|0)>13780509){if(y=mc(15,_)|0,y|0)break;v=_,_=A[v>>2]|0,v=A[v+4>>2]|0}else y=((h|0)<0)<<31>>31,R=Kn(h|0,y|0,3,0)|0,v=V()|0,y=We(h|0,y|0,1,0)|0,y=Kn(R|0,v|0,y|0,V()|0)|0,y=We(y|0,V()|0,1,0)|0,v=V()|0,A[_>>2]=y,A[_+4>>2]=v,_=y;if(vo(d|0,0,_<<3|0)|0,m|0){vo(m|0,0,_<<2|0)|0,y=ts(u,l,h,d,m,_,v,0)|0;break}y=Lr(_,4)|0,y?(R=ts(u,l,h,d,y,_,v,0)|0,Qe(y),y=R):y=13}else y=2;while(!1);return R=y,F=w,R|0}function Ty(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0;if(ne=F,F=F+16|0,H=ne,W=ne+8|0,$=H,A[$>>2]=u,A[$+4>>2]=l,(h|0)<0)return W=2,F=ne,W|0;if(y=d,A[y>>2]=u,A[y+4>>2]=l,y=(m|0)!=0,y&&(A[m>>2]=0),Zt(u,l)|0)return W=9,F=ne,W|0;A[W>>2]=0;e:do if((h|0)>=1)if(y)for(M=1,R=0,G=0,$=1,y=u;;){if(!(R|G)){if(y=Xn(y,l,4,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,Zt(y,l)|0){y=9;break e}}if(y=Xn(y,l,A[26800+(G<<2)>>2]|0,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,u=d+(M<<3)|0,A[u>>2]=y,A[u+4>>2]=l,A[m+(M<<2)>>2]=$,u=R+1|0,_=(u|0)==($|0),v=G+1|0,w=(v|0)==6,Zt(y,l)|0){y=9;break e}if($=$+(w&_&1)|0,($|0)>(h|0)){y=0;break}else M=M+1|0,R=_?0:u,G=_?w?0:v:G}else for(M=1,R=0,G=0,$=1,y=u;;){if(!(R|G)){if(y=Xn(y,l,4,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,Zt(y,l)|0){y=9;break e}}if(y=Xn(y,l,A[26800+(G<<2)>>2]|0,W,H)|0,y|0)break e;if(l=H,y=A[l>>2]|0,l=A[l+4>>2]|0,u=d+(M<<3)|0,A[u>>2]=y,A[u+4>>2]=l,u=R+1|0,_=(u|0)==($|0),v=G+1|0,w=(v|0)==6,Zt(y,l)|0){y=9;break e}if($=$+(w&_&1)|0,($|0)>(h|0)){y=0;break}else M=M+1|0,R=_?0:u,G=_?w?0:v:G}else y=0;while(!1);return W=y,F=ne,W|0}function ts(u,l,h,d,m,y,_,v){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0,_=_|0,v=v|0;var w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0;if(ne=F,F=F+16|0,H=ne+8|0,W=ne,w=ll(u|0,l|0,y|0,_|0)|0,M=V()|0,G=d+(w<<3)|0,se=G,ce=A[se>>2]|0,se=A[se+4>>2]|0,R=(ce|0)==(u|0)&(se|0)==(l|0),!((ce|0)==0&(se|0)==0|R))do w=We(w|0,M|0,1,0)|0,w=al(w|0,V()|0,y|0,_|0)|0,M=V()|0,G=d+(w<<3)|0,ce=G,se=A[ce>>2]|0,ce=A[ce+4>>2]|0,R=(se|0)==(u|0)&(ce|0)==(l|0);while(!((se|0)==0&(ce|0)==0|R));if(w=m+(w<<2)|0,R&&(A[w>>2]|0)<=(v|0)||(ce=G,A[ce>>2]=u,A[ce+4>>2]=l,A[w>>2]=v,(v|0)>=(h|0)))return ce=0,F=ne,ce|0;switch(R=v+1|0,A[H>>2]=0,w=Xn(u,l,2,H,W)|0,w|0){case 9:{$=9;break}case 0:{w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w||($=9);break}}e:do if(($|0)==9){switch(A[H>>2]=0,w=Xn(u,l,3,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Xn(u,l,1,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Xn(u,l,5,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Xn(u,l,4,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}switch(A[H>>2]=0,w=Xn(u,l,6,H,W)|0,w|0){case 9:break;case 0:{if(w=W,w=ts(A[w>>2]|0,A[w+4>>2]|0,h,d,m,y,_,R)|0,w|0)break e;break}default:break e}return ce=0,F=ne,ce|0}while(!1);return ce=w,F=ne,ce|0}function Xn(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(h>>>0>6)return m=1,m|0;if(G=(A[d>>2]|0)%6|0,A[d>>2]=G,(G|0)>0){y=0;do h=Aa(h)|0,y=y+1|0;while((y|0)<(A[d>>2]|0))}if(G=_e(u|0,l|0,45)|0,V()|0,M=G&127,M>>>0>121)return m=5,m|0;w=Dr(u,l)|0,y=_e(u|0,l|0,52)|0,V()|0,y=y&15;e:do if(!y)R=8;else{for(;;){if(_=(15-y|0)*3|0,v=_e(u|0,l|0,_|0)|0,V()|0,v=v&7,(v|0)==7){l=5;break}if(W=(ci(y)|0)==0,y=y+-1|0,$=Re(7,0,_|0)|0,l=l&~(V()|0),H=Re(A[(W?432:16)+(v*28|0)+(h<<2)>>2]|0,0,_|0)|0,_=V()|0,h=A[(W?640:224)+(v*28|0)+(h<<2)>>2]|0,u=H|u&~$,l=_|l,!h){h=0;break e}if(!y){R=8;break e}}return l|0}while(!1);(R|0)==8&&(W=A[848+(M*28|0)+(h<<2)>>2]|0,H=Re(W|0,0,45)|0,u=H|u,l=V()|0|l&-1040385,h=A[4272+(M*28|0)+(h<<2)>>2]|0,(W&127|0)==127&&(W=Re(A[848+(M*28|0)+20>>2]|0,0,45)|0,l=V()|0|l&-1040385,h=A[4272+(M*28|0)+20>>2]|0,u=ca(W|u,l)|0,l=V()|0,A[d>>2]=(A[d>>2]|0)+1)),v=_e(u|0,l|0,45)|0,V()|0,v=v&127;e:do if(an(v)|0){t:do if((Dr(u,l)|0)==1){if((M|0)!=(v|0))if(Ry(v,A[7696+(M*28|0)>>2]|0)|0){u=vd(u,l)|0,_=1,l=V()|0;break}else rt(27795,26864,533,26872);switch(w|0){case 3:{u=ca(u,l)|0,l=V()|0,A[d>>2]=(A[d>>2]|0)+1,_=0;break t}case 5:{u=vd(u,l)|0,l=V()|0,A[d>>2]=(A[d>>2]|0)+5,_=0;break t}case 0:return W=9,W|0;default:return W=1,W|0}}else _=0;while(!1);if((h|0)>0){y=0;do u=bd(u,l)|0,l=V()|0,y=y+1|0;while((y|0)!=(h|0))}if((M|0)!=(v|0)){if(!(ld(v)|0)){if((_|0)!=0|(Dr(u,l)|0)!=5)break;A[d>>2]=(A[d>>2]|0)+1;break}switch(G&127){case 8:case 118:break e}(Dr(u,l)|0)!=3&&(A[d>>2]=(A[d>>2]|0)+1)}}else if((h|0)>0){y=0;do u=ca(u,l)|0,l=V()|0,y=y+1|0;while((y|0)!=(h|0))}while(!1);return A[d>>2]=((A[d>>2]|0)+h|0)%6|0,W=m,A[W>>2]=u,A[W+4>>2]=l,W=0,W|0}function U7(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,wy(u,l,h,d)|0?(vo(d|0,0,h*48|0)|0,d=q7(u,l,h,d)|0,d|0):(d=0,d|0)}function wy(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(W=F,F=F+16|0,$=W,H=W+8|0,G=$,A[G>>2]=u,A[G+4>>2]=l,(h|0)<0)return H=2,F=W,H|0;if(!h)return H=d,A[H>>2]=u,A[H+4>>2]=l,H=0,F=W,H|0;A[H>>2]=0;e:do if(Zt(u,l)|0)u=9;else{m=0,G=u;do{if(u=Xn(G,l,4,H,$)|0,u|0)break e;if(l=$,G=A[l>>2]|0,l=A[l+4>>2]|0,m=m+1|0,Zt(G,l)|0){u=9;break e}}while((m|0)<(h|0));M=d,A[M>>2]=G,A[M+4>>2]=l,M=h+-1|0,R=0,u=1;do{if(m=26800+(R<<2)|0,(R|0)==5)for(_=A[m>>2]|0,y=0,m=u;;){if(u=$,u=Xn(A[u>>2]|0,A[u+4>>2]|0,_,H,$)|0,u|0)break e;if((y|0)!=(M|0))if(w=$,v=A[w>>2]|0,w=A[w+4>>2]|0,u=d+(m<<3)|0,A[u>>2]=v,A[u+4>>2]=w,!(Zt(v,w)|0))u=m+1|0;else{u=9;break e}else u=m;if(y=y+1|0,(y|0)>=(h|0))break;m=u}else for(_=$,w=A[m>>2]|0,v=0,m=u,y=A[_>>2]|0,_=A[_+4>>2]|0;;){if(u=Xn(y,_,w,H,$)|0,u|0)break e;if(_=$,y=A[_>>2]|0,_=A[_+4>>2]|0,u=d+(m<<3)|0,A[u>>2]=y,A[u+4>>2]=_,u=m+1|0,Zt(y,_)|0){u=9;break e}if(v=v+1|0,(v|0)>=(h|0))break;m=u}R=R+1|0}while(R>>>0<6);u=$,u=(G|0)==(A[u>>2]|0)&&(l|0)==(A[u+4>>2]|0)?0:9}while(!1);return H=u,F=W,H|0}function q7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0;if(G=F,F=F+16|0,_=G,!h)return A[d>>2]=u,A[d+4>>2]=l,d=0,F=G,d|0;do if((h|0)>=0){if((h|0)>13780509){if(m=mc(15,_)|0,m|0)break;y=_,m=A[y>>2]|0,y=A[y+4>>2]|0}else m=((h|0)<0)<<31>>31,M=Kn(h|0,m|0,3,0)|0,y=V()|0,m=We(h|0,m|0,1,0)|0,m=Kn(M|0,y|0,m|0,V()|0)|0,m=We(m|0,V()|0,1,0)|0,y=V()|0,M=_,A[M>>2]=m,A[M+4>>2]=y;if(R=Lr(m,8)|0,!R)m=13;else{if(M=Lr(m,4)|0,!M){Qe(R),m=13;break}if(m=ts(u,l,h,R,M,m,y,0)|0,m|0){Qe(R),Qe(M);break}if(l=A[_>>2]|0,_=A[_+4>>2]|0,(_|0)>0|(_|0)==0&l>>>0>0){m=0,v=0,w=0;do u=R+(v<<3)|0,y=A[u>>2]|0,u=A[u+4>>2]|0,!((y|0)==0&(u|0)==0)&&(A[M+(v<<2)>>2]|0)==(h|0)&&($=d+(m<<3)|0,A[$>>2]=y,A[$+4>>2]=u,m=m+1|0),v=We(v|0,w|0,1,0)|0,w=V()|0;while((w|0)<(_|0)|(w|0)==(_|0)&v>>>0<l>>>0)}Qe(R),Qe(M),m=0}}else m=2;while(!1);return $=m,F=G,$|0}function ad(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0;for(v=F,F=F+16|0,y=v,_=v+8|0,m=(Zt(u,l)|0)==0,m=m?1:2;;){if(A[_>>2]=0,R=(Xn(u,l,m,_,y)|0)==0,w=y,R&((A[w>>2]|0)==(h|0)?(A[w+4>>2]|0)==(d|0):0)){u=4;break}if(m=m+1|0,m>>>0>=7){m=7,u=4;break}}return(u|0)==4?(F=v,m|0):0}function G7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0;if(v=F,F=F+48|0,m=v+16|0,y=v+8|0,_=v,h=wu(h)|0,h|0)return _=h,F=v,_|0;if(R=u,w=A[R+4>>2]|0,h=y,A[h>>2]=A[R>>2],A[h+4>>2]=w,Jy(y,m),h=Py(m,l,_)|0,!h){if(l=A[y>>2]|0,y=A[u+8>>2]|0,(y|0)>0){m=A[u+12>>2]|0,h=0;do l=(A[m+(h<<3)>>2]|0)+l|0,h=h+1|0;while((h|0)<(y|0))}h=_,m=A[h>>2]|0,h=A[h+4>>2]|0,y=((l|0)<0)<<31>>31,(h|0)<(y|0)|(h|0)==(y|0)&m>>>0<l>>>0?(h=_,A[h>>2]=l,A[h+4>>2]=y,h=y):l=m,w=We(l|0,h|0,12,0)|0,R=V()|0,h=_,A[h>>2]=w,A[h+4>>2]=R,h=d,A[h>>2]=w,A[h+4>>2]=R,h=0}return R=h,F=v,R|0}function Sy(u,l,h,d,m,y,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0,_=_|0;var v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0,At=0,bt=0,nt=0,He=0,Ne=0,pt=0,Qt=0,ht=0,Xt=0,xr=0,f_=0;if(Qt=F,F=F+64|0,nt=Qt+48|0,He=Qt+32|0,Ne=Qt+24|0,Ce=Qt+8|0,$e=Qt,w=A[u>>2]|0,(w|0)<=0)return pt=0,F=Qt,pt|0;for(qe=u+4|0,lt=nt+8|0,At=He+8|0,bt=Ce+8|0,v=0,le=0;;){R=A[qe>>2]|0,Ae=R+(le<<4)|0,A[nt>>2]=A[Ae>>2],A[nt+4>>2]=A[Ae+4>>2],A[nt+8>>2]=A[Ae+8>>2],A[nt+12>>2]=A[Ae+12>>2],(le|0)==(w+-1|0)?(A[He>>2]=A[R>>2],A[He+4>>2]=A[R+4>>2],A[He+8>>2]=A[R+8>>2],A[He+12>>2]=A[R+12>>2]):(Ae=R+(le+1<<4)|0,A[He>>2]=A[Ae>>2],A[He+4>>2]=A[Ae+4>>2],A[He+8>>2]=A[Ae+8>>2],A[He+12>>2]=A[Ae+12>>2]),w=J7(nt,He,d,Ne)|0;e:do if(w)R=0,v=w;else if(w=Ne,R=A[w>>2]|0,w=A[w+4>>2]|0,(w|0)>0|(w|0)==0&R>>>0>0){ce=0,Ae=0;t:for(;;){if(Xt=1/(+(R>>>0)+4294967296*+(w|0)),f_=+O[nt>>3],w=Yn(R|0,w|0,ce|0,Ae|0)|0,xr=+(w>>>0)+4294967296*+(V()|0),ht=+(ce>>>0)+4294967296*+(Ae|0),O[Ce>>3]=Xt*(f_*xr)+Xt*(+O[He>>3]*ht),O[bt>>3]=Xt*(+O[lt>>3]*xr)+Xt*(+O[At>>3]*ht),w=xd(Ce,d,$e)|0,w|0){v=w;break}se=$e,ne=A[se>>2]|0,se=A[se+4>>2]|0,$=ll(ne|0,se|0,l|0,h|0)|0,M=V()|0,w=_+($<<3)|0,G=w,R=A[G>>2]|0,G=A[G+4>>2]|0;n:do if((R|0)==0&(G|0)==0)ie=w,pt=16;else for(H=0,W=0;;){if((H|0)>(h|0)|(H|0)==(h|0)&W>>>0>l>>>0){v=1;break t}if((R|0)==(ne|0)&(G|0)==(se|0))break n;if(w=We($|0,M|0,1,0)|0,$=al(w|0,V()|0,l|0,h|0)|0,M=V()|0,W=We(W|0,H|0,1,0)|0,H=V()|0,w=_+($<<3)|0,G=w,R=A[G>>2]|0,G=A[G+4>>2]|0,(R|0)==0&(G|0)==0){ie=w,pt=16;break}}while(!1);if((pt|0)==16&&(pt=0,!((ne|0)==0&(se|0)==0))&&(W=ie,A[W>>2]=ne,A[W+4>>2]=se,W=y+(A[m>>2]<<3)|0,A[W>>2]=ne,A[W+4>>2]=se,W=m,W=We(A[W>>2]|0,A[W+4>>2]|0,1,0)|0,ne=V()|0,se=m,A[se>>2]=W,A[se+4>>2]=ne),ce=We(ce|0,Ae|0,1,0)|0,Ae=V()|0,w=Ne,R=A[w>>2]|0,w=A[w+4>>2]|0,!((w|0)>(Ae|0)|(w|0)==(Ae|0)&R>>>0>ce>>>0)){R=1;break e}}R=0}else R=1;while(!1);if(le=le+1|0,!R){pt=21;break}if(w=A[u>>2]|0,(le|0)>=(w|0)){v=0,pt=21;break}}return(pt|0)==21?(F=Qt,v|0):0}function V7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0,At=0,bt=0,nt=0,He=0,Ne=0,pt=0,Qt=0,ht=0,Xt=0,xr=0;if(xr=F,F=F+112|0,pt=xr+80|0,w=xr+72|0,Qt=xr,ht=xr+56|0,m=wu(h)|0,m|0)return Xt=m,F=xr,Xt|0;if(R=u+8|0,Xt=ns((A[R>>2]<<5)+32|0)|0,!Xt)return Xt=13,F=xr,Xt|0;if(Cd(u,Xt),m=wu(h)|0,!m){if(He=u,Ne=A[He+4>>2]|0,m=w,A[m>>2]=A[He>>2],A[m+4>>2]=Ne,Jy(w,pt),m=Py(pt,l,Qt)|0,m)He=0,Ne=0;else{if(m=A[w>>2]|0,y=A[R>>2]|0,(y|0)>0){_=A[u+12>>2]|0,h=0;do m=(A[_+(h<<3)>>2]|0)+m|0,h=h+1|0;while((h|0)!=(y|0));h=m}else h=m;m=Qt,y=A[m>>2]|0,m=A[m+4>>2]|0,_=((h|0)<0)<<31>>31,(m|0)<(_|0)|(m|0)==(_|0)&y>>>0<h>>>0?(m=Qt,A[m>>2]=h,A[m+4>>2]=_,m=_):h=y,He=We(h|0,m|0,12,0)|0,Ne=V()|0,m=Qt,A[m>>2]=He,A[m+4>>2]=Ne,m=0}if(!m){if(h=Lr(He,8)|0,!h)return Qe(Xt),Xt=13,F=xr,Xt|0;if(v=Lr(He,8)|0,!v)return Qe(Xt),Qe(h),Xt=13,F=xr,Xt|0;bt=pt,A[bt>>2]=0,A[bt+4>>2]=0,bt=u,nt=A[bt+4>>2]|0,m=w,A[m>>2]=A[bt>>2],A[m+4>>2]=nt,m=Sy(w,He,Ne,l,pt,h,v)|0;e:do if(m)Qe(h),Qe(v),Qe(Xt);else{t:do if((A[R>>2]|0)>0){for(_=u+12|0,y=0;m=Sy((A[_>>2]|0)+(y<<3)|0,He,Ne,l,pt,h,v)|0,y=y+1|0,!(m|0);)if((y|0)>=(A[R>>2]|0))break t;Qe(h),Qe(v),Qe(Xt);break e}while(!1);(Ne|0)>0|(Ne|0)==0&He>>>0>0&&vo(v|0,0,He<<3|0)|0,nt=pt,bt=A[nt+4>>2]|0;t:do if((bt|0)>0|(bt|0)==0&(A[nt>>2]|0)>>>0>0){qe=h,lt=v,At=h,bt=v,nt=h,m=h,ie=h,Ce=v,$e=v,h=v;n:for(;;){for(se=0,ce=0,Ae=0,le=0,y=0,_=0;;){v=Qt,w=v+56|0;do A[v>>2]=0,v=v+4|0;while((v|0)<(w|0));if(l=qe+(se<<3)|0,R=A[l>>2]|0,l=A[l+4>>2]|0,Ty(R,l,1,Qt,0)|0){v=Qt,w=v+56|0;do A[v>>2]=0,v=v+4|0;while((v|0)<(w|0));v=Lr(7,4)|0,v|0&&(ts(R,l,1,Qt,v,7,0,0)|0,Qe(v))}for(ne=0;;){W=Qt+(ne<<3)|0,H=A[W>>2]|0,W=A[W+4>>2]|0;r:do if((H|0)==0&(W|0)==0)v=y,w=_;else{if(M=ll(H|0,W|0,He|0,Ne|0)|0,R=V()|0,v=d+(M<<3)|0,l=v,w=A[l>>2]|0,l=A[l+4>>2]|0,!((w|0)==0&(l|0)==0)){G=0,$=0;do{if((G|0)>(Ne|0)|(G|0)==(Ne|0)&$>>>0>He>>>0)break n;if((w|0)==(H|0)&(l|0)==(W|0)){v=y,w=_;break r}v=We(M|0,R|0,1,0)|0,M=al(v|0,V()|0,He|0,Ne|0)|0,R=V()|0,$=We($|0,G|0,1,0)|0,G=V()|0,v=d+(M<<3)|0,l=v,w=A[l>>2]|0,l=A[l+4>>2]|0}while(!((w|0)==0&(l|0)==0))}if((H|0)==0&(W|0)==0){v=y,w=_;break}ha(H,W,ht)|0,Md(u,Xt,ht)|0&&($=We(y|0,_|0,1,0)|0,_=V()|0,G=v,A[G>>2]=H,A[G+4>>2]=W,y=lt+(y<<3)|0,A[y>>2]=H,A[y+4>>2]=W,y=$),v=y,w=_}while(!1);if(ne=ne+1|0,ne>>>0>=7)break;y=v,_=w}if(se=We(se|0,ce|0,1,0)|0,ce=V()|0,Ae=We(Ae|0,le|0,1,0)|0,le=V()|0,_=pt,y=A[_>>2]|0,_=A[_+4>>2]|0,(le|0)<(_|0)|(le|0)==(_|0)&Ae>>>0<y>>>0)y=v,_=w;else break}if((_|0)>0|(_|0)==0&y>>>0>0){y=0,_=0;do le=qe+(y<<3)|0,A[le>>2]=0,A[le+4>>2]=0,y=We(y|0,_|0,1,0)|0,_=V()|0,le=pt,Ae=A[le+4>>2]|0;while((_|0)<(Ae|0)|((_|0)==(Ae|0)?y>>>0<(A[le>>2]|0)>>>0:0))}if(le=pt,A[le>>2]=v,A[le+4>>2]=w,(w|0)>0|(w|0)==0&v>>>0>0)ne=h,se=$e,ce=nt,Ae=Ce,le=lt,h=ie,$e=m,Ce=At,ie=ne,m=se,nt=bt,bt=ce,At=Ae,lt=qe,qe=le;else break t}Qe(At),Qe(bt),Qe(Xt),m=1;break e}else m=v;while(!1);Qe(Xt),Qe(h),Qe(m),m=0}while(!1);return Xt=m,F=xr,Xt|0}}return Qe(Xt),Xt=m,F=xr,Xt|0}function z7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(M=F,F=F+176|0,w=M,(l|0)<1)return s_(h,0,0),R=0,F=M,R|0;for(v=u,v=_e(A[v>>2]|0,A[v+4>>2]|0,52)|0,V()|0,s_(h,(l|0)>6?l:6,v&15),v=0;d=u+(v<<3)|0,d=sl(A[d>>2]|0,A[d+4>>2]|0,w)|0,!(d|0);){if(d=A[w>>2]|0,(d|0)>0){_=0;do y=w+8+(_<<4)|0,_=_+1|0,d=w+8+(((_|0)%(d|0)|0)<<4)|0,m=yR(h,d,y)|0,m?l_(h,m)|0:gR(h,y,d)|0,d=A[w>>2]|0;while((_|0)<(d|0))}if(v=v+1|0,(v|0)>=(l|0)){d=0,R=13;break}}return(R|0)==13?(F=M,d|0):(o_(h),R=d,F=M,R|0)}function j7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;if(y=F,F=F+32|0,d=y,m=y+16|0,u=z7(u,l,m)|0,u|0)return h=u,F=y,h|0;if(A[h>>2]=0,A[h+4>>2]=0,A[h+8>>2]=0,u=a_(m)|0,u|0)do{l=WE(h)|0;do QE(l,u)|0,_=u+16|0,A[d>>2]=A[_>>2],A[d+4>>2]=A[_+4>>2],A[d+8>>2]=A[_+8>>2],A[d+12>>2]=A[_+12>>2],l_(m,u)|0,u=_R(m,d)|0;while(u|0);u=a_(m)|0}while(u|0);return o_(m),u=XE(h)|0,u?(Xy(h),_=u,F=y,_|0):(_=0,F=y,_|0)}function an(u){return u=u|0,u>>>0>121?(u=0,u|0):(u=A[7696+(u*28|0)+16>>2]|0,u|0)}function ld(u){return u=u|0,(u|0)==4|(u|0)==117|0}function Ey(u){return u=u|0,A[11120+((A[u>>2]|0)*216|0)+((A[u+4>>2]|0)*72|0)+((A[u+8>>2]|0)*24|0)+(A[u+12>>2]<<3)>>2]|0}function $7(u){return u=u|0,A[11120+((A[u>>2]|0)*216|0)+((A[u+4>>2]|0)*72|0)+((A[u+8>>2]|0)*24|0)+(A[u+12>>2]<<3)+4>>2]|0}function H7(u,l){u=u|0,l=l|0,u=7696+(u*28|0)|0,A[l>>2]=A[u>>2],A[l+4>>2]=A[u+4>>2],A[l+8>>2]=A[u+8>>2],A[l+12>>2]=A[u+12>>2]}function W7(u,l){u=u|0,l=l|0;var h=0,d=0;if(l>>>0>20)return l=-1,l|0;do if((A[11120+(l*216|0)>>2]|0)!=(u|0))if((A[11120+(l*216|0)+8>>2]|0)!=(u|0))if((A[11120+(l*216|0)+16>>2]|0)!=(u|0))if((A[11120+(l*216|0)+24>>2]|0)!=(u|0))if((A[11120+(l*216|0)+32>>2]|0)!=(u|0))if((A[11120+(l*216|0)+40>>2]|0)!=(u|0))if((A[11120+(l*216|0)+48>>2]|0)!=(u|0))if((A[11120+(l*216|0)+56>>2]|0)!=(u|0))if((A[11120+(l*216|0)+64>>2]|0)!=(u|0))if((A[11120+(l*216|0)+72>>2]|0)!=(u|0))if((A[11120+(l*216|0)+80>>2]|0)!=(u|0))if((A[11120+(l*216|0)+88>>2]|0)!=(u|0))if((A[11120+(l*216|0)+96>>2]|0)!=(u|0))if((A[11120+(l*216|0)+104>>2]|0)!=(u|0))if((A[11120+(l*216|0)+112>>2]|0)!=(u|0))if((A[11120+(l*216|0)+120>>2]|0)!=(u|0))if((A[11120+(l*216|0)+128>>2]|0)!=(u|0))if((A[11120+(l*216|0)+136>>2]|0)==(u|0))u=2,h=1,d=2;else{if((A[11120+(l*216|0)+144>>2]|0)==(u|0)){u=0,h=2,d=0;break}if((A[11120+(l*216|0)+152>>2]|0)==(u|0)){u=0,h=2,d=1;break}if((A[11120+(l*216|0)+160>>2]|0)==(u|0)){u=0,h=2,d=2;break}if((A[11120+(l*216|0)+168>>2]|0)==(u|0)){u=1,h=2,d=0;break}if((A[11120+(l*216|0)+176>>2]|0)==(u|0)){u=1,h=2,d=1;break}if((A[11120+(l*216|0)+184>>2]|0)==(u|0)){u=1,h=2,d=2;break}if((A[11120+(l*216|0)+192>>2]|0)==(u|0)){u=2,h=2,d=0;break}if((A[11120+(l*216|0)+200>>2]|0)==(u|0)){u=2,h=2,d=1;break}if((A[11120+(l*216|0)+208>>2]|0)==(u|0)){u=2,h=2,d=2;break}else u=-1;return u|0}else u=2,h=1,d=1;else u=2,h=1,d=0;else u=1,h=1,d=2;else u=1,h=1,d=1;else u=1,h=1,d=0;else u=0,h=1,d=2;else u=0,h=1,d=1;else u=0,h=1,d=0;else u=2,h=0,d=2;else u=2,h=0,d=1;else u=2,h=0,d=0;else u=1,h=0,d=2;else u=1,h=0,d=1;else u=1,h=0,d=0;else u=0,h=0,d=2;else u=0,h=0,d=1;else u=0,h=0,d=0;while(!1);return l=A[11120+(l*216|0)+(h*72|0)+(u*24|0)+(d<<3)+4>>2]|0,l|0}function Ry(u,l){return u=u|0,l=l|0,(A[7696+(u*28|0)+20>>2]|0)==(l|0)?(l=1,l|0):(l=(A[7696+(u*28|0)+24>>2]|0)==(l|0),l|0)}function ud(u,l){return u=u|0,l=l|0,A[848+(u*28|0)+(l<<2)>>2]|0}function Ad(u,l){return u=u|0,l=l|0,(A[848+(u*28|0)>>2]|0)==(l|0)?(l=0,l|0):(A[848+(u*28|0)+4>>2]|0)==(l|0)?(l=1,l|0):(A[848+(u*28|0)+8>>2]|0)==(l|0)?(l=2,l|0):(A[848+(u*28|0)+12>>2]|0)==(l|0)?(l=3,l|0):(A[848+(u*28|0)+16>>2]|0)==(l|0)?(l=4,l|0):(A[848+(u*28|0)+20>>2]|0)==(l|0)?(l=5,l|0):((A[848+(u*28|0)+24>>2]|0)==(l|0)?6:7)|0}function Q7(){return 122}function X7(u){u=u|0;var l=0,h=0,d=0;l=0;do Re(l|0,0,45)|0,d=V()|0|134225919,h=u+(l<<3)|0,A[h>>2]=-1,A[h+4>>2]=d,l=l+1|0;while((l|0)!=122);return 0}function Y7(u){u=u|0;var l=0,h=0,d=0;return d=+O[u+16>>3],h=+O[u+24>>3],l=d-h,+(d<h?l+6.283185307179586:l)}function Ny(u){return u=u|0,+O[u+16>>3]<+O[u+24>>3]|0}function K7(u){return u=u|0,+(+O[u>>3]-+O[u+8>>3])}function cd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return h=+O[l>>3],!(h>=+O[u+8>>3])||!(h<=+O[u>>3])?(l=0,l|0):(d=+O[u+16>>3],h=+O[u+24>>3],m=+O[l+8>>3],l=m>=h,u=m<=d&1,d<h?l&&(u=1):l||(u=0),l=(u|0)!=0,l|0)}function hd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;return+O[u>>3]<+O[l+8>>3]||+O[u+8>>3]>+O[l>>3]?(d=0,d|0):(y=+O[u+16>>3],h=u+24|0,M=+O[h>>3],_=y<M,d=l+16|0,R=+O[d>>3],m=l+24|0,w=+O[m>>3],v=R<w,l=M-R<w-y,u=_?v|l?1:2:0,l=v?_?1:l?2:1:0,y=+Qr(y,u),y<+Qr(+O[m>>3],l)||(M=+Qr(+O[h>>3],u),M>+Qr(+O[d>>3],l))?(v=0,v|0):(v=1,v|0))}function Z7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0;y=+O[u+16>>3],w=+O[u+24>>3],u=y<w,v=+O[l+16>>3],_=+O[l+24>>3],m=v<_,l=w-v<_-y,A[h>>2]=u?m|l?1:2:0,A[d>>2]=m?u?1:l?2:1:0}function Cy(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;return+O[u>>3]<+O[l>>3]||+O[u+8>>3]>+O[l+8>>3]?(d=0,d|0):(d=u+16|0,w=+O[d>>3],y=+O[u+24>>3],_=w<y,h=l+16|0,M=+O[h>>3],m=l+24|0,R=+O[m>>3],v=M<R,l=y-M<R-w,u=_?v|l?1:2:0,l=v?_?1:l?2:1:0,y=+Qr(y,u),y<=+Qr(+O[m>>3],l)?(M=+Qr(+O[d>>3],u),v=M>=+Qr(+O[h>>3],l),v|0):(v=0,v|0))}function My(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0;m=F,F=F+176|0,d=m,A[d>>2]=4,v=+O[l>>3],O[d+8>>3]=v,y=+O[l+16>>3],O[d+16>>3]=y,O[d+24>>3]=v,v=+O[l+24>>3],O[d+32>>3]=v,_=+O[l+8>>3],O[d+40>>3]=_,O[d+48>>3]=v,O[d+56>>3]=_,O[d+64>>3]=y,l=d+72|0,h=l+96|0;do A[l>>2]=0,l=l+4|0;while((l|0)<(h|0));ul(u|0,d|0,168)|0,F=m}function Py(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0;W=F,F=F+288|0,M=W+264|0,G=W+96|0,R=W,v=R,w=v+96|0;do A[v>>2]=0,v=v+4|0;while((v|0)<(w|0));return l=wd(l,R)|0,l|0?(H=l,F=W,H|0):(w=R,R=A[w>>2]|0,w=A[w+4>>2]|0,ha(R,w,M)|0,sl(R,w,G)|0,_=+xu(M,G+8|0),O[M>>3]=+O[u>>3],w=M+8|0,O[w>>3]=+O[u+16>>3],O[G>>3]=+O[u+8>>3],R=G+8|0,O[R>>3]=+O[u+24>>3],m=+xu(M,G),se=+O[w>>3]-+O[R>>3],y=+gt(+se),ne=+O[M>>3]-+O[G>>3],d=+gt(+ne),!(se==0|ne==0)&&(se=+c_(+y,+d),se=+nl(+(m*m/+_c(+(se/+_c(+y,+d)),3)/(_*(_*2.59807621135)*.8))),O[Mt>>3]=se,$=~~se>>>0,H=+gt(se)>=1?se>0?~~+od(+Qn(se/4294967296),4294967295)>>>0:~~+nl((se-+(~~se>>>0))/4294967296)>>>0:0,(A[Mt+4>>2]&2146435072|0)!=2146435072)?(G=($|0)==0&(H|0)==0,l=h,A[l>>2]=G?1:$,A[l+4>>2]=G?0:H,l=0):l=1,H=l,F=W,H|0)}function J7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0;R=F,F=F+288|0,_=R+264|0,v=R+96|0,w=R,m=w,y=m+96|0;do A[m>>2]=0,m=m+4|0;while((m|0)<(y|0));return h=wd(h,w)|0,h|0?(d=h,F=R,d|0):(h=w,m=A[h>>2]|0,h=A[h+4>>2]|0,ha(m,h,_)|0,sl(m,h,v)|0,M=+xu(_,v+8|0),M=+nl(+(+xu(u,l)/(M*2))),O[Mt>>3]=M,h=~~M>>>0,m=+gt(M)>=1?M>0?~~+od(+Qn(M/4294967296),4294967295)>>>0:~~+nl((M-+(~~M>>>0))/4294967296)>>>0:0,(A[Mt+4>>2]&2146435072|0)==2146435072?(d=1,F=R,d|0):(w=(h|0)==0&(m|0)==0,A[d>>2]=w?1:h,A[d+4>>2]=w?0:m,d=0,F=R,d|0))}function eE(u,l){u=u|0,l=+l;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;y=u+16|0,_=+O[y>>3],h=u+24|0,m=+O[h>>3],d=_-m,d=_<m?d+6.283185307179586:d,R=+O[u>>3],v=u+8|0,w=+O[v>>3],M=R-w,d=(d*l-d)*.5,l=(M*l-M)*.5,R=R+l,O[u>>3]=R>1.5707963267948966?1.5707963267948966:R,l=w-l,O[v>>3]=l<-1.5707963267948966?-1.5707963267948966:l,l=_+d,l=l>3.141592653589793?l+-6.283185307179586:l,O[y>>3]=l<-3.141592653589793?l+6.283185307179586:l,l=m-d,l=l>3.141592653589793?l+-6.283185307179586:l,O[h>>3]=l<-3.141592653589793?l+6.283185307179586:l}function tE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0,A[u>>2]=l,A[u+4>>2]=h,A[u+8>>2]=d}function nE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0;G=l+8|0,A[G>>2]=0,w=+O[u>>3],_=+gt(+w),R=+O[u+8>>3],v=+gt(+R)*1.1547005383792515,_=_+v*.5,h=~~_,u=~~v,_=_-+(h|0),v=v-+(u|0);do if(_<.5)if(_<.3333333333333333)if(A[l>>2]=h,v<(_+1)*.5){A[l+4>>2]=u;break}else{u=u+1|0,A[l+4>>2]=u;break}else if($=1-_,u=(!(v<$)&1)+u|0,A[l+4>>2]=u,$<=v&v<_*2){h=h+1|0,A[l>>2]=h;break}else{A[l>>2]=h;break}else{if(!(_<.6666666666666666))if(h=h+1|0,A[l>>2]=h,v<_*.5){A[l+4>>2]=u;break}else{u=u+1|0,A[l+4>>2]=u;break}if(v<1-_){if(A[l+4>>2]=u,_*2+-1<v){A[l>>2]=h;break}}else u=u+1|0,A[l+4>>2]=u;h=h+1|0,A[l>>2]=h}while(!1);do if(w<0)if(u&1){M=(u+1|0)/2|0,M=Yn(h|0,((h|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-((+(M>>>0)+4294967296*+(V()|0))*2+1)),A[l>>2]=h;break}else{M=(u|0)/2|0,M=Yn(h|0,((h|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-(+(M>>>0)+4294967296*+(V()|0))*2),A[l>>2]=h;break}while(!1);M=l+4|0,R<0&&(h=h-((u<<1|1|0)/2|0)|0,A[l>>2]=h,u=0-u|0,A[M>>2]=u),d=u-h|0,(h|0)<0?(m=0-h|0,A[M>>2]=d,A[G>>2]=m,A[l>>2]=0,u=d,h=0):m=0,(u|0)<0&&(h=h-u|0,A[l>>2]=h,m=m-u|0,A[G>>2]=m,A[M>>2]=0,u=0),y=h-m|0,d=u-m|0,(m|0)<0&&(A[l>>2]=y,A[M>>2]=d,A[G>>2]=0,u=d,h=y,m=0),d=(u|0)<(h|0)?u:h,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(A[l>>2]=h-d,A[M>>2]=u-d,A[G>>2]=m-d)}function hr(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0;l=A[u>>2]|0,_=u+4|0,h=A[_>>2]|0,(l|0)<0&&(h=h-l|0,A[_>>2]=h,y=u+8|0,A[y>>2]=(A[y>>2]|0)-l,A[u>>2]=0,l=0),(h|0)<0?(l=l-h|0,A[u>>2]=l,y=u+8|0,m=(A[y>>2]|0)-h|0,A[y>>2]=m,A[_>>2]=0,h=0):(m=u+8|0,y=m,m=A[m>>2]|0),(m|0)<0&&(l=l-m|0,A[u>>2]=l,h=h-m|0,A[_>>2]=h,A[y>>2]=0,m=0),d=(h|0)<(l|0)?h:l,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(A[u>>2]=l-d,A[_>>2]=h-d,A[y>>2]=m-d)}function la(u,l){u=u|0,l=l|0;var h=0,d=0;d=A[u+8>>2]|0,h=+((A[u+4>>2]|0)-d|0),O[l>>3]=+((A[u>>2]|0)-d|0)-h*.5,O[l+8>>3]=h*.8660254037844386}function vr(u,l,h){u=u|0,l=l|0,h=h|0,A[h>>2]=(A[l>>2]|0)+(A[u>>2]|0),A[h+4>>2]=(A[l+4>>2]|0)+(A[u+4>>2]|0),A[h+8>>2]=(A[l+8>>2]|0)+(A[u+8>>2]|0)}function fd(u,l,h){u=u|0,l=l|0,h=h|0,A[h>>2]=(A[u>>2]|0)-(A[l>>2]|0),A[h+4>>2]=(A[u+4>>2]|0)-(A[l+4>>2]|0),A[h+8>>2]=(A[u+8>>2]|0)-(A[l+8>>2]|0)}function By(u,l){u=u|0,l=l|0;var h=0,d=0;h=es(A[u>>2]|0,l)|0,A[u>>2]=h,h=u+4|0,d=es(A[h>>2]|0,l)|0,A[h>>2]=d,u=u+8|0,l=es(A[u>>2]|0,l)|0,A[u>>2]=l}function hc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;_=A[u>>2]|0,v=(_|0)<0,d=(A[u+4>>2]|0)-(v?_:0)|0,y=(d|0)<0,m=(y?0-d|0:0)+((A[u+8>>2]|0)-(v?_:0))|0,h=(m|0)<0,u=h?0:m,l=(y?0:d)-(h?m:0)|0,m=(v?0:_)-(y?d:0)-(h?m:0)|0,h=(l|0)<(m|0)?l:m,h=(u|0)<(h|0)?u:h,d=(h|0)>0,u=u-(d?h:0)|0,l=l-(d?h:0)|0;e:do switch(m-(d?h:0)|0){case 0:switch(l|0){case 0:return v=u|0?(u|0)==1?1:7:0,v|0;case 1:return v=u|0?(u|0)==1?3:7:2,v|0;default:break e}case 1:switch(l|0){case 0:return v=u|0?(u|0)==1?5:7:4,v|0;case 1:{if(!u)u=6;else break e;return u|0}default:break e}}while(!1);return v=7,v|0}function rE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0;if(w=u+8|0,_=A[w>>2]|0,v=(A[u>>2]|0)-_|0,R=u+4|0,_=(A[R>>2]|0)-_|0,v>>>0>715827881|_>>>0>715827881){if(d=(v|0)>0,m=2147483647-v|0,y=-2147483648-v|0,(d?(m|0)<(v|0):(y|0)>(v|0))||(h=v<<1,d?(2147483647-h|0)<(v|0):(-2147483648-h|0)>(v|0))||((_|0)>0?(2147483647-_|0)<(_|0):(-2147483648-_|0)>(_|0))||(l=v*3|0,h=_<<1,(d?(m|0)<(h|0):(y|0)>(h|0))||((v|0)>-1?(l|-2147483648|0)>=(_|0):(l^-2147483648|0)<(_|0))))return R=1,R|0}else h=_<<1,l=v*3|0;return d=_o(+(l-_|0)*.14285714285714285)|0,A[u>>2]=d,m=_o(+(h+v|0)*.14285714285714285)|0,A[R>>2]=m,A[w>>2]=0,h=(m|0)<(d|0),l=h?d:m,h=h?m:d,(h|0)<0&&(((h|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(h|0):(-2147483648-l|0)>(h|0)))&&rt(27795,26892,354,26903),((l|0)>-1?(l|-2147483648|0)>=(h|0):(l^-2147483648|0)<(h|0))&&rt(27795,26892,354,26903)),l=m-d|0,(d|0)<0?(h=0-d|0,A[R>>2]=l,A[w>>2]=h,A[u>>2]=0,d=0):(l=m,h=0),(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[w>>2]=h,A[R>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[R>>2]=m,A[w>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(R=0,R|0):(A[u>>2]=m-d,A[R>>2]=l-d,A[w>>2]=h-d,R=0,R|0)}function iE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0;if(_=u+8|0,m=A[_>>2]|0,y=(A[u>>2]|0)-m|0,v=u+4|0,m=(A[v>>2]|0)-m|0,y>>>0>715827881|m>>>0>715827881){if(h=(y|0)>0,(h?(2147483647-y|0)<(y|0):(-2147483648-y|0)>(y|0))||(l=y<<1,d=(m|0)>0,d?(2147483647-m|0)<(m|0):(-2147483648-m|0)>(m|0)))return v=1,v|0;if(w=m<<1,(d?(2147483647-w|0)<(m|0):(-2147483648-w|0)>(m|0))||(h?(2147483647-l|0)<(m|0):(-2147483648-l|0)>(m|0))||(h=m*3|0,(m|0)>-1?(h|-2147483648|0)>=(y|0):(h^-2147483648|0)<(y|0)))return w=1,w|0}else h=m*3|0,l=y<<1;return d=_o(+(l+m|0)*.14285714285714285)|0,A[u>>2]=d,m=_o(+(h-y|0)*.14285714285714285)|0,A[v>>2]=m,A[_>>2]=0,h=(m|0)<(d|0),l=h?d:m,h=h?m:d,(h|0)<0&&(((h|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(h|0):(-2147483648-l|0)>(h|0)))&&rt(27795,26892,402,26917),((l|0)>-1?(l|-2147483648|0)>=(h|0):(l^-2147483648|0)<(h|0))&&rt(27795,26892,402,26917)),l=m-d|0,(d|0)<0?(h=0-d|0,A[v>>2]=l,A[_>>2]=h,A[u>>2]=0,d=0):(l=m,h=0),(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[_>>2]=h,A[v>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[v>>2]=m,A[_>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(w=0,w|0):(A[u>>2]=m-d,A[v>>2]=l-d,A[_>>2]=h-d,w=0,w|0)}function sE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;_=u+8|0,h=A[_>>2]|0,l=(A[u>>2]|0)-h|0,v=u+4|0,h=(A[v>>2]|0)-h|0,d=_o(+((l*3|0)-h|0)*.14285714285714285)|0,A[u>>2]=d,l=_o(+((h<<1)+l|0)*.14285714285714285)|0,A[v>>2]=l,A[_>>2]=0,h=l-d|0,(d|0)<0?(y=0-d|0,A[v>>2]=h,A[_>>2]=y,A[u>>2]=0,l=h,d=0,h=y):h=0,(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[_>>2]=h,A[v>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[v>>2]=m,A[_>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(A[u>>2]=m-d,A[v>>2]=l-d,A[_>>2]=h-d)}function Dy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;_=u+8|0,h=A[_>>2]|0,l=(A[u>>2]|0)-h|0,v=u+4|0,h=(A[v>>2]|0)-h|0,d=_o(+((l<<1)+h|0)*.14285714285714285)|0,A[u>>2]=d,l=_o(+((h*3|0)-l|0)*.14285714285714285)|0,A[v>>2]=l,A[_>>2]=0,h=l-d|0,(d|0)<0?(y=0-d|0,A[v>>2]=h,A[_>>2]=y,A[u>>2]=0,l=h,d=0,h=y):h=0,(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[_>>2]=h,A[v>>2]=0,l=0),y=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=y,A[v>>2]=m,A[_>>2]=0,l=m,m=y,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(A[u>>2]=m-d,A[v>>2]=l-d,A[_>>2]=h-d)}function fc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;l=A[u>>2]|0,_=u+4|0,h=A[_>>2]|0,v=u+8|0,d=A[v>>2]|0,m=h+(l*3|0)|0,A[u>>2]=m,h=d+(h*3|0)|0,A[_>>2]=h,l=(d*3|0)+l|0,A[v>>2]=l,d=h-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=d,A[v>>2]=l,A[u>>2]=0,h=d,d=0):d=m,(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[v>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[v>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[v>>2]=l-h)}function ua(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;m=A[u>>2]|0,_=u+4|0,l=A[_>>2]|0,v=u+8|0,h=A[v>>2]|0,d=(l*3|0)+m|0,m=h+(m*3|0)|0,A[u>>2]=m,A[_>>2]=d,l=(h*3|0)+l|0,A[v>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[v>>2]=l,A[u>>2]=0,m=0):h=d,(h|0)<0&&(m=m-h|0,A[u>>2]=m,l=l-h|0,A[v>>2]=l,A[_>>2]=0,h=0),y=m-l|0,d=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=d,A[v>>2]=0,m=y,l=0):d=h,h=(d|0)<(m|0)?d:m,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=m-h,A[_>>2]=d-h,A[v>>2]=l-h)}function Ly(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0;(l+-1|0)>>>0>=6||(m=(A[15440+(l*12|0)>>2]|0)+(A[u>>2]|0)|0,A[u>>2]=m,v=u+4|0,d=(A[15440+(l*12|0)+4>>2]|0)+(A[v>>2]|0)|0,A[v>>2]=d,_=u+8|0,l=(A[15440+(l*12|0)+8>>2]|0)+(A[_>>2]|0)|0,A[_>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[v>>2]=h,A[_>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[_>>2]=l,A[v>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[v>>2]=m,A[_>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[v>>2]=m-h,A[_>>2]=l-h))}function Oy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;m=A[u>>2]|0,_=u+4|0,l=A[_>>2]|0,v=u+8|0,h=A[v>>2]|0,d=l+m|0,m=h+m|0,A[u>>2]=m,A[_>>2]=d,l=h+l|0,A[v>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[v>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[v>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[v>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[v>>2]=l-h)}function dc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;l=A[u>>2]|0,_=u+4|0,d=A[_>>2]|0,v=u+8|0,h=A[v>>2]|0,m=d+l|0,A[u>>2]=m,d=h+d|0,A[_>>2]=d,l=h+l|0,A[v>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[v>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[v>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[v>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[v>>2]=l-h)}function Aa(u){switch(u=u|0,u|0){case 1:{u=5;break}case 5:{u=4;break}case 4:{u=6;break}case 6:{u=2;break}case 2:{u=3;break}case 3:{u=1;break}}return u|0}function go(u){switch(u=u|0,u|0){case 1:{u=3;break}case 3:{u=2;break}case 2:{u=6;break}case 6:{u=4;break}case 4:{u=5;break}case 5:{u=1;break}}return u|0}function Fy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;l=A[u>>2]|0,_=u+4|0,h=A[_>>2]|0,v=u+8|0,d=A[v>>2]|0,m=h+(l<<1)|0,A[u>>2]=m,h=d+(h<<1)|0,A[_>>2]=h,l=(d<<1)+l|0,A[v>>2]=l,d=h-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=d,A[v>>2]=l,A[u>>2]=0,h=d,d=0):d=m,(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[v>>2]=l,A[_>>2]=0,h=0),y=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=m,A[v>>2]=0,d=y,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[_>>2]=m-h,A[v>>2]=l-h)}function Iy(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;m=A[u>>2]|0,_=u+4|0,l=A[_>>2]|0,v=u+8|0,h=A[v>>2]|0,d=(l<<1)+m|0,m=h+(m<<1)|0,A[u>>2]=m,A[_>>2]=d,l=(h<<1)+l|0,A[v>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[_>>2]=h,A[v>>2]=l,A[u>>2]=0,m=0):h=d,(h|0)<0&&(m=m-h|0,A[u>>2]=m,l=l-h|0,A[v>>2]=l,A[_>>2]=0,h=0),y=m-l|0,d=h-l|0,(l|0)<0?(A[u>>2]=y,A[_>>2]=d,A[v>>2]=0,m=y,l=0):d=h,h=(d|0)<(m|0)?d:m,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=m-h,A[_>>2]=d-h,A[v>>2]=l-h)}function dd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0;return _=(A[u>>2]|0)-(A[l>>2]|0)|0,v=(_|0)<0,d=(A[u+4>>2]|0)-(A[l+4>>2]|0)-(v?_:0)|0,y=(d|0)<0,m=(v?0-_|0:0)+(A[u+8>>2]|0)-(A[l+8>>2]|0)+(y?0-d|0:0)|0,u=(m|0)<0,l=u?0:m,h=(y?0:d)-(u?m:0)|0,m=(v?0:_)-(y?d:0)-(u?m:0)|0,u=(h|0)<(m|0)?h:m,u=(l|0)<(u|0)?l:u,d=(u|0)>0,l=l-(d?u:0)|0,h=h-(d?u:0)|0,u=m-(d?u:0)|0,u=(u|0)>-1?u:0-u|0,h=(h|0)>-1?h:0-h|0,l=(l|0)>-1?l:0-l|0,l=(h|0)>(l|0)?h:l,((u|0)>(l|0)?u:l)|0}function oE(u,l){u=u|0,l=l|0;var h=0;h=A[u+8>>2]|0,A[l>>2]=(A[u>>2]|0)-h,A[l+4>>2]=(A[u+4>>2]|0)-h}function aE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0;return d=A[u>>2]|0,A[l>>2]=d,m=A[u+4>>2]|0,_=l+4|0,A[_>>2]=m,v=l+8|0,A[v>>2]=0,h=(m|0)<(d|0),u=h?d:m,h=h?m:d,(h|0)<0&&((h|0)==-2147483648||((u|0)>0?(2147483647-u|0)<(h|0):(-2147483648-u|0)>(h|0))||((u|0)>-1?(u|-2147483648|0)>=(h|0):(u^-2147483648|0)<(h|0)))?(l=1,l|0):(u=m-d|0,(d|0)<0?(h=0-d|0,A[_>>2]=u,A[v>>2]=h,A[l>>2]=0,d=0):(u=m,h=0),(u|0)<0&&(d=d-u|0,A[l>>2]=d,h=h-u|0,A[v>>2]=h,A[_>>2]=0,u=0),y=d-h|0,m=u-h|0,(h|0)<0?(A[l>>2]=y,A[_>>2]=m,A[v>>2]=0,u=m,m=y,h=0):m=d,d=(u|0)<(m|0)?u:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(l=0,l|0):(A[l>>2]=m-d,A[_>>2]=u-d,A[v>>2]=h-d,l=0,l|0))}function ky(u){u=u|0;var l=0,h=0,d=0,m=0;l=u+8|0,m=A[l>>2]|0,h=m-(A[u>>2]|0)|0,A[u>>2]=h,d=u+4|0,u=(A[d>>2]|0)-m|0,A[d>>2]=u,A[l>>2]=0-(u+h)}function lE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;h=A[u>>2]|0,l=0-h|0,A[u>>2]=l,_=u+8|0,A[_>>2]=0,v=u+4|0,d=A[v>>2]|0,m=d+h|0,(h|0)>0?(A[v>>2]=m,A[_>>2]=h,A[u>>2]=0,l=0,d=m):h=0,(d|0)<0?(y=l-d|0,A[u>>2]=y,h=h-d|0,A[_>>2]=h,A[v>>2]=0,m=y-h|0,l=0-h|0,(h|0)<0?(A[u>>2]=m,A[v>>2]=l,A[_>>2]=0,d=l,h=0):(d=0,m=y)):m=l,l=(d|0)<(m|0)?d:m,l=(h|0)<(l|0)?h:l,!((l|0)<=0)&&(A[u>>2]=m-l,A[v>>2]=d-l,A[_>>2]=h-l)}function uE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0;if(G=F,F=F+64|0,M=G,v=G+56|0,!(!0&(l&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return m=5,F=G,m|0;if((u|0)==(h|0)&(l|0)==(d|0))return A[m>>2]=0,m=0,F=G,m|0;if(_=_e(u|0,l|0,52)|0,V()|0,_=_&15,R=_e(h|0,d|0,52)|0,V()|0,(_|0)!=(R&15|0))return m=12,F=G,m|0;if(y=_+-1|0,_>>>0>1){_d(u,l,y,M)|0,_d(h,d,y,v)|0,R=M,w=A[R>>2]|0,R=A[R+4>>2]|0;e:do if((w|0)==(A[v>>2]|0)&&(R|0)==(A[v+4>>2]|0)){_=(_^15)*3|0,y=_e(u|0,l|0,_|0)|0,V()|0,y=y&7,_=_e(h|0,d|0,_|0)|0,V()|0,_=_&7;do if((y|0)==0|(_|0)==0)A[m>>2]=1,y=0;else if((y|0)==7)y=5;else{if((y|0)==1|(_|0)==1&&Zt(w,R)|0){y=5;break}if((A[15536+(y<<2)>>2]|0)!=(_|0)&&(A[15568+(y<<2)>>2]|0)!=(_|0))break e;A[m>>2]=1,y=0}while(!1);return m=y,F=G,m|0}while(!1)}y=M,_=y+56|0;do A[y>>2]=0,y=y+4|0;while((y|0)<(_|0));return vy(u,l,1,M)|0,l=M,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0))&&(l=M+8|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+16|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+24|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+32|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+40|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))?(y=M+48|0,y=((A[y>>2]|0)==(h|0)?(A[y+4>>2]|0)==(d|0):0)&1):y=1,A[m>>2]=y,m=0,F=G,m|0}function AE(u,l,h,d,m){return u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,h=ad(u,l,h,d)|0,(h|0)==7?(m=11,m|0):(d=Re(h|0,0,56)|0,l=l&-2130706433|(V()|0)|268435456,A[m>>2]=u|d,A[m+4>>2]=l,m=0,m|0)}function cE(u,l,h){return u=u|0,l=l|0,h=h|0,!0&(l&2013265920|0)==268435456?(A[h>>2]=u,A[h+4>>2]=l&-2130706433|134217728,h=0,h|0):(h=6,h|0)}function hE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;return m=F,F=F+16|0,d=m,A[d>>2]=0,!0&(l&2013265920|0)==268435456?(y=_e(u|0,l|0,56)|0,V()|0,d=Xn(u,l&-2130706433|134217728,y&7,d,h)|0,F=m,d|0):(d=6,F=m,d|0)}function Uy(u,l){u=u|0,l=l|0;var h=0;switch(h=_e(u|0,l|0,56)|0,V()|0,h&7){case 0:case 7:return h=0,h|0}return h=l&-2130706433|134217728,!(!0&(l&2013265920|0)==268435456)||!0&(l&117440512|0)==16777216&(Zt(u,h)|0)!=0?(h=0,h|0):(h=gd(u,h)|0,h|0)}function fE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;return m=F,F=F+16|0,d=m,!0&(l&2013265920|0)==268435456?(y=l&-2130706433|134217728,_=h,A[_>>2]=u,A[_+4>>2]=y,A[d>>2]=0,l=_e(u|0,l|0,56)|0,V()|0,d=Xn(u,y,l&7,d,h+8|0)|0,F=m,d|0):(d=6,F=m,d|0)}function dE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;return m=(Zt(u,l)|0)==0,l=l&-2130706433,d=h,A[d>>2]=m?u:0,A[d+4>>2]=m?l|285212672:0,d=h+8|0,A[d>>2]=u,A[d+4>>2]=l|301989888,d=h+16|0,A[d>>2]=u,A[d+4>>2]=l|318767104,d=h+24|0,A[d>>2]=u,A[d+4>>2]=l|335544320,d=h+32|0,A[d>>2]=u,A[d+4>>2]=l|352321536,h=h+40|0,A[h>>2]=u,A[h+4>>2]=l|369098752,0}function pc(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;return _=F,F=F+16|0,m=_,y=l&-2130706433|134217728,!0&(l&2013265920|0)==268435456?(d=_e(u|0,l|0,56)|0,V()|0,d=dR(u,y,d&7)|0,(d|0)==-1?(A[h>>2]=0,y=6,F=_,y|0):(il(u,y,m)|0&&rt(27795,26932,282,26947),l=_e(u|0,l|0,52)|0,V()|0,l=l&15,Zt(u,y)|0?pd(m,l,d,2,h):md(m,l,d,2,h),y=0,F=_,y|0)):(y=6,F=_,y|0)}function pE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;d=F,F=F+16|0,m=d,mE(u,l,h,m),nE(m,h+4|0),F=d}function mE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0;if(v=F,F=F+16|0,w=v,gE(u,h,w),y=+cc(+(1-+O[w>>3]*.5)),y<1e-16){A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,A[d+12>>2]=0,F=v;return}if(w=A[h>>2]|0,m=+O[15920+(w*24|0)>>3],m=+vu(m-+vu(+IE(15600+(w<<4)|0,u))),ci(l)|0?_=+vu(m+-.3334731722518321):_=m,m=+ui(+y)*2.618033988749896,(l|0)>0){u=0;do m=m*2.6457513110645907,u=u+1|0;while((u|0)!=(l|0))}y=+Ot(+_)*m,O[d>>3]=y,_=+yt(+_)*m,O[d+8>>3]=_,F=v}function gE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(y=F,F=F+32|0,m=y,fR(u,m),A[l>>2]=0,O[h>>3]=5,d=+Fn(16400,m),d<+O[h>>3]&&(A[l>>2]=0,O[h>>3]=d),d=+Fn(16424,m),d<+O[h>>3]&&(A[l>>2]=1,O[h>>3]=d),d=+Fn(16448,m),d<+O[h>>3]&&(A[l>>2]=2,O[h>>3]=d),d=+Fn(16472,m),d<+O[h>>3]&&(A[l>>2]=3,O[h>>3]=d),d=+Fn(16496,m),d<+O[h>>3]&&(A[l>>2]=4,O[h>>3]=d),d=+Fn(16520,m),d<+O[h>>3]&&(A[l>>2]=5,O[h>>3]=d),d=+Fn(16544,m),d<+O[h>>3]&&(A[l>>2]=6,O[h>>3]=d),d=+Fn(16568,m),d<+O[h>>3]&&(A[l>>2]=7,O[h>>3]=d),d=+Fn(16592,m),d<+O[h>>3]&&(A[l>>2]=8,O[h>>3]=d),d=+Fn(16616,m),d<+O[h>>3]&&(A[l>>2]=9,O[h>>3]=d),d=+Fn(16640,m),d<+O[h>>3]&&(A[l>>2]=10,O[h>>3]=d),d=+Fn(16664,m),d<+O[h>>3]&&(A[l>>2]=11,O[h>>3]=d),d=+Fn(16688,m),d<+O[h>>3]&&(A[l>>2]=12,O[h>>3]=d),d=+Fn(16712,m),d<+O[h>>3]&&(A[l>>2]=13,O[h>>3]=d),d=+Fn(16736,m),d<+O[h>>3]&&(A[l>>2]=14,O[h>>3]=d),d=+Fn(16760,m),d<+O[h>>3]&&(A[l>>2]=15,O[h>>3]=d),d=+Fn(16784,m),d<+O[h>>3]&&(A[l>>2]=16,O[h>>3]=d),d=+Fn(16808,m),d<+O[h>>3]&&(A[l>>2]=17,O[h>>3]=d),d=+Fn(16832,m),d<+O[h>>3]&&(A[l>>2]=18,O[h>>3]=d),d=+Fn(16856,m),!(d<+O[h>>3])){F=y;return}A[l>>2]=19,O[h>>3]=d,F=y}function _u(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0;if(y=+hR(u),y<1e-16){l=15600+(l<<4)|0,A[m>>2]=A[l>>2],A[m+4>>2]=A[l+4>>2],A[m+8>>2]=A[l+8>>2],A[m+12>>2]=A[l+12>>2];return}if(_=+Ai(+ +O[u+8>>3],+ +O[u>>3]),(h|0)>0){u=0;do y=y*.37796447300922725,u=u+1|0;while((u|0)!=(h|0))}v=y*.3333333333333333,d?(h=(ci(h)|0)==0,y=+sd(+((h?v:v*.37796447300922725)*.381966011250105))):(y=+sd(+(y*.381966011250105)),ci(h)|0&&(_=+vu(_+.3334731722518321))),kE(15600+(l<<4)|0,+vu(+O[15920+(l*24|0)>>3]-_),y,m)}function yE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;d=F,F=F+16|0,m=d,la(u+4|0,m),_u(m,A[u>>2]|0,l,0,h),F=d}function pd(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0,At=0,bt=0,nt=0,He=0,Ne=0,pt=0,Qt=0,ht=0;if(pt=F,F=F+272|0,y=pt+256|0,Ae=pt+240|0,nt=pt,He=pt+224|0,Ne=pt+208|0,le=pt+176|0,ie=pt+160|0,Ce=pt+192|0,$e=pt+144|0,qe=pt+128|0,lt=pt+112|0,At=pt+96|0,bt=pt+80|0,A[y>>2]=l,A[Ae>>2]=A[u>>2],A[Ae+4>>2]=A[u+4>>2],A[Ae+8>>2]=A[u+8>>2],A[Ae+12>>2]=A[u+12>>2],qy(Ae,y,nt),A[m>>2]=0,Ae=d+h+((d|0)==5&1)|0,(Ae|0)<=(h|0)){F=pt;return}w=A[y>>2]|0,R=He+4|0,M=le+4|0,G=h+5|0,$=16880+(w<<2)|0,H=16960+(w<<2)|0,W=qe+8|0,ne=lt+8|0,se=At+8|0,ce=Ne+4|0,v=h;e:for(;;){_=nt+(((v|0)%5|0)<<4)|0,A[Ne>>2]=A[_>>2],A[Ne+4>>2]=A[_+4>>2],A[Ne+8>>2]=A[_+8>>2],A[Ne+12>>2]=A[_+12>>2];do;while((rl(Ne,w,0,1)|0)==2);if((v|0)>(h|0)&(ci(l)|0)!=0){if(A[le>>2]=A[Ne>>2],A[le+4>>2]=A[Ne+4>>2],A[le+8>>2]=A[Ne+8>>2],A[le+12>>2]=A[Ne+12>>2],la(R,ie),d=A[le>>2]|0,y=A[17040+(d*80|0)+(A[He>>2]<<2)>>2]|0,A[le>>2]=A[18640+(d*80|0)+(y*20|0)>>2],_=A[18640+(d*80|0)+(y*20|0)+16>>2]|0,(_|0)>0){u=0;do Oy(M),u=u+1|0;while((u|0)<(_|0))}switch(_=18640+(d*80|0)+(y*20|0)+4|0,A[Ce>>2]=A[_>>2],A[Ce+4>>2]=A[_+4>>2],A[Ce+8>>2]=A[_+8>>2],By(Ce,(A[$>>2]|0)*3|0),vr(M,Ce,M),hr(M),la(M,$e),Qt=+(A[H>>2]|0),O[qe>>3]=Qt*3,O[W>>3]=0,ht=Qt*-1.5,O[lt>>3]=ht,O[ne>>3]=Qt*2.598076211353316,O[At>>3]=ht,O[se>>3]=Qt*-2.598076211353316,A[17040+((A[le>>2]|0)*80|0)+(A[Ne>>2]<<2)>>2]|0){case 1:{u=lt,d=qe;break}case 3:{u=At,d=lt;break}case 2:{u=qe,d=At;break}default:{u=12;break e}}n_(ie,$e,d,u,bt),_u(bt,A[le>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1}if((v|0)<(G|0)&&(la(ce,le),_u(le,A[Ne>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1),A[He>>2]=A[Ne>>2],A[He+4>>2]=A[Ne+4>>2],A[He+8>>2]=A[Ne+8>>2],A[He+12>>2]=A[Ne+12>>2],v=v+1|0,(v|0)>=(Ae|0)){u=3;break}}if((u|0)==3){F=pt;return}else(u|0)==12&&rt(26970,27017,572,27027)}function qy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0;w=F,F=F+128|0,d=w+64|0,m=w,y=d,_=20240,v=y+60|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(v|0));y=m,_=20304,v=y+60|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(v|0));v=(ci(A[l>>2]|0)|0)==0,d=v?d:m,m=u+4|0,Fy(m),Iy(m),ci(A[l>>2]|0)|0&&(ua(m),A[l>>2]=(A[l>>2]|0)+1),A[h>>2]=A[u>>2],l=h+4|0,vr(m,d,l),hr(l),A[h+16>>2]=A[u>>2],l=h+20|0,vr(m,d+12|0,l),hr(l),A[h+32>>2]=A[u>>2],l=h+36|0,vr(m,d+24|0,l),hr(l),A[h+48>>2]=A[u>>2],l=h+52|0,vr(m,d+36|0,l),hr(l),A[h+64>>2]=A[u>>2],h=h+68|0,vr(m,d+48|0,h),hr(h),F=w}function rl(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(W=F,F=F+32|0,$=W+12|0,v=W,H=u+4|0,G=A[16960+(l<<2)>>2]|0,M=(d|0)!=0,G=M?G*3|0:G,m=A[H>>2]|0,R=u+8|0,_=A[R>>2]|0,M){if(y=u+12|0,d=A[y>>2]|0,m=_+m+d|0,(m|0)==(G|0))return H=1,F=W,H|0;w=y}else w=u+12|0,d=A[w>>2]|0,m=_+m+d|0;if((m|0)<=(G|0))return H=0,F=W,H|0;do if((d|0)>0){if(d=A[u>>2]|0,(_|0)>0){y=18640+(d*80|0)+60|0,d=u;break}d=18640+(d*80|0)+40|0,h?(tE($,G,0,0),fd(H,$,v),dc(v),vr(v,$,H),y=d,d=u):(y=d,d=u)}else y=18640+((A[u>>2]|0)*80|0)+20|0,d=u;while(!1);if(A[d>>2]=A[y>>2],m=y+16|0,(A[m>>2]|0)>0){d=0;do Oy(H),d=d+1|0;while((d|0)<(A[m>>2]|0))}return u=y+4|0,A[$>>2]=A[u>>2],A[$+4>>2]=A[u+4>>2],A[$+8>>2]=A[u+8>>2],l=A[16880+(l<<2)>>2]|0,By($,M?l*3|0:l),vr(H,$,H),hr(H),M?d=((A[R>>2]|0)+(A[H>>2]|0)+(A[w>>2]|0)|0)==(G|0)?1:2:d=2,H=d,F=W,H|0}function _E(u,l){u=u|0,l=l|0;var h=0;do h=rl(u,l,0,1)|0;while((h|0)==2);return h|0}function md(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0,At=0,bt=0,nt=0;if(At=F,F=F+240|0,y=At+224|0,Ce=At+208|0,$e=At,qe=At+192|0,lt=At+176|0,se=At+160|0,ce=At+144|0,Ae=At+128|0,le=At+112|0,ie=At+96|0,A[y>>2]=l,A[Ce>>2]=A[u>>2],A[Ce+4>>2]=A[u+4>>2],A[Ce+8>>2]=A[u+8>>2],A[Ce+12>>2]=A[u+12>>2],Gy(Ce,y,$e),A[m>>2]=0,ne=d+h+((d|0)==6&1)|0,(ne|0)<=(h|0)){F=At;return}w=A[y>>2]|0,R=h+6|0,M=16960+(w<<2)|0,G=ce+8|0,$=Ae+8|0,H=le+8|0,W=qe+4|0,_=0,v=h,d=-1;e:for(;;){if(y=(v|0)%6|0,u=$e+(y<<4)|0,A[qe>>2]=A[u>>2],A[qe+4>>2]=A[u+4>>2],A[qe+8>>2]=A[u+8>>2],A[qe+12>>2]=A[u+12>>2],u=_,_=rl(qe,w,0,1)|0,(v|0)>(h|0)&(ci(l)|0)!=0&&(u|0)!=1&&(A[qe>>2]|0)!=(d|0)){switch(la($e+(((y+5|0)%6|0)<<4)+4|0,lt),la($e+(y<<4)+4|0,se),bt=+(A[M>>2]|0),O[ce>>3]=bt*3,O[G>>3]=0,nt=bt*-1.5,O[Ae>>3]=nt,O[$>>3]=bt*2.598076211353316,O[le>>3]=nt,O[H>>3]=bt*-2.598076211353316,y=A[Ce>>2]|0,A[17040+(y*80|0)+(((d|0)==(y|0)?A[qe>>2]|0:d)<<2)>>2]|0){case 1:{u=Ae,d=ce;break}case 3:{u=le,d=Ae;break}case 2:{u=ce,d=le;break}default:{u=8;break e}}n_(lt,se,d,u,ie),!(r_(lt,ie)|0)&&!(r_(se,ie)|0)&&(_u(ie,A[Ce>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1)}if((v|0)<(R|0)&&(la(W,lt),_u(lt,A[qe>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1),v=v+1|0,(v|0)>=(ne|0)){u=3;break}else d=A[qe>>2]|0}if((u|0)==3){F=At;return}else(u|0)==8&&rt(27054,27017,737,27099)}function Gy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0;w=F,F=F+160|0,d=w+80|0,m=w,y=d,_=20368,v=y+72|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(v|0));y=m,_=20448,v=y+72|0;do A[y>>2]=A[_>>2],y=y+4|0,_=_+4|0;while((y|0)<(v|0));v=(ci(A[l>>2]|0)|0)==0,d=v?d:m,m=u+4|0,Fy(m),Iy(m),ci(A[l>>2]|0)|0&&(ua(m),A[l>>2]=(A[l>>2]|0)+1),A[h>>2]=A[u>>2],l=h+4|0,vr(m,d,l),hr(l),A[h+16>>2]=A[u>>2],l=h+20|0,vr(m,d+12|0,l),hr(l),A[h+32>>2]=A[u>>2],l=h+36|0,vr(m,d+24|0,l),hr(l),A[h+48>>2]=A[u>>2],l=h+52|0,vr(m,d+36|0,l),hr(l),A[h+64>>2]=A[u>>2],l=h+68|0,vr(m,d+48|0,l),hr(l),A[h+80>>2]=A[u>>2],h=h+84|0,vr(m,d+60|0,h),hr(h),F=w}function bE(u,l){return u=u|0,l=l|0,l=_e(u|0,l|0,52)|0,V()|0,l&15|0}function Vy(u,l){return u=u|0,l=l|0,l=_e(u|0,l|0,45)|0,V()|0,l&127|0}function vE(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,(h+-1|0)>>>0>14?(d=4,d|0):(h=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,A[d>>2]=h&7,d=0,d|0)}function xE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0;if(u>>>0>15)return d=4,d|0;if(l>>>0>121)return d=17,d|0;_=Re(u|0,0,52)|0,m=V()|0,v=Re(l|0,0,45)|0,m=m|(V()|0)|134225919;e:do if((u|0)>=1){for(v=1,_=(Te[20528+l>>0]|0)!=0,y=-1;;){if(l=A[h+(v+-1<<2)>>2]|0,l>>>0>6){m=18,l=10;break}if(!((l|0)==0|_^1))if((l|0)==1){m=19,l=10;break}else _=0;if(R=(15-v|0)*3|0,w=Re(7,0,R|0)|0,m=m&~(V()|0),l=Re(l|0,((l|0)<0)<<31>>31|0,R|0)|0,y=l|y&~w,m=V()|0|m,(v|0)<(u|0))v=v+1|0;else break e}if((l|0)==10)return m|0}else y=-1;while(!1);return R=d,A[R>>2]=y,A[R+4>>2]=m,R=0,R|0}function gd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;return!(!0&(l&-16777216|0)==134217728)||(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,h=_e(u|0,l|0,45)|0,V()|0,h=h&127,h>>>0>121)?(u=0,u|0):(_=(d^15)*3|0,m=_e(u|0,l|0,_|0)|0,_=Re(m|0,V()|0,_|0)|0,m=V()|0,y=Yn(-1227133514,-1171,_|0,m|0)|0,!((_&613566756&y|0)==0&(m&4681&(V()|0)|0)==0)||(_=(d*3|0)+19|0,y=Re(~u|0,~l|0,_|0)|0,_=_e(y|0,V()|0,_|0)|0,!((d|0)==15|(_|0)==0&(V()|0)==0))?(_=0,_|0):!(Te[20528+h>>0]|0)||(l=l&8191,(u|0)==0&(l|0)==0)?(_=1,_|0):(_=Bd(u|0,l|0)|0,V()|0,((63-_|0)%3|0|0)!=0|0))}function TE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;return!0&(l&-16777216|0)==134217728&&(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,h=_e(u|0,l|0,45)|0,V()|0,h=h&127,h>>>0<=121)&&(_=(d^15)*3|0,m=_e(u|0,l|0,_|0)|0,_=Re(m|0,V()|0,_|0)|0,m=V()|0,y=Yn(-1227133514,-1171,_|0,m|0)|0,(_&613566756&y|0)==0&(m&4681&(V()|0)|0)==0)&&(_=(d*3|0)+19|0,y=Re(~u|0,~l|0,_|0)|0,_=_e(y|0,V()|0,_|0)|0,(d|0)==15|(_|0)==0&(V()|0)==0)&&(!(Te[20528+h>>0]|0)||(h=l&8191,(u|0)==0&(h|0)==0)||(_=Bd(u|0,h|0)|0,V()|0,(63-_|0)%3|0|0))||Uy(u,l)|0?(_=1,_|0):(_=(i_(u,l)|0)!=0&1,_|0)}function yd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0;if(m=Re(l|0,0,52)|0,y=V()|0,h=Re(h|0,0,45)|0,h=y|(V()|0)|134225919,(l|0)<1){y=-1,d=h,l=u,A[l>>2]=y,u=u+4|0,A[u>>2]=d;return}for(y=1,m=-1;_=(15-y|0)*3|0,v=Re(7,0,_|0)|0,h=h&~(V()|0),_=Re(d|0,0,_|0)|0,m=m&~v|_,h=h|(V()|0),(y|0)!=(l|0);)y=y+1|0;v=u,_=v,A[_>>2]=m,v=v+4|0,A[v>>2]=h}function _d(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;if(y=_e(u|0,l|0,52)|0,V()|0,y=y&15,h>>>0>15)return d=4,d|0;if((y|0)<(h|0))return d=12,d|0;if((y|0)==(h|0))return A[d>>2]=u,A[d+4>>2]=l,d=0,d|0;if(m=Re(h|0,0,52)|0,m=m|u,u=V()|0|l&-15728641,(y|0)>(h|0))do l=Re(7,0,(14-h|0)*3|0)|0,h=h+1|0,m=l|m,u=V()|0|u;while((h|0)<(y|0));return A[d>>2]=m,A[d+4>>2]=u,d=0,d|0}function bu(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;if(y=_e(u|0,l|0,52)|0,V()|0,y=y&15,!((h|0)<16&(y|0)<=(h|0)))return d=4,d|0;m=h-y|0,h=_e(u|0,l|0,45)|0,V()|0;e:do if(!(an(h&127)|0))h=yo(7,0,m,((m|0)<0)<<31>>31)|0,m=V()|0;else{t:do if(y|0){for(h=1;_=Re(7,0,(15-h|0)*3|0)|0,!!((_&u|0)==0&((V()|0)&l|0)==0);)if(h>>>0<y>>>0)h=h+1|0;else break t;h=yo(7,0,m,((m|0)<0)<<31>>31)|0,m=V()|0;break e}while(!1);h=yo(7,0,m,((m|0)<0)<<31>>31)|0,h=Kn(h|0,V()|0,5,0)|0,h=We(h|0,V()|0,-5,-1)|0,h=bo(h|0,V()|0,6,0)|0,h=We(h|0,V()|0,1,0)|0,m=V()|0}while(!1);return _=d,A[_>>2]=h,A[_+4>>2]=m,_=0,_|0}function Zt(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;if(m=_e(u|0,l|0,45)|0,V()|0,!(an(m&127)|0))return m=0,m|0;m=_e(u|0,l|0,52)|0,V()|0,m=m&15;e:do if(!m)h=0;else for(d=1;;){if(h=_e(u|0,l|0,(15-d|0)*3|0)|0,V()|0,h=h&7,h|0)break e;if(d>>>0<m>>>0)d=d+1|0;else{h=0;break}}while(!1);return m=(h|0)==0&1,m|0}function wE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0;if(_=F,F=F+16|0,y=_,Sd(y,u,l,h),l=y,u=A[l>>2]|0,l=A[l+4>>2]|0,(u|0)==0&(l|0)==0)return F=_,0;m=0,h=0;do v=d+(m<<3)|0,A[v>>2]=u,A[v+4>>2]=l,m=We(m|0,h|0,1,0)|0,h=V()|0,Ed(y),v=y,u=A[v>>2]|0,l=A[v+4>>2]|0;while(!((u|0)==0&(l|0)==0));return F=_,0}function zy(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,(d|0)<(h|0)?(h=l,d=u,ut(h|0),d|0):(h=Re(-1,-1,((d-h|0)*3|0)+3|0)|0,d=Re(~h|0,~(V()|0)|0,(15-d|0)*3|0)|0,h=~(V()|0)&l,d=~d&u,ut(h|0),d|0)}function jy(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0;return m=_e(u|0,l|0,52)|0,V()|0,m=m&15,(h|0)<16&(m|0)<=(h|0)?((m|0)<(h|0)&&(m=Re(-1,-1,((h+-1-m|0)*3|0)+3|0)|0,m=Re(~m|0,~(V()|0)|0,(15-h|0)*3|0)|0,l=~(V()|0)&l,u=~m&u),m=Re(h|0,0,52)|0,h=l&-15728641|(V()|0),A[d>>2]=u|m,A[d+4>>2]=h,d=0,d|0):(d=4,d|0)}function SE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0,At=0,bt=0,nt=0,He=0,Ne=0;if((h|0)==0&(d|0)==0)return Ne=0,Ne|0;if(m=u,y=A[m>>2]|0,m=A[m+4>>2]|0,!0&(m&15728640|0)==0){if(!((d|0)>0|(d|0)==0&h>>>0>0)||(Ne=l,A[Ne>>2]=y,A[Ne+4>>2]=m,(h|0)==1&(d|0)==0))return Ne=0,Ne|0;m=1,y=0;do nt=u+(m<<3)|0,He=A[nt+4>>2]|0,Ne=l+(m<<3)|0,A[Ne>>2]=A[nt>>2],A[Ne+4>>2]=He,m=We(m|0,y|0,1,0)|0,y=V()|0;while((y|0)<(d|0)|(y|0)==(d|0)&m>>>0<h>>>0);return m=0,m|0}if(bt=h<<3,He=ns(bt)|0,!He)return Ne=13,Ne|0;if(ul(He|0,u|0,bt|0)|0,nt=Lr(h,8)|0,!nt)return Qe(He),Ne=13,Ne|0;e:for(;;){m=He,R=A[m>>2]|0,m=A[m+4>>2]|0,lt=_e(R|0,m|0,52)|0,V()|0,lt=lt&15,At=lt+-1|0,qe=(lt|0)!=0,$e=(d|0)>0|(d|0)==0&h>>>0>0;t:do if(qe&$e){if(Ae=Re(At|0,0,52)|0,le=V()|0,At>>>0>15){if(!((R|0)==0&(m|0)==0)){Ne=16;break e}for(y=0,u=0;;){if(y=We(y|0,u|0,1,0)|0,u=V()|0,!((u|0)<(d|0)|(u|0)==(d|0)&y>>>0<h>>>0))break t;if(_=He+(y<<3)|0,Ce=A[_>>2]|0,_=A[_+4>>2]|0,!((Ce|0)==0&(_|0)==0)){m=_,Ne=16;break e}}}for(v=R,u=m,y=0,_=0;;){if(!((v|0)==0&(u|0)==0)){if(!(!0&(u&117440512|0)==0)){Ne=21;break e}if(M=_e(v|0,u|0,52)|0,V()|0,M=M&15,(M|0)<(At|0)){m=12,Ne=27;break e}if((M|0)!=(At|0)&&(v=v|Ae,u=u&-15728641|le,M>>>0>=lt>>>0)){w=At;do Ce=Re(7,0,(14-w|0)*3|0)|0,w=w+1|0,v=Ce|v,u=V()|0|u;while(w>>>0<M>>>0)}if($=ll(v|0,u|0,h|0,d|0)|0,H=V()|0,w=nt+($<<3)|0,M=w,G=A[M>>2]|0,M=A[M+4>>2]|0,!((G|0)==0&(M|0)==0)){se=0,ce=0;do{if((se|0)>(d|0)|(se|0)==(d|0)&ce>>>0>h>>>0){Ne=31;break e}if((G|0)==(v|0)&(M&-117440513|0)==(u|0)){W=_e(G|0,M|0,56)|0,V()|0,W=W&7,ne=W+1|0,Ce=_e(G|0,M|0,45)|0,V()|0;n:do if(!(an(Ce&127)|0))M=7;else{if(G=_e(G|0,M|0,52)|0,V()|0,G=G&15,!G){M=6;break}for(M=1;;){if(Ce=Re(7,0,(15-M|0)*3|0)|0,!((Ce&v|0)==0&((V()|0)&u|0)==0)){M=7;break n}if(M>>>0<G>>>0)M=M+1|0;else{M=6;break}}}while(!1);if((W+2|0)>>>0>M>>>0){Ne=41;break e}Ce=Re(ne|0,0,56)|0,u=V()|0|u&-117440513,ie=w,A[ie>>2]=0,A[ie+4>>2]=0,v=Ce|v}else $=We($|0,H|0,1,0)|0,$=al($|0,V()|0,h|0,d|0)|0,H=V()|0;ce=We(ce|0,se|0,1,0)|0,se=V()|0,w=nt+($<<3)|0,M=w,G=A[M>>2]|0,M=A[M+4>>2]|0}while(!((G|0)==0&(M|0)==0))}Ce=w,A[Ce>>2]=v,A[Ce+4>>2]=u}if(y=We(y|0,_|0,1,0)|0,_=V()|0,!((_|0)<(d|0)|(_|0)==(d|0)&y>>>0<h>>>0))break t;u=He+(y<<3)|0,v=A[u>>2]|0,u=A[u+4>>2]|0}}while(!1);if(Ce=We(h|0,d|0,5,0)|0,ie=V()|0,ie>>>0<0|(ie|0)==0&Ce>>>0<11){Ne=85;break}if(Ce=bo(h|0,d|0,6,0)|0,V()|0,Ce=Lr(Ce,8)|0,!Ce){Ne=48;break}do if($e){for(ne=0,u=0,W=0,se=0;;){if(M=nt+(ne<<3)|0,_=M,y=A[_>>2]|0,_=A[_+4>>2]|0,(y|0)==0&(_|0)==0)ie=W;else{G=_e(y|0,_|0,56)|0,V()|0,G=G&7,v=G+1|0,$=_&-117440513,ie=_e(y|0,_|0,45)|0,V()|0;t:do if(an(ie&127)|0){if(H=_e(y|0,_|0,52)|0,V()|0,H=H&15,H|0)for(w=1;;){if(ie=Re(7,0,(15-w|0)*3|0)|0,!((y&ie|0)==0&($&(V()|0)|0)==0))break t;if(w>>>0<H>>>0)w=w+1|0;else break}_=Re(v|0,0,56)|0,y=_|y,_=V()|0|$,v=M,A[v>>2]=y,A[v+4>>2]=_,v=G+2|0}while(!1);(v|0)==7?(ie=Ce+(u<<3)|0,A[ie>>2]=y,A[ie+4>>2]=_&-117440513,u=We(u|0,W|0,1,0)|0,ie=V()|0):ie=W}if(ne=We(ne|0,se|0,1,0)|0,se=V()|0,(se|0)<(d|0)|(se|0)==(d|0)&ne>>>0<h>>>0)W=ie;else break}if($e){if(ce=At>>>0>15,Ae=Re(At|0,0,52)|0,le=V()|0,!qe){for(y=0,w=0,v=0,_=0;(R|0)==0&(m|0)==0||(At=l+(y<<3)|0,A[At>>2]=R,A[At+4>>2]=m,y=We(y|0,w|0,1,0)|0,w=V()|0),v=We(v|0,_|0,1,0)|0,_=V()|0,!!((_|0)<(d|0)|(_|0)==(d|0)&v>>>0<h>>>0);)m=He+(v<<3)|0,R=A[m>>2]|0,m=A[m+4>>2]|0;m=ie;break}for(y=0,w=0,_=0,v=0;;){do if(!((R|0)==0&(m|0)==0)){if(H=_e(R|0,m|0,52)|0,V()|0,H=H&15,ce|(H|0)<(At|0)){Ne=80;break e}if((H|0)!=(At|0)){if(M=R|Ae,G=m&-15728641|le,H>>>0>=lt>>>0){$=At;do qe=Re(7,0,(14-$|0)*3|0)|0,$=$+1|0,M=qe|M,G=V()|0|G;while($>>>0<H>>>0)}}else M=R,G=m;W=ll(M|0,G|0,h|0,d|0)|0,$=0,H=0,se=V()|0;do{if(($|0)>(d|0)|($|0)==(d|0)&H>>>0>h>>>0){Ne=81;break e}if(qe=nt+(W<<3)|0,ne=A[qe+4>>2]|0,(ne&-117440513|0)==(G|0)&&(A[qe>>2]|0)==(M|0)){Ne=65;break}qe=We(W|0,se|0,1,0)|0,W=al(qe|0,V()|0,h|0,d|0)|0,se=V()|0,H=We(H|0,$|0,1,0)|0,$=V()|0,qe=nt+(W<<3)|0}while(!((A[qe>>2]|0)==(M|0)&&(A[qe+4>>2]|0)==(G|0)));if((Ne|0)==65&&(Ne=0,!0&(ne&117440512|0)==100663296))break;qe=l+(y<<3)|0,A[qe>>2]=R,A[qe+4>>2]=m,y=We(y|0,w|0,1,0)|0,w=V()|0}while(!1);if(_=We(_|0,v|0,1,0)|0,v=V()|0,!((v|0)<(d|0)|(v|0)==(d|0)&_>>>0<h>>>0))break;m=He+(_<<3)|0,R=A[m>>2]|0,m=A[m+4>>2]|0}m=ie}else y=0,m=ie}else y=0,u=0,m=0;while(!1);if(vo(nt|0,0,bt|0)|0,ul(He|0,Ce|0,u<<3|0)|0,Qe(Ce),(u|0)==0&(m|0)==0){Ne=89;break}else l=l+(y<<3)|0,d=m,h=u}if((Ne|0)==16)!0&(m&117440512|0)==0?(m=4,Ne=27):Ne=21;else if((Ne|0)==31)rt(27795,27122,620,27132);else{if((Ne|0)==41)return Qe(He),Qe(nt),Ne=10,Ne|0;if((Ne|0)==48)return Qe(He),Qe(nt),Ne=13,Ne|0;(Ne|0)==80?rt(27795,27122,711,27132):(Ne|0)==81?rt(27795,27122,723,27132):(Ne|0)==85&&(ul(l|0,He|0,h<<3|0)|0,Ne=89)}return(Ne|0)==21?(Qe(He),Qe(nt),Ne=5,Ne|0):(Ne|0)==27?(Qe(He),Qe(nt),Ne=m,Ne|0):(Ne|0)==89?(Qe(He),Qe(nt),Ne=0,Ne|0):0}function EE(u,l,h,d,m,y,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0,_=_|0;var v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0;if(ne=F,F=F+16|0,W=ne,!((h|0)>0|(h|0)==0&l>>>0>0))return W=0,F=ne,W|0;if((_|0)>=16)return W=12,F=ne,W|0;$=0,H=0,G=0,v=0;e:for(;;){if(R=u+($<<3)|0,w=A[R>>2]|0,R=A[R+4>>2]|0,M=_e(w|0,R|0,52)|0,V()|0,(M&15|0)>(_|0)){v=12,w=11;break}if(Sd(W,w,R,_),M=W,R=A[M>>2]|0,M=A[M+4>>2]|0,(R|0)==0&(M|0)==0)w=G;else{w=G;do{if(!((v|0)<(y|0)|(v|0)==(y|0)&w>>>0<m>>>0)){w=10;break e}G=d+(w<<3)|0,A[G>>2]=R,A[G+4>>2]=M,w=We(w|0,v|0,1,0)|0,v=V()|0,Ed(W),G=W,R=A[G>>2]|0,M=A[G+4>>2]|0}while(!((R|0)==0&(M|0)==0))}if($=We($|0,H|0,1,0)|0,H=V()|0,(H|0)<(h|0)|(H|0)==(h|0)&$>>>0<l>>>0)G=w;else{v=0,w=11;break}}return(w|0)==10?(W=14,F=ne,W|0):(w|0)==11?(F=ne,v|0):0}function RE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0;$=F,F=F+16|0,G=$;e:do if((h|0)>0|(h|0)==0&l>>>0>0){for(R=0,_=0,y=0,M=0;;){if(w=u+(R<<3)|0,v=A[w>>2]|0,w=A[w+4>>2]|0,!((v|0)==0&(w|0)==0)&&(w=(bu(v,w,d,G)|0)==0,v=G,_=We(A[v>>2]|0,A[v+4>>2]|0,_|0,y|0)|0,y=V()|0,!w)){y=12;break}if(R=We(R|0,M|0,1,0)|0,M=V()|0,!((M|0)<(h|0)|(M|0)==(h|0)&R>>>0<l>>>0))break e}return F=$,y|0}else _=0,y=0;while(!1);return A[m>>2]=_,A[m+4>>2]=y,m=0,F=$,m|0}function NE(u,l){return u=u|0,l=l|0,l=_e(u|0,l|0,52)|0,V()|0,l&1|0}function Dr(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;if(m=_e(u|0,l|0,52)|0,V()|0,m=m&15,!m)return m=0,m|0;for(d=1;;){if(h=_e(u|0,l|0,(15-d|0)*3|0)|0,V()|0,h=h&7,h|0){d=5;break}if(d>>>0<m>>>0)d=d+1|0;else{h=0,d=5;break}}return(d|0)==5?h|0:0}function bd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0;if(w=_e(u|0,l|0,52)|0,V()|0,w=w&15,!w)return v=l,w=u,ut(v|0),w|0;for(v=1,h=0;;){y=(15-v|0)*3|0,d=Re(7,0,y|0)|0,m=V()|0,_=_e(u|0,l|0,y|0)|0,V()|0,y=Re(Aa(_&7)|0,0,y|0)|0,_=V()|0,u=y|u&~d,l=_|l&~m;e:do if(!h)if((y&d|0)==0&(_&m|0)==0)h=0;else if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(_=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,_&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(_=(15-h|0)*3|0,m=_e(u|0,l|0,_|0)|0,V()|0,y=Re(7,0,_|0)|0,l=l&~(V()|0),_=Re(Aa(m&7)|0,0,_|0)|0,u=u&~y|_,l=l|(V()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(v>>>0<w>>>0)v=v+1|0;else break}return ut(l|0),u|0}function ca(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)return h=l,d=u,ut(h|0),d|0;for(h=1;y=(15-h|0)*3|0,_=_e(u|0,l|0,y|0)|0,V()|0,m=Re(7,0,y|0)|0,l=l&~(V()|0),y=Re(Aa(_&7)|0,0,y|0)|0,u=y|u&~m,l=V()|0|l,h>>>0<d>>>0;)h=h+1|0;return ut(l|0),u|0}function CE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0;if(w=_e(u|0,l|0,52)|0,V()|0,w=w&15,!w)return v=l,w=u,ut(v|0),w|0;for(v=1,h=0;;){y=(15-v|0)*3|0,d=Re(7,0,y|0)|0,m=V()|0,_=_e(u|0,l|0,y|0)|0,V()|0,y=Re(go(_&7)|0,0,y|0)|0,_=V()|0,u=y|u&~d,l=_|l&~m;e:do if(!h)if((y&d|0)==0&(_&m|0)==0)h=0;else if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(_=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,_&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(m=(15-h|0)*3|0,y=Re(7,0,m|0)|0,_=l&~(V()|0),l=_e(u|0,l|0,m|0)|0,V()|0,l=Re(go(l&7)|0,0,m|0)|0,u=u&~y|l,l=_|(V()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(v>>>0<w>>>0)v=v+1|0;else break}return ut(l|0),u|0}function vd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;if(d=_e(u|0,l|0,52)|0,V()|0,d=d&15,!d)return h=l,d=u,ut(h|0),d|0;for(h=1;_=(15-h|0)*3|0,y=Re(7,0,_|0)|0,m=l&~(V()|0),l=_e(u|0,l|0,_|0)|0,V()|0,l=Re(go(l&7)|0,0,_|0)|0,u=l|u&~y,l=V()|0|m,h>>>0<d>>>0;)h=h+1|0;return ut(l|0),u|0}function ME(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(w=F,F=F+64|0,v=w+40|0,d=w+24|0,m=w+12|0,y=w,Re(l|0,0,52)|0,h=V()|0|134225919,!l)return(A[u+4>>2]|0)>2||(A[u+8>>2]|0)>2||(A[u+12>>2]|0)>2?(_=0,v=0,ut(_|0),F=w,v|0):(Re(Ey(u)|0,0,45)|0,_=V()|0|h,v=-1,ut(_|0),F=w,v|0);if(A[v>>2]=A[u>>2],A[v+4>>2]=A[u+4>>2],A[v+8>>2]=A[u+8>>2],A[v+12>>2]=A[u+12>>2],_=v+4|0,(l|0)>0)for(u=-1;A[d>>2]=A[_>>2],A[d+4>>2]=A[_+4>>2],A[d+8>>2]=A[_+8>>2],l&1?(sE(_),A[m>>2]=A[_>>2],A[m+4>>2]=A[_+4>>2],A[m+8>>2]=A[_+8>>2],fc(m)):(Dy(_),A[m>>2]=A[_>>2],A[m+4>>2]=A[_+4>>2],A[m+8>>2]=A[_+8>>2],ua(m)),fd(d,m,y),hr(y),M=(15-l|0)*3|0,R=Re(7,0,M|0)|0,h=h&~(V()|0),M=Re(hc(y)|0,0,M|0)|0,u=M|u&~R,h=V()|0|h,(l|0)>1;)l=l+-1|0;else u=-1;e:do if((A[_>>2]|0)<=2&&(A[v+8>>2]|0)<=2&&(A[v+12>>2]|0)<=2){if(d=Ey(v)|0,l=Re(d|0,0,45)|0,l=l|u,u=V()|0|h&-1040385,y=$7(v)|0,!(an(d)|0)){if((y|0)<=0)break;for(m=0;;){if(d=_e(l|0,u|0,52)|0,V()|0,d=d&15,d)for(h=1;M=(15-h|0)*3|0,v=_e(l|0,u|0,M|0)|0,V()|0,R=Re(7,0,M|0)|0,u=u&~(V()|0),M=Re(Aa(v&7)|0,0,M|0)|0,l=l&~R|M,u=u|(V()|0),h>>>0<d>>>0;)h=h+1|0;if(m=m+1|0,(m|0)==(y|0))break e}}m=_e(l|0,u|0,52)|0,V()|0,m=m&15;t:do if(m){h=1;n:for(;;){switch(M=_e(l|0,u|0,(15-h|0)*3|0)|0,V()|0,M&7){case 1:break n;case 0:break;default:break t}if(h>>>0<m>>>0)h=h+1|0;else break t}if(Ry(d,A[v>>2]|0)|0)for(h=1;v=(15-h|0)*3|0,R=Re(7,0,v|0)|0,M=u&~(V()|0),u=_e(l|0,u|0,v|0)|0,V()|0,u=Re(go(u&7)|0,0,v|0)|0,l=l&~R|u,u=M|(V()|0),h>>>0<m>>>0;)h=h+1|0;else for(h=1;M=(15-h|0)*3|0,v=_e(l|0,u|0,M|0)|0,V()|0,R=Re(7,0,M|0)|0,u=u&~(V()|0),M=Re(Aa(v&7)|0,0,M|0)|0,l=l&~R|M,u=u|(V()|0),h>>>0<m>>>0;)h=h+1|0}while(!1);if((y|0)>0){h=0;do l=bd(l,u)|0,u=V()|0,h=h+1|0;while((h|0)!=(y|0))}}else l=0,u=0;while(!1);return R=u,M=l,ut(R|0),F=w,M|0}function ci(u){return u=u|0,(u|0)%2|0|0}function xd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;return m=F,F=F+16|0,d=m,l>>>0>15?(d=4,F=m,d|0):(A[u+4>>2]&2146435072|0)==2146435072||(A[u+8+4>>2]&2146435072|0)==2146435072?(d=3,F=m,d|0):(pE(u,l,d),l=ME(d,l)|0,d=V()|0,A[h>>2]=l,A[h+4>>2]=d,(l|0)==0&(d|0)==0&&rt(27795,27122,1050,27145),d=0,F=m,d|0)}function Td(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;if(m=h+4|0,y=_e(u|0,l|0,52)|0,V()|0,y=y&15,_=_e(u|0,l|0,45)|0,V()|0,d=(y|0)==0,an(_&127)|0){if(d)return _=1,_|0;d=1}else{if(d)return _=0,_|0;!(A[m>>2]|0)&&!(A[h+8>>2]|0)?d=(A[h+12>>2]|0)!=0&1:d=1}for(h=1;h&1?fc(m):ua(m),_=_e(u|0,l|0,(15-h|0)*3|0)|0,V()|0,Ly(m,_&7),h>>>0<y>>>0;)h=h+1|0;return d|0}function il(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(M=F,F=F+16|0,w=M,R=_e(u|0,l|0,45)|0,V()|0,R=R&127,R>>>0>121)return A[h>>2]=0,A[h+4>>2]=0,A[h+8>>2]=0,A[h+12>>2]=0,R=5,F=M,R|0;e:do if(an(R)|0&&(y=_e(u|0,l|0,52)|0,V()|0,y=y&15,(y|0)!=0)){d=1;t:for(;;){switch(v=_e(u|0,l|0,(15-d|0)*3|0)|0,V()|0,v&7){case 5:break t;case 0:break;default:{d=l;break e}}if(d>>>0<y>>>0)d=d+1|0;else{d=l;break e}}for(m=1,d=l;l=(15-m|0)*3|0,_=Re(7,0,l|0)|0,v=d&~(V()|0),d=_e(u|0,d|0,l|0)|0,V()|0,d=Re(go(d&7)|0,0,l|0)|0,u=u&~_|d,d=v|(V()|0),m>>>0<y>>>0;)m=m+1|0}else d=l;while(!1);if(v=7696+(R*28|0)|0,A[h>>2]=A[v>>2],A[h+4>>2]=A[v+4>>2],A[h+8>>2]=A[v+8>>2],A[h+12>>2]=A[v+12>>2],!(Td(u,d,h)|0))return R=0,F=M,R|0;if(_=h+4|0,A[w>>2]=A[_>>2],A[w+4>>2]=A[_+4>>2],A[w+8>>2]=A[_+8>>2],y=_e(u|0,d|0,52)|0,V()|0,v=y&15,y&1?(ua(_),y=v+1|0):y=v,!(an(R)|0))d=0;else{e:do if(!v)d=0;else for(l=1;;){if(m=_e(u|0,d|0,(15-l|0)*3|0)|0,V()|0,m=m&7,m|0){d=m;break e}if(l>>>0<v>>>0)l=l+1|0;else{d=0;break}}while(!1);d=(d|0)==4&1}if(!(rl(h,y,d,0)|0))(y|0)!=(v|0)&&(A[_>>2]=A[w>>2],A[_+4>>2]=A[w+4>>2],A[_+8>>2]=A[w+8>>2]);else{if(an(R)|0)do;while(rl(h,y,0,0)|0);(y|0)!=(v|0)&&Dy(_)}return R=0,F=M,R|0}function ha(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;return y=F,F=F+16|0,d=y,m=il(u,l,d)|0,m|0?(F=y,m|0):(m=_e(u|0,l|0,52)|0,V()|0,yE(d,m&15,h),m=0,F=y,m|0)}function sl(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0;if(_=F,F=F+16|0,y=_,d=il(u,l,y)|0,d|0)return y=d,F=_,y|0;d=_e(u|0,l|0,45)|0,V()|0,d=(an(d&127)|0)==0,m=_e(u|0,l|0,52)|0,V()|0,m=m&15;e:do if(!d){if(m|0)for(d=1;;){if(v=Re(7,0,(15-d|0)*3|0)|0,!((v&u|0)==0&((V()|0)&l|0)==0))break e;if(d>>>0<m>>>0)d=d+1|0;else break}return pd(y,m,0,5,h),v=0,F=_,v|0}while(!1);return md(y,m,0,6,h),v=0,F=_,v|0}function PE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(m=_e(u|0,l|0,45)|0,V()|0,!(an(m&127)|0))return m=2,A[h>>2]=m,0;if(m=_e(u|0,l|0,52)|0,V()|0,m=m&15,!m)return m=5,A[h>>2]=m,0;for(d=1;;){if(y=Re(7,0,(15-d|0)*3|0)|0,!((y&u|0)==0&((V()|0)&l|0)==0)){d=2,u=6;break}if(d>>>0<m>>>0)d=d+1|0;else{d=5,u=6;break}}return(u|0)==6&&(A[h>>2]=d),0}function $y(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0;G=F,F=F+128|0,R=G+112|0,y=G+96|0,M=G,m=_e(u|0,l|0,52)|0,V()|0,v=m&15,A[R>>2]=v,_=_e(u|0,l|0,45)|0,V()|0,_=_&127;e:do if(an(_)|0){if(v|0)for(d=1;;){if(w=Re(7,0,(15-d|0)*3|0)|0,!((w&u|0)==0&((V()|0)&l|0)==0)){m=0;break e}if(d>>>0<v>>>0)d=d+1|0;else break}if(m&1)m=1;else return w=Re(v+1|0,0,52)|0,M=V()|0|l&-15728641,R=Re(7,0,(14-v|0)*3|0)|0,M=$y((w|u)&~R,M&~(V()|0),h)|0,F=G,M|0}else m=0;while(!1);if(d=il(u,l,y)|0,!d){m?(qy(y,R,M),w=5):(Gy(y,R,M),w=6);e:do if(an(_)|0)if(!v)u=5;else for(d=1;;){if(_=Re(7,0,(15-d|0)*3|0)|0,!((_&u|0)==0&((V()|0)&l|0)==0)){u=2;break e}if(d>>>0<v>>>0)d=d+1|0;else{u=5;break}}else u=2;while(!1);vo(h|0,-1,u<<2|0)|0;e:do if(m)for(y=0;;){if(_=M+(y<<4)|0,_E(_,A[R>>2]|0)|0,_=A[_>>2]|0,v=A[h>>2]|0,(v|0)==-1|(v|0)==(_|0))d=h;else{m=0;do{if(m=m+1|0,m>>>0>=u>>>0){d=1;break e}d=h+(m<<2)|0,v=A[d>>2]|0}while(!((v|0)==-1|(v|0)==(_|0)))}if(A[d>>2]=_,y=y+1|0,y>>>0>=w>>>0){d=0;break}}else for(y=0;;){if(_=M+(y<<4)|0,rl(_,A[R>>2]|0,0,1)|0,_=A[_>>2]|0,v=A[h>>2]|0,(v|0)==-1|(v|0)==(_|0))d=h;else{m=0;do{if(m=m+1|0,m>>>0>=u>>>0){d=1;break e}d=h+(m<<2)|0,v=A[d>>2]|0}while(!((v|0)==-1|(v|0)==(_|0)))}if(A[d>>2]=_,y=y+1|0,y>>>0>=w>>>0){d=0;break}}while(!1)}return M=d,F=G,M|0}function BE(){return 12}function wd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0;if(u>>>0>15)return v=4,v|0;if(Re(u|0,0,52)|0,v=V()|0|134225919,!u){h=0,d=0;do an(d)|0&&(Re(d|0,0,45)|0,_=v|(V()|0),u=l+(h<<3)|0,A[u>>2]=-1,A[u+4>>2]=_,h=h+1|0),d=d+1|0;while((d|0)!=122);return h=0,h|0}h=0,_=0;do{if(an(_)|0){for(Re(_|0,0,45)|0,d=1,m=-1,y=v|(V()|0);w=Re(7,0,(15-d|0)*3|0)|0,m=m&~w,y=y&~(V()|0),(d|0)!=(u|0);)d=d+1|0;w=l+(h<<3)|0,A[w>>2]=m,A[w+4>>2]=y,h=h+1|0}_=_+1|0}while((_|0)!=122);return h=0,h|0}function DE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0;if(Ae=F,F=F+16|0,se=Ae,ce=_e(u|0,l|0,52)|0,V()|0,ce=ce&15,h>>>0>15)return ce=4,F=Ae,ce|0;if((ce|0)<(h|0))return ce=12,F=Ae,ce|0;if((ce|0)!=(h|0))if(y=Re(h|0,0,52)|0,y=y|u,v=V()|0|l&-15728641,(ce|0)>(h|0)){w=h;do ne=Re(7,0,(14-w|0)*3|0)|0,w=w+1|0,y=ne|y,v=V()|0|v;while((w|0)<(ce|0));ne=y}else ne=y;else ne=u,v=l;W=_e(ne|0,v|0,45)|0,V()|0;e:do if(an(W&127)|0){if(w=_e(ne|0,v|0,52)|0,V()|0,w=w&15,w|0)for(y=1;;){if(W=Re(7,0,(15-y|0)*3|0)|0,!((W&ne|0)==0&((V()|0)&v|0)==0)){R=33;break e}if(y>>>0<w>>>0)y=y+1|0;else break}if(W=d,A[W>>2]=0,A[W+4>>2]=0,(ce|0)>(h|0)){for(W=l&-15728641,H=ce;;){if($=H,H=H+-1|0,H>>>0>15|(ce|0)<(H|0)){R=19;break}if((ce|0)!=(H|0))if(y=Re(H|0,0,52)|0,y=y|u,w=V()|0|W,(ce|0)<($|0))G=y;else{R=H;do G=Re(7,0,(14-R|0)*3|0)|0,R=R+1|0,y=G|y,w=V()|0|w;while((R|0)<(ce|0));G=y}else G=u,w=l;if(M=_e(G|0,w|0,45)|0,V()|0,!(an(M&127)|0))y=0;else{M=_e(G|0,w|0,52)|0,V()|0,M=M&15;t:do if(!M)y=0;else for(R=1;;){if(y=_e(G|0,w|0,(15-R|0)*3|0)|0,V()|0,y=y&7,y|0)break t;if(R>>>0<M>>>0)R=R+1|0;else{y=0;break}}while(!1);y=(y|0)==0&1}if(w=_e(u|0,l|0,(15-$|0)*3|0)|0,V()|0,w=w&7,(w|0)==7){m=5,R=42;break}if(y=(y|0)!=0,(w|0)==1&y){m=5,R=42;break}if(G=w+(((w|0)!=0&y)<<31>>31)|0,G|0&&(R=ce-$|0,R=yo(7,0,R,((R|0)<0)<<31>>31)|0,M=V()|0,y?(y=Kn(R|0,M|0,5,0)|0,y=We(y|0,V()|0,-5,-1)|0,y=bo(y|0,V()|0,6,0)|0,y=We(y|0,V()|0,1,0)|0,w=V()|0):(y=R,w=M),$=G+-1|0,$=Kn(R|0,M|0,$|0,(($|0)<0)<<31>>31|0)|0,$=We(y|0,w|0,$|0,V()|0)|0,G=V()|0,M=d,M=We($|0,G|0,A[M>>2]|0,A[M+4>>2]|0)|0,G=V()|0,$=d,A[$>>2]=M,A[$+4>>2]=G),(H|0)<=(h|0)){R=37;break}}if((R|0)==19)rt(27795,27122,1367,27158);else if((R|0)==37){_=d,m=A[_+4>>2]|0,_=A[_>>2]|0;break}else if((R|0)==42)return F=Ae,m|0}else m=0,_=0}else R=33;while(!1);e:do if((R|0)==33)if(W=d,A[W>>2]=0,A[W+4>>2]=0,(ce|0)>(h|0)){for(y=ce;;){if(m=_e(u|0,l|0,(15-y|0)*3|0)|0,V()|0,m=m&7,(m|0)==7){m=5;break}if(_=ce-y|0,_=yo(7,0,_,((_|0)<0)<<31>>31)|0,m=Kn(_|0,V()|0,m|0,0)|0,_=V()|0,W=d,_=We(A[W>>2]|0,A[W+4>>2]|0,m|0,_|0)|0,m=V()|0,W=d,A[W>>2]=_,A[W+4>>2]=m,y=y+-1|0,(y|0)<=(h|0))break e}return F=Ae,m|0}else m=0,_=0;while(!1);return bu(ne,v,ce,se)|0&&rt(27795,27122,1327,27173),ce=se,se=A[ce+4>>2]|0,((m|0)>-1|(m|0)==-1&_>>>0>4294967295)&((se|0)>(m|0)|((se|0)==(m|0)?(A[ce>>2]|0)>>>0>_>>>0:0))?(ce=0,F=Ae,ce|0):(rt(27795,27122,1407,27158),0)}function LE(u,l,h,d,m,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0;var _=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0;if(G=F,F=F+16|0,_=G,m>>>0>15)return y=4,F=G,y|0;if(v=_e(h|0,d|0,52)|0,V()|0,v=v&15,(v|0)>(m|0))return y=12,F=G,y|0;if(bu(h,d,m,_)|0&&rt(27795,27122,1327,27173),M=_,R=A[M+4>>2]|0,!(((l|0)>-1|(l|0)==-1&u>>>0>4294967295)&((R|0)>(l|0)|((R|0)==(l|0)?(A[M>>2]|0)>>>0>u>>>0:0))))return y=2,F=G,y|0;M=m-v|0,m=Re(m|0,0,52)|0,w=V()|0|d&-15728641,R=y,A[R>>2]=m|h,A[R+4>>2]=w,R=_e(h|0,d|0,45)|0,V()|0;e:do if(an(R&127)|0){if(v|0)for(_=1;;){if(R=Re(7,0,(15-_|0)*3|0)|0,!((R&h|0)==0&((V()|0)&d|0)==0))break e;if(_>>>0<v>>>0)_=_+1|0;else break}if((M|0)<1)return y=0,F=G,y|0;for(R=v^15,d=-1,w=1,_=1;;){v=M-w|0,v=yo(7,0,v,((v|0)<0)<<31>>31)|0,h=V()|0;do if(_)if(_=Kn(v|0,h|0,5,0)|0,_=We(_|0,V()|0,-5,-1)|0,_=bo(_|0,V()|0,6,0)|0,m=V()|0,(l|0)>(m|0)|(l|0)==(m|0)&u>>>0>_>>>0){l=We(u|0,l|0,-1,-1)|0,l=Yn(l|0,V()|0,_|0,m|0)|0,_=V()|0,$=y,W=A[$>>2]|0,$=A[$+4>>2]|0,ne=(R+d|0)*3|0,H=Re(7,0,ne|0)|0,$=$&~(V()|0),d=bo(l|0,_|0,v|0,h|0)|0,u=V()|0,m=We(d|0,u|0,2,0)|0,ne=Re(m|0,V()|0,ne|0)|0,$=V()|0|$,m=y,A[m>>2]=ne|W&~H,A[m+4>>2]=$,u=Kn(d|0,u|0,v|0,h|0)|0,u=Yn(l|0,_|0,u|0,V()|0)|0,_=0,l=V()|0;break}else{ne=y,H=A[ne>>2]|0,ne=A[ne+4>>2]|0,W=Re(7,0,(R+d|0)*3|0)|0,ne=ne&~(V()|0),_=y,A[_>>2]=H&~W,A[_+4>>2]=ne,_=1;break}else H=y,m=A[H>>2]|0,H=A[H+4>>2]|0,d=(R+d|0)*3|0,$=Re(7,0,d|0)|0,H=H&~(V()|0),ne=bo(u|0,l|0,v|0,h|0)|0,_=V()|0,d=Re(ne|0,_|0,d|0)|0,H=V()|0|H,W=y,A[W>>2]=d|m&~$,A[W+4>>2]=H,_=Kn(ne|0,_|0,v|0,h|0)|0,u=Yn(u|0,l|0,_|0,V()|0)|0,_=0,l=V()|0;while(!1);if((M|0)>(w|0))d=~w,w=w+1|0;else{l=0;break}}return F=G,l|0}while(!1);if((M|0)<1)return ne=0,F=G,ne|0;for(m=v^15,_=1;;)if(W=M-_|0,W=yo(7,0,W,((W|0)<0)<<31>>31)|0,ne=V()|0,w=y,h=A[w>>2]|0,w=A[w+4>>2]|0,v=(m-_|0)*3|0,d=Re(7,0,v|0)|0,w=w&~(V()|0),$=bo(u|0,l|0,W|0,ne|0)|0,H=V()|0,v=Re($|0,H|0,v|0)|0,w=V()|0|w,R=y,A[R>>2]=v|h&~d,A[R+4>>2]=w,ne=Kn($|0,H|0,W|0,ne|0)|0,u=Yn(u|0,l|0,ne|0,V()|0)|0,l=V()|0,(M|0)<=(_|0)){l=0;break}else _=_+1|0;return F=G,l|0}function Sd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;m=_e(l|0,h|0,52)|0,V()|0,m=m&15,(l|0)==0&(h|0)==0|((d|0)>15|(m|0)>(d|0))?(y=-1,l=-1,h=0,m=0):(l=zy(l,h,m+1|0,d)|0,_=(V()|0)&-15728641,h=Re(d|0,0,52)|0,h=l|h,_=_|(V()|0),l=(Zt(h,_)|0)==0,y=m,l=l?-1:d,m=_),_=u,A[_>>2]=h,A[_+4>>2]=m,A[u+8>>2]=y,A[u+12>>2]=l}function Hy(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;if(m=_e(u|0,l|0,52)|0,V()|0,m=m&15,y=d+8|0,A[y>>2]=m,(u|0)==0&(l|0)==0|((h|0)>15|(m|0)>(h|0))){h=d,A[h>>2]=0,A[h+4>>2]=0,A[y>>2]=-1,A[d+12>>2]=-1;return}if(u=zy(u,l,m+1|0,h)|0,y=(V()|0)&-15728641,m=Re(h|0,0,52)|0,m=u|m,y=y|(V()|0),u=d,A[u>>2]=m,A[u+4>>2]=y,u=d+12|0,Zt(m,y)|0){A[u>>2]=h;return}else{A[u>>2]=-1;return}}function Ed(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0;if(h=u,l=A[h>>2]|0,h=A[h+4>>2]|0,!((l|0)==0&(h|0)==0)&&(d=_e(l|0,h|0,52)|0,V()|0,d=d&15,v=Re(1,0,(d^15)*3|0)|0,l=We(v|0,V()|0,l|0,h|0)|0,h=V()|0,v=u,A[v>>2]=l,A[v+4>>2]=h,v=u+8|0,_=A[v>>2]|0,!((d|0)<(_|0)))){for(w=u+12|0,y=d;;){if((y|0)==(_|0)){d=5;break}if(R=(y|0)==(A[w>>2]|0),m=(15-y|0)*3|0,d=_e(l|0,h|0,m|0)|0,V()|0,d=d&7,R&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(R=Re(1,0,m|0)|0,l=We(l|0,h|0,R|0,V()|0)|0,h=V()|0,R=u,A[R>>2]=l,A[R+4>>2]=h,(y|0)>(_|0))y=y+-1|0;else{d=10;break}}if((d|0)==5){R=u,A[R>>2]=0,A[R+4>>2]=0,A[v>>2]=-1,A[w>>2]=-1;return}else if((d|0)==7){_=Re(1,0,m|0)|0,_=We(l|0,h|0,_|0,V()|0)|0,v=V()|0,R=u,A[R>>2]=_,A[R+4>>2]=v,A[w>>2]=y+-1;return}else if((d|0)==10)return}}function vu(u){u=+u;var l=0;return l=u<0?u+6.283185307179586:u,+(u>=6.283185307179586?l+-6.283185307179586:l)}function ol(u,l){return u=u|0,l=l|0,+gt(+(+O[u>>3]-+O[l>>3]))<17453292519943298e-27?(l=+gt(+(+O[u+8>>3]-+O[l+8>>3]))<17453292519943298e-27,l|0):(l=0,l|0)}function Qr(u,l){switch(u=+u,l=l|0,l|0){case 1:{u=u<0?u+6.283185307179586:u;break}case 2:{u=u>0?u+-6.283185307179586:u;break}}return+u}function OE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=+O[l>>3],d=+O[u>>3],y=+yt(+((m-d)*.5)),h=+yt(+((+O[l+8>>3]-+O[u+8>>3])*.5)),h=y*y+h*(+Ot(+m)*+Ot(+d)*h),+(+Ai(+ +Pt(+h),+ +Pt(+(1-h)))*2)}function xu(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=+O[l>>3],d=+O[u>>3],y=+yt(+((m-d)*.5)),h=+yt(+((+O[l+8>>3]-+O[u+8>>3])*.5)),h=y*y+h*(+Ot(+m)*+Ot(+d)*h),+(+Ai(+ +Pt(+h),+ +Pt(+(1-h)))*2*6371.007180918475)}function FE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=+O[l>>3],d=+O[u>>3],y=+yt(+((m-d)*.5)),h=+yt(+((+O[l+8>>3]-+O[u+8>>3])*.5)),h=y*y+h*(+Ot(+m)*+Ot(+d)*h),+(+Ai(+ +Pt(+h),+ +Pt(+(1-h)))*2*6371.007180918475*1e3)}function IE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0;return y=+O[l>>3],d=+Ot(+y),m=+O[l+8>>3]-+O[u+8>>3],_=d*+yt(+m),h=+O[u>>3],+ +Ai(+_,+(+yt(+y)*+Ot(+h)-+Ot(+m)*(d*+yt(+h))))}function kE(u,l,h,d){u=u|0,l=+l,h=+h,d=d|0;var m=0,y=0,_=0,v=0;if(h<1e-16){A[d>>2]=A[u>>2],A[d+4>>2]=A[u+4>>2],A[d+8>>2]=A[u+8>>2],A[d+12>>2]=A[u+12>>2];return}y=l<0?l+6.283185307179586:l,y=l>=6.283185307179586?y+-6.283185307179586:y;do if(y<1e-16)l=+O[u>>3]+h,O[d>>3]=l,m=d;else{if(m=+gt(+(y+-3.141592653589793))<1e-16,l=+O[u>>3],m){l=l-h,O[d>>3]=l,m=d;break}if(_=+Ot(+h),h=+yt(+h),l=_*+yt(+l)+ +Ot(+y)*(h*+Ot(+l)),l=l>1?1:l,l=+R7(+(l<-1?-1:l)),O[d>>3]=l,+gt(+(l+-1.5707963267948966))<1e-16){O[d>>3]=1.5707963267948966,O[d+8>>3]=0;return}if(+gt(+(l+1.5707963267948966))<1e-16){O[d>>3]=-1.5707963267948966,O[d+8>>3]=0;return}if(v=1/+Ot(+l),y=h*+yt(+y)*v,h=+O[u>>3],l=v*((_-+yt(+l)*+yt(+h))/+Ot(+h)),_=y>1?1:y,l=l>1?1:l,l=+O[u+8>>3]+ +Ai(+(_<-1?-1:_),+(l<-1?-1:l)),l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);O[d+8>>3]=l;return}while(!1);if(+gt(+(l+-1.5707963267948966))<1e-16){O[m>>3]=1.5707963267948966,O[d+8>>3]=0;return}if(+gt(+(l+1.5707963267948966))<1e-16){O[m>>3]=-1.5707963267948966,O[d+8>>3]=0;return}if(l=+O[u+8>>3],l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);O[d+8>>3]=l}function Wy(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[20656+(u<<3)>>3],l=0,l|0)}function UE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[20784+(u<<3)>>3],l=0,l|0)}function qE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[20912+(u<<3)>>3],l=0,l|0)}function GE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(O[l>>3]=+O[21040+(u<<3)>>3],l=0,l|0)}function mc(u,l){u=u|0,l=l|0;var h=0;return u>>>0>15?(l=4,l|0):(h=yo(7,0,u,((u|0)<0)<<31>>31)|0,h=Kn(h|0,V()|0,120,0)|0,u=V()|0,A[l>>2]=h|2,A[l+4>>2]=u,l=0,l|0)}function Qy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0;return $=+O[l>>3],M=+O[u>>3],w=+yt(+(($-M)*.5)),y=+O[l+8>>3],R=+O[u+8>>3],_=+yt(+((y-R)*.5)),v=+Ot(+M),G=+Ot(+$),_=w*w+_*(G*v*_),_=+Ai(+ +Pt(+_),+ +Pt(+(1-_)))*2,w=+O[h>>3],$=+yt(+((w-$)*.5)),d=+O[h+8>>3],y=+yt(+((d-y)*.5)),m=+Ot(+w),y=$*$+y*(G*m*y),y=+Ai(+ +Pt(+y),+ +Pt(+(1-y)))*2,w=+yt(+((M-w)*.5)),d=+yt(+((R-d)*.5)),d=w*w+d*(v*m*d),d=+Ai(+ +Pt(+d),+ +Pt(+(1-d)))*2,m=(_+y+d)*.5,+(+sd(+ +Pt(+(+ui(+(m*.5))*+ui(+((m-_)*.5))*+ui(+((m-y)*.5))*+ui(+((m-d)*.5)))))*4)}function Rd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0;if(v=F,F=F+192|0,y=v+168|0,_=v,m=ha(u,l,y)|0,m|0)return h=m,F=v,h|0;if(sl(u,l,_)|0&&rt(27795,27190,415,27199),l=A[_>>2]|0,(l|0)>0){if(d=+Qy(_+8|0,_+8+(((l|0)!=1&1)<<4)|0,y)+0,(l|0)!=1){u=1;do m=u,u=u+1|0,d=d+ +Qy(_+8+(m<<4)|0,_+8+(((u|0)%(l|0)|0)<<4)|0,y);while((u|0)<(l|0))}}else d=0;return O[h>>3]=d,h=0,F=v,h|0}function VE(u,l,h){return u=u|0,l=l|0,h=h|0,u=Rd(u,l,h)|0,u|0||(O[h>>3]=+O[h>>3]*6371.007180918475*6371.007180918475),u|0}function zE(u,l,h){return u=u|0,l=l|0,h=h|0,u=Rd(u,l,h)|0,u|0||(O[h>>3]=+O[h>>3]*6371.007180918475*6371.007180918475*1e3*1e3),u|0}function jE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(v=F,F=F+176|0,_=v,u=pc(u,l,_)|0,u|0)return _=u,F=v,_|0;if(O[h>>3]=0,u=A[_>>2]|0,(u|0)<=1)return _=0,F=v,_|0;l=u+-1|0,u=0,d=+O[_+8>>3],m=+O[_+16>>3],y=0;do u=u+1|0,R=d,d=+O[_+8+(u<<4)>>3],M=+yt(+((d-R)*.5)),w=m,m=+O[_+8+(u<<4)+8>>3],w=+yt(+((m-w)*.5)),w=M*M+w*(+Ot(+d)*+Ot(+R)*w),y=y+ +Ai(+ +Pt(+w),+ +Pt(+(1-w)))*2;while((u|0)<(l|0));return O[h>>3]=y,_=0,F=v,_|0}function $E(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(v=F,F=F+176|0,_=v,u=pc(u,l,_)|0,u|0)return _=u,y=+O[h>>3],y=y*6371.007180918475,O[h>>3]=y,F=v,_|0;if(O[h>>3]=0,u=A[_>>2]|0,(u|0)<=1)return _=0,y=0,y=y*6371.007180918475,O[h>>3]=y,F=v,_|0;l=u+-1|0,u=0,d=+O[_+8>>3],m=+O[_+16>>3],y=0;do u=u+1|0,R=d,d=+O[_+8+(u<<4)>>3],M=+yt(+((d-R)*.5)),w=m,m=+O[_+8+(u<<4)+8>>3],w=+yt(+((m-w)*.5)),w=M*M+w*(+Ot(+R)*+Ot(+d)*w),y=y+ +Ai(+ +Pt(+w),+ +Pt(+(1-w)))*2;while((u|0)!=(l|0));return O[h>>3]=y,_=0,M=y,M=M*6371.007180918475,O[h>>3]=M,F=v,_|0}function HE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(v=F,F=F+176|0,_=v,u=pc(u,l,_)|0,u|0)return _=u,y=+O[h>>3],y=y*6371.007180918475,y=y*1e3,O[h>>3]=y,F=v,_|0;if(O[h>>3]=0,u=A[_>>2]|0,(u|0)<=1)return _=0,y=0,y=y*6371.007180918475,y=y*1e3,O[h>>3]=y,F=v,_|0;l=u+-1|0,u=0,d=+O[_+8>>3],m=+O[_+16>>3],y=0;do u=u+1|0,R=d,d=+O[_+8+(u<<4)>>3],M=+yt(+((d-R)*.5)),w=m,m=+O[_+8+(u<<4)+8>>3],w=+yt(+((m-w)*.5)),w=M*M+w*(+Ot(+R)*+Ot(+d)*w),y=y+ +Ai(+ +Pt(+w),+ +Pt(+(1-w)))*2;while((u|0)!=(l|0));return O[h>>3]=y,_=0,M=y,M=M*6371.007180918475,M=M*1e3,O[h>>3]=M,F=v,_|0}function WE(u){u=u|0;var l=0,h=0,d=0;return l=Lr(1,12)|0,l||rt(27280,27235,49,27293),h=u+4|0,d=A[h>>2]|0,d|0?(d=d+8|0,A[d>>2]=l,A[h>>2]=l,l|0):(A[u>>2]|0&&rt(27310,27235,61,27333),d=u,A[d>>2]=l,A[h>>2]=l,l|0)}function QE(u,l){u=u|0,l=l|0;var h=0,d=0;return d=ns(24)|0,d||rt(27347,27235,78,27361),A[d>>2]=A[l>>2],A[d+4>>2]=A[l+4>>2],A[d+8>>2]=A[l+8>>2],A[d+12>>2]=A[l+12>>2],A[d+16>>2]=0,l=u+4|0,h=A[l>>2]|0,h|0?(A[h+16>>2]=d,A[l>>2]=d,d|0):(A[u>>2]|0&&rt(27376,27235,82,27361),A[u>>2]=d,A[l>>2]=d,d|0)}function Xy(u){u=u|0;var l=0,h=0,d=0,m=0;if(u)for(d=1;;){if(l=A[u>>2]|0,l|0)do{if(h=A[l>>2]|0,h|0)do m=h,h=A[h+16>>2]|0,Qe(m);while(h|0);m=l,l=A[l+8>>2]|0,Qe(m)}while(l|0);if(l=u,u=A[u+8>>2]|0,d||Qe(l),u)d=0;else break}}function XE(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0,At=0,bt=0,nt=0,He=0,Ne=0,pt=0,Qt=0,ht=0;if(m=u+8|0,A[m>>2]|0)return ht=1,ht|0;if(d=A[u>>2]|0,!d)return ht=0,ht|0;l=d,h=0;do h=h+1|0,l=A[l+8>>2]|0;while(l|0);if(h>>>0<2)return ht=0,ht|0;pt=ns(h<<2)|0,pt||rt(27396,27235,317,27415),Ne=ns(h<<5)|0,Ne||rt(27437,27235,321,27415),A[u>>2]=0,$e=u+4|0,A[$e>>2]=0,A[m>>2]=0,h=0,He=0,Ce=0,G=0;e:for(;;){if(M=A[d>>2]|0,M){y=0,_=M;do{if(w=+O[_+8>>3],l=_,_=A[_+16>>2]|0,R=(_|0)==0,m=R?M:_,v=+O[m+8>>3],+gt(+(w-v))>3.141592653589793){ht=14;break}y=y+(v-w)*(+O[l>>3]+ +O[m>>3])}while(!R);if((ht|0)==14){ht=0,y=0,l=M;do ie=+O[l+8>>3],nt=l+16|0,bt=A[nt>>2]|0,bt=bt|0?bt:M,le=+O[bt+8>>3],y=y+(+O[l>>3]+ +O[bt>>3])*((le<0?le+6.283185307179586:le)-(ie<0?ie+6.283185307179586:ie)),l=A[(l|0?nt:d)>>2]|0;while(l|0)}y>0?(A[pt+(He<<2)>>2]=d,He=He+1|0,m=Ce,l=G):ht=19}else ht=19;if((ht|0)==19){ht=0;do if(h){if(l=h+8|0,A[l>>2]|0){ht=21;break e}if(h=Lr(1,12)|0,!h){ht=23;break e}A[l>>2]=h,m=h+4|0,_=h,l=G}else if(G){m=$e,_=G+8|0,l=d,h=u;break}else if(A[u>>2]|0){ht=27;break e}else{m=$e,_=u,l=d,h=u;break}while(!1);if(A[_>>2]=d,A[m>>2]=d,_=Ne+(Ce<<5)|0,R=A[d>>2]|0,R){for(M=Ne+(Ce<<5)+8|0,O[M>>3]=17976931348623157e292,G=Ne+(Ce<<5)+24|0,O[G>>3]=17976931348623157e292,O[_>>3]=-17976931348623157e292,$=Ne+(Ce<<5)+16|0,O[$>>3]=-17976931348623157e292,ce=17976931348623157e292,Ae=-17976931348623157e292,m=0,H=R,w=17976931348623157e292,ne=17976931348623157e292,se=-17976931348623157e292,v=-17976931348623157e292;y=+O[H>>3],ie=+O[H+8>>3],H=A[H+16>>2]|0,W=(H|0)==0,le=+O[(W?R:H)+8>>3],y<w&&(O[M>>3]=y,w=y),ie<ne&&(O[G>>3]=ie,ne=ie),y>se?O[_>>3]=y:y=se,ie>v&&(O[$>>3]=ie,v=ie),ce=ie>0&ie<ce?ie:ce,Ae=ie<0&ie>Ae?ie:Ae,m=m|+gt(+(ie-le))>3.141592653589793,!W;)se=y;m&&(O[$>>3]=Ae,O[G>>3]=ce)}else A[_>>2]=0,A[_+4>>2]=0,A[_+8>>2]=0,A[_+12>>2]=0,A[_+16>>2]=0,A[_+20>>2]=0,A[_+24>>2]=0,A[_+28>>2]=0;m=Ce+1|0}if(nt=d+8|0,d=A[nt>>2]|0,A[nt>>2]=0,d)Ce=m,G=l;else{ht=45;break}}if((ht|0)==21)rt(27213,27235,35,27247);else if((ht|0)==23)rt(27267,27235,37,27247);else if((ht|0)==27)rt(27310,27235,61,27333);else if((ht|0)==45){e:do if((He|0)>0){for(nt=(m|0)==0,At=m<<2,bt=(u|0)==0,lt=0,l=0;;){if(qe=A[pt+(lt<<2)>>2]|0,nt)ht=73;else{if(Ce=ns(At)|0,!Ce){ht=50;break}if($e=ns(At)|0,!$e){ht=52;break}t:do if(bt)h=0;else{for(m=0,h=0,_=u;d=Ne+(m<<5)|0,Yy(A[_>>2]|0,d,A[qe>>2]|0)|0?(A[Ce+(h<<2)>>2]=_,A[$e+(h<<2)>>2]=d,W=h+1|0):W=h,_=A[_+8>>2]|0,_;)m=m+1|0,h=W;if((W|0)>0)if(d=A[Ce>>2]|0,(W|0)==1)h=d;else for($=0,H=-1,h=d,G=d;;){for(R=A[G>>2]|0,d=0,_=0;m=A[A[Ce+(_<<2)>>2]>>2]|0,(m|0)==(R|0)?M=d:M=d+((Yy(m,A[$e+(_<<2)>>2]|0,A[R>>2]|0)|0)&1)|0,_=_+1|0,(_|0)!=(W|0);)d=M;if(m=(M|0)>(H|0),h=m?G:h,d=$+1|0,(d|0)==(W|0))break t;$=d,H=m?M:H,G=A[Ce+(d<<2)>>2]|0}else h=0}while(!1);if(Qe(Ce),Qe($e),h){if(m=h+4|0,d=A[m>>2]|0,d)h=d+8|0;else if(A[h>>2]|0){ht=70;break}A[h>>2]=qe,A[m>>2]=qe}else ht=73}if((ht|0)==73){if(ht=0,l=A[qe>>2]|0,l|0)do $e=l,l=A[l+16>>2]|0,Qe($e);while(l|0);Qe(qe),l=1}if(lt=lt+1|0,(lt|0)>=(He|0)){Qt=l;break e}}(ht|0)==50?rt(27452,27235,249,27471):(ht|0)==52?rt(27490,27235,252,27471):(ht|0)==70&&rt(27310,27235,61,27333)}else Qt=0;while(!1);return Qe(pt),Qe(Ne),ht=Qt,ht|0}return 0}function Yy(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(!(cd(l,h)|0)||(l=Ny(l)|0,d=+O[h>>3],m=+O[h+8>>3],m=l&m<0?m+6.283185307179586:m,u=A[u>>2]|0,!u))return u=0,u|0;if(l){l=0,R=m,h=u;e:for(;;){for(;_=+O[h>>3],m=+O[h+8>>3],h=h+16|0,M=A[h>>2]|0,M=M|0?M:u,y=+O[M>>3],v=+O[M+8>>3],_>y?(w=_,_=v):(w=y,y=_,_=m,m=v),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=A[h>>2]|0,!h){h=22;break e}if(v=_<0?_+6.283185307179586:_,_=m<0?m+6.283185307179586:m,R=v==R|_==R?R+-2220446049250313e-31:R,w=v+(_-v)*((d-y)/(w-y)),(w<0?w+6.283185307179586:w)>R&&(l=l^1),h=A[h>>2]|0,!h){h=22;break}}if((h|0)==22)return l|0}else{l=0,R=m,h=u;e:for(;;){for(;_=+O[h>>3],m=+O[h+8>>3],h=h+16|0,M=A[h>>2]|0,M=M|0?M:u,y=+O[M>>3],v=+O[M+8>>3],_>y?(w=_,_=v):(w=y,y=_,_=m,m=v),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=A[h>>2]|0,!h){h=22;break e}if(R=_==R|m==R?R+-2220446049250313e-31:R,_+(m-_)*((d-y)/(w-y))>R&&(l=l^1),h=A[h>>2]|0,!h){h=22;break}}if((h|0)==22)return l|0}return 0}function Us(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0;if(Ae=F,F=F+32|0,ce=Ae+16|0,se=Ae,y=_e(u|0,l|0,52)|0,V()|0,y=y&15,H=_e(h|0,d|0,52)|0,V()|0,(y|0)!=(H&15|0))return ce=12,F=Ae,ce|0;if(R=_e(u|0,l|0,45)|0,V()|0,R=R&127,M=_e(h|0,d|0,45)|0,V()|0,M=M&127,R>>>0>121|M>>>0>121)return ce=5,F=Ae,ce|0;if(H=(R|0)!=(M|0),H){if(v=Ad(R,M)|0,(v|0)==7)return ce=1,F=Ae,ce|0;w=Ad(M,R)|0,(w|0)==7?rt(27514,27538,161,27548):(W=v,_=w)}else W=0,_=0;G=an(R)|0,$=an(M)|0,A[ce>>2]=0,A[ce+4>>2]=0,A[ce+8>>2]=0,A[ce+12>>2]=0;do if(W){if(M=A[4272+(R*28|0)+(W<<2)>>2]|0,v=(M|0)>0,$)if(v){R=0,w=h,v=d;do w=CE(w,v)|0,v=V()|0,_=go(_)|0,(_|0)==1&&(_=go(1)|0),R=R+1|0;while((R|0)!=(M|0));M=_,R=w,w=v}else M=_,R=h,w=d;else if(v){R=0,w=h,v=d;do w=vd(w,v)|0,v=V()|0,_=go(_)|0,R=R+1|0;while((R|0)!=(M|0));M=_,R=w,w=v}else M=_,R=h,w=d;if(Td(R,w,ce)|0,H||rt(27563,27538,191,27548),v=(G|0)!=0,_=($|0)!=0,v&_&&rt(27590,27538,192,27548),v){if(_=Dr(u,l)|0,(_|0)==7){y=5;break}if(Te[22e3+(_*7|0)+W>>0]|0){y=1;break}w=A[21168+(_*28|0)+(W<<2)>>2]|0,R=w}else if(_){if(_=Dr(R,w)|0,(_|0)==7){y=5;break}if(Te[22e3+(_*7|0)+M>>0]|0){y=1;break}R=0,w=A[21168+(M*28|0)+(_<<2)>>2]|0}else R=0,w=0;if((R|w|0)<0)y=5;else{if((w|0)>0){v=ce+4|0,_=0;do dc(v),_=_+1|0;while((_|0)!=(w|0))}if(A[se>>2]=0,A[se+4>>2]=0,A[se+8>>2]=0,Ly(se,W),y|0)for(;ci(y)|0?fc(se):ua(se),(y|0)>1;)y=y+-1|0;if((R|0)>0){y=0;do dc(se),y=y+1|0;while((y|0)!=(R|0))}ne=ce+4|0,vr(ne,se,ne),hr(ne),ne=51}}else if(Td(h,d,ce)|0,(G|0)!=0&($|0)!=0)if((M|0)!=(R|0)&&rt(27621,27538,261,27548),_=Dr(u,l)|0,y=Dr(h,d)|0,(_|0)==7|(y|0)==7)y=5;else if(Te[22e3+(_*7|0)+y>>0]|0)y=1;else if(_=A[21168+(_*28|0)+(y<<2)>>2]|0,(_|0)>0){v=ce+4|0,y=0;do dc(v),y=y+1|0;while((y|0)!=(_|0));ne=51}else ne=51;else ne=51;while(!1);return(ne|0)==51&&(y=ce+4|0,A[m>>2]=A[y>>2],A[m+4>>2]=A[y+4>>2],A[m+8>>2]=A[y+8>>2],y=0),ce=y,F=Ae,ce|0}function Ky(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0;if(ne=F,F=F+48|0,R=ne+36|0,_=ne+24|0,v=ne+12|0,w=ne,m=_e(u|0,l|0,52)|0,V()|0,m=m&15,$=_e(u|0,l|0,45)|0,V()|0,$=$&127,$>>>0>121)return d=5,F=ne,d|0;if(M=an($)|0,Re(m|0,0,52)|0,se=V()|0|134225919,y=d,A[y>>2]=-1,A[y+4>>2]=se,!m)return m=hc(h)|0,(m|0)==7||(m=ud($,m)|0,(m|0)==127)?(se=1,F=ne,se|0):(H=Re(m|0,0,45)|0,W=V()|0,$=d,W=A[$+4>>2]&-1040385|W,se=d,A[se>>2]=A[$>>2]|H,A[se+4>>2]=W,se=0,F=ne,se|0);for(A[R>>2]=A[h>>2],A[R+4>>2]=A[h+4>>2],A[R+8>>2]=A[h+8>>2],h=m;;){if(y=h,h=h+-1|0,A[_>>2]=A[R>>2],A[_+4>>2]=A[R+4>>2],A[_+8>>2]=A[R+8>>2],ci(y)|0){if(m=rE(R)|0,m|0){h=13;break}A[v>>2]=A[R>>2],A[v+4>>2]=A[R+4>>2],A[v+8>>2]=A[R+8>>2],fc(v)}else{if(m=iE(R)|0,m|0){h=13;break}A[v>>2]=A[R>>2],A[v+4>>2]=A[R+4>>2],A[v+8>>2]=A[R+8>>2],ua(v)}if(fd(_,v,w),hr(w),m=d,Ae=A[m>>2]|0,m=A[m+4>>2]|0,le=(15-y|0)*3|0,ce=Re(7,0,le|0)|0,m=m&~(V()|0),le=Re(hc(w)|0,0,le|0)|0,m=V()|0|m,se=d,A[se>>2]=le|Ae&~ce,A[se+4>>2]=m,(y|0)<=1){h=14;break}}e:do if((h|0)!=13&&(h|0)==14)if((A[R>>2]|0)<=1&&(A[R+4>>2]|0)<=1&&(A[R+8>>2]|0)<=1){h=hc(R)|0,m=ud($,h)|0,(m|0)==127?w=0:w=an(m)|0;t:do if(h){if(M){if(m=Dr(u,l)|0,(m|0)==7){m=5;break e}if(y=A[21376+(m*28|0)+(h<<2)>>2]|0,(y|0)>0){m=h,h=0;do m=Aa(m)|0,h=h+1|0;while((h|0)!=(y|0))}else m=h;if((m|0)==1){m=9;break e}h=ud($,m)|0,(h|0)==127&&rt(27648,27538,411,27678),an(h)|0?rt(27693,27538,412,27678):(W=h,H=y,G=m)}else W=m,H=0,G=h;if(v=A[4272+($*28|0)+(G<<2)>>2]|0,(v|0)<=-1&&rt(27724,27538,419,27678),!w){if((H|0)<0){m=5;break e}if(H|0){y=d,m=0,h=A[y>>2]|0,y=A[y+4>>2]|0;do h=ca(h,y)|0,y=V()|0,le=d,A[le>>2]=h,A[le+4>>2]=y,m=m+1|0;while((m|0)<(H|0))}if((v|0)<=0){m=W,h=58;break}for(y=d,m=0,h=A[y>>2]|0,y=A[y+4>>2]|0;;)if(h=ca(h,y)|0,y=V()|0,le=d,A[le>>2]=h,A[le+4>>2]=y,m=m+1|0,(m|0)==(v|0)){m=W,h=58;break t}}if(_=Ad(W,$)|0,(_|0)==7&&rt(27514,27538,428,27678),m=d,h=A[m>>2]|0,m=A[m+4>>2]|0,(v|0)>0){y=0;do h=ca(h,m)|0,m=V()|0,le=d,A[le>>2]=h,A[le+4>>2]=m,y=y+1|0;while((y|0)!=(v|0))}if(m=Dr(h,m)|0,(m|0)==7&&rt(27795,27538,440,27678),h=ld(W)|0,h=A[(h?21792:21584)+(_*28|0)+(m<<2)>>2]|0,(h|0)<0&&rt(27795,27538,454,27678),!h)m=W,h=58;else{_=d,m=0,y=A[_>>2]|0,_=A[_+4>>2]|0;do y=bd(y,_)|0,_=V()|0,le=d,A[le>>2]=y,A[le+4>>2]=_,m=m+1|0;while((m|0)<(h|0));m=W,h=58}}else if((M|0)!=0&(w|0)!=0){if(h=Dr(u,l)|0,y=d,y=Dr(A[y>>2]|0,A[y+4>>2]|0)|0,(h|0)==7|(y|0)==7){m=5;break e}if(y=A[21376+(h*28|0)+(y<<2)>>2]|0,(y|0)<0){m=5;break e}if(!y)h=59;else{v=d,h=0,_=A[v>>2]|0,v=A[v+4>>2]|0;do _=ca(_,v)|0,v=V()|0,le=d,A[le>>2]=_,A[le+4>>2]=v,h=h+1|0;while((h|0)<(y|0));h=58}}else h=58;while(!1);if((h|0)==58&&w&&(h=59),(h|0)==59&&(le=d,(Dr(A[le>>2]|0,A[le+4>>2]|0)|0)==1)){m=9;break}le=d,ce=A[le>>2]|0,le=A[le+4>>2]&-1040385,Ae=Re(m|0,0,45)|0,le=le|(V()|0),m=d,A[m>>2]=ce|Ae,A[m+4>>2]=le,m=0}else m=1;while(!1);return le=m,F=ne,le|0}function YE(u,l,h,d,m,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0;var _=0,v=0;return v=F,F=F+16|0,_=v,m?u=15:(u=Us(u,l,h,d,_)|0,u||(oE(_,y),u=0)),F=v,u|0}function KE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0;return _=F,F=F+16|0,y=_,d?h=15:(h=aE(h,y)|0,h||(h=Ky(u,l,y,m)|0)),F=_,h|0}function ZE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0;return w=F,F=F+32|0,_=w+12|0,v=w,y=Us(u,l,u,l,_)|0,y|0?(v=y,F=w,v|0):(u=Us(u,l,h,d,v)|0,u|0?(v=u,F=w,v|0):(_=dd(_,v)|0,v=m,A[v>>2]=_,A[v+4>>2]=((_|0)<0)<<31>>31,v=0,F=w,v|0))}function JE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0;return w=F,F=F+32|0,_=w+12|0,v=w,y=Us(u,l,u,l,_)|0,!y&&(y=Us(u,l,h,d,v)|0,!y)?(d=dd(_,v)|0,d=We(d|0,((d|0)<0)<<31>>31|0,1,0)|0,_=V()|0,v=m,A[v>>2]=d,A[v+4>>2]=_,v=0,F=w,v|0):(v=y,F=w,v|0)}function eR(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0;if(qe=F,F=F+48|0,Ce=qe+24|0,_=qe+12|0,$e=qe,y=Us(u,l,u,l,Ce)|0,!y&&(y=Us(u,l,h,d,_)|0,!y)){le=dd(Ce,_)|0,ie=((le|0)<0)<<31>>31,A[Ce>>2]=0,A[Ce+4>>2]=0,A[Ce+8>>2]=0,A[_>>2]=0,A[_+4>>2]=0,A[_+8>>2]=0,Us(u,l,u,l,Ce)|0&&rt(27795,27538,692,27747),Us(u,l,h,d,_)|0&&rt(27795,27538,697,27747),ky(Ce),ky(_),M=le|0?1/+(le|0):0,h=A[Ce>>2]|0,ne=M*+((A[_>>2]|0)-h|0),se=Ce+4|0,d=A[se>>2]|0,ce=M*+((A[_+4>>2]|0)-d|0),Ae=Ce+8|0,y=A[Ae>>2]|0,M=M*+((A[_+8>>2]|0)-y|0),A[$e>>2]=h,G=$e+4|0,A[G>>2]=d,$=$e+8|0,A[$>>2]=y;e:do if((le|0)<0)y=0;else for(H=0,W=0;;){w=+(W>>>0)+4294967296*+(H|0),lt=ne*w+ +(h|0),v=ce*w+ +(d|0),w=M*w+ +(y|0),h=~~+bc(+lt),_=~~+bc(+v),y=~~+bc(+w),lt=+gt(+(+(h|0)-lt)),v=+gt(+(+(_|0)-v)),w=+gt(+(+(y|0)-w));do if(lt>v&lt>w)h=0-(_+y)|0,d=_;else if(R=0-h|0,v>w){d=R-y|0;break}else{d=_,y=R-_|0;break}while(!1);if(A[$e>>2]=h,A[G>>2]=d,A[$>>2]=y,lE($e),y=Ky(u,l,$e,m+(W<<3)|0)|0,y|0)break e;if(!((H|0)<(ie|0)|(H|0)==(ie|0)&W>>>0<le>>>0)){y=0;break e}h=We(W|0,H|0,1,0)|0,d=V()|0,H=d,W=h,h=A[Ce>>2]|0,d=A[se>>2]|0,y=A[Ae>>2]|0}while(!1);return $e=y,F=qe,$e|0}return $e=y,F=qe,$e|0}function yo(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;if((h|0)==0&(d|0)==0)return m=0,y=1,ut(m|0),y|0;y=u,m=l,u=1,l=0;do _=(h&1|0)==0&!0,u=Kn((_?1:y)|0,(_?0:m)|0,u|0,l|0)|0,l=V()|0,h=A_(h|0,d|0,1)|0,d=V()|0,y=Kn(y|0,m|0,y|0,m|0)|0,m=V()|0;while(!((h|0)==0&(d|0)==0));return ut(l|0),u|0}function Nd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0;v=F,F=F+16|0,y=v,_=_e(u|0,l|0,52)|0,V()|0,_=_&15;do if(_){if(m=ha(u,l,y)|0,!m){R=+O[y>>3],w=1/+Ot(+R),M=+O[25968+(_<<3)>>3],O[h>>3]=R+M,O[h+8>>3]=R-M,R=+O[y+8>>3],w=M*w,O[h+16>>3]=w+R,O[h+24>>3]=R-w;break}return _=m,F=v,_|0}else{if(m=_e(u|0,l|0,45)|0,V()|0,m=m&127,m>>>0>121)return _=5,F=v,_|0;y=22064+(m<<5)|0,A[h>>2]=A[y>>2],A[h+4>>2]=A[y+4>>2],A[h+8>>2]=A[y+8>>2],A[h+12>>2]=A[y+12>>2],A[h+16>>2]=A[y+16>>2],A[h+20>>2]=A[y+20>>2],A[h+24>>2]=A[y+24>>2],A[h+28>>2]=A[y+28>>2];break}while(!1);return eE(h,d?1.4:1.1),d=26096+(_<<3)|0,(A[d>>2]|0)==(u|0)&&(A[d+4>>2]|0)==(l|0)&&(O[h>>3]=1.5707963267948966),_=26224+(_<<3)|0,(A[_>>2]|0)==(u|0)&&(A[_+4>>2]|0)==(l|0)&&(O[h+8>>3]=-1.5707963267948966),+O[h>>3]!=1.5707963267948966&&+O[h+8>>3]!=-1.5707963267948966?(_=0,F=v,_|0):(O[h+16>>3]=3.141592653589793,O[h+24>>3]=-3.141592653589793,_=0,F=v,_|0)}function tR(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0;R=F,F=F+48|0,_=R+32|0,y=R+40|0,v=R,yd(_,0,0,0),w=A[_>>2]|0,_=A[_+4>>2]|0;do if(h>>>0<=15){if(m=wu(d)|0,m|0){d=v,A[d>>2]=0,A[d+4>>2]=0,A[v+8>>2]=m,A[v+12>>2]=-1,d=v+16|0,w=v+29|0,A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,Te[d+12>>0]=0,Te[w>>0]=Te[y>>0]|0,Te[w+1>>0]=Te[y+1>>0]|0,Te[w+2>>0]=Te[y+2>>0]|0;break}if(m=Lr((A[l+8>>2]|0)+1|0,32)|0,m){Cd(l,m),M=v,A[M>>2]=w,A[M+4>>2]=_,A[v+8>>2]=0,A[v+12>>2]=h,A[v+16>>2]=d,A[v+20>>2]=l,A[v+24>>2]=m,Te[v+28>>0]=0,w=v+29|0,Te[w>>0]=Te[y>>0]|0,Te[w+1>>0]=Te[y+1>>0]|0,Te[w+2>>0]=Te[y+2>>0]|0;break}else{d=v,A[d>>2]=0,A[d+4>>2]=0,A[v+8>>2]=13,A[v+12>>2]=-1,d=v+16|0,w=v+29|0,A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,Te[d+12>>0]=0,Te[w>>0]=Te[y>>0]|0,Te[w+1>>0]=Te[y+1>>0]|0,Te[w+2>>0]=Te[y+2>>0]|0;break}}else w=v,A[w>>2]=0,A[w+4>>2]=0,A[v+8>>2]=4,A[v+12>>2]=-1,w=v+16|0,M=v+29|0,A[w>>2]=0,A[w+4>>2]=0,A[w+8>>2]=0,Te[w+12>>0]=0,Te[M>>0]=Te[y>>0]|0,Te[M+1>>0]=Te[y+1>>0]|0,Te[M+2>>0]=Te[y+2>>0]|0;while(!1);gc(v),A[u>>2]=A[v>>2],A[u+4>>2]=A[v+4>>2],A[u+8>>2]=A[v+8>>2],A[u+12>>2]=A[v+12>>2],A[u+16>>2]=A[v+16>>2],A[u+20>>2]=A[v+20>>2],A[u+24>>2]=A[v+24>>2],A[u+28>>2]=A[v+28>>2],F=R}function gc(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0;if(ie=F,F=F+336|0,H=ie+168|0,W=ie,d=u,h=A[d>>2]|0,d=A[d+4>>2]|0,(h|0)==0&(d|0)==0){F=ie;return}if(l=u+28|0,Te[l>>0]|0?(h=Zy(h,d)|0,d=V()|0):Te[l>>0]=1,le=u+20|0,!(A[A[le>>2]>>2]|0)){l=u+24|0,h=A[l>>2]|0,h|0&&Qe(h),Ae=u,A[Ae>>2]=0,A[Ae+4>>2]=0,A[u+8>>2]=0,A[le>>2]=0,A[u+12>>2]=-1,A[u+16>>2]=0,A[l>>2]=0,F=ie;return}Ae=u+16|0,l=A[Ae>>2]|0,m=l&15;e:do if((h|0)==0&(d|0)==0)ce=u+24|0;else{ne=u+12|0,G=(m|0)==3,M=l&255,w=(m|1|0)==3,$=u+24|0,R=(m+-1|0)>>>0<3,_=(m|2|0)==3,v=W+8|0;t:for(;;){if(y=_e(h|0,d|0,52)|0,V()|0,y=y&15,(y|0)==(A[ne>>2]|0)){switch(M&15){case 0:case 2:case 3:{if(m=ha(h,d,H)|0,m|0){se=15;break t}if(Md(A[le>>2]|0,A[$>>2]|0,H)|0){se=19;break t}break}}if(w&&(m=A[(A[le>>2]|0)+4>>2]|0,A[H>>2]=A[m>>2],A[H+4>>2]=A[m+4>>2],A[H+8>>2]=A[m+8>>2],A[H+12>>2]=A[m+12>>2],cd(26832,H)|0)){if(xd(A[(A[le>>2]|0)+4>>2]|0,y,W)|0){se=25;break}if(m=W,(A[m>>2]|0)==(h|0)&&(A[m+4>>2]|0)==(d|0)){se=29;break}}if(R){if(m=sl(h,d,H)|0,m|0){se=32;break}if(Nd(h,d,W,0)|0){se=36;break}if(_&&e_(A[le>>2]|0,A[$>>2]|0,H,W)|0){se=42;break}if(w&&t_(A[le>>2]|0,A[$>>2]|0,H,W)|0){se=42;break}}if(G){if(l=Nd(h,d,H,1)|0,m=A[$>>2]|0,l|0){se=45;break}if(hd(m,H)|0){if(My(W,H),Cy(H,A[$>>2]|0)|0){se=53;break}if(Md(A[le>>2]|0,A[$>>2]|0,v)|0){se=53;break}if(t_(A[le>>2]|0,A[$>>2]|0,W,H)|0){se=53;break}}}}do if((y|0)<(A[ne>>2]|0)){if(l=Nd(h,d,H,1)|0,m=A[$>>2]|0,l|0){se=58;break t}if(!(hd(m,H)|0)){se=73;break}if(Cy(A[$>>2]|0,H)|0&&(My(W,H),e_(A[le>>2]|0,A[$>>2]|0,W,H)|0)){se=65;break t}if(h=jy(h,d,y+1|0,W)|0,h|0){se=67;break t}d=W,h=A[d>>2]|0,d=A[d+4>>2]|0}else se=73;while(!1);if((se|0)==73&&(se=0,h=Zy(h,d)|0,d=V()|0),(h|0)==0&(d|0)==0){ce=$;break e}}switch(se|0){case 15:{l=A[$>>2]|0,l|0&&Qe(l),se=u,A[se>>2]=0,A[se+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=m,se=20;break}case 19:{A[u>>2]=h,A[u+4>>2]=d,se=20;break}case 25:{rt(27795,27761,470,27772);break}case 29:{A[u>>2]=h,A[u+4>>2]=d,F=ie;return}case 32:{l=A[$>>2]|0,l|0&&Qe(l),ce=u,A[ce>>2]=0,A[ce+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=m,F=ie;return}case 36:{rt(27795,27761,493,27772);break}case 42:{A[u>>2]=h,A[u+4>>2]=d,F=ie;return}case 45:{m|0&&Qe(m),se=u,A[se>>2]=0,A[se+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=l,se=55;break}case 53:{A[u>>2]=h,A[u+4>>2]=d,se=55;break}case 58:{m|0&&Qe(m),se=u,A[se>>2]=0,A[se+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=l,se=71;break}case 65:{A[u>>2]=h,A[u+4>>2]=d,se=71;break}case 67:{l=A[$>>2]|0,l|0&&Qe(l),ce=u,A[ce>>2]=0,A[ce+4>>2]=0,A[le>>2]=0,A[ne>>2]=-1,A[Ae>>2]=0,A[$>>2]=0,A[u+8>>2]=h,F=ie;return}}if((se|0)==20){F=ie;return}else if((se|0)==55){F=ie;return}else if((se|0)==71){F=ie;return}}while(!1);l=A[ce>>2]|0,l|0&&Qe(l),se=u,A[se>>2]=0,A[se+4>>2]=0,A[u+8>>2]=0,A[le>>2]=0,A[u+12>>2]=-1,A[Ae>>2]=0,A[ce>>2]=0,F=ie}function Zy(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0;G=F,F=F+16|0,M=G,d=_e(u|0,l|0,52)|0,V()|0,d=d&15,h=_e(u|0,l|0,45)|0,V()|0;do if(d){for(;h=Re(d+4095|0,0,52)|0,m=V()|0|l&-15728641,y=(15-d|0)*3|0,_=Re(7,0,y|0)|0,v=V()|0,h=h|u|_,m=m|v,w=_e(u|0,l|0,y|0)|0,V()|0,w=w&7,d=d+-1|0,!(w>>>0<6);)if(d)l=m,u=h;else{R=4;break}if((R|0)==4){h=_e(h|0,m|0,45)|0,V()|0;break}return M=(w|0)==0&(Zt(h,m)|0)!=0,M=Re((M?2:1)+w|0,0,y|0)|0,R=V()|0|l&~v,M=M|u&~_,ut(R|0),F=G,M|0}while(!1);return h=h&127,h>>>0>120?(R=0,M=0,ut(R|0),F=G,M|0):(yd(M,0,h+1|0,0),R=A[M+4>>2]|0,M=A[M>>2]|0,ut(R|0),F=G,M|0)}function nR(u,l,h,d,m,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,y=y|0;var _=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0;se=F,F=F+160|0,G=se+80|0,v=se+64|0,$=se+112|0,ne=se,tR(G,u,l,h),R=G,Sd(v,A[R>>2]|0,A[R+4>>2]|0,l),R=v,w=A[R>>2]|0,R=A[R+4>>2]|0,_=A[G+8>>2]|0,H=$+4|0,A[H>>2]=A[G>>2],A[H+4>>2]=A[G+4>>2],A[H+8>>2]=A[G+8>>2],A[H+12>>2]=A[G+12>>2],A[H+16>>2]=A[G+16>>2],A[H+20>>2]=A[G+20>>2],A[H+24>>2]=A[G+24>>2],A[H+28>>2]=A[G+28>>2],H=ne,A[H>>2]=w,A[H+4>>2]=R,H=ne+8|0,A[H>>2]=_,u=ne+12|0,l=$,h=u+36|0;do A[u>>2]=A[l>>2],u=u+4|0,l=l+4|0;while((u|0)<(h|0));if($=ne+48|0,A[$>>2]=A[v>>2],A[$+4>>2]=A[v+4>>2],A[$+8>>2]=A[v+8>>2],A[$+12>>2]=A[v+12>>2],(w|0)==0&(R|0)==0)return ne=_,F=se,ne|0;h=ne+16|0,M=ne+24|0,G=ne+28|0,_=0,v=0,l=w,u=R;do{if(!((_|0)<(m|0)|(_|0)==(m|0)&v>>>0<d>>>0)){W=4;break}if(R=v,v=We(v|0,_|0,1,0)|0,_=V()|0,R=y+(R<<3)|0,A[R>>2]=l,A[R+4>>2]=u,Ed($),u=$,l=A[u>>2]|0,u=A[u+4>>2]|0,(l|0)==0&(u|0)==0){if(gc(h),l=h,u=A[l>>2]|0,l=A[l+4>>2]|0,(u|0)==0&(l|0)==0){W=10;break}Hy(u,l,A[G>>2]|0,$),u=$,l=A[u>>2]|0,u=A[u+4>>2]|0}R=ne,A[R>>2]=l,A[R+4>>2]=u}while(!((l|0)==0&(u|0)==0));return(W|0)==4?(u=ne+40|0,l=A[u>>2]|0,l|0&&Qe(l),W=ne+16|0,A[W>>2]=0,A[W+4>>2]=0,A[M>>2]=0,A[ne+36>>2]=0,A[G>>2]=-1,A[ne+32>>2]=0,A[u>>2]=0,Hy(0,0,0,$),A[ne>>2]=0,A[ne+4>>2]=0,A[H>>2]=0,ne=14,F=se,ne|0):((W|0)==10&&(A[ne>>2]=0,A[ne+4>>2]=0,A[H>>2]=A[M>>2]),ne=A[H>>2]|0,F=se,ne|0)}function rR(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0;if(G=F,F=F+48|0,w=G+32|0,v=G+40|0,R=G,!(A[u>>2]|0))return M=d,A[M>>2]=0,A[M+4>>2]=0,M=0,F=G,M|0;yd(w,0,0,0),_=w,m=A[_>>2]|0,_=A[_+4>>2]|0;do if(l>>>0>15)M=R,A[M>>2]=0,A[M+4>>2]=0,A[R+8>>2]=4,A[R+12>>2]=-1,M=R+16|0,h=R+29|0,A[M>>2]=0,A[M+4>>2]=0,A[M+8>>2]=0,Te[M+12>>0]=0,Te[h>>0]=Te[v>>0]|0,Te[h+1>>0]=Te[v+1>>0]|0,Te[h+2>>0]=Te[v+2>>0]|0,h=4,M=9;else{if(h=wu(h)|0,h|0){w=R,A[w>>2]=0,A[w+4>>2]=0,A[R+8>>2]=h,A[R+12>>2]=-1,w=R+16|0,M=R+29|0,A[w>>2]=0,A[w+4>>2]=0,A[w+8>>2]=0,Te[w+12>>0]=0,Te[M>>0]=Te[v>>0]|0,Te[M+1>>0]=Te[v+1>>0]|0,Te[M+2>>0]=Te[v+2>>0]|0,M=9;break}if(h=Lr((A[u+8>>2]|0)+1|0,32)|0,!h){M=R,A[M>>2]=0,A[M+4>>2]=0,A[R+8>>2]=13,A[R+12>>2]=-1,M=R+16|0,h=R+29|0,A[M>>2]=0,A[M+4>>2]=0,A[M+8>>2]=0,Te[M+12>>0]=0,Te[h>>0]=Te[v>>0]|0,Te[h+1>>0]=Te[v+1>>0]|0,Te[h+2>>0]=Te[v+2>>0]|0,h=13,M=9;break}Cd(u,h),H=R,A[H>>2]=m,A[H+4>>2]=_,_=R+8|0,A[_>>2]=0,A[R+12>>2]=l,A[R+20>>2]=u,A[R+24>>2]=h,Te[R+28>>0]=0,m=R+29|0,Te[m>>0]=Te[v>>0]|0,Te[m+1>>0]=Te[v+1>>0]|0,Te[m+2>>0]=Te[v+2>>0]|0,A[R+16>>2]=3,$=+K7(h),$=$*+Y7(h),y=+gt(+ +O[h>>3]),y=$/+Ot(+ +_c(+y,+ +gt(+ +O[h+8>>3])))*6371.007180918475*6371.007180918475,m=R+12|0,h=A[m>>2]|0;e:do if((h|0)>0)do{if(Wy(h+-1|0,w)|0,!(y/+O[w>>3]>10))break e;H=A[m>>2]|0,h=H+-1|0,A[m>>2]=h}while((H|0)>1);while(!1);if(gc(R),m=d,A[m>>2]=0,A[m+4>>2]=0,m=R,h=A[m>>2]|0,m=A[m+4>>2]|0,!((h|0)==0&(m|0)==0))do bu(h,m,l,w)|0,v=w,u=d,v=We(A[u>>2]|0,A[u+4>>2]|0,A[v>>2]|0,A[v+4>>2]|0)|0,u=V()|0,H=d,A[H>>2]=v,A[H+4>>2]=u,gc(R),H=R,h=A[H>>2]|0,m=A[H+4>>2]|0;while(!((h|0)==0&(m|0)==0));h=A[_>>2]|0}while(!1);return H=h,F=G,H|0}function Tu(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0;if(!(cd(l,h)|0)||(l=Ny(l)|0,d=+O[h>>3],m=+O[h+8>>3],m=l&m<0?m+6.283185307179586:m,$=A[u>>2]|0,($|0)<=0))return $=0,$|0;if(G=A[u+4>>2]|0,l){l=0,M=m,h=-1,u=0;e:for(;;){for(R=u;_=+O[G+(R<<4)>>3],m=+O[G+(R<<4)+8>>3],u=(h+2|0)%($|0)|0,y=+O[G+(u<<4)>>3],v=+O[G+(u<<4)+8>>3],_>y?(w=_,_=v):(w=y,y=_,_=m,m=v),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=R+1|0,(h|0)>=($|0)){h=22;break e}else u=R,R=h,h=u;if(v=_<0?_+6.283185307179586:_,_=m<0?m+6.283185307179586:m,M=v==M|_==M?M+-2220446049250313e-31:M,w=v+(_-v)*((d-y)/(w-y)),(w<0?w+6.283185307179586:w)>M&&(l=l^1),u=R+1|0,(u|0)>=($|0)){h=22;break}else h=R}if((h|0)==22)return l|0}else{l=0,M=m,h=-1,u=0;e:for(;;){for(R=u;_=+O[G+(R<<4)>>3],m=+O[G+(R<<4)+8>>3],u=(h+2|0)%($|0)|0,y=+O[G+(u<<4)>>3],v=+O[G+(u<<4)+8>>3],_>y?(w=_,_=v):(w=y,y=_,_=m,m=v),d=d==y|d==w?d+2220446049250313e-31:d,!!(d<y|d>w);)if(h=R+1|0,(h|0)>=($|0)){h=22;break e}else u=R,R=h,h=u;if(M=_==M|m==M?M+-2220446049250313e-31:M,_+(m-_)*((d-y)/(w-y))>M&&(l=l^1),u=R+1|0,(u|0)>=($|0)){h=22;break}else h=R}if((h|0)==22)return l|0}return 0}function Jy(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0;if(W=A[u>>2]|0,!W){A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,A[l+16>>2]=0,A[l+20>>2]=0,A[l+24>>2]=0,A[l+28>>2]=0;return}if(ne=l+8|0,O[ne>>3]=17976931348623157e292,se=l+24|0,O[se>>3]=17976931348623157e292,O[l>>3]=-17976931348623157e292,ce=l+16|0,O[ce>>3]=-17976931348623157e292,!((W|0)<=0)){for($=A[u+4>>2]|0,R=17976931348623157e292,M=-17976931348623157e292,G=0,u=-1,y=17976931348623157e292,_=17976931348623157e292,w=-17976931348623157e292,d=-17976931348623157e292,H=0;h=+O[$+(H<<4)>>3],v=+O[$+(H<<4)+8>>3],u=u+2|0,m=+O[$+(((u|0)==(W|0)?0:u)<<4)+8>>3],h<y&&(O[ne>>3]=h,y=h),v<_&&(O[se>>3]=v,_=v),h>w?O[l>>3]=h:h=w,v>d&&(O[ce>>3]=v,d=v),R=v>0&v<R?v:R,M=v<0&v>M?v:M,G=G|+gt(+(v-m))>3.141592653589793,u=H+1|0,(u|0)!=(W|0);)Ae=H,w=h,H=u,u=Ae;G&&(O[ce>>3]=M,O[se>>3]=R)}}function wu(u){return u=u|0,(u>>>0<4?0:15)|0}function Cd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0;if(W=A[u>>2]|0,W){if(ne=l+8|0,O[ne>>3]=17976931348623157e292,se=l+24|0,O[se>>3]=17976931348623157e292,O[l>>3]=-17976931348623157e292,ce=l+16|0,O[ce>>3]=-17976931348623157e292,(W|0)>0){for(m=A[u+4>>2]|0,$=17976931348623157e292,H=-17976931348623157e292,d=0,h=-1,w=17976931348623157e292,R=17976931348623157e292,G=-17976931348623157e292,_=-17976931348623157e292,Ae=0;y=+O[m+(Ae<<4)>>3],M=+O[m+(Ae<<4)+8>>3],$e=h+2|0,v=+O[m+((($e|0)==(W|0)?0:$e)<<4)+8>>3],y<w&&(O[ne>>3]=y,w=y),M<R&&(O[se>>3]=M,R=M),y>G?O[l>>3]=y:y=G,M>_&&(O[ce>>3]=M,_=M),$=M>0&M<$?M:$,H=M<0&M>H?M:H,d=d|+gt(+(M-v))>3.141592653589793,h=Ae+1|0,(h|0)!=(W|0);)$e=Ae,G=y,Ae=h,h=$e;d&&(O[ce>>3]=H,O[se>>3]=$)}}else A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,A[l+16>>2]=0,A[l+20>>2]=0,A[l+24>>2]=0,A[l+28>>2]=0;if($e=u+8|0,h=A[$e>>2]|0,!((h|0)<=0)){Ce=u+12|0,ie=0;do if(m=A[Ce>>2]|0,d=ie,ie=ie+1|0,se=l+(ie<<5)|0,ce=A[m+(d<<3)>>2]|0,ce){if(Ae=l+(ie<<5)+8|0,O[Ae>>3]=17976931348623157e292,u=l+(ie<<5)+24|0,O[u>>3]=17976931348623157e292,O[se>>3]=-17976931348623157e292,le=l+(ie<<5)+16|0,O[le>>3]=-17976931348623157e292,(ce|0)>0){for(W=A[m+(d<<3)+4>>2]|0,$=17976931348623157e292,H=-17976931348623157e292,m=0,d=-1,ne=0,w=17976931348623157e292,R=17976931348623157e292,M=-17976931348623157e292,_=-17976931348623157e292;y=+O[W+(ne<<4)>>3],G=+O[W+(ne<<4)+8>>3],d=d+2|0,v=+O[W+(((d|0)==(ce|0)?0:d)<<4)+8>>3],y<w&&(O[Ae>>3]=y,w=y),G<R&&(O[u>>3]=G,R=G),y>M?O[se>>3]=y:y=M,G>_&&(O[le>>3]=G,_=G),$=G>0&G<$?G:$,H=G<0&G>H?G:H,m=m|+gt(+(G-v))>3.141592653589793,d=ne+1|0,(d|0)!=(ce|0);)qe=ne,ne=d,M=y,d=qe;m&&(O[le>>3]=H,O[u>>3]=$)}}else A[se>>2]=0,A[se+4>>2]=0,A[se+8>>2]=0,A[se+12>>2]=0,A[se+16>>2]=0,A[se+20>>2]=0,A[se+24>>2]=0,A[se+28>>2]=0,h=A[$e>>2]|0;while((ie|0)<(h|0))}}function Md(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(!(Tu(u,l,h)|0))return m=0,m|0;if(m=u+8|0,(A[m>>2]|0)<=0)return m=1,m|0;for(d=u+12|0,u=0;;){if(y=u,u=u+1|0,Tu((A[d>>2]|0)+(y<<3)|0,l+(u<<5)|0,h)|0){u=0,d=6;break}if((u|0)>=(A[m>>2]|0)){u=1,d=6;break}}return(d|0)==6?u|0:0}function e_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(R=F,F=F+16|0,v=R,_=h+8|0,!(Tu(u,l,_)|0))return w=0,F=R,w|0;w=u+8|0;e:do if((A[w>>2]|0)>0){for(y=u+12|0,m=0;;){if(M=m,m=m+1|0,Tu((A[y>>2]|0)+(M<<3)|0,l+(m<<5)|0,_)|0){m=0;break}if((m|0)>=(A[w>>2]|0))break e}return F=R,m|0}while(!1);if(yc(u,l,h,d)|0)return M=0,F=R,M|0;A[v>>2]=A[h>>2],A[v+4>>2]=_,m=A[w>>2]|0;e:do if((m|0)>0)for(u=u+12|0,_=0,y=m;;){if(m=A[u>>2]|0,(A[m+(_<<3)>>2]|0)>0){if(Tu(v,d,A[m+(_<<3)+4>>2]|0)|0){m=0;break e}if(m=_+1|0,yc((A[u>>2]|0)+(_<<3)|0,l+(m<<5)|0,h,d)|0){m=0;break e}y=A[w>>2]|0}else m=_+1|0;if((m|0)<(y|0))_=m;else{m=1;break}}else m=1;while(!1);return M=m,F=R,M|0}function yc(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0,$e=0,qe=0,lt=0;if($e=F,F=F+176|0,Ae=$e+172|0,m=$e+168|0,le=$e,!(hd(l,d)|0))return u=0,F=$e,u|0;if(Z7(l,d,Ae,m),ul(le|0,h|0,168)|0,(A[h>>2]|0)>0){l=0;do qe=le+8+(l<<4)+8|0,ce=+Qr(+O[qe>>3],A[m>>2]|0),O[qe>>3]=ce,l=l+1|0;while((l|0)<(A[h>>2]|0))}ne=+O[d>>3],se=+O[d+8>>3],ce=+Qr(+O[d+16>>3],A[m>>2]|0),H=+Qr(+O[d+24>>3],A[m>>2]|0);e:do if((A[u>>2]|0)>0){if(d=u+4|0,m=A[le>>2]|0,(m|0)<=0){for(l=0;;)if(l=l+1|0,(l|0)>=(A[u>>2]|0)){l=0;break e}}for(h=0;;){if(l=A[d>>2]|0,$=+O[l+(h<<4)>>3],W=+Qr(+O[l+(h<<4)+8>>3],A[Ae>>2]|0),l=A[d>>2]|0,h=h+1|0,qe=(h|0)%(A[u>>2]|0)|0,y=+O[l+(qe<<4)>>3],_=+Qr(+O[l+(qe<<4)+8>>3],A[Ae>>2]|0),!($>=ne)|!(y>=ne)&&!($<=se)|!(y<=se)&&!(W<=H)|!(_<=H)&&!(W>=ce)|!(_>=ce)){G=y-$,R=_-W,l=0;do if(lt=l,l=l+1|0,qe=(l|0)==(m|0)?0:l,y=+O[le+8+(lt<<4)+8>>3],_=+O[le+8+(qe<<4)+8>>3]-y,v=+O[le+8+(lt<<4)>>3],w=+O[le+8+(qe<<4)>>3]-v,M=G*_-R*w,M!=0&&(ie=W-y,Ce=$-v,w=(ie*w-_*Ce)/M,!(w<0|w>1))&&(M=(G*ie-R*Ce)/M,M>=0&M<=1)){l=1;break e}while((l|0)<(m|0))}if((h|0)>=(A[u>>2]|0)){l=0;break}}}else l=0;while(!1);return lt=l,F=$e,lt|0}function t_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0;if(yc(u,l,h,d)|0)return y=1,y|0;if(y=u+8|0,(A[y>>2]|0)<=0)return y=0,y|0;for(m=u+12|0,u=0;;){if(_=u,u=u+1|0,yc((A[m>>2]|0)+(_<<3)|0,l+(u<<5)|0,h,d)|0){u=1,m=6;break}if((u|0)>=(A[y>>2]|0)){u=0,m=6;break}}return(m|0)==6?u|0:0}function iR(){return 8}function sR(){return 16}function oR(){return 168}function aR(){return 8}function lR(){return 16}function uR(){return 12}function AR(){return 8}function cR(u){return u=u|0,+(+((A[u>>2]|0)>>>0)+4294967296*+(A[u+4>>2]|0))}function hR(u){u=u|0;var l=0,h=0;return h=+O[u>>3],l=+O[u+8>>3],+ +Pt(+(h*h+l*l))}function n_(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0;R=+O[u>>3],w=+O[l>>3]-R,v=+O[u+8>>3],_=+O[l+8>>3]-v,G=+O[h>>3],y=+O[d>>3]-G,$=+O[h+8>>3],M=+O[d+8>>3]-$,y=(y*(v-$)-(R-G)*M)/(w*M-_*y),O[m>>3]=R+w*y,O[m+8>>3]=v+_*y}function r_(u,l){return u=u|0,l=l|0,+gt(+(+O[u>>3]-+O[l>>3]))<11920928955078125e-23?(l=+gt(+(+O[u+8>>3]-+O[l+8>>3]))<11920928955078125e-23,l|0):(l=0,l|0)}function Fn(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return m=+O[u>>3]-+O[l>>3],d=+O[u+8>>3]-+O[l+8>>3],h=+O[u+16>>3]-+O[l+16>>3],+(m*m+d*d+h*h)}function fR(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;h=+O[u>>3],d=+Ot(+h),h=+yt(+h),O[l+16>>3]=h,h=+O[u+8>>3],m=d*+Ot(+h),O[l>>3]=m,h=d*+yt(+h),O[l+8>>3]=h}function dR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if(y=F,F=F+16|0,m=y,d=Zt(u,l)|0,(h+-1|0)>>>0>5||(d=(d|0)!=0,(h|0)==1&d))return m=-1,F=y,m|0;do if(Su(u,l,m)|0)d=-1;else if(d){d=((A[26352+(h<<2)>>2]|0)+5-(A[m>>2]|0)|0)%5|0;break}else{d=((A[26384+(h<<2)>>2]|0)+6-(A[m>>2]|0)|0)%6|0;break}while(!1);return m=d,F=y,m|0}function Su(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0;if(M=F,F=F+32|0,v=M+16|0,w=M,d=il(u,l,v)|0,d|0)return h=d,F=M,h|0;y=Vy(u,l)|0,R=Dr(u,l)|0,H7(y,w),d=W7(y,A[v>>2]|0)|0;do if(an(y)|0){do switch(y|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:rt(27795,27797,75,27806)}while(!1);if(_=A[26416+(m*24|0)+8>>2]|0,l=A[26416+(m*24|0)+16>>2]|0,u=A[v>>2]|0,(u|0)!=(A[w>>2]|0)&&(w=ld(y)|0,u=A[v>>2]|0,w|(u|0)==(l|0)&&(d=(d+1|0)%6|0)),(R|0)==3&(u|0)==(l|0)){d=(d+5|0)%6|0;break}(R|0)==5&(u|0)==(_|0)&&(d=(d+1|0)%6|0)}while(!1);return A[h>>2]=d,h=0,F=M,h|0}function hi(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0;if(le=F,F=F+32|0,Ae=le+24|0,se=le+20|0,W=le+8|0,H=le+16|0,$=le,w=(Zt(u,l)|0)==0,w=w?6:5,M=_e(u|0,l|0,52)|0,V()|0,M=M&15,w>>>0<=h>>>0)return d=2,F=le,d|0;G=(M|0)==0,!G&&(ne=Re(7,0,(M^15)*3|0)|0,(ne&u|0)==0&((V()|0)&l|0)==0)?m=h:y=4;e:do if((y|0)==4){if(m=(Zt(u,l)|0)!=0,((m?4:5)|0)<(h|0)||Su(u,l,Ae)|0||(y=(A[Ae>>2]|0)+h|0,m?m=26704+(((y|0)%5|0)<<2)|0:m=26736+(((y|0)%6|0)<<2)|0,ne=A[m>>2]|0,(ne|0)==7))return d=1,F=le,d|0;A[se>>2]=0,m=Xn(u,l,ne,se,W)|0;do if(!m){if(v=W,R=A[v>>2]|0,v=A[v+4>>2]|0,_=v>>>0<l>>>0|(v|0)==(l|0)&R>>>0<u>>>0,y=_?R:u,_=_?v:l,!G&&(G=Re(7,0,(M^15)*3|0)|0,(R&G|0)==0&(v&(V()|0)|0)==0))m=h;else{if(v=(h+-1+w|0)%(w|0)|0,m=Zt(u,l)|0,(v|0)<0&&rt(27795,27797,248,27822),w=(m|0)!=0,((w?4:5)|0)<(v|0)&&rt(27795,27797,248,27822),Su(u,l,Ae)|0&&rt(27795,27797,248,27822),m=(A[Ae>>2]|0)+v|0,w?m=26704+(((m|0)%5|0)<<2)|0:m=26736+(((m|0)%6|0)<<2)|0,v=A[m>>2]|0,(v|0)==7&&rt(27795,27797,248,27822),A[H>>2]=0,m=Xn(u,l,v,H,$)|0,m|0)break;R=$,w=A[R>>2]|0,R=A[R+4>>2]|0;do if(R>>>0<_>>>0|(R|0)==(_|0)&w>>>0<y>>>0){if(Zt(w,R)|0?y=ad(w,R,u,l)|0:y=A[26800+((((A[H>>2]|0)+(A[26768+(v<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Zt(w,R)|0,(y+-1|0)>>>0>5){m=-1,y=w,_=R;break}if(m=(m|0)!=0,(y|0)==1&m){m=-1,y=w,_=R;break}do if(Su(w,R,Ae)|0)m=-1;else if(m){m=((A[26352+(y<<2)>>2]|0)+5-(A[Ae>>2]|0)|0)%5|0;break}else{m=((A[26384+(y<<2)>>2]|0)+6-(A[Ae>>2]|0)|0)%6|0;break}while(!1);y=w,_=R}else m=h;while(!1);v=W,R=A[v>>2]|0,v=A[v+4>>2]|0}if((y|0)==(R|0)&(_|0)==(v|0)){if(w=(Zt(R,v)|0)!=0,w?u=ad(R,v,u,l)|0:u=A[26800+((((A[se>>2]|0)+(A[26768+(ne<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Zt(R,v)|0,(u+-1|0)>>>0<=5&&(ce=(m|0)!=0,!((u|0)==1&ce)))do if(Su(R,v,Ae)|0)m=-1;else if(ce){m=((A[26352+(u<<2)>>2]|0)+5-(A[Ae>>2]|0)|0)%5|0;break}else{m=((A[26384+(u<<2)>>2]|0)+6-(A[Ae>>2]|0)|0)%6|0;break}while(!1);else m=-1;m=m+1|0,m=(m|0)==6|w&(m|0)==5?0:m}l=_,u=y;break e}while(!1);return d=m,F=le,d|0}while(!1);return ce=Re(m|0,0,56)|0,Ae=V()|0|l&-2130706433|536870912,A[d>>2]=ce|u,A[d+4>>2]=Ae,d=0,F=le,d|0}function pR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;return y=(Zt(u,l)|0)==0,d=hi(u,l,0,h)|0,m=(d|0)==0,y?!m||(d=hi(u,l,1,h+8|0)|0,d|0)||(d=hi(u,l,2,h+16|0)|0,d|0)||(d=hi(u,l,3,h+24|0)|0,d|0)||(d=hi(u,l,4,h+32|0)|0,d)?(y=d,y|0):hi(u,l,5,h+40|0)|0:!m||(d=hi(u,l,1,h+8|0)|0,d|0)||(d=hi(u,l,2,h+16|0)|0,d|0)||(d=hi(u,l,3,h+24|0)|0,d|0)||(d=hi(u,l,4,h+32|0)|0,d|0)?(y=d,y|0):(y=h+40|0,A[y>>2]=0,A[y+4>>2]=0,y=0,y|0)}function mR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0,v=0,w=0;return w=F,F=F+192|0,m=w,y=w+168|0,_=_e(u|0,l|0,56)|0,V()|0,_=_&7,v=l&-2130706433|134217728,d=il(u,v,y)|0,d|0?(v=d,F=w,v|0):(l=_e(u|0,l|0,52)|0,V()|0,l=l&15,Zt(u,v)|0?pd(y,l,_,1,m):md(y,l,_,1,m),v=m+8|0,A[h>>2]=A[v>>2],A[h+4>>2]=A[v+4>>2],A[h+8>>2]=A[v+8>>2],A[h+12>>2]=A[v+12>>2],v=0,F=w,v|0)}function i_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return m=F,F=F+16|0,h=m,!(!0&(l&2013265920|0)==536870912)||(d=l&-2130706433|134217728,!(gd(u,d)|0))?(d=0,F=m,d|0):(y=_e(u|0,l|0,56)|0,V()|0,y=(hi(u,d,y&7,h)|0)==0,d=h,d=y&((A[d>>2]|0)==(u|0)?(A[d+4>>2]|0)==(l|0):0)&1,F=m,d|0)}function s_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0;(l|0)>0?(d=Lr(l,4)|0,A[u>>2]=d,d||rt(27835,27858,40,27872)):A[u>>2]=0,A[u+4>>2]=l,A[u+8>>2]=0,A[u+12>>2]=h}function o_(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0;m=u+4|0,y=u+12|0,_=u+8|0;e:for(;;){for(h=A[m>>2]|0,l=0;;){if((l|0)>=(h|0))break e;if(d=A[u>>2]|0,v=A[d+(l<<2)>>2]|0,!v)l=l+1|0;else break}l=d+(~~(+gt(+(+mo(10,+ +(15-(A[y>>2]|0)|0))*(+O[v>>3]+ +O[v+8>>3])))%+(h|0))>>>0<<2)|0,h=A[l>>2]|0;t:do if(h|0){if(d=v+32|0,(h|0)==(v|0))A[l>>2]=A[d>>2];else{if(h=h+32|0,l=A[h>>2]|0,!l)break;for(;(l|0)!=(v|0);)if(h=l+32|0,l=A[h>>2]|0,!l)break t;A[h>>2]=A[d>>2]}Qe(v),A[_>>2]=(A[_>>2]|0)+-1}while(!1)}Qe(A[u>>2]|0)}function a_(u){u=u|0;var l=0,h=0,d=0;for(d=A[u+4>>2]|0,h=0;;){if((h|0)>=(d|0)){l=0,h=4;break}if(l=A[(A[u>>2]|0)+(h<<2)>>2]|0,!l)h=h+1|0;else{h=4;break}}return(h|0)==4?l|0:0}function l_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;if(h=~~(+gt(+(+mo(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,h=(A[u>>2]|0)+(h<<2)|0,d=A[h>>2]|0,!d)return y=1,y|0;y=l+32|0;do if((d|0)!=(l|0)){if(h=A[d+32>>2]|0,!h)return y=1,y|0;for(m=h;;){if((m|0)==(l|0)){m=8;break}if(h=A[m+32>>2]|0,h)d=m,m=h;else{h=1,m=10;break}}if((m|0)==8){A[d+32>>2]=A[y>>2];break}else if((m|0)==10)return h|0}else A[h>>2]=A[y>>2];while(!1);return Qe(l),y=u+8|0,A[y>>2]=(A[y>>2]|0)+-1,y=0,y|0}function gR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;y=ns(40)|0,y||rt(27888,27858,98,27901),A[y>>2]=A[l>>2],A[y+4>>2]=A[l+4>>2],A[y+8>>2]=A[l+8>>2],A[y+12>>2]=A[l+12>>2],m=y+16|0,A[m>>2]=A[h>>2],A[m+4>>2]=A[h+4>>2],A[m+8>>2]=A[h+8>>2],A[m+12>>2]=A[h+12>>2],A[y+32>>2]=0,m=~~(+gt(+(+mo(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,m=(A[u>>2]|0)+(m<<2)|0,d=A[m>>2]|0;do if(!d)A[m>>2]=y;else{for(;!(ol(d,l)|0&&ol(d+16|0,h)|0);)if(m=A[d+32>>2]|0,d=m|0?m:d,!(A[d+32>>2]|0)){_=10;break}if((_|0)==10){A[d+32>>2]=y;break}return Qe(y),_=d,_|0}while(!1);return _=u+8|0,A[_>>2]=(A[_>>2]|0)+1,_=y,_|0}function yR(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;if(m=~~(+gt(+(+mo(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,m=A[(A[u>>2]|0)+(m<<2)>>2]|0,!m)return h=0,h|0;if(!h){for(u=m;;){if(ol(u,l)|0){d=10;break}if(u=A[u+32>>2]|0,!u){u=0,d=10;break}}if((d|0)==10)return u|0}for(u=m;;){if(ol(u,l)|0&&ol(u+16|0,h)|0){d=10;break}if(u=A[u+32>>2]|0,!u){u=0,d=10;break}}return(d|0)==10?u|0:0}function _R(u,l){u=u|0,l=l|0;var h=0;if(h=~~(+gt(+(+mo(10,+ +(15-(A[u+12>>2]|0)|0))*(+O[l>>3]+ +O[l+8>>3])))%+(A[u+4>>2]|0))>>>0,u=A[(A[u>>2]|0)+(h<<2)>>2]|0,!u)return h=0,h|0;for(;;){if(ol(u,l)|0){l=5;break}if(u=A[u+32>>2]|0,!u){u=0,l=5;break}}return(l|0)==5?u|0:0}function bR(){return 27920}function _o(u){return u=+u,~~+h_(+u)|0}function ns(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0,ne=0,se=0,ce=0,Ae=0,le=0,ie=0,Ce=0;Ce=F,F=F+16|0,$=Ce;do if(u>>>0<245){if(R=u>>>0<11?16:u+11&-8,u=R>>>3,G=A[6981]|0,h=G>>>u,h&3|0)return l=(h&1^1)+u|0,u=27964+(l<<1<<2)|0,h=u+8|0,d=A[h>>2]|0,m=d+8|0,y=A[m>>2]|0,(y|0)==(u|0)?A[6981]=G&~(1<<l):(A[y+12>>2]=u,A[h>>2]=y),ie=l<<3,A[d+4>>2]=ie|3,ie=d+ie+4|0,A[ie>>2]=A[ie>>2]|1,ie=m,F=Ce,ie|0;if(M=A[6983]|0,R>>>0>M>>>0){if(h|0)return l=2<<u,l=h<<u&(l|0-l),l=(l&0-l)+-1|0,v=l>>>12&16,l=l>>>v,h=l>>>5&8,l=l>>>h,y=l>>>2&4,l=l>>>y,u=l>>>1&2,l=l>>>u,d=l>>>1&1,d=(h|v|y|u|d)+(l>>>d)|0,l=27964+(d<<1<<2)|0,u=l+8|0,y=A[u>>2]|0,v=y+8|0,h=A[v>>2]|0,(h|0)==(l|0)?(u=G&~(1<<d),A[6981]=u):(A[h+12>>2]=l,A[u>>2]=h,u=G),ie=d<<3,_=ie-R|0,A[y+4>>2]=R|3,m=y+R|0,A[m+4>>2]=_|1,A[y+ie>>2]=_,M|0&&(d=A[6986]|0,l=M>>>3,h=27964+(l<<1<<2)|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=d,A[l+12>>2]=d,A[d+8>>2]=l,A[d+12>>2]=h),A[6983]=_,A[6986]=m,ie=v,F=Ce,ie|0;if(y=A[6982]|0,y){for(h=(y&0-y)+-1|0,m=h>>>12&16,h=h>>>m,d=h>>>5&8,h=h>>>d,_=h>>>2&4,h=h>>>_,v=h>>>1&2,h=h>>>v,w=h>>>1&1,w=A[28228+((d|m|_|v|w)+(h>>>w)<<2)>>2]|0,h=w,v=w,w=(A[w+4>>2]&-8)-R|0;u=A[h+16>>2]|0,!(!u&&(u=A[h+20>>2]|0,!u));)_=(A[u+4>>2]&-8)-R|0,m=_>>>0<w>>>0,h=u,v=m?u:v,w=m?_:w;if(_=v+R|0,_>>>0>v>>>0){m=A[v+24>>2]|0,l=A[v+12>>2]|0;do if((l|0)==(v|0)){if(u=v+20|0,l=A[u>>2]|0,!l&&(u=v+16|0,l=A[u>>2]|0,!l)){h=0;break}for(;;)if(d=l+20|0,h=A[d>>2]|0,h)l=h,u=d;else if(d=l+16|0,h=A[d>>2]|0,h)l=h,u=d;else break;A[u>>2]=0,h=l}else h=A[v+8>>2]|0,A[h+12>>2]=l,A[l+8>>2]=h,h=l;while(!1);do if(m|0){if(l=A[v+28>>2]|0,u=28228+(l<<2)|0,(v|0)==(A[u>>2]|0)){if(A[u>>2]=h,!h){A[6982]=y&~(1<<l);break}}else if(ie=m+16|0,A[((A[ie>>2]|0)==(v|0)?ie:m+20|0)>>2]=h,!h)break;A[h+24>>2]=m,l=A[v+16>>2]|0,l|0&&(A[h+16>>2]=l,A[l+24>>2]=h),l=A[v+20>>2]|0,l|0&&(A[h+20>>2]=l,A[l+24>>2]=h)}while(!1);return w>>>0<16?(ie=w+R|0,A[v+4>>2]=ie|3,ie=v+ie+4|0,A[ie>>2]=A[ie>>2]|1):(A[v+4>>2]=R|3,A[_+4>>2]=w|1,A[_+w>>2]=w,M|0&&(d=A[6986]|0,l=M>>>3,h=27964+(l<<1<<2)|0,l=1<<l,l&G?(u=h+8|0,l=A[u>>2]|0):(A[6981]=l|G,l=h,u=h+8|0),A[u>>2]=d,A[l+12>>2]=d,A[d+8>>2]=l,A[d+12>>2]=h),A[6983]=w,A[6986]=_),ie=v+8|0,F=Ce,ie|0}else G=R}else G=R}else G=R}else if(u>>>0<=4294967231)if(u=u+11|0,R=u&-8,d=A[6982]|0,d){m=0-R|0,u=u>>>8,u?R>>>0>16777215?w=31:(G=(u+1048320|0)>>>16&8,ne=u<<G,v=(ne+520192|0)>>>16&4,ne=ne<<v,w=(ne+245760|0)>>>16&2,w=14-(v|G|w)+(ne<<w>>>15)|0,w=R>>>(w+7|0)&1|w<<1):w=0,h=A[28228+(w<<2)>>2]|0;e:do if(!h)h=0,u=0,ne=61;else for(u=0,v=R<<((w|0)==31?0:25-(w>>>1)|0),y=0;;){if(_=(A[h+4>>2]&-8)-R|0,_>>>0<m>>>0)if(_)u=h,m=_;else{u=h,m=0,ne=65;break e}if(ne=A[h+20>>2]|0,h=A[h+16+(v>>>31<<2)>>2]|0,y=(ne|0)==0|(ne|0)==(h|0)?y:ne,h)v=v<<1;else{h=y,ne=61;break}}while(!1);if((ne|0)==61){if((h|0)==0&(u|0)==0){if(u=2<<w,u=(u|0-u)&d,!u){G=R;break}G=(u&0-u)+-1|0,_=G>>>12&16,G=G>>>_,y=G>>>5&8,G=G>>>y,v=G>>>2&4,G=G>>>v,w=G>>>1&2,G=G>>>w,h=G>>>1&1,u=0,h=A[28228+((y|_|v|w|h)+(G>>>h)<<2)>>2]|0}h?ne=65:(v=u,_=m)}if((ne|0)==65)for(y=h;;)if(G=(A[y+4>>2]&-8)-R|0,h=G>>>0<m>>>0,m=h?G:m,u=h?y:u,h=A[y+16>>2]|0,h||(h=A[y+20>>2]|0),h)y=h;else{v=u,_=m;break}if(v|0&&_>>>0<((A[6983]|0)-R|0)>>>0&&(M=v+R|0,M>>>0>v>>>0)){y=A[v+24>>2]|0,l=A[v+12>>2]|0;do if((l|0)==(v|0)){if(u=v+20|0,l=A[u>>2]|0,!l&&(u=v+16|0,l=A[u>>2]|0,!l)){l=0;break}for(;;)if(m=l+20|0,h=A[m>>2]|0,h)l=h,u=m;else if(m=l+16|0,h=A[m>>2]|0,h)l=h,u=m;else break;A[u>>2]=0}else ie=A[v+8>>2]|0,A[ie+12>>2]=l,A[l+8>>2]=ie;while(!1);do if(y){if(u=A[v+28>>2]|0,h=28228+(u<<2)|0,(v|0)==(A[h>>2]|0)){if(A[h>>2]=l,!l){d=d&~(1<<u),A[6982]=d;break}}else if(ie=y+16|0,A[((A[ie>>2]|0)==(v|0)?ie:y+20|0)>>2]=l,!l)break;A[l+24>>2]=y,u=A[v+16>>2]|0,u|0&&(A[l+16>>2]=u,A[u+24>>2]=l),u=A[v+20>>2]|0,u&&(A[l+20>>2]=u,A[u+24>>2]=l)}while(!1);e:do if(_>>>0<16)ie=_+R|0,A[v+4>>2]=ie|3,ie=v+ie+4|0,A[ie>>2]=A[ie>>2]|1;else{if(A[v+4>>2]=R|3,A[M+4>>2]=_|1,A[M+_>>2]=_,l=_>>>3,_>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=M,A[l+12>>2]=M,A[M+8>>2]=l,A[M+12>>2]=h;break}if(l=_>>>8,l?_>>>0>16777215?h=31:(le=(l+1048320|0)>>>16&8,ie=l<<le,Ae=(ie+520192|0)>>>16&4,ie=ie<<Ae,h=(ie+245760|0)>>>16&2,h=14-(Ae|le|h)+(ie<<h>>>15)|0,h=_>>>(h+7|0)&1|h<<1):h=0,l=28228+(h<<2)|0,A[M+28>>2]=h,u=M+16|0,A[u+4>>2]=0,A[u>>2]=0,u=1<<h,!(d&u)){A[6982]=d|u,A[l>>2]=M,A[M+24>>2]=l,A[M+12>>2]=M,A[M+8>>2]=M;break}l=A[l>>2]|0;t:do if((A[l+4>>2]&-8|0)!=(_|0)){for(d=_<<((h|0)==31?0:25-(h>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(_|0)){l=u;break t}else d=d<<1,l=u;A[h>>2]=M,A[M+24>>2]=l,A[M+12>>2]=M,A[M+8>>2]=M;break e}while(!1);le=l+8|0,ie=A[le>>2]|0,A[ie+12>>2]=M,A[le>>2]=M,A[M+8>>2]=ie,A[M+12>>2]=l,A[M+24>>2]=0}while(!1);return ie=v+8|0,F=Ce,ie|0}else G=R}else G=R;else G=-1;while(!1);if(h=A[6983]|0,h>>>0>=G>>>0)return l=h-G|0,u=A[6986]|0,l>>>0>15?(ie=u+G|0,A[6986]=ie,A[6983]=l,A[ie+4>>2]=l|1,A[u+h>>2]=l,A[u+4>>2]=G|3):(A[6983]=0,A[6986]=0,A[u+4>>2]=h|3,ie=u+h+4|0,A[ie>>2]=A[ie>>2]|1),ie=u+8|0,F=Ce,ie|0;if(_=A[6984]|0,_>>>0>G>>>0)return Ae=_-G|0,A[6984]=Ae,ie=A[6987]|0,le=ie+G|0,A[6987]=le,A[le+4>>2]=Ae|1,A[ie+4>>2]=G|3,ie=ie+8|0,F=Ce,ie|0;if(A[7099]|0?u=A[7101]|0:(A[7101]=4096,A[7100]=4096,A[7102]=-1,A[7103]=-1,A[7104]=0,A[7092]=0,A[7099]=$&-16^1431655768,u=4096),v=G+48|0,w=G+47|0,y=u+w|0,m=0-u|0,R=y&m,R>>>0<=G>>>0||(u=A[7091]|0,u|0&&(M=A[7089]|0,$=M+R|0,$>>>0<=M>>>0|$>>>0>u>>>0)))return ie=0,F=Ce,ie|0;e:do if(A[7092]&4)l=0,ne=143;else{h=A[6987]|0;t:do if(h){for(d=28372;$=A[d>>2]|0,!($>>>0<=h>>>0&&($+(A[d+4>>2]|0)|0)>>>0>h>>>0);)if(u=A[d+8>>2]|0,u)d=u;else{ne=128;break t}if(l=y-_&m,l>>>0<2147483647)if(u=xo(l|0)|0,(u|0)==((A[d>>2]|0)+(A[d+4>>2]|0)|0)){if((u|0)!=-1){_=l,y=u,ne=145;break e}}else d=u,ne=136;else l=0}else ne=128;while(!1);do if((ne|0)==128)if(h=xo(0)|0,(h|0)!=-1&&(l=h,H=A[7100]|0,W=H+-1|0,l=(W&l|0?(W+l&0-H)-l|0:0)+R|0,H=A[7089]|0,W=l+H|0,l>>>0>G>>>0&l>>>0<2147483647)){if($=A[7091]|0,$|0&&W>>>0<=H>>>0|W>>>0>$>>>0){l=0;break}if(u=xo(l|0)|0,(u|0)==(h|0)){_=l,y=h,ne=145;break e}else d=u,ne=136}else l=0;while(!1);do if((ne|0)==136){if(h=0-l|0,!(v>>>0>l>>>0&(l>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){l=0;break}else{_=l,y=d,ne=145;break e}if(u=A[7101]|0,u=w-l+u&0-u,u>>>0>=2147483647){_=l,y=d,ne=145;break e}if((xo(u|0)|0)==-1){xo(h|0)|0,l=0;break}else{_=u+l|0,y=d,ne=145;break e}}while(!1);A[7092]=A[7092]|4,ne=143}while(!1);if((ne|0)==143&&R>>>0<2147483647&&(Ae=xo(R|0)|0,W=xo(0)|0,se=W-Ae|0,ce=se>>>0>(G+40|0)>>>0,!((Ae|0)==-1|ce^1|Ae>>>0<W>>>0&((Ae|0)!=-1&(W|0)!=-1)^1))&&(_=ce?se:l,y=Ae,ne=145),(ne|0)==145){l=(A[7089]|0)+_|0,A[7089]=l,l>>>0>(A[7090]|0)>>>0&&(A[7090]=l),w=A[6987]|0;e:do if(w){for(l=28372;;){if(u=A[l>>2]|0,h=A[l+4>>2]|0,(y|0)==(u+h|0)){ne=154;break}if(d=A[l+8>>2]|0,d)l=d;else break}if((ne|0)==154&&(le=l+4|0,(A[l+12>>2]&8|0)==0)&&y>>>0>w>>>0&u>>>0<=w>>>0){A[le>>2]=h+_,ie=(A[6984]|0)+_|0,Ae=w+8|0,Ae=Ae&7|0?0-Ae&7:0,le=w+Ae|0,Ae=ie-Ae|0,A[6987]=le,A[6984]=Ae,A[le+4>>2]=Ae|1,A[w+ie+4>>2]=40,A[6988]=A[7103];break}for(y>>>0<(A[6985]|0)>>>0&&(A[6985]=y),h=y+_|0,l=28372;;){if((A[l>>2]|0)==(h|0)){ne=162;break}if(u=A[l+8>>2]|0,u)l=u;else break}if((ne|0)==162&&!(A[l+12>>2]&8|0)){A[l>>2]=y,M=l+4|0,A[M>>2]=(A[M>>2]|0)+_,M=y+8|0,M=y+(M&7|0?0-M&7:0)|0,l=h+8|0,l=h+(l&7|0?0-l&7:0)|0,R=M+G|0,v=l-M-G|0,A[M+4>>2]=G|3;t:do if((w|0)==(l|0))ie=(A[6984]|0)+v|0,A[6984]=ie,A[6987]=R,A[R+4>>2]=ie|1;else{if((A[6986]|0)==(l|0)){ie=(A[6983]|0)+v|0,A[6983]=ie,A[6986]=R,A[R+4>>2]=ie|1,A[R+ie>>2]=ie;break}if(u=A[l+4>>2]|0,(u&3|0)==1){_=u&-8,d=u>>>3;n:do if(u>>>0<256)if(u=A[l+8>>2]|0,h=A[l+12>>2]|0,(h|0)==(u|0)){A[6981]=A[6981]&~(1<<d);break}else{A[u+12>>2]=h,A[h+8>>2]=u;break}else{y=A[l+24>>2]|0,u=A[l+12>>2]|0;do if((u|0)==(l|0)){if(h=l+16|0,d=h+4|0,u=A[d>>2]|0,u)h=d;else if(u=A[h>>2]|0,!u){u=0;break}for(;;)if(m=u+20|0,d=A[m>>2]|0,d)u=d,h=m;else if(m=u+16|0,d=A[m>>2]|0,d)u=d,h=m;else break;A[h>>2]=0}else ie=A[l+8>>2]|0,A[ie+12>>2]=u,A[u+8>>2]=ie;while(!1);if(!y)break;h=A[l+28>>2]|0,d=28228+(h<<2)|0;do if((A[d>>2]|0)!=(l|0)){if(ie=y+16|0,A[((A[ie>>2]|0)==(l|0)?ie:y+20|0)>>2]=u,!u)break n}else{if(A[d>>2]=u,u|0)break;A[6982]=A[6982]&~(1<<h);break n}while(!1);if(A[u+24>>2]=y,h=l+16|0,d=A[h>>2]|0,d|0&&(A[u+16>>2]=d,A[d+24>>2]=u),h=A[h+4>>2]|0,!h)break;A[u+20>>2]=h,A[h+24>>2]=u}while(!1);l=l+_|0,m=_+v|0}else m=v;if(l=l+4|0,A[l>>2]=A[l>>2]&-2,A[R+4>>2]=m|1,A[R+m>>2]=m,l=m>>>3,m>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=R,A[l+12>>2]=R,A[R+8>>2]=l,A[R+12>>2]=h;break}l=m>>>8;do if(!l)d=0;else{if(m>>>0>16777215){d=31;break}le=(l+1048320|0)>>>16&8,ie=l<<le,Ae=(ie+520192|0)>>>16&4,ie=ie<<Ae,d=(ie+245760|0)>>>16&2,d=14-(Ae|le|d)+(ie<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1}while(!1);if(l=28228+(d<<2)|0,A[R+28>>2]=d,u=R+16|0,A[u+4>>2]=0,A[u>>2]=0,u=A[6982]|0,h=1<<d,!(u&h)){A[6982]=u|h,A[l>>2]=R,A[R+24>>2]=l,A[R+12>>2]=R,A[R+8>>2]=R;break}l=A[l>>2]|0;n:do if((A[l+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(m|0)){l=u;break n}else d=d<<1,l=u;A[h>>2]=R,A[R+24>>2]=l,A[R+12>>2]=R,A[R+8>>2]=R;break t}while(!1);le=l+8|0,ie=A[le>>2]|0,A[ie+12>>2]=R,A[le>>2]=R,A[R+8>>2]=ie,A[R+12>>2]=l,A[R+24>>2]=0}while(!1);return ie=M+8|0,F=Ce,ie|0}for(l=28372;u=A[l>>2]|0,!(u>>>0<=w>>>0&&(ie=u+(A[l+4>>2]|0)|0,ie>>>0>w>>>0));)l=A[l+8>>2]|0;m=ie+-47|0,u=m+8|0,u=m+(u&7|0?0-u&7:0)|0,m=w+16|0,u=u>>>0<m>>>0?w:u,l=u+8|0,h=_+-40|0,Ae=y+8|0,Ae=Ae&7|0?0-Ae&7:0,le=y+Ae|0,Ae=h-Ae|0,A[6987]=le,A[6984]=Ae,A[le+4>>2]=Ae|1,A[y+h+4>>2]=40,A[6988]=A[7103],h=u+4|0,A[h>>2]=27,A[l>>2]=A[7093],A[l+4>>2]=A[7094],A[l+8>>2]=A[7095],A[l+12>>2]=A[7096],A[7093]=y,A[7094]=_,A[7096]=0,A[7095]=l,l=u+24|0;do le=l,l=l+4|0,A[l>>2]=7;while((le+8|0)>>>0<ie>>>0);if((u|0)!=(w|0)){if(y=u-w|0,A[h>>2]=A[h>>2]&-2,A[w+4>>2]=y|1,A[u>>2]=y,l=y>>>3,y>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=w,A[l+12>>2]=w,A[w+8>>2]=l,A[w+12>>2]=h;break}if(l=y>>>8,l?y>>>0>16777215?d=31:(le=(l+1048320|0)>>>16&8,ie=l<<le,Ae=(ie+520192|0)>>>16&4,ie=ie<<Ae,d=(ie+245760|0)>>>16&2,d=14-(Ae|le|d)+(ie<<d>>>15)|0,d=y>>>(d+7|0)&1|d<<1):d=0,h=28228+(d<<2)|0,A[w+28>>2]=d,A[w+20>>2]=0,A[m>>2]=0,l=A[6982]|0,u=1<<d,!(l&u)){A[6982]=l|u,A[h>>2]=w,A[w+24>>2]=h,A[w+12>>2]=w,A[w+8>>2]=w;break}l=A[h>>2]|0;t:do if((A[l+4>>2]&-8|0)!=(y|0)){for(d=y<<((d|0)==31?0:25-(d>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(y|0)){l=u;break t}else d=d<<1,l=u;A[h>>2]=w,A[w+24>>2]=l,A[w+12>>2]=w,A[w+8>>2]=w;break e}while(!1);le=l+8|0,ie=A[le>>2]|0,A[ie+12>>2]=w,A[le>>2]=w,A[w+8>>2]=ie,A[w+12>>2]=l,A[w+24>>2]=0}}else ie=A[6985]|0,(ie|0)==0|y>>>0<ie>>>0&&(A[6985]=y),A[7093]=y,A[7094]=_,A[7096]=0,A[6990]=A[7099],A[6989]=-1,A[6994]=27964,A[6993]=27964,A[6996]=27972,A[6995]=27972,A[6998]=27980,A[6997]=27980,A[7e3]=27988,A[6999]=27988,A[7002]=27996,A[7001]=27996,A[7004]=28004,A[7003]=28004,A[7006]=28012,A[7005]=28012,A[7008]=28020,A[7007]=28020,A[7010]=28028,A[7009]=28028,A[7012]=28036,A[7011]=28036,A[7014]=28044,A[7013]=28044,A[7016]=28052,A[7015]=28052,A[7018]=28060,A[7017]=28060,A[7020]=28068,A[7019]=28068,A[7022]=28076,A[7021]=28076,A[7024]=28084,A[7023]=28084,A[7026]=28092,A[7025]=28092,A[7028]=28100,A[7027]=28100,A[7030]=28108,A[7029]=28108,A[7032]=28116,A[7031]=28116,A[7034]=28124,A[7033]=28124,A[7036]=28132,A[7035]=28132,A[7038]=28140,A[7037]=28140,A[7040]=28148,A[7039]=28148,A[7042]=28156,A[7041]=28156,A[7044]=28164,A[7043]=28164,A[7046]=28172,A[7045]=28172,A[7048]=28180,A[7047]=28180,A[7050]=28188,A[7049]=28188,A[7052]=28196,A[7051]=28196,A[7054]=28204,A[7053]=28204,A[7056]=28212,A[7055]=28212,ie=_+-40|0,Ae=y+8|0,Ae=Ae&7|0?0-Ae&7:0,le=y+Ae|0,Ae=ie-Ae|0,A[6987]=le,A[6984]=Ae,A[le+4>>2]=Ae|1,A[y+ie+4>>2]=40,A[6988]=A[7103];while(!1);if(l=A[6984]|0,l>>>0>G>>>0)return Ae=l-G|0,A[6984]=Ae,ie=A[6987]|0,le=ie+G|0,A[6987]=le,A[le+4>>2]=Ae|1,A[ie+4>>2]=G|3,ie=ie+8|0,F=Ce,ie|0}return ie=bR()|0,A[ie>>2]=12,ie=0,F=Ce,ie|0}function Qe(u){u=u|0;var l=0,h=0,d=0,m=0,y=0,_=0,v=0,w=0;if(u){h=u+-8|0,m=A[6985]|0,u=A[u+-4>>2]|0,l=u&-8,w=h+l|0;do if(u&1)v=h,_=h;else{if(d=A[h>>2]|0,!(u&3)||(_=h+(0-d)|0,y=d+l|0,_>>>0<m>>>0))return;if((A[6986]|0)==(_|0)){if(u=w+4|0,l=A[u>>2]|0,(l&3|0)!=3){v=_,l=y;break}A[6983]=y,A[u>>2]=l&-2,A[_+4>>2]=y|1,A[_+y>>2]=y;return}if(h=d>>>3,d>>>0<256)if(u=A[_+8>>2]|0,l=A[_+12>>2]|0,(l|0)==(u|0)){A[6981]=A[6981]&~(1<<h),v=_,l=y;break}else{A[u+12>>2]=l,A[l+8>>2]=u,v=_,l=y;break}m=A[_+24>>2]|0,u=A[_+12>>2]|0;do if((u|0)==(_|0)){if(l=_+16|0,h=l+4|0,u=A[h>>2]|0,u)l=h;else if(u=A[l>>2]|0,!u){u=0;break}for(;;)if(d=u+20|0,h=A[d>>2]|0,h)u=h,l=d;else if(d=u+16|0,h=A[d>>2]|0,h)u=h,l=d;else break;A[l>>2]=0}else v=A[_+8>>2]|0,A[v+12>>2]=u,A[u+8>>2]=v;while(!1);if(m){if(l=A[_+28>>2]|0,h=28228+(l<<2)|0,(A[h>>2]|0)==(_|0)){if(A[h>>2]=u,!u){A[6982]=A[6982]&~(1<<l),v=_,l=y;break}}else if(v=m+16|0,A[((A[v>>2]|0)==(_|0)?v:m+20|0)>>2]=u,!u){v=_,l=y;break}A[u+24>>2]=m,l=_+16|0,h=A[l>>2]|0,h|0&&(A[u+16>>2]=h,A[h+24>>2]=u),l=A[l+4>>2]|0,l?(A[u+20>>2]=l,A[l+24>>2]=u,v=_,l=y):(v=_,l=y)}else v=_,l=y}while(!1);if(!(_>>>0>=w>>>0)&&(u=w+4|0,d=A[u>>2]|0,!!(d&1))){if(d&2)A[u>>2]=d&-2,A[v+4>>2]=l|1,A[_+l>>2]=l,m=l;else{if((A[6987]|0)==(w|0)){if(w=(A[6984]|0)+l|0,A[6984]=w,A[6987]=v,A[v+4>>2]=w|1,(v|0)!=(A[6986]|0))return;A[6986]=0,A[6983]=0;return}if((A[6986]|0)==(w|0)){w=(A[6983]|0)+l|0,A[6983]=w,A[6986]=_,A[v+4>>2]=w|1,A[_+w>>2]=w;return}m=(d&-8)+l|0,h=d>>>3;do if(d>>>0<256)if(l=A[w+8>>2]|0,u=A[w+12>>2]|0,(u|0)==(l|0)){A[6981]=A[6981]&~(1<<h);break}else{A[l+12>>2]=u,A[u+8>>2]=l;break}else{y=A[w+24>>2]|0,u=A[w+12>>2]|0;do if((u|0)==(w|0)){if(l=w+16|0,h=l+4|0,u=A[h>>2]|0,u)l=h;else if(u=A[l>>2]|0,!u){h=0;break}for(;;)if(d=u+20|0,h=A[d>>2]|0,h)u=h,l=d;else if(d=u+16|0,h=A[d>>2]|0,h)u=h,l=d;else break;A[l>>2]=0,h=u}else h=A[w+8>>2]|0,A[h+12>>2]=u,A[u+8>>2]=h,h=u;while(!1);if(y|0){if(u=A[w+28>>2]|0,l=28228+(u<<2)|0,(A[l>>2]|0)==(w|0)){if(A[l>>2]=h,!h){A[6982]=A[6982]&~(1<<u);break}}else if(d=y+16|0,A[((A[d>>2]|0)==(w|0)?d:y+20|0)>>2]=h,!h)break;A[h+24>>2]=y,u=w+16|0,l=A[u>>2]|0,l|0&&(A[h+16>>2]=l,A[l+24>>2]=h),u=A[u+4>>2]|0,u|0&&(A[h+20>>2]=u,A[u+24>>2]=h)}}while(!1);if(A[v+4>>2]=m|1,A[_+m>>2]=m,(v|0)==(A[6986]|0)){A[6983]=m;return}}if(u=m>>>3,m>>>0<256){h=27964+(u<<1<<2)|0,l=A[6981]|0,u=1<<u,l&u?(l=h+8|0,u=A[l>>2]|0):(A[6981]=l|u,u=h,l=h+8|0),A[l>>2]=v,A[u+12>>2]=v,A[v+8>>2]=u,A[v+12>>2]=h;return}u=m>>>8,u?m>>>0>16777215?d=31:(_=(u+1048320|0)>>>16&8,w=u<<_,y=(w+520192|0)>>>16&4,w=w<<y,d=(w+245760|0)>>>16&2,d=14-(y|_|d)+(w<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,u=28228+(d<<2)|0,A[v+28>>2]=d,A[v+20>>2]=0,A[v+16>>2]=0,l=A[6982]|0,h=1<<d;e:do if(!(l&h))A[6982]=l|h,A[u>>2]=v,A[v+24>>2]=u,A[v+12>>2]=v,A[v+8>>2]=v;else{u=A[u>>2]|0;t:do if((A[u+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=u+16+(d>>>31<<2)|0,l=A[h>>2]|0,!!l;)if((A[l+4>>2]&-8|0)==(m|0)){u=l;break t}else d=d<<1,u=l;A[h>>2]=v,A[v+24>>2]=u,A[v+12>>2]=v,A[v+8>>2]=v;break e}while(!1);_=u+8|0,w=A[_>>2]|0,A[w+12>>2]=v,A[_>>2]=v,A[v+8>>2]=w,A[v+12>>2]=u,A[v+24>>2]=0}while(!1);if(w=(A[6989]|0)+-1|0,A[6989]=w,!(w|0)){for(u=28380;u=A[u>>2]|0,u;)u=u+8|0;A[6989]=-1}}}}function Lr(u,l){u=u|0,l=l|0;var h=0;return u?(h=es(l,u)|0,(l|u)>>>0>65535&&(h=((h>>>0)/(u>>>0)|0|0)==(l|0)?h:-1)):h=0,u=ns(h)|0,!u||!(A[u+-4>>2]&3)||vo(u|0,0,h|0)|0,u|0}function We(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,h=u+h>>>0,ut(l+d+(h>>>0<u>>>0|0)>>>0|0),h|0|0}function Yn(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,d=l-d-(h>>>0>u>>>0|0)>>>0,ut(d|0),u-h>>>0|0|0}function u_(u){return u=u|0,(u?31-(ks(u^u-1)|0)|0:32)|0}function Pd(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var y=0,_=0,v=0,w=0,R=0,M=0,G=0,$=0,H=0,W=0;if(M=u,w=l,R=w,_=h,$=d,v=$,!R)return y=(m|0)!=0,v?y?(A[m>>2]=u|0,A[m+4>>2]=l&0,$=0,m=0,ut($|0),m|0):($=0,m=0,ut($|0),m|0):(y&&(A[m>>2]=(M>>>0)%(_>>>0),A[m+4>>2]=0),$=0,m=(M>>>0)/(_>>>0)>>>0,ut($|0),m|0);y=(v|0)==0;do if(_){if(!y){if(y=(ks(v|0)|0)-(ks(R|0)|0)|0,y>>>0<=31){G=y+1|0,v=31-y|0,l=y-31>>31,_=G,u=M>>>(G>>>0)&l|R<<v,l=R>>>(G>>>0)&l,y=0,v=M<<v;break}return m?(A[m>>2]=u|0,A[m+4>>2]=w|l&0,$=0,m=0,ut($|0),m|0):($=0,m=0,ut($|0),m|0)}if(y=_-1|0,y&_|0){v=(ks(_|0)|0)+33-(ks(R|0)|0)|0,W=64-v|0,G=32-v|0,w=G>>31,H=v-32|0,l=H>>31,_=v,u=G-1>>31&R>>>(H>>>0)|(R<<G|M>>>(v>>>0))&l,l=l&R>>>(v>>>0),y=M<<W&w,v=(R<<W|M>>>(H>>>0))&w|M<<G&v-33>>31;break}return m|0&&(A[m>>2]=y&M,A[m+4>>2]=0),(_|0)==1?(H=w|l&0,W=u|0|0,ut(H|0),W|0):(W=u_(_|0)|0,H=R>>>(W>>>0)|0,W=R<<32-W|M>>>(W>>>0)|0,ut(H|0),W|0)}else{if(y)return m|0&&(A[m>>2]=(R>>>0)%(_>>>0),A[m+4>>2]=0),H=0,W=(R>>>0)/(_>>>0)>>>0,ut(H|0),W|0;if(!M)return m|0&&(A[m>>2]=0,A[m+4>>2]=(R>>>0)%(v>>>0)),H=0,W=(R>>>0)/(v>>>0)>>>0,ut(H|0),W|0;if(y=v-1|0,!(y&v))return m|0&&(A[m>>2]=u|0,A[m+4>>2]=y&R|l&0),H=0,W=R>>>((u_(v|0)|0)>>>0),ut(H|0),W|0;if(y=(ks(v|0)|0)-(ks(R|0)|0)|0,y>>>0<=30){l=y+1|0,v=31-y|0,_=l,u=R<<v|M>>>(l>>>0),l=R>>>(l>>>0),y=0,v=M<<v;break}return m?(A[m>>2]=u|0,A[m+4>>2]=w|l&0,H=0,W=0,ut(H|0),W|0):(H=0,W=0,ut(H|0),W|0)}while(!1);if(!_)R=v,w=0,v=0;else{G=h|0|0,M=$|d&0,R=We(G|0,M|0,-1,-1)|0,h=V()|0,w=v,v=0;do d=w,w=y>>>31|w<<1,y=v|y<<1,d=u<<1|d>>>31|0,$=u>>>31|l<<1|0,Yn(R|0,h|0,d|0,$|0)|0,W=V()|0,H=W>>31|((W|0)<0?-1:0)<<1,v=H&1,u=Yn(d|0,$|0,H&G|0,(((W|0)<0?-1:0)>>31|((W|0)<0?-1:0)<<1)&M|0)|0,l=V()|0,_=_-1|0;while(_|0);R=w,w=0}return _=0,m|0&&(A[m>>2]=u,A[m+4>>2]=l),H=(y|0)>>>31|(R|_)<<1|(_<<1|y>>>31)&0|w,W=(y<<1|0)&-2|v,ut(H|0),W|0}function bo(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0;return R=l>>31|((l|0)<0?-1:0)<<1,w=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,y=d>>31|((d|0)<0?-1:0)<<1,m=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,v=Yn(R^u|0,w^l|0,R|0,w|0)|0,_=V()|0,u=y^R,l=m^w,Yn((Pd(v,_,Yn(y^h|0,m^d|0,y|0,m|0)|0,V()|0,0)|0)^u|0,(V()|0)^l|0,u|0,l|0)|0}function vR(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,y=0;return y=u&65535,m=l&65535,h=es(m,y)|0,d=u>>>16,u=(h>>>16)+(es(m,d)|0)|0,m=l>>>16,l=es(m,y)|0,ut((u>>>16)+(es(m,d)|0)+(((u&65535)+l|0)>>>16)|0),u+l<<16|h&65535|0|0}function Kn(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;return m=u,y=h,h=vR(m,y)|0,u=V()|0,ut((es(l,y)|0)+(es(d,m)|0)+u|u&0|0),h|0|0|0}function al(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0,_=0,v=0,w=0,R=0;return m=F,F=F+16|0,v=m|0,_=l>>31|((l|0)<0?-1:0)<<1,y=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,R=d>>31|((d|0)<0?-1:0)<<1,w=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,u=Yn(_^u|0,y^l|0,_|0,y|0)|0,l=V()|0,Pd(u,l,Yn(R^h|0,w^d|0,R|0,w|0)|0,V()|0,v)|0,d=Yn(A[v>>2]^_|0,A[v+4>>2]^y|0,_|0,y|0)|0,h=V()|0,F=m,ut(h|0),d|0}function ll(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,y=0;return y=F,F=F+16|0,m=y|0,Pd(u,l,h,d,m)|0,F=y,ut(A[m+4>>2]|0),A[m>>2]|0|0}function A_(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(ut(l>>h|0),u>>>h|(l&(1<<h)-1)<<32-h):(ut(((l|0)<0?-1:0)|0),l>>h-32|0)}function _e(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(ut(l>>>h|0),u>>>h|(l&(1<<h)-1)<<32-h):(ut(0),l>>>h-32|0)}function Re(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(ut(l<<h|(u&(1<<h)-1<<32-h)>>>32-h|0),u<<h):(ut(u<<h-32|0),0)}function Bd(u,l,h){return u=u|0,l=l|0,l=ks(l)|0,(l|0)==32&&(l=l+(ks(u)|0)|0),ut(0),l|0}function c_(u,l){return u=+u,l=+l,u!=u?+l:l!=l?+u:+N7(+u,+l)}function _c(u,l){return u=+u,l=+l,u!=u?+l:l!=l?+u:+od(+u,+l)}function bc(u){return u=+u,u>=0?+Qn(u+.5):+nl(u-.5)}function ul(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0;if((h|0)>=8192)return M7(u|0,l|0,h|0)|0,u|0;if(y=u|0,m=u+h|0,(u&3)==(l&3)){for(;u&3;){if(!h)return y|0;Te[u>>0]=Te[l>>0]|0,u=u+1|0,l=l+1|0,h=h-1|0}for(h=m&-4|0,d=h-64|0;(u|0)<=(d|0);)A[u>>2]=A[l>>2],A[u+4>>2]=A[l+4>>2],A[u+8>>2]=A[l+8>>2],A[u+12>>2]=A[l+12>>2],A[u+16>>2]=A[l+16>>2],A[u+20>>2]=A[l+20>>2],A[u+24>>2]=A[l+24>>2],A[u+28>>2]=A[l+28>>2],A[u+32>>2]=A[l+32>>2],A[u+36>>2]=A[l+36>>2],A[u+40>>2]=A[l+40>>2],A[u+44>>2]=A[l+44>>2],A[u+48>>2]=A[l+48>>2],A[u+52>>2]=A[l+52>>2],A[u+56>>2]=A[l+56>>2],A[u+60>>2]=A[l+60>>2],u=u+64|0,l=l+64|0;for(;(u|0)<(h|0);)A[u>>2]=A[l>>2],u=u+4|0,l=l+4|0}else for(h=m-4|0;(u|0)<(h|0);)Te[u>>0]=Te[l>>0]|0,Te[u+1>>0]=Te[l+1>>0]|0,Te[u+2>>0]=Te[l+2>>0]|0,Te[u+3>>0]=Te[l+3>>0]|0,u=u+4|0,l=l+4|0;for(;(u|0)<(m|0);)Te[u>>0]=Te[l>>0]|0,u=u+1|0,l=l+1|0;return y|0}function vo(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,y=0,_=0;if(y=u+h|0,l=l&255,(h|0)>=67){for(;u&3;)Te[u>>0]=l,u=u+1|0;for(d=y&-4|0,_=l|l<<8|l<<16|l<<24,m=d-64|0;(u|0)<=(m|0);)A[u>>2]=_,A[u+4>>2]=_,A[u+8>>2]=_,A[u+12>>2]=_,A[u+16>>2]=_,A[u+20>>2]=_,A[u+24>>2]=_,A[u+28>>2]=_,A[u+32>>2]=_,A[u+36>>2]=_,A[u+40>>2]=_,A[u+44>>2]=_,A[u+48>>2]=_,A[u+52>>2]=_,A[u+56>>2]=_,A[u+60>>2]=_,u=u+64|0;for(;(u|0)<(d|0);)A[u>>2]=_,u=u+4|0}for(;(u|0)<(y|0);)Te[u>>0]=l,u=u+1|0;return y-h|0}function h_(u){return u=+u,u>=0?+Qn(u+.5):+nl(u-.5)}function xo(u){u=u|0;var l=0,h=0,d=0;return d=C7()|0,h=A[Gt>>2]|0,l=h+u|0,(u|0)>0&(l|0)<(h|0)|(l|0)<0?(B7(l|0)|0,by(12),-1):(l|0)>(d|0)&&!(P7(l|0)|0)?(by(12),-1):(A[Gt>>2]=l,h|0)}return{___divdi3:bo,___muldi3:Kn,___remdi3:al,___uremdi3:ll,_areNeighborCells:uE,_bitshift64Ashr:A_,_bitshift64Lshr:_e,_bitshift64Shl:Re,_calloc:Lr,_cellAreaKm2:VE,_cellAreaM2:zE,_cellAreaRads2:Rd,_cellToBoundary:sl,_cellToCenterChild:jy,_cellToChildPos:DE,_cellToChildren:wE,_cellToChildrenSize:bu,_cellToLatLng:ha,_cellToLocalIj:YE,_cellToParent:_d,_cellToVertex:hi,_cellToVertexes:pR,_cellsToDirectedEdge:AE,_cellsToLinkedMultiPolygon:j7,_childPosToCell:LE,_compactCells:SE,_constructCell:xE,_destroyLinkedMultiPolygon:Xy,_directedEdgeToBoundary:pc,_directedEdgeToCells:fE,_edgeLengthKm:$E,_edgeLengthM:HE,_edgeLengthRads:jE,_emscripten_replace_memory:D7,_free:Qe,_getBaseCellNumber:Vy,_getDirectedEdgeDestination:hE,_getDirectedEdgeOrigin:cE,_getHexagonAreaAvgKm2:Wy,_getHexagonAreaAvgM2:UE,_getHexagonEdgeLengthAvgKm:qE,_getHexagonEdgeLengthAvgM:GE,_getIcosahedronFaces:$y,_getIndexDigit:vE,_getNumCells:mc,_getPentagons:wd,_getRes0Cells:X7,_getResolution:bE,_greatCircleDistanceKm:xu,_greatCircleDistanceM:FE,_greatCircleDistanceRads:OE,_gridDisk:vy,_gridDiskDistances:xy,_gridDistance:ZE,_gridPathCells:eR,_gridPathCellsSize:JE,_gridRing:U7,_gridRingUnsafe:wy,_i64Add:We,_i64Subtract:Yn,_isPentagon:Zt,_isResClassIII:NE,_isValidCell:gd,_isValidDirectedEdge:Uy,_isValidIndex:TE,_isValidVertex:i_,_latLngToCell:xd,_llvm_ctlz_i64:Bd,_llvm_maxnum_f64:c_,_llvm_minnum_f64:_c,_llvm_round_f64:bc,_localIjToCell:KE,_malloc:ns,_maxFaceCount:PE,_maxGridDiskSize:k7,_maxPolygonToCellsSize:G7,_maxPolygonToCellsSizeExperimental:rR,_memcpy:ul,_memset:vo,_originToDirectedEdges:dE,_pentagonCount:BE,_polygonToCells:V7,_polygonToCellsExperimental:nR,_readInt64AsDoubleFromPointer:cR,_res0CellCount:Q7,_round:h_,_sbrk:xo,_sizeOfCellBoundary:oR,_sizeOfCoordIJ:AR,_sizeOfGeoLoop:aR,_sizeOfGeoPolygon:lR,_sizeOfH3Index:iR,_sizeOfLatLng:sR,_sizeOfLinkedGeoPolygon:uR,_uncompactCells:EE,_uncompactCellsSize:RE,_vertexToLatLng:mR,establishStackSpace:I7,stackAlloc:L7,stackRestore:F7,stackSave:O7}}(x7,T7,Q);e.___divdi3=Ee.___divdi3,e.___muldi3=Ee.___muldi3,e.___remdi3=Ee.___remdi3,e.___uremdi3=Ee.___uremdi3,e._areNeighborCells=Ee._areNeighborCells,e._bitshift64Ashr=Ee._bitshift64Ashr,e._bitshift64Lshr=Ee._bitshift64Lshr,e._bitshift64Shl=Ee._bitshift64Shl,e._calloc=Ee._calloc,e._cellAreaKm2=Ee._cellAreaKm2,e._cellAreaM2=Ee._cellAreaM2,e._cellAreaRads2=Ee._cellAreaRads2,e._cellToBoundary=Ee._cellToBoundary,e._cellToCenterChild=Ee._cellToCenterChild,e._cellToChildPos=Ee._cellToChildPos,e._cellToChildren=Ee._cellToChildren,e._cellToChildrenSize=Ee._cellToChildrenSize,e._cellToLatLng=Ee._cellToLatLng,e._cellToLocalIj=Ee._cellToLocalIj,e._cellToParent=Ee._cellToParent,e._cellToVertex=Ee._cellToVertex,e._cellToVertexes=Ee._cellToVertexes,e._cellsToDirectedEdge=Ee._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=Ee._cellsToLinkedMultiPolygon,e._childPosToCell=Ee._childPosToCell,e._compactCells=Ee._compactCells,e._constructCell=Ee._constructCell,e._destroyLinkedMultiPolygon=Ee._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=Ee._directedEdgeToBoundary,e._directedEdgeToCells=Ee._directedEdgeToCells,e._edgeLengthKm=Ee._edgeLengthKm,e._edgeLengthM=Ee._edgeLengthM,e._edgeLengthRads=Ee._edgeLengthRads;var w7=e._emscripten_replace_memory=Ee._emscripten_replace_memory;e._free=Ee._free,e._getBaseCellNumber=Ee._getBaseCellNumber,e._getDirectedEdgeDestination=Ee._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=Ee._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=Ee._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=Ee._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=Ee._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=Ee._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=Ee._getIcosahedronFaces,e._getIndexDigit=Ee._getIndexDigit,e._getNumCells=Ee._getNumCells,e._getPentagons=Ee._getPentagons,e._getRes0Cells=Ee._getRes0Cells,e._getResolution=Ee._getResolution,e._greatCircleDistanceKm=Ee._greatCircleDistanceKm,e._greatCircleDistanceM=Ee._greatCircleDistanceM,e._greatCircleDistanceRads=Ee._greatCircleDistanceRads,e._gridDisk=Ee._gridDisk,e._gridDiskDistances=Ee._gridDiskDistances,e._gridDistance=Ee._gridDistance,e._gridPathCells=Ee._gridPathCells,e._gridPathCellsSize=Ee._gridPathCellsSize,e._gridRing=Ee._gridRing,e._gridRingUnsafe=Ee._gridRingUnsafe,e._i64Add=Ee._i64Add,e._i64Subtract=Ee._i64Subtract,e._isPentagon=Ee._isPentagon,e._isResClassIII=Ee._isResClassIII,e._isValidCell=Ee._isValidCell,e._isValidDirectedEdge=Ee._isValidDirectedEdge,e._isValidIndex=Ee._isValidIndex,e._isValidVertex=Ee._isValidVertex,e._latLngToCell=Ee._latLngToCell,e._llvm_ctlz_i64=Ee._llvm_ctlz_i64,e._llvm_maxnum_f64=Ee._llvm_maxnum_f64,e._llvm_minnum_f64=Ee._llvm_minnum_f64,e._llvm_round_f64=Ee._llvm_round_f64,e._localIjToCell=Ee._localIjToCell,e._malloc=Ee._malloc,e._maxFaceCount=Ee._maxFaceCount,e._maxGridDiskSize=Ee._maxGridDiskSize,e._maxPolygonToCellsSize=Ee._maxPolygonToCellsSize,e._maxPolygonToCellsSizeExperimental=Ee._maxPolygonToCellsSizeExperimental,e._memcpy=Ee._memcpy,e._memset=Ee._memset,e._originToDirectedEdges=Ee._originToDirectedEdges,e._pentagonCount=Ee._pentagonCount,e._polygonToCells=Ee._polygonToCells,e._polygonToCellsExperimental=Ee._polygonToCellsExperimental,e._readInt64AsDoubleFromPointer=Ee._readInt64AsDoubleFromPointer,e._res0CellCount=Ee._res0CellCount,e._round=Ee._round,e._sbrk=Ee._sbrk,e._sizeOfCellBoundary=Ee._sizeOfCellBoundary,e._sizeOfCoordIJ=Ee._sizeOfCoordIJ,e._sizeOfGeoLoop=Ee._sizeOfGeoLoop,e._sizeOfGeoPolygon=Ee._sizeOfGeoPolygon,e._sizeOfH3Index=Ee._sizeOfH3Index,e._sizeOfLatLng=Ee._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=Ee._sizeOfLinkedGeoPolygon,e._uncompactCells=Ee._uncompactCells,e._uncompactCellsSize=Ee._uncompactCellsSize,e._vertexToLatLng=Ee._vertexToLatLng,e.establishStackSpace=Ee.establishStackSpace;var my=e.stackAlloc=Ee.stackAlloc,S7=e.stackRestore=Ee.stackRestore,E7=e.stackSave=Ee.stackSave;if(e.asm=Ee,e.cwrap=D,e.setValue=x,e.getValue=T,Is){dy(Is)||(Is=s(Is));{c7();var rd=function(fe){fe.byteLength&&(fe=new Uint8Array(fe)),te.set(fe,b),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,h7()},gy=function(){o(Is,rd,function(){throw"could not load memory initializer "+Is})},yy=nd(Is);if(yy)rd(yy.buffer);else if(e.memoryInitializerRequest){var _y=function(){var fe=e.memoryInitializerRequest,be=fe.response;if(fe.status!==200&&fe.status!==0){var Fe=nd(e.memoryInitializerRequestURL);if(Fe)be=Fe.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+fe.status+", retrying "+Is),gy();return}}rd(be)};e.memoryInitializerRequest.response?setTimeout(_y,0):e.memoryInitializerRequest.addEventListener("load",_y)}else gy()}}var Ac;Di=function fe(){Ac||id(),Ac||(Di=fe)};function id(fe){if(li>0||(Wt(),li>0))return;function be(){Ac||(Ac=!0,!S&&(Pn(),Vn(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),vn()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),be()},1)):be()}e.run=id;function tl(fe){throw e.onAbort&&e.onAbort(fe),fe+="",a(fe),c(fe),S=!0,"abort("+fe+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=tl,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return id(),n}(typeof Nt=="object"?Nt:{}),Je="number",Ze=Je,gl=Je,it=Je,st=Je,Zn=Je,Ue=Je,DL=[["sizeOfH3Index",Je],["sizeOfLatLng",Je],["sizeOfCellBoundary",Je],["sizeOfGeoLoop",Je],["sizeOfGeoPolygon",Je],["sizeOfLinkedGeoPolygon",Je],["sizeOfCoordIJ",Je],["readInt64AsDoubleFromPointer",Je],["isValidCell",gl,[it,st]],["isValidIndex",gl,[it,st]],["latLngToCell",Ze,[Je,Je,Zn,Ue]],["cellToLatLng",Ze,[it,st,Ue]],["cellToBoundary",Ze,[it,st,Ue]],["maxGridDiskSize",Ze,[Je,Ue]],["gridDisk",Ze,[it,st,Je,Ue]],["gridDiskDistances",Ze,[it,st,Je,Ue,Ue]],["gridRing",Ze,[it,st,Je,Ue]],["gridRingUnsafe",Ze,[it,st,Je,Ue]],["maxPolygonToCellsSize",Ze,[Ue,Zn,Je,Ue]],["polygonToCells",Ze,[Ue,Zn,Je,Ue]],["maxPolygonToCellsSizeExperimental",Ze,[Ue,Zn,Je,Ue]],["polygonToCellsExperimental",Ze,[Ue,Zn,Je,Je,Je,Ue]],["cellsToLinkedMultiPolygon",Ze,[Ue,Je,Ue]],["destroyLinkedMultiPolygon",null,[Ue]],["compactCells",Ze,[Ue,Ue,Je,Je]],["uncompactCells",Ze,[Ue,Je,Je,Ue,Je,Zn]],["uncompactCellsSize",Ze,[Ue,Je,Je,Zn,Ue]],["isPentagon",gl,[it,st]],["isResClassIII",gl,[it,st]],["getBaseCellNumber",Je,[it,st]],["getResolution",Je,[it,st]],["getIndexDigit",Je,[it,st,Je]],["constructCell",Ze,[Je,Je,Ue,Ue]],["maxFaceCount",Ze,[it,st,Ue]],["getIcosahedronFaces",Ze,[it,st,Ue]],["cellToParent",Ze,[it,st,Zn,Ue]],["cellToChildren",Ze,[it,st,Zn,Ue]],["cellToCenterChild",Ze,[it,st,Zn,Ue]],["cellToChildrenSize",Ze,[it,st,Zn,Ue]],["cellToChildPos",Ze,[it,st,Zn,Ue]],["childPosToCell",Ze,[Je,Je,it,st,Zn,Ue]],["areNeighborCells",Ze,[it,st,it,st,Ue]],["cellsToDirectedEdge",Ze,[it,st,it,st,Ue]],["getDirectedEdgeOrigin",Ze,[it,st,Ue]],["getDirectedEdgeDestination",Ze,[it,st,Ue]],["isValidDirectedEdge",gl,[it,st]],["directedEdgeToCells",Ze,[it,st,Ue]],["originToDirectedEdges",Ze,[it,st,Ue]],["directedEdgeToBoundary",Ze,[it,st,Ue]],["gridDistance",Ze,[it,st,it,st,Ue]],["gridPathCells",Ze,[it,st,it,st,Ue]],["gridPathCellsSize",Ze,[it,st,it,st,Ue]],["cellToLocalIj",Ze,[it,st,it,st,Je,Ue]],["localIjToCell",Ze,[it,st,Ue,Je,Ue]],["getHexagonAreaAvgM2",Ze,[Zn,Ue]],["getHexagonAreaAvgKm2",Ze,[Zn,Ue]],["getHexagonEdgeLengthAvgM",Ze,[Zn,Ue]],["getHexagonEdgeLengthAvgKm",Ze,[Zn,Ue]],["greatCircleDistanceM",Je,[Ue,Ue]],["greatCircleDistanceKm",Je,[Ue,Ue]],["greatCircleDistanceRads",Je,[Ue,Ue]],["cellAreaM2",Ze,[it,st,Ue]],["cellAreaKm2",Ze,[it,st,Ue]],["cellAreaRads2",Ze,[it,st,Ue]],["edgeLengthM",Ze,[it,st,Ue]],["edgeLengthKm",Ze,[it,st,Ue]],["edgeLengthRads",Ze,[it,st,Ue]],["getNumCells",Ze,[Zn,Ue]],["getRes0Cells",Ze,[Ue]],["res0CellCount",Je],["getPentagons",Ze,[Je,Ue]],["pentagonCount",Je],["cellToVertex",Ze,[it,st,Je,Ue]],["cellToVertexes",Ze,[it,st,Ue]],["vertexToLatLng",Ze,[it,st,Ue]],["isValidVertex",gl,[it,st]]],LL=0,OL=1,FL=2,IL=3,tT=4,kL=5,UL=6,qL=7,GL=8,VL=9,zL=10,jL=11,$L=12,HL=13,WL=14,QL=15,XL=16,YL=17,KL=18,ZL=19,On={};On[LL]="Success";On[OL]="The operation failed but a more specific error is not available";On[FL]="Argument was outside of acceptable range";On[IL]="Latitude or longitude arguments were outside of acceptable range";On[tT]="Resolution argument was outside of acceptable range";On[kL]="Cell argument was not valid";On[UL]="Directed edge argument was not valid";On[qL]="Undirected edge argument was not valid";On[GL]="Vertex argument was not valid";On[VL]="Pentagon distortion was encountered";On[zL]="Duplicate input";On[jL]="Cell arguments were not neighbors";On[$L]="Cell arguments had incompatible resolutions";On[HL]="Memory allocation failed";On[WL]="Bounds of provided memory were insufficient";On[QL]="Mode or flags argument was not valid";On[XL]="Index argument was not valid";On[YL]="Base cell number was outside of acceptable range";On[KL]="Child indexing digits invalid";On[ZL]="Child indexing digits refer to a deleted subsequence";var JL=1e3,nT=1001,rT=1002,cf={};cf[JL]="Unknown unit";cf[nT]="Array length out of bounds";cf[rT]="Got unexpected null value for H3 index";var eO="Unknown error";function iT(n,e,t){var r=t&&"value"in t,i=new Error((n[e]||eO)+" (code: "+e+(r?", value: "+t.value:"")+")");return i.code=e,i}function sT(n,e){var t=arguments.length===2?{value:e}:{};return iT(On,n,t)}function oT(n,e){var t=arguments.length===2?{value:e}:{};return iT(cf,n,t)}function LA(n){if(n!==0)throw sT(n)}var Vr={};DL.forEach(function(e){Vr[e[0]]=Nt.cwrap.apply(Nt,e)});var Il=16,OA=4,su=8,tO=8,Ch=Vr.sizeOfH3Index(),w1=Vr.sizeOfLatLng(),nO=Vr.sizeOfCellBoundary(),rO=Vr.sizeOfGeoPolygon(),hA=Vr.sizeOfGeoLoop();Vr.sizeOfLinkedGeoPolygon();Vr.sizeOfCoordIJ();function iO(n){if(typeof n!="number"||n<0||n>15||Math.floor(n)!==n)throw sT(tT,n);return n}function sO(n){if(!n)throw oT(rT);return n}var oO=Math.pow(2,32)-1;function aO(n){if(n>oO)throw oT(nT,n);return n}var lO=/[^0-9a-fA-F]/;function aT(n){if(Array.isArray(n)&&n.length===2&&Number.isInteger(n[0])&&Number.isInteger(n[1]))return n;if(typeof n!="string"||lO.test(n))return[0,0];var e=parseInt(n.substring(0,n.length-8),Il),t=parseInt(n.substring(n.length-8),Il);return[t,e]}function X3(n){if(n>=0)return n.toString(Il);n=n&2147483647;var e=lT(8,n.toString(Il)),t=(parseInt(e[0],Il)+8).toString(Il);return e=t+e.substring(1),e}function uO(n,e){return X3(e)+lT(8,X3(n))}function lT(n,e){for(var t=n-e.length,r="",i=0;i<t;i++)r+="0";return r=r+e,r}function Y3(n,e,t){for(var r=n.length,i=Nt._calloc(r,w1),s=t?1:0,o=t?0:1,a=0;a<r*2;a+=2)Nt.HEAPF64.set([n[a/2][s],n[a/2][o]].map(hT),i/su+a);return Nt.HEAPU32.set([r,i],e/OA),e}function AO(n,e){var t=n.length-1,r=Nt._calloc(rO),i=0,s=i+hA,o=s+OA;Y3(n[0],r+i,e);var a;if(t>0){a=Nt._calloc(t,hA);for(var c=0;c<t;c++)Y3(n[c+1],a+hA*c,e)}return Nt.setValue(r+s,t,"i32"),Nt.setValue(r+o,a,"i32"),r}function cO(n){var e=0,t=e+hA,r=t+OA,i=OA;Nt._free(Nt.getValue(n+e+i,"i8*"));var s=Nt.getValue(n+t,"i32");if(s>0){for(var o=Nt.getValue(n+r,"i32"),a=0;a<s;a++)Nt._free(Nt.getValue(o+hA*a+i,"i8*"));Nt._free(o)}Nt._free(n)}function uT(n,e){e===void 0&&(e=0);var t=Nt.getValue(n+Ch*e,"i32"),r=Nt.getValue(n+Ch*e+OA,"i32");return r?uO(t,r):null}function hO(n){return Vr.readInt64AsDoubleFromPointer(n)}function fO(n,e){for(var t=[],r=0;r<e;r++){var i=uT(n,r);i!==null&&t.push(i)}return t}function Mh(n){return yO(Nt.getValue(n,"double"))}function dO(n){return[Mh(n),Mh(n+su)]}function pO(n){return[Mh(n+su),Mh(n)]}function mO(n,e,t){for(var r=Nt.getValue(n,"i32"),i=n+su,s=[],o=pO,a=0;a<r*2;a+=2)s.push(o(i+su*a));return s.push(s[0]),s}function gO(n,e,t){var r=Nt._malloc(w1);Nt.HEAPF64.set([n,e].map(hT),r/su);var i=Nt._malloc(Ch);try{return LA(Vr.latLngToCell(r,t,i)),sO(uT(i))}finally{Nt._free(i),Nt._free(r)}}function AT(n){var e=Nt._malloc(w1),t=aT(n),r=t[0],i=t[1];try{return LA(Vr.cellToLatLng(r,i,e)),dO(e)}finally{Nt._free(e)}}function cT(n,e){var t=Nt._malloc(nO),r=aT(n),i=r[0],s=r[1];try{return LA(Vr.cellToBoundary(i,s,t)),mO(t,e,e)}finally{Nt._free(t)}}function K3(n,e,t){if(iO(e),t=!!t,n.length===0||n[0].length===0)return[];var r=typeof n[0][0]=="number"?[n]:n,i=AO(r,t),s=Nt._malloc(tO);try{LA(Vr.maxPolygonToCellsSize(i,e,0,s));var o=aO(hO(s)),a=Nt._calloc(o,Ch);try{return LA(Vr.polygonToCells(i,e,0,a)),fO(a,o)}finally{Nt._free(a)}}finally{Nt._free(s),cO(i)}}function hT(n){return n*Math.PI/180}function yO(n){return n*180/Math.PI}function _O(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const bO=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Xd=new WeakMap;class vO{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=bO,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:r,material:i,object:s}=e;if(t={material:this.getMaterialData(i),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const i=e[r];t[r]={version:i.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const i=e[r];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[r]={id:i.id,version:i.version}:t[r]=i.clone():t[r]=i)}return t}equals(e,t){const{object:r,material:i,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(r.matrixWorld)!==!0)return o.worldMatrix.copy(r.matrixWorld),!1;const a=o.material;for(const E in a){const C=a[E],P=i[E];if(C.equals!==void 0){if(C.equals(P)===!1)return C.copy(P),!1}else if(P.isTexture===!0){if(C.id!==P.id||C.version!==P.version)return C.id=P.id,C.version=P.version,!1}else if(C!==P)return a[E]=P,!1}if(a.transmission>0){const{width:E,height:C}=e.context;if(o.bufferWidth!==E||o.bufferHeight!==C)return o.bufferWidth=E,o.bufferHeight=C,!1}const c=o.geometry,f=s.attributes,p=c.attributes,g=Object.keys(p),b=Object.keys(f);if(c.id!==s.id)return c.id=s.id,!1;if(g.length!==b.length)return o.geometry.attributes=this.getAttributesData(f),!1;for(const E of g){const C=p[E],P=f[E];if(P===void 0)return delete p[E],!1;if(C.version!==P.version)return C.version=P.version,!1}const x=s.index,T=c.indexVersion,S=x?x.version:null;if(T!==S)return c.indexVersion=S,!1;if(c.drawRange.start!==s.drawRange.start||c.drawRange.count!==s.drawRange.count)return c.drawRange.start=s.drawRange.start,c.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let E=!1;for(let C=0;C<o.morphTargetInfluences.length;C++)o.morphTargetInfluences[C]!==r.morphTargetInfluences[C]&&(o.morphTargetInfluences[C]=r.morphTargetInfluences[C],E=!0);if(E)return!1}if(o.lights){for(let E=0;E<t.length;E++)if(o.lights[E].map!==t[E].map)return!1}return o.center&&o.center.equals(r.center)===!1?(o.center.copy(r.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const r of e)r.isSpotLight===!0&&r.map!==null&&t.push({map:r.map.version});return t}getLights(e,t){if(Xd.has(e)){const i=Xd.get(e);if(i.renderId===t)return i.lightsData}const r=this.getLightsData(e.getLights());return Xd.set(e,{renderId:t,lightsData:r}),r}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const i=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(i||s)return!1;const o=this.getLights(e.lightsNode,r);return this.equals(e,o)!==!0}}function S1(n,e=0){let t=3735928559^e,r=1103547991^e;if(n instanceof Array)for(let i=0,s;i<n.length;i++)s=n[i],t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);else for(let i=0,s;i<n.length;i++)s=n.charCodeAt(i),t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&r)+(t>>>0)}const KA=n=>S1(n),fu=n=>S1(n),fA=(...n)=>S1(n),xO=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Z3=new WeakMap;function fT(n){return xO.get(n)}function Ph(n){if(/[iu]?vec\d/.test(n))return n.startsWith("ivec")?Int32Array:n.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(n)||/float/.test(n))return Float32Array;if(/uint/.test(n))return Uint32Array;if(/int/.test(n))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${n}`)}function dT(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 9;if(/mat4/.test(n))return 16;Be("TSL: Unsupported type:",n)}function TO(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 12;if(/mat4/.test(n))return 16;Be("TSL: Unsupported type:",n)}function wO(n){if(/float|int|uint/.test(n))return 4;if(/vec2/.test(n))return 8;if(/vec3/.test(n)||/vec4/.test(n))return 16;if(/mat2/.test(n))return 8;if(/mat3/.test(n)||/mat4/.test(n))return 16;Be("TSL: Unsupported type:",n)}function qo(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function E1(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new $n(...e):t==="vec2"?new _t(...e):t==="vec3"?new ge(...e):t==="vec4"?new $t(...e):t==="mat2"?new Ix(...e):t==="mat3"?new WA(...e):t==="mat4"?new dn(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?gT(e[0]):null}function pT(n){let e=Z3.get(n);return e===void 0&&(e={},Z3.set(n,e)),e}function mT(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function gT(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const rA={VERTEX:"vertex",FRAGMENT:"fragment"},ot={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},SO={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},ar={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},yT=["fragment","vertex"],Jm=["setup","analyze","generate"],eg=[...yT,"compute"],Xa=["x","y","z","w"],EO={analyze:"setup",generate:"analyze"};let RO=0;class Ie extends ef{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=ot.NONE,this.updateBeforeType=ot.NONE,this.updateAfterType=ot.NONE,this.uuid=Kl.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:RO++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,ot.FRAME)}onRenderUpdate(e){return this.onUpdate(e,ot.RENDER)}onObjectUpdate(e){return this.onUpdate(e,ot.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const r of Object.getOwnPropertyNames(this)){const i=this[r];if(!(r.startsWith("_")===!0||e.has(i))){if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}else if(i&&i.isNode===!0)t.push({property:r,childNode:i});else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const s in i){if(s.startsWith("_")===!0)continue;const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const r=[];for(const{property:i,childNode:s}of this._getChildren(t))r.push(KA(i.slice(0,-4)),s.getCacheKey(e,t));this._cacheKey=fA(fu(r),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())t["node"+r++]=i;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(r===1){const i=e.getNodeProperties(this);for(const s of Object.values(i))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){De("Abstract function.")}updateAfter(){De("Abstract function.")}update(){De("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const f of c)f.build(e,t);this._beforeNodes=c}const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const s=EO[e.buildStage];if(s&&i.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const f of Object.values(c))if(f&&f.isNode===!0){if(f.parents===!0){const p=e.getNodeProperties(f);p.parents=p.parents||[],p.parents.push(this)}f.build(e)}}o=c.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length<2){const f=this.getNodeType(e),p=e.getDataFromNode(this);o=p.snippet,o===void 0?p.generated===void 0?(p.generated=!0,o=this.generate(e)||"",p.snippet=o):(De("Node: Recursion detected.",this),o="/* Recursion detected. */"):p.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,f,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Be(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:i,index:s,childNode:o}of t)s!==void 0?(r[i]===void 0&&(r[i]=Number.isInteger(s)?[]:{}),r[i][s]=o.toJSON(e.meta).uuid):r[i]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const i=[];for(const s of e.inputNodes[r])i.push(t[s]);this[r]=i}else if(typeof e.inputNodes[r]=="object"){const i={};for(const s in e.inputNodes[r]){const o=e.inputNodes[r][s];i[s]=t[o]}this[r]=i}else{const i=e.inputNodes[r];this[r]=t[i]}}}toJSON(e){const{uuid:t,type:r}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const c=[];for(const f in a){const p=a[f];delete p.metadata,c.push(p)}return c}if(i){const a=o(e.textures),c=o(e.images),f=o(e.nodes);a.length>0&&(s.textures=a),c.length>0&&(s.images=c),f.length>0&&(s.nodes=f)}return s}}class Ya extends Ie{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),r=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${r}[ ${i} ]`}}class _T extends Ie{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const i of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(i))&&(r=i);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,i=this.getNodeType(e),s=r.build(e,i);return e.format(s,i,t)}}class bn extends Ie{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,i),a=e.getVarFromNode(this,null,i),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,i,t)}}return super.build(e,t)}}class NO extends bn{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),i=e.getTypeLength(r),s=this.nodes,o=e.getComponentType(r),a=[];let c=0;for(const p of s){if(c>=i){Be(`TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let g=p.getNodeType(e),b=e.getTypeLength(g),x;if(c+b>i&&(Be(`TSL: Length of '${r}()' data exceeds maximum length of output type.`),b=i-c,g=e.getTypeFromLength(b)),c+=b,x=p.build(e,g),e.getComponentType(g)!==o){const S=e.getTypeFromLength(b,o);x=e.format(x,g,S)}a.push(x)}const f=`${e.getType(r)}( ${a.join(", ")} )`;return e.format(f,r,t)}}const CO=Xa.join("");class bT extends Ie{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Xa.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const r=this.node,i=e.getTypeLength(r.getNodeType(e));let s=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=r.build(e,o);this.components.length===i&&this.components===CO.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=r.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class MO extends bn{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:i}=this,s=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),a=e.getTypeFromLength(r.length,o),c=i.build(e,a),f=t.build(e,s),p=e.getTypeLength(s),g=[];for(let b=0;b<p;b++){const x=Xa[b];x===r[0]?(g.push(c),b+=r.length-1):g.push(f+"."+x)}return`${e.getType(s)}( ${g.join(", ")} )`}}class PO extends bn{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,i=this.getNodeType(e),s=r.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const c=e.getTypeLength(i),f=[];let p=0;for(let g=0;g<c;g++){const b=Xa[g];b===t[p]?(f.push("1.0 - "+(a+"."+b)),p++):f.push(a+"."+b)}return`${e.getType(i)}( ${f.join(", ")} )`}}class R1 extends Ie{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?qo(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=qo(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=mT(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?E1(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){De("Abstract function.")}}const J3=/float|u?int/;class Pi extends R1{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return J3.test(r)&&J3.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class BO extends Ie{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){De(`TSL: Member "${this.property}" does not exist in struct.`);const r=this.getNodeType(e);return e.generateConst(r)}return this.structNode.build(e)+"."+this.property}}let Xo=null;const tg=new Map;function de(n,e){if(tg.has(n)){De(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);tg.set(n,e),n!=="assign"&&(Ie.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Ie.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const DO=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),eb=n=>DO(n).split("").sort().join("");Ie.prototype.assign=function(...n){if(this.isStackNode!==!0)return Xo!==null?Xo.assign(this,...n):Be("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=tg.get("assign");return this.addToStack(e(...n))}};Ie.prototype.toVarIntent=function(){return this};Ie.prototype.get=function(n){return new BO(this,n)};const dA={};function Oc(n,e,t){dA[n]=dA[e]=dA[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new bT(this,n),this._cache[n]=o),o},set(o){this[n].assign(Pe(o))}};const r=n.toUpperCase(),i=e.toUpperCase(),s=t.toUpperCase();Ie.prototype["set"+r]=Ie.prototype["set"+i]=Ie.prototype["set"+s]=function(o){const a=eb(n);return new MO(this,a,Pe(o))},Ie.prototype["flip"+r]=Ie.prototype["flip"+i]=Ie.prototype["flip"+s]=function(){const o=eb(n);return new PO(this,o)}}const rs=["x","y","z","w"],is=["r","g","b","a"],ss=["s","t","p","q"];for(let n=0;n<4;n++){let e=rs[n],t=is[n],r=ss[n];Oc(e,t,r);for(let i=0;i<4;i++){e=rs[n]+rs[i],t=is[n]+is[i],r=ss[n]+ss[i],Oc(e,t,r);for(let s=0;s<4;s++){e=rs[n]+rs[i]+rs[s],t=is[n]+is[i]+is[s],r=ss[n]+ss[i]+ss[s],Oc(e,t,r);for(let o=0;o<4;o++)e=rs[n]+rs[i]+rs[s]+rs[o],t=is[n]+is[i]+is[s]+is[o],r=ss[n]+ss[i]+ss[s]+ss[o],Oc(e,t,r)}}}for(let n=0;n<32;n++)dA[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new Ya(this,new Pi(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(Pe(e))}};Object.defineProperties(Ie.prototype,dA);const tb=new WeakMap,LO=function(n,e=null){const t=qo(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Pe(ng(n,e)):t==="shader"?n.isFn?n:re(n):n},OO=function(n,e=null){for(const t in n)n[t]=Pe(n[t],e);return n},FO=function(n,e=null){const t=n.length;for(let r=0;r<t;r++)n[r]=Pe(n[r],e);return n},vT=function(n,e=null,t=null,r=null){function i(p){return r!==null?(p=Pe(Object.assign(p,r)),r.intent===!0&&(p=p.toVarIntent())):p=Pe(p),p}let s,o=e,a,c;function f(p){let g;return o?g=/[a-z]/i.test(o)?o+"()":o:g=n.type,a!==void 0&&p.length<a?(Be(`TSL: "${g}" parameter length is less than minimum required.`),p.concat(new Array(a-p.length).fill(0))):c!==void 0&&p.length>c?(Be(`TSL: "${g}" parameter length exceeds limit.`),p.slice(0,c)):p}return e===null?s=(...p)=>i(new n(...Ga(f(p)))):t!==null?(t=Pe(t),s=(...p)=>i(new n(e,...Ga(f(p)),t))):s=(...p)=>i(new n(e,...Ga(f(p)))),s.setParameterLength=(...p)=>(p.length===1?a=c=p[0]:p.length===2&&([a,c]=p),s),s.setName=p=>(o=p,s),s},IO=function(n,...e){return new n(...Ga(e))};class kO extends Ie{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:r}=this,i=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",o=s||"default";if(i[o])return i[o];const a=e.subBuildFn,c=e.fnCall;e.subBuildFn=s,e.fnCall=this;let f=null;if(t.layout){let p=tb.get(e.constructor);p===void 0&&(p=new WeakMap,tb.set(e.constructor,p));let g=p.get(t);g===void 0&&(g=Pe(e.buildFunctionNode(t)),p.set(t,g)),e.addInclude(g);const b=r?UO(r):null;f=Pe(g.call(b))}else{const p=new Proxy(e,{get:(S,E,C)=>{let P;return Symbol.iterator===E?P=function*(){yield void 0}:P=Reflect.get(S,E,C),P}}),g=r?qO(r):null,b=Array.isArray(r)?r.length>0:r!==null,x=t.jsFunc,T=b||x.length>1?x(g,p):x(p);f=Pe(T)}return e.subBuildFn=a,e.fnCall=c,t.once&&(i[o]=f),f}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getSubBuildOutput(this);return t[r]=t[r]||this.setupOutput(e),t[r].subBuild=e.getClosestSubBuild(this),t[r]}build(e,t=null){let r=null;const i=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,i==="setup"){const f=e.getSubBuildProperty("initialized",this);if(s[f]!==!0&&(s[f]=!0,s[o]=this.getOutputNode(e),s[o].build(e),this.shaderNode.subBuilds))for(const p of e.chaining){const g=e.getDataFromNode(p,"any");g.subBuilds=g.subBuilds||new Set;for(const b of this.shaderNode.subBuilds)g.subBuilds.add(b)}r=s[o]}else i==="analyze"?a.build(e,t):i==="generate"&&(r=a.build(e,t)||"");return e.fnCall=c,r}}function UO(n){let e;return df(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function qO(n){let e=0;return df(n),new Proxy(n,{get:(t,r,i)=>{let s;if(r==="length")return s=n.length,s;if(Symbol.iterator===r)s=function*(){for(const o of n)yield Pe(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[r]===void 0?s=o[e++]:s=Reflect.get(o,r,i)}else n[0]instanceof Ie&&(n[r]===void 0?s=n[e++]:s=Reflect.get(n,r,i));else s=Reflect.get(t,r,i);s=Pe(s)}return s}})}class GO extends Ie{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new kO(this,e)}setup(){return this.call()}}const VO=[!1,!0],zO=[0,1,2,3],jO=[-1,-2],xT=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],N1=new Map;for(const n of VO)N1.set(n,new Pi(n));const C1=new Map;for(const n of zO)C1.set(n,new Pi(n,"uint"));const M1=new Map([...C1].map(n=>new Pi(n.value,"int")));for(const n of jO)M1.set(n,new Pi(n,"int"));const hf=new Map([...M1].map(n=>new Pi(n.value)));for(const n of xT)hf.set(n,new Pi(n));for(const n of xT)hf.set(-n,new Pi(-n));const ff={bool:N1,uint:C1,ints:M1,float:hf},nb=new Map([...N1,...hf]),ng=(n,e)=>nb.has(n)?nb.get(n):n.isNode===!0?n:new Pi(n,e),Gn=function(n,e=null){return(...t)=>{for(const i of t)if(i===void 0)return Be(`TSL: Invalid parameter for the type "${n}".`),new Pi(0,n);if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(i=>{const s=typeof i;return s!=="object"&&s!=="function"}))&&(t=[E1(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return iA(e.get(t[0]));if(t.length===1){const i=ng(t[0],n);return i.nodeType===n?iA(i):iA(new _T(i,n))}const r=t.map(i=>ng(i));return iA(new NO(r,n))}},FA=n=>typeof n=="object"&&n!==null?n.value:n,TT=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function kl(n,e){return new GO(n,e)}const Pe=(n,e=null)=>LO(n,e),iA=(n,e=null)=>Pe(n,e).toVarIntent(),df=(n,e=null)=>new OO(n,e),Ga=(n,e=null)=>new FO(n,e),tt=(n,e=null,t=null,r=null)=>new vT(n,e,t,r),Me=(n,...e)=>new IO(n,...e),Se=(n,e=null,t=null,r={})=>new vT(n,e,t,{...r,intent:!0});let $O=0;class HO extends Ie{constructor(e,t=null){super();let r=null;t!==null&&(typeof t=="object"?r=t.return:(typeof t=="string"?r=t:Be("TSL: Invalid layout type."),t=null)),this.shaderNode=new kl(e,r),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const r={name:"fn"+$O++,type:t,inputs:[]};for(const i in e)i!=="return"&&r.inputs.push({name:i,type:e[i]});e=r}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Be('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function re(n,e=null){const t=new HO(n,e);return new Proxy(()=>{},{apply(r,i,s){return t.call(...s)},get(r,i,s){return Reflect.get(t,i,s)},set(r,i,s,o){return Reflect.set(t,i,s,o)}})}const IA=n=>{Xo=n},P1=()=>Xo,ze=(...n)=>Xo.If(...n),WO=(...n)=>Xo.Switch(...n);function pf(n){return Xo&&Xo.addToStack(n),n}de("toStack",pf);const wT=new Gn("color"),z=new Gn("float",ff.float),X=new Gn("int",ff.ints),ye=new Gn("uint",ff.uint),Ei=new Gn("bool",ff.bool),we=new Gn("vec2"),In=new Gn("ivec2"),B1=new Gn("uvec2"),ST=new Gn("bvec2"),Z=new Gn("vec3"),D1=new Gn("ivec3"),Ka=new Gn("uvec3"),L1=new Gn("bvec3"),je=new Gn("vec4"),O1=new Gn("ivec4"),F1=new Gn("uvec4"),ET=new Gn("bvec4"),mf=new Gn("mat2"),ur=new Gn("mat3"),Ho=new Gn("mat4"),QO=(n="")=>new Pi(n,"string"),XO=n=>new Pi(n,"ArrayBuffer");de("toColor",wT);de("toFloat",z);de("toInt",X);de("toUint",ye);de("toBool",Ei);de("toVec2",we);de("toIVec2",In);de("toUVec2",B1);de("toBVec2",ST);de("toVec3",Z);de("toIVec3",D1);de("toUVec3",Ka);de("toBVec3",L1);de("toVec4",je);de("toIVec4",O1);de("toUVec4",F1);de("toBVec4",ET);de("toMat2",mf);de("toMat3",ur);de("toMat4",Ho);const RT=tt(Ya).setParameterLength(2),NT=(n,e)=>Pe(new _T(Pe(n),e)),YO=(n,e)=>Pe(new bT(Pe(n),e));de("element",RT);de("convert",NT);const KO=n=>(De("TSL: append() has been renamed to Stack()."),pf(n));de("append",n=>(De("TSL: .append() has been renamed to .toStack()."),pf(n)));class Dt extends Ie{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return KA(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Zs=(n,e)=>new Dt(n,e),kA=(n,e)=>new Dt(n,e,!0),kt=Me(Dt,"vec4","DiffuseColor"),Sa=Me(Dt,"vec3","DiffuseContribution"),rg=Me(Dt,"vec3","EmissiveColor"),ps=Me(Dt,"float","Roughness"),Qs=Me(Dt,"float","Metalness"),Bh=Me(Dt,"float","Clearcoat"),UA=Me(Dt,"float","ClearcoatRoughness"),Kr=Me(Dt,"vec3","Sheen"),Oo=Me(Dt,"float","SheenRoughness"),gf=Me(Dt,"float","Iridescence"),Dh=Me(Dt,"float","IridescenceIOR"),Lh=Me(Dt,"float","IridescenceThickness"),Oh=Me(Dt,"float","AlphaT"),Do=Me(Dt,"float","Anisotropy"),pA=Me(Dt,"vec3","AnisotropyT"),Va=Me(Dt,"vec3","AnisotropyB"),Yo=Me(Dt,"color","SpecularColor"),Oa=Me(Dt,"color","SpecularColorBlended"),zl=Me(Dt,"float","SpecularF90"),Fh=Me(Dt,"float","Shininess"),jl=Me(Dt,"vec4","Output"),P0=Me(Dt,"float","dashSize"),ig=Me(Dt,"float","gapSize"),ZO=Me(Dt,"float","pointWidth"),mA=Me(Dt,"float","IOR"),Ih=Me(Dt,"float","Transmission"),I1=Me(Dt,"float","Thickness"),k1=Me(Dt,"float","AttenuationDistance"),U1=Me(Dt,"color","AttenuationColor"),q1=Me(Dt,"float","Dispersion");class CT extends Ie{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const MT=n=>new CT(n),yf=(n,e=0)=>new CT(n,!0,e),PT=yf("frame"),Ge=yf("render"),G1=MT("object");class ZA extends R1{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=G1}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(r=>{const i=e(r,this);i!==void 0&&(this.value=i)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const r=this.getNodeType(e),i=this.getUniformHash(e);let s=e.getNodeFromHash(i);s===void 0&&(e.setHashNode(this,i),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let f=c;if(r==="bool"){const p=e.getDataFromNode(this);let g=p.propertyName;if(g===void 0){const b=e.getVarFromNode(this,null,"bool");g=e.getPropertyName(b),p.propertyName=g,f=e.format(c,o,r),e.addLineFlowCode(`${g} = ${f}`,this)}f=g}return e.format(f,r,t)}}const Ve=(n,e)=>{const t=TT(e||n);if(t===n&&(n=E1(t)),n&&n.isNode===!0){let r=n.value;n.traverse(i=>{i.isConstNode===!0&&(r=i.value)}),n=r}return new ZA(n,t)};class rb extends bn{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const BT=(...n)=>{let e;if(n.length===1){const t=n[0];e=new rb(null,t.length,t)}else{const t=n[0],r=n[1];e=new rb(t,r)}return Pe(e)};de("toArray",(n,e)=>BT(Array(e).fill(n)));class JO extends bn{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return Xa.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,i=t.getScope(),s=e.getDataFromNode(i);s.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=r,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:i}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=r.build(e),a=r.getNodeType(e),c=i.build(e,a),f=i.getNodeType(e),p=e.getDataFromNode(this);let g;if(p.initialized===!0)t!=="void"&&(g=o);else if(s){const b=e.getVarFromNode(this,null,a),x=e.getPropertyName(b);e.addLineFlowCode(`${x} = ${c}`,this);const T=r.node,E=T.node.context({assign:!0}).build(e);for(let C=0;C<T.components.length;C++){const P=T.components[C];e.addLineFlowCode(`${E}.${P} = ${x}[ ${C} ]`,this)}t!=="void"&&(g=o)}else g=`${o} = ${c}`,(t==="void"||f==="void")&&(e.addLineFlowCode(g,this),t!=="void"&&(g=o));return p.initialized=!0,e.format(g,a,t)}}const DT=tt(JO).setParameterLength(2);de("assign",DT);class eF extends bn{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],r=this.functionNode,i=r.getInputs(e),s=this.parameters,o=(c,f)=>{const p=f.type,g=p==="pointer";let b;return g?b="&"+c.build(e):b=c.build(e,p),b};if(Array.isArray(s)){if(s.length>i.length)Be("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=i.length;else if(s.length<i.length)for(Be("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<i.length;)s.push(z(0));for(let c=0;c<s.length;c++)t.push(o(s[c],i[c]))}else for(const c of i){const f=s[c.name];f!==void 0?t.push(o(f,c)):(Be(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(z(0),c)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const LT=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Ga(e):df(e[0]),new eF(Pe(n),e));de("call",LT);const tF={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class yn extends bn{static get type(){return"OperatorNode"}constructor(e,t,r,...i){if(super(),i.length>0){let s=new yn(e,t,r);for(let o=0;o<i.length-1;o++)s=new yn(e,s,i[o]);t=s,r=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(tF[this.op],t)}getNodeType(e,t=null){const r=this.op,i=this.aNode,s=this.bNode,o=i.getNodeType(e),a=s?s.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(r==="%")return o;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(o);if(r==="!"||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const r=this.op,{aNode:i,bNode:s}=this,o=this.getNodeType(e,t);let a=null,c=null;o!=="void"?(a=i.getNodeType(e),c=s?s.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="||r==="!="?e.isVector(a)?c=a:e.isVector(c)?a=c:a!==c&&(a=c="float"):r===">>"||r==="<<"?(a=o,c=e.changeComponentType(c,"uint")):r==="%"?(a=o,c=e.isInteger(a)&&e.isInteger(c)?c:a):e.isMatrix(a)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(a):e.isMatrix(c)||(a=c=o):e.isMatrix(c)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(c):a=c=o:a=c=o):a=c=o;const f=i.build(e,a),p=s?s.build(e,c):null,g=e.getFunctionOperator(r);if(t!=="void"){const b=e.renderer.coordinateSystem===G0;if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">=")return b?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${f}, ${p} )`,o,t):e.format(`( ${f} ${r} ${p} )`,o,t):e.format(`( ${f} ${r} ${p} )`,o,t);if(r==="%")return e.isInteger(c)?e.format(`( ${f} % ${p} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${f}, ${p} )`,o,t);if(r==="!"||r==="~")return e.format(`(${r}${f})`,a,t);if(g)return e.format(`${g}( ${f}, ${p} )`,o,t);if(e.isMatrix(a)&&c==="float")return e.format(`( ${p} ${r} ${f} )`,o,t);if(a==="float"&&e.isMatrix(c))return e.format(`${f} ${r} ${p}`,o,t);{let x=`( ${f} ${r} ${p} )`;return!b&&o==="bool"&&e.isVector(a)&&e.isVector(c)&&(x=`all${x}`),e.format(x,o,t)}}else if(a!=="void")return g?e.format(`${g}( ${f}, ${p} )`,o,t):e.isMatrix(a)&&c==="float"?e.format(`${p} ${r} ${f}`,o,t):e.format(`${f} ${r} ${p}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Ln=Se(yn,"+").setParameterLength(2,1/0).setName("add"),St=Se(yn,"-").setParameterLength(2,1/0).setName("sub"),et=Se(yn,"*").setParameterLength(2,1/0).setName("mul"),oi=Se(yn,"/").setParameterLength(2,1/0).setName("div"),JA=Se(yn,"%").setParameterLength(2).setName("mod"),V1=Se(yn,"==").setParameterLength(2).setName("equal"),OT=Se(yn,"!=").setParameterLength(2).setName("notEqual"),FT=Se(yn,"<").setParameterLength(2).setName("lessThan"),z1=Se(yn,">").setParameterLength(2).setName("greaterThan"),IT=Se(yn,"<=").setParameterLength(2).setName("lessThanEqual"),kT=Se(yn,">=").setParameterLength(2).setName("greaterThanEqual"),UT=Se(yn,"&&").setParameterLength(2,1/0).setName("and"),qT=Se(yn,"||").setParameterLength(2,1/0).setName("or"),GT=Se(yn,"!").setParameterLength(1).setName("not"),VT=Se(yn,"^^").setParameterLength(2).setName("xor"),zT=Se(yn,"&").setParameterLength(2).setName("bitAnd"),jT=Se(yn,"~").setParameterLength(1).setName("bitNot"),$T=Se(yn,"|").setParameterLength(2).setName("bitOr"),HT=Se(yn,"^").setParameterLength(2).setName("bitXor"),WT=Se(yn,"<<").setParameterLength(2).setName("shiftLeft"),QT=Se(yn,">>").setParameterLength(2).setName("shiftRight"),XT=re(([n])=>(n.addAssign(1),n)),YT=re(([n])=>(n.subAssign(1),n)),KT=re(([n])=>{const e=X(n).toConst();return n.addAssign(1),e}),ZT=re(([n])=>{const e=X(n).toConst();return n.subAssign(1),e});de("add",Ln);de("sub",St);de("mul",et);de("div",oi);de("mod",JA);de("equal",V1);de("notEqual",OT);de("lessThan",FT);de("greaterThan",z1);de("lessThanEqual",IT);de("greaterThanEqual",kT);de("and",UT);de("or",qT);de("not",GT);de("xor",VT);de("bitAnd",zT);de("bitNot",jT);de("bitOr",$T);de("bitXor",HT);de("shiftLeft",WT);de("shiftRight",QT);de("incrementBefore",XT);de("decrementBefore",YT);de("increment",KT);de("decrement",ZT);const JT=(n,e)=>(De('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),JA(X(n),X(e)));de("modInt",JT);class ue extends bn{static get type(){return"MathNode"}constructor(e,t,r=null,i=null){if(super(),(e===ue.MAX||e===ue.MIN)&&arguments.length>3){let s=new ue(e,t,r);for(let o=2;o<arguments.length-1;o++)s=new ue(e,s,arguments[o]);t=s,r=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(r)?0:e.getTypeLength(r),a=e.isMatrix(i)?0:e.getTypeLength(i);return s>o&&s>a?t:o>a?r:a>s?i:t}getNodeType(e){const t=this.method;return t===ue.LENGTH||t===ue.DISTANCE||t===ue.DOT?"float":t===ue.CROSS?"vec3":t===ue.ALL||t===ue.ANY?"bool":t===ue.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:i}=this;let s=null;if(i===ue.ONE_MINUS)s=St(1,t);else if(i===ue.RECIPROCAL)s=oi(1,t);else if(i===ue.DIFFERENCE)s=en(St(t,r));else if(i===ue.TRANSFORM_DIRECTION){let o=t,a=r;e.isMatrix(o.getNodeType(e))?a=je(Z(a),0):o=je(Z(o),0);const c=et(o,a).xyz;s=Pr(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const s=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,c=this.bNode,f=this.cNode,p=e.renderer.coordinateSystem;if(i===ue.NEGATE)return e.format("( - "+a.build(e,o)+" )",s,t);{const g=[];return i===ue.CROSS?g.push(a.build(e,s),c.build(e,s)):p===G0&&i===ue.STEP?g.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),c.build(e,o)):p===G0&&(i===ue.MIN||i===ue.MAX)?g.push(a.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):i===ue.REFRACT?g.push(a.build(e,o),c.build(e,o),f.build(e,"float")):i===ue.MIX?g.push(a.build(e,o),c.build(e,o),f.build(e,e.getTypeLength(f.getNodeType(e))===1?"float":o)):(p===Wo&&i===ue.ATAN&&c!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===ue.DFDX||i===ue.DFDY)&&(De(`TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),g.push(a.build(e,o)),c!==null&&g.push(c.build(e,o)),f!==null&&g.push(f.build(e,o))),e.format(`${e.getMethod(i,s)}( ${g.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}ue.ALL="all";ue.ANY="any";ue.RADIANS="radians";ue.DEGREES="degrees";ue.EXP="exp";ue.EXP2="exp2";ue.LOG="log";ue.LOG2="log2";ue.SQRT="sqrt";ue.INVERSE_SQRT="inversesqrt";ue.FLOOR="floor";ue.CEIL="ceil";ue.NORMALIZE="normalize";ue.FRACT="fract";ue.SIN="sin";ue.COS="cos";ue.TAN="tan";ue.ASIN="asin";ue.ACOS="acos";ue.ATAN="atan";ue.ABS="abs";ue.SIGN="sign";ue.LENGTH="length";ue.NEGATE="negate";ue.ONE_MINUS="oneMinus";ue.DFDX="dFdx";ue.DFDY="dFdy";ue.ROUND="round";ue.RECIPROCAL="reciprocal";ue.TRUNC="trunc";ue.FWIDTH="fwidth";ue.TRANSPOSE="transpose";ue.DETERMINANT="determinant";ue.INVERSE="inverse";ue.EQUALS="equals";ue.MIN="min";ue.MAX="max";ue.STEP="step";ue.REFLECT="reflect";ue.DISTANCE="distance";ue.DIFFERENCE="difference";ue.DOT="dot";ue.CROSS="cross";ue.POW="pow";ue.TRANSFORM_DIRECTION="transformDirection";ue.MIX="mix";ue.CLAMP="clamp";ue.REFRACT="refract";ue.SMOOTHSTEP="smoothstep";ue.FACEFORWARD="faceforward";const j1=z(1e-6),nF=z(1e6),kh=z(Math.PI),rF=z(Math.PI*2),iF=z(Math.PI*2),sF=z(Math.PI*.5),e8=Se(ue,ue.ALL).setParameterLength(1),t8=Se(ue,ue.ANY).setParameterLength(1),n8=Se(ue,ue.RADIANS).setParameterLength(1),r8=Se(ue,ue.DEGREES).setParameterLength(1),$1=Se(ue,ue.EXP).setParameterLength(1),ou=Se(ue,ue.EXP2).setParameterLength(1),_f=Se(ue,ue.LOG).setParameterLength(1),xs=Se(ue,ue.LOG2).setParameterLength(1),gr=Se(ue,ue.SQRT).setParameterLength(1),H1=Se(ue,ue.INVERSE_SQRT).setParameterLength(1),Ts=Se(ue,ue.FLOOR).setParameterLength(1),bf=Se(ue,ue.CEIL).setParameterLength(1),Pr=Se(ue,ue.NORMALIZE).setParameterLength(1),Yi=Se(ue,ue.FRACT).setParameterLength(1),Cr=Se(ue,ue.SIN).setParameterLength(1),Ui=Se(ue,ue.COS).setParameterLength(1),i8=Se(ue,ue.TAN).setParameterLength(1),s8=Se(ue,ue.ASIN).setParameterLength(1),W1=Se(ue,ue.ACOS).setParameterLength(1),vf=Se(ue,ue.ATAN).setParameterLength(1,2),en=Se(ue,ue.ABS).setParameterLength(1),Q1=Se(ue,ue.SIGN).setParameterLength(1),ws=Se(ue,ue.LENGTH).setParameterLength(1),X1=Se(ue,ue.NEGATE).setParameterLength(1),o8=Se(ue,ue.ONE_MINUS).setParameterLength(1),Y1=Se(ue,ue.DFDX).setParameterLength(1),K1=Se(ue,ue.DFDY).setParameterLength(1),a8=Se(ue,ue.ROUND).setParameterLength(1),l8=Se(ue,ue.RECIPROCAL).setParameterLength(1),Z1=Se(ue,ue.TRUNC).setParameterLength(1),J1=Se(ue,ue.FWIDTH).setParameterLength(1),u8=Se(ue,ue.TRANSPOSE).setParameterLength(1),A8=Se(ue,ue.DETERMINANT).setParameterLength(1),c8=Se(ue,ue.INVERSE).setParameterLength(1),h8=(n,e)=>(De('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),V1(n,e)),zr=Se(ue,ue.MIN).setParameterLength(2,1/0),_n=Se(ue,ue.MAX).setParameterLength(2,1/0),xf=Se(ue,ue.STEP).setParameterLength(2),f8=Se(ue,ue.REFLECT).setParameterLength(2),d8=Se(ue,ue.DISTANCE).setParameterLength(2),p8=Se(ue,ue.DIFFERENCE).setParameterLength(2),Ri=Se(ue,ue.DOT).setParameterLength(2),lo=Se(ue,ue.CROSS).setParameterLength(2),yi=Se(ue,ue.POW).setParameterLength(2),e2=n=>et(n,n),m8=n=>et(n,n,n),t2=n=>et(n,n,n,n),g8=Se(ue,ue.TRANSFORM_DIRECTION).setParameterLength(2),y8=n=>et(Q1(n),yi(en(n),1/3)),n2=n=>Ri(n,n),Tt=Se(ue,ue.MIX).setParameterLength(3),Ki=(n,e=0,t=1)=>Pe(new ue(ue.CLAMP,Pe(n),Pe(e),Pe(t))),Tf=n=>Ki(n),r2=Se(ue,ue.REFRACT).setParameterLength(3),Zi=Se(ue,ue.SMOOTHSTEP).setParameterLength(3),i2=Se(ue,ue.FACEFORWARD).setParameterLength(3),_8=re(([n])=>{const r=43758.5453,i=Ri(n.xy,we(12.9898,78.233)),s=JA(i,kh);return Yi(Cr(s).mul(r))}),b8=(n,e,t)=>Tt(e,t,n),v8=(n,e,t)=>Zi(e,t,n),x8=(n,e)=>xf(e,n),T8=(n,e)=>(De('TSL: "atan2" is overloaded. Use "atan" instead.'),vf(n,e)),oF=i2,aF=H1;de("all",e8);de("any",t8);de("equals",h8);de("radians",n8);de("degrees",r8);de("exp",$1);de("exp2",ou);de("log",_f);de("log2",xs);de("sqrt",gr);de("inverseSqrt",H1);de("floor",Ts);de("ceil",bf);de("normalize",Pr);de("fract",Yi);de("sin",Cr);de("cos",Ui);de("tan",i8);de("asin",s8);de("acos",W1);de("atan",vf);de("abs",en);de("sign",Q1);de("length",ws);de("lengthSq",n2);de("negate",X1);de("oneMinus",o8);de("dFdx",Y1);de("dFdy",K1);de("round",a8);de("reciprocal",l8);de("trunc",Z1);de("fwidth",J1);de("atan2",T8);de("min",zr);de("max",_n);de("step",x8);de("reflect",f8);de("distance",d8);de("dot",Ri);de("cross",lo);de("pow",yi);de("pow2",e2);de("pow3",m8);de("pow4",t2);de("transformDirection",g8);de("mix",b8);de("clamp",Ki);de("refract",r2);de("smoothstep",v8);de("faceForward",i2);de("difference",p8);de("saturate",Tf);de("cbrt",y8);de("transpose",u8);de("determinant",A8);de("inverse",c8);de("rand",_8);class lF extends Ie{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const i=t.getNodeType(e);if(r!==null){const s=r.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const t=this.condNode,r=this.ifNode.isolate(),i=this.elseNode?this.elseNode.isolate():null,s=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=s,i!==null&&(e.getDataFromNode(i).parentNodeBlock=s);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?r:r.context({nodeBlock:r}),a.elseNode=i?o?i:i.context({nodeBlock:i}):null}generate(e,t){const r=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),c=e.currentFunctionNode,f=t!=="void",p=f?Zs(r).build(e):"";i.nodeProperty=p;const g=s.build(e,"bool");if(e.context.uniformFlow&&a!==null){const T=o.build(e,r),S=a.build(e,r),E=e.getTernary(g,T,S);return e.format(E,r,t)}e.addFlowCode(`
${e.tab}if ( ${g} ) {

`).addFlowTab();let x=o.build(e,r);if(x&&(f?x=p+" = "+x+";":(x="return "+x+";",c===null&&(De("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let T=a.build(e,r);T&&(f?T=p+" = "+T+";":(T="return "+T+";",c===null&&(De("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),T="// "+T))),e.removeFlowTab().addFlowCode(e.tab+"	"+T+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(p,r,t)}}const lr=tt(lF).setParameterLength(2,3);de("select",lr);class w8 extends Ie{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const r=e.addContext(this.value),i=this.node.build(e,t);return e.setContext(r),i}}const ho=(n=null,e={})=>{let t=n;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new w8(t,e)},S8=n=>ho(n,{uniformFlow:!0}),s2=(n,e)=>ho(n,{nodeName:e});function E8(n,e,t=null){return ho(t,{getShadow:({light:r,shadowColorNode:i})=>e===r?i.mul(n):i})}function R8(n,e=null){return ho(e,{getAO:(t,{material:r})=>r.transparent===!0?t:t!==null?t.mul(n):n})}function N8(n,e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),s2(n,e)}de("context",ho);de("label",N8);de("uniformFlow",S8);de("setName",s2);de("builtinShadowContext",(n,e,t)=>E8(e,t,n));de("builtinAOContext",(n,e)=>R8(e,n));class B0 extends Ie{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let r=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,r=!0}const i=t.getBaseStack();r?i.addToStackBefore(this):i.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:r,readOnly:i}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let a=!1,c=!1;i&&(a=e.isDeterministic(t),c=o?i:a);const f=this.getNodeType(e);if(f=="void")return this.isIntent(e)!==!0&&Be('TSL: ".toVar()" can not be used with void type.'),t.build(e);const p=e.getVectorType(f),g=t.build(e,p),b=e.getVarFromNode(this,r,p,void 0,c),x=e.getPropertyName(b);let T=x;if(c)if(o)T=a?`const ${x}`:`let ${x}`;else{const S=t.getArrayCount(e);T=`const ${e.getVar(b.type,x,S)}`}return e.addLineFlowCode(`${T} = ${g}`,this),x}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const o2=tt(B0),C8=(n,e=null)=>o2(n,e).toStack(),M8=(n,e=null)=>o2(n,e,!0).toStack(),P8=n=>o2(n).setIntent(!0).toStack();de("toVar",C8);de("toConst",M8);de("toVarIntent",P8);class uF extends Ie{static get type(){return"SubBuild"}constructor(e,t,r=null){super(r),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const r=this.node.build(e,...t);return e.removeSubBuild(),r}}const $l=(n,e,t=null)=>Pe(new uF(Pe(n),e,t));class AF extends Ie{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(r===void 0){const i=this.name,s=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,i,s,o,a),t.node=$l(this.node,"VERTEX")}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(rA.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(rA.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),r=e.getNodeProperties(this),i=this.setupVarying(e);if(r[t]===void 0){const s=this.getNodeType(e),o=e.getPropertyName(i,rA.VERTEX);e.flowNodeFromShaderStage(rA.VERTEX,r.node,s,o),r[t]=o}return e.getPropertyName(i)}}const Os=tt(AF).setParameterLength(1,2),B8=n=>Os(n);de("toVarying",Os);de("toVertexStage",B8);de("varying",(...n)=>(De("TSL: .varying() has been renamed to .toVarying()."),Os(...n)));de("vertexStage",(...n)=>(De("TSL: .vertexStage() has been renamed to .toVertexStage()."),Os(...n)));const D8=re(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),r=n.lessThanEqual(.04045);return Tt(e,t,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),L8=re(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),r=n.lessThanEqual(.0031308);return Tt(e,t,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),a2="WorkingColorSpace",cF="OutputColorSpace";class l2 extends bn{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===a2?Sn.workingColorSpace:t===cF?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let s=t;return Sn.enabled===!1||r===i||!r||!i||(Sn.getTransfer(r)===ft&&(s=je(D8(s.rgb),s.a)),Sn.getPrimaries(r)!==Sn.getPrimaries(i)&&(s=je(ur(Sn._getMatrix(new WA,r,i)).mul(s.rgb),s.a)),Sn.getTransfer(i)===ft&&(s=je(L8(s.rgb),s.a))),s}}const O8=(n,e)=>Pe(new l2(Pe(n),a2,e)),wf=(n,e)=>Pe(new l2(Pe(n),e,a2)),hF=(n,e,t)=>Pe(new l2(Pe(n),e,t));de("workingToColorSpace",O8);de("colorSpaceToWorking",wf);let fF=class extends Ya{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}};class F8 extends Ie{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=ot.OBJECT}setGroup(e){return this.group=e,this}element(e){return new fF(this,Pe(e))}setNodeType(e){const t=Ve(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const dF=(n,e,t)=>new F8(n,e,t);class pF extends F8{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(Ge)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const I8=(n,e,t=null)=>new pF(n,e,t);class mF extends bn{static get type(){return"ToneMappingNode"}constructor(e,t=U8,r=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return fA(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,r=this._toneMapping;if(r===Pa)return t;let i=null;const s=e.renderer.library.getToneMappingFunction(r);return s!==null?i=je(s(t.rgb,this.exposureNode),t.a):(Be("ToneMappingNode: Unsupported Tone Mapping configuration.",r),i=t),i}}const k8=(n,e,t)=>Pe(new mF(n,Pe(e),Pe(t))),U8=I8("toneMappingExposure","float");de("toneMapping",(n,e,t)=>k8(e,t,n));const ib=new WeakMap;function sb(n,e){let t=ib.get(n);return t===void 0&&(t=new ex(n,e),ib.set(n,t)),t}class So extends R1{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=i,this.usage=n1,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),r=e.getTypeLength(t),i=this.value,s=this.bufferStride||r,o=this.bufferOffset;let a;i.isInterleavedBuffer===!0?a=i:i.isBufferAttribute===!0?a=sb(i.array,s):a=sb(i,s);const c=new Uo(a,r,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(r);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,s=i):s=Os(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function Sf(n,e=null,t=0,r=0,i=n1,s=!1){return e==="mat3"||e===null&&n.itemSize===9?ur(new So(n,"vec3",9,0).setUsage(i).setInstanced(s),new So(n,"vec3",9,3).setUsage(i).setInstanced(s),new So(n,"vec3",9,6).setUsage(i).setInstanced(s)):e==="mat4"||e===null&&n.itemSize===16?Ho(new So(n,"vec4",16,0).setUsage(i).setInstanced(s),new So(n,"vec4",16,4).setUsage(i).setInstanced(s),new So(n,"vec4",16,8).setUsage(i).setInstanced(s),new So(n,"vec4",16,12).setUsage(i).setInstanced(s)):new So(n,e,t,r)}const u2=(n,e=null,t=0,r=0)=>Sf(n,e,t,r),gF=(n,e=null,t=0,r=0)=>Sf(n,e,t,r,Ba),Uh=(n,e=null,t=0,r=0)=>Sf(n,e,t,r,n1,!0),sg=(n,e=null,t=0,r=0)=>Sf(n,e,t,r,Ba,!0);de("toAttribute",n=>u2(n.value));class yF extends Ie{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=ot.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const r=e.getNodeProperties(this);r.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if(r==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const A2=(n,e=[64])=>{(e.length===0||e.length>3)&&Be("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const r=e[t];(typeof r!="number"||r<=0||!Number.isInteger(r))&&Be(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Pe(new yF(Pe(n),e))},q8=(n,e,t)=>A2(n,t).setCount(e);de("compute",q8);de("computeKernel",A2);class _F extends Ie{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const r=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.build(e,...t);return e.setCache(r),s}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const Hl=n=>new _F(Pe(n));function G8(n,e=!0){return De('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),Hl(n).setParent(e)}de("cache",G8);de("isolate",Hl);class bF extends Ie{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const V8=tt(bF).setParameterLength(2);de("bypass",V8);class z8 extends Ie{static get type(){return"RemapNode"}constructor(e,t,r,i=z(0),s=z(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=i,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:i,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(r.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(i)).add(i)}}const j8=tt(z8,null,null,{doClamp:!1}).setParameterLength(3,5),$8=tt(z8).setParameterLength(3,5);de("remap",j8);de("remapClamp",$8);class D0 extends Ie{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),i=this.snippet;if(r==="void")e.addLineFlowCode(i,this);else return e.format(i,r,t)}}const uo=tt(D0).setParameterLength(1,2),H8=n=>(n?lr(n,uo("discard")):uo("discard")).toStack(),vF=()=>uo("return").toStack();de("discard",H8);class xF extends bn{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const r=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Pa,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Xl;return r!==Pa&&(t=t.toneMapping(r)),i!==Xl&&i!==Sn.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const W8=(n,e=null,t=null)=>Pe(new xF(Pe(n),e,t));de("renderOutput",W8);class TF extends bn{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(i.length);let o="";return o+="// #"+i+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+r+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):kN(o),r}}const Q8=(n,e=null)=>Pe(new TF(Pe(n),e)).toStack();de("debug",Q8);class X8{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class wF extends Ie{static get type(){return"InspectorNode"}constructor(e,t="",r=null){super(),this.node=e,this.name=t,this.callback=r,this.updateType=ot.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==X8&&fn('TSL: ".toInspector()" is only available with WebGPU.'),t}}function Y8(n,e="",t=null){return n=Pe(n),n.before(new wF(n,e,t))}de("toInspector",Y8);function SF(n){De("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",n)}class K8 extends Ie{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const i=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,r):Os(this).build(e,r)}else return De(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Ao=(n,e=null)=>new K8(n,e),Ht=(n=0)=>Ao("uv"+(n>0?n:""),"vec2");class EF extends Ie{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${i} )`,this.getNodeType(e),t)}}const Js=tt(EF).setParameterLength(1,2);class RF extends ZA{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=ot.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&r.width!==void 0){const{width:i,height:s}=r;this.value=Math.log2(Math.max(i,s))}}}const c2=tt(RF).setParameterLength(1),h2=new Wg;class Ms extends ZA{static get type(){return"TextureNode"}constructor(e=h2,t=null,r=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=ot.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Un?"uvec4":this.value.type===Sr?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ht(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Ve(this.value.matrix)),this._matrixUniform.mul(Z(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Ve(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(X(Js(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||r.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const i=re(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?ot.OBJECT:ot.NONE,o})();let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,r,i,s,o,a,c,f){const p=this.value;let g;return s?g=e.generateTextureBias(p,t,r,s,o,f):c?g=e.generateTextureGrad(p,t,r,c,o,f):a?g=e.generateTextureCompare(p,t,r,a,o,f):this.sampler===!1?g=e.generateTextureLoad(p,t,r,i,o,f):i?g=e.generateTextureLevel(p,t,r,i,o,f):g=e.generateTexture(p,t,r,o,f),g}generate(e,t){const r=this.value,i=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:p,levelNode:g,biasNode:b,compareNode:x,depthNode:T,gradNode:S,offsetNode:E}=i,C=this.generateUV(e,p),P=g?g.build(e,"float"):null,D=b?b.build(e,"float"):null,L=T?T.build(e,"int"):null,k=x?x.build(e,"float"):null,q=S?[S[0].build(e,"vec2"),S[1].build(e,"vec2")]:null,I=E?this.generateOffset(e,E):null,U=e.getVarFromNode(this);a=e.getPropertyName(U);const j=this.generateSnippet(e,s,C,P,D,L,k,q,I);e.addLineFlowCode(`${a} = ${j}`,this),o.snippet=j,o.propertyName=a}let c=a;const f=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(c=wf(uo(c,f),r.colorSpace).setup(e).build(e,f)),e.format(c,f,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return De("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Pe(e).mul(c2(t)),t.referenceNode=this.getBase();const r=t.value;return t.generateMipmaps===!1&&(r&&r.generateMipmaps===!1||r.minFilter===qi||r.magFilter===qi)&&(De("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Pe(t)}level(e){const t=this.clone();return t.levelNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}size(e){return Js(this,e)}bias(e){const t=this.clone();return t.biasNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}grad(e,t){const r=this.clone();return r.gradNode=[Pe(e),Pe(t)],r.referenceNode=this.getBase(),Pe(r)}depth(e){const t=this.clone();return t.depthNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}offset(e){const t=this.clone();return t.offsetNode=Pe(e),t.referenceNode=this.getBase(),Pe(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const r=this._flipYUniform;r!==null&&(r.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const NF=tt(Ms).setParameterLength(1,4).setName("texture"),Ct=(n=h2,e=null,t=null,r=null)=>{let i;return n&&n.isTextureNode===!0?(i=Pe(n.clone()),i.referenceNode=n.getBase(),e!==null&&(i.uvNode=Pe(e)),t!==null&&(i.levelNode=Pe(t)),r!==null&&(i.biasNode=Pe(r))):i=NF(n,e,t,r),i},CF=(n=h2)=>Ct(n),wn=(...n)=>Ct(...n).setSampler(!1),MF=(n,e,t)=>Ct(n,e).level(t),PF=n=>(n.isNode===!0?n:Ct(n)).convert("sampler"),BF=n=>(n.isNode===!0?n:Ct(n)).convert("samplerComparison");class f2 extends ZA{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const ec=(n,e,t)=>new f2(n,e,t);class DF extends Ya{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,r)}}class LF extends f2{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?qo(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=ot.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if(r==="float"||r==="int"||r==="uint")for(let i=0;i<e.length;i++){const s=i*4;t[s]=e[i]}else if(r==="color")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(r==="mat2")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(r==="mat3")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(r==="mat4")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,r=this.elementType;let i=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return r.charAt(0)==="i"&&(i=Int32Array),r.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return new DF(this,Pe(e))}}const mr=(n,e)=>new LF(n,e);class OF extends Ie{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const fo=tt(OF).setParameterLength(1);let Bu,Du;class rn extends Ie{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===rn.DPR?"float":this.scope===rn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=ot.NONE;return(this.scope===rn.SIZE||this.scope===rn.VIEWPORT||this.scope===rn.DPR)&&(e=ot.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===rn.VIEWPORT?t!==null?Du.copy(t.viewport):(e.getViewport(Du),Du.multiplyScalar(e.getPixelRatio())):this.scope===rn.DPR?this._output.value=e.getPixelRatio():t!==null?(Bu.width=t.width,Bu.height=t.height):e.getDrawingBufferSize(Bu)}setup(){const e=this.scope;let t=null;return e===rn.SIZE?t=Ve(Bu||(Bu=new _t)):e===rn.VIEWPORT?t=Ve(Du||(Du=new $t)):e===rn.DPR?t=Ve(1):t=we(Za.div(Wa)),this._output=t,t}generate(e){if(this.scope===rn.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(Wa).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}rn.COORDINATE="coordinate";rn.VIEWPORT="viewport";rn.SIZE="size";rn.UV="uv";rn.DPR="dpr";const Z8=Me(rn,rn.DPR),eo=Me(rn,rn.UV),Wa=Me(rn,rn.SIZE),Za=Me(rn,rn.COORDINATE),d2=Me(rn,rn.VIEWPORT),p2=d2.zw,J8=Za.sub(d2.xy),FF=J8.div(p2),IF=re(()=>(De('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),Wa),"vec2").once()(),ea=Ve(0,"uint").setName("u_cameraIndex").setGroup(yf("cameraIndex")).toVarying("v_cameraIndex"),Fo=Ve("float").setName("cameraNear").setGroup(Ge).onRenderUpdate(({camera:n})=>n.near),Io=Ve("float").setName("cameraFar").setGroup(Ge).onRenderUpdate(({camera:n})=>n.far),to=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrix);e=mr(t).setGroup(Ge).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?fo("gl_ViewID_OVR"):ea).toConst("cameraProjectionMatrix")}else e=Ve("mat4").setName("cameraProjectionMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),kF=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrixInverse);e=mr(t).setGroup(Ge).setName("cameraProjectionMatricesInverse").element(n.isMultiViewCamera?fo("gl_ViewID_OVR"):ea).toConst("cameraProjectionMatrixInverse")}else e=Ve("mat4").setName("cameraProjectionMatrixInverse").setGroup(Ge).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),Bi=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorldInverse);e=mr(t).setGroup(Ge).setName("cameraViewMatrices").element(n.isMultiViewCamera?fo("gl_ViewID_OVR"):ea).toConst("cameraViewMatrix")}else e=Ve("mat4").setName("cameraViewMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),UF=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorld);e=mr(t).setGroup(Ge).setName("cameraWorldMatrices").element(n.isMultiViewCamera?fo("gl_ViewID_OVR"):ea).toConst("cameraWorldMatrix")}else e=Ve("mat4").setName("cameraWorldMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),qF=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.normalMatrix);e=mr(t).setGroup(Ge).setName("cameraNormalMatrices").element(n.isMultiViewCamera?fo("gl_ViewID_OVR"):ea).toConst("cameraNormalMatrix")}else e=Ve("mat3").setName("cameraNormalMatrix").setGroup(Ge).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),e6=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let i=0,s=n.cameras.length;i<s;i++)t.push(new ge);e=mr(t).setGroup(Ge).setName("cameraPositions").onRenderUpdate(({camera:i},s)=>{const o=i.cameras,a=s.array;for(let c=0,f=o.length;c<f;c++)a[c].setFromMatrixPosition(o[c].matrixWorld)}).element(n.isMultiViewCamera?fo("gl_ViewID_OVR"):ea).toConst("cameraPosition")}else e=Ve(new ge).setName("cameraPosition").setGroup(Ge).onRenderUpdate(({camera:t},r)=>r.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),GF=re(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.viewport);e=mr(t,"vec4").setGroup(Ge).setName("cameraViewports").element(ea).toConst("cameraViewport")}else e=je(0,0,Wa.x,Wa.y).toConst("cameraViewport");return e}).once()(),ob=new t1;class xt extends Ie{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=ot.OBJECT,this.uniformNode=new ZA(null)}getNodeType(){const e=this.scope;if(e===xt.WORLD_MATRIX)return"mat4";if(e===xt.POSITION||e===xt.VIEW_POSITION||e===xt.DIRECTION||e===xt.SCALE)return"vec3";if(e===xt.RADIUS)return"float"}update(e){const t=this.object3d,r=this.uniformNode,i=this.scope;if(i===xt.WORLD_MATRIX)r.value=t.matrixWorld;else if(i===xt.POSITION)r.value=r.value||new ge,r.value.setFromMatrixPosition(t.matrixWorld);else if(i===xt.SCALE)r.value=r.value||new ge,r.value.setFromMatrixScale(t.matrixWorld);else if(i===xt.DIRECTION)r.value=r.value||new ge,t.getWorldDirection(r.value);else if(i===xt.VIEW_POSITION){const s=e.camera;r.value=r.value||new ge,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(s.matrixWorldInverse)}else if(i===xt.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),ob.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),r.value=ob.radius}}generate(e){const t=this.scope;return t===xt.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===xt.POSITION||t===xt.VIEW_POSITION||t===xt.DIRECTION||t===xt.SCALE?this.uniformNode.nodeType="vec3":t===xt.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}xt.WORLD_MATRIX="worldMatrix";xt.POSITION="position";xt.SCALE="scale";xt.VIEW_POSITION="viewPosition";xt.DIRECTION="direction";xt.RADIUS="radius";const VF=tt(xt,xt.DIRECTION).setParameterLength(1),zF=tt(xt,xt.WORLD_MATRIX).setParameterLength(1),t6=tt(xt,xt.POSITION).setParameterLength(1),jF=tt(xt,xt.SCALE).setParameterLength(1),$F=tt(xt,xt.VIEW_POSITION).setParameterLength(1),HF=tt(xt,xt.RADIUS).setParameterLength(1);class Ni extends xt{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const WF=Me(Ni,Ni.DIRECTION),_i=Me(Ni,Ni.WORLD_MATRIX),QF=Me(Ni,Ni.POSITION),XF=Me(Ni,Ni.SCALE),YF=Me(Ni,Ni.VIEW_POSITION),KF=Me(Ni,Ni.RADIUS),n6=Ve(new WA).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),ZF=Ve(new dn).onObjectUpdate(({object:n},e)=>e.value.copy(n.matrixWorld).invert()),ta=re(n=>n.context.modelViewMatrix||r6).once()().toVar("modelViewMatrix"),r6=Bi.mul(_i),og=re(n=>(n.context.isHighPrecisionModelViewMatrix=!0,Ve("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),ag=re(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return Ve("mat3").onObjectUpdate(({object:t,camera:r})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),tc=Ao("position","vec3"),pn=tc.toVarying("positionLocal"),qh=tc.toVarying("positionPrevious"),Ss=re(n=>_i.mul(pn).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),m2=re(()=>pn.transformDirection(_i).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),Mn=re(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Yt=re(n=>{let e;return n.camera.isOrthographicCamera?e=Z(0,0,1):e=Mn.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class JF extends Ie{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===yr?"false":e.getFrontFacing()}}const i6=Me(JF),g2=z(i6).mul(2).sub(1),du=re(([n],{material:e})=>{const t=e.side;return t===yr?n=n.mul(-1):t===vi&&(n=n.mul(g2)),n}),Ef=Ao("normal","vec3"),jr=re(n=>n.geometry.hasAttribute("normal")===!1?(De('TSL: Vertex attribute "normal" not found on geometry.'),Z(0,1,0)):Ef,"vec3").once()().toVar("normalLocal"),s6=Mn.dFdx().cross(Mn.dFdy()).normalize().toVar("normalFlat"),au=re(n=>{let e;return n.material.flatShading===!0?e=s6:e=y2(jr).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),o6=re(n=>{let e=au.transformDirection(Bi);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Rt=re(({subBuildFn:n,material:e,context:t})=>{let r;return n==="NORMAL"||n==="VERTEX"?(r=au,e.flatShading!==!0&&(r=du(r))):r=t.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),na=Rt.transformDirection(Bi).toVar("normalWorld"),Fa=re(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=Rt:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),a6=re(([n,e=_i])=>{const t=ur(e),r=n.div(Z(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(r).xyz}),y2=re(([n],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(n);const r=n6.mul(n);return Bi.transformDirection(r)}),eI=re(()=>(De('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Rt)).once(["NORMAL","VERTEX"])(),tI=re(()=>(De('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),na)).once(["NORMAL","VERTEX"])(),nI=re(()=>(De('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Fa)).once(["NORMAL","VERTEX"])(),ab=new wA,Yd=new dn,l6=Ve(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),L0=Ve(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),_2=Ve(new dn).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(ab.copy(t),Yd.makeRotationFromEuler(ab)):Yd.identity(),Yd}),u6=Yt.negate().reflect(Rt),A6=Yt.negate().refract(Rt,l6),c6=u6.transformDirection(Bi).toVar("reflectVector"),h6=A6.transformDirection(Bi).toVar("reflectVector"),f6=new Hg;class rI extends Ms{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,i=null){super(e,t,r,i),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===Q0?c6:e.mapping===X0?h6:(Be('CubeTextureNode: Mapping "%s" not supported.',e.mapping),Z(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return r.isDepthTexture===!0?e.renderer.coordinateSystem===Wo?Z(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===Wo||!r.isRenderTargetTexture)&&(t=Z(t.x.negate(),t.yz)),_2.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const b2=tt(rI).setParameterLength(1,4).setName("cubeTexture"),Mr=(n=f6,e=null,t=null,r=null)=>{let i;return n&&n.isCubeTextureNode===!0?(i=Pe(n.clone()),i.referenceNode=n,e!==null&&(i.uvNode=Pe(e)),t!==null&&(i.levelNode=Pe(t)),r!==null&&(i.biasNode=Pe(r))):i=b2(n,e,t,r),i},iI=(n=f6)=>b2(n);class sI extends Ya{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}}class Rf extends Ie{static get type(){return"ReferenceNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=ot.OBJECT}element(e){return new sI(this,Pe(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=ec(null,e,this.count):Array.isArray(this.getValueFromReference())?t=mr(null,e):e==="texture"?t=Ct(null):e==="cubeTexture"?t=Mr(null):t=Ve(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const zt=(n,e,t)=>new Rf(n,e,t),lg=(n,e,t,r)=>new Rf(n,e,r,t);class oI extends Rf{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const $s=(n,e,t=null)=>new oI(n,e,t),d6=Ht(),aI=Mn.dFdx(),lI=Mn.dFdy(),p6=d6.dFdx(),m6=d6.dFdy(),g6=Rt,y6=lI.cross(g6),_6=g6.cross(aI),ug=y6.mul(p6.x).add(_6.mul(m6.x)),Ag=y6.mul(p6.y).add(_6.mul(m6.y)),lb=ug.dot(ug).max(Ag.dot(Ag)),b6=lb.equal(0).select(0,lb.inverseSqrt()),uI=ug.mul(b6).toVar("tangentViewFrame"),AI=Ag.mul(b6).toVar("bitangentViewFrame"),Nf=Ao("tangent","vec4"),nc=Nf.xyz.toVar("tangentLocal"),Cf=re(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=ta.mul(je(nc,0)).xyz.toVarying("v_tangentView").normalize():r=uI,t.flatShading!==!0&&(r=du(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),v6=Cf.transformDirection(Bi).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),Mf=re(([n,e],{subBuildFn:t,material:r})=>{let i=n.mul(Nf.w).xyz;return t==="NORMAL"&&r.flatShading!==!0&&(i=i.toVarying(e)),i}).once(["NORMAL"]),cI=Mf(Ef.cross(Nf),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),hI=Mf(jr.cross(nc),"v_bitangentLocal").normalize().toVar("bitangentLocal"),x6=re(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Mf(Rt.cross(Cf),"v_bitangentView").normalize():r=AI,t.flatShading!==!0&&(r=du(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),fI=Mf(na.cross(v6),"v_bitangentWorld").normalize().toVar("bitangentWorld"),Ia=ur(Cf,x6,Rt).toVar("TBNViewMatrix"),T6=Yt.mul(Ia),dI=(n,e)=>n.sub(T6.mul(e)),w6=re(()=>{let n=Va.cross(Yt);return n=n.cross(Va).normalize(),n=Tt(n,Rt,Do.mul(ps.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()(),S6=n=>Pe(n).mul(.5).add(.5),pI=n=>Pe(n).mul(2).sub(1),cg=n=>Z(n,gr(Tf(z(1).sub(Ri(n,n)))));class mI extends bn{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Dd,this.unpackNormalMode=Ld}setup({material:e}){const{normalMapType:t,scaleNode:r,unpackNormalMode:i}=this;let s=this.node.mul(2).sub(1);if(t===Dd?i===Ux?s=cg(s.xy):i===LN?s=cg(s.yw):i!==Ld&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${i}`):i!==Ld&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${i}'`),r!==null){let a=r;e.flatShading===!0&&(a=du(a)),s=Z(s.xy.mul(a),s.z)}let o=null;return t===ON?o=y2(s):t===Dd?o=Ia.mul(s).normalize():(Be(`NodeMaterial: Unsupported normal map type: ${t}`),o=Rt),o}}const hg=tt(mI).setParameterLength(1,2),gI=re(({textureNode:n,bumpScale:e})=>{const t=i=>n.isolate().context({getUV:s=>i(s.uvNode||Ht()),forceUVContext:!0}),r=z(t(i=>i));return we(z(t(i=>i.add(i.dFdx()))).sub(r),z(t(i=>i.add(i.dFdy()))).sub(r)).mul(e)}),yI=re(n=>{const{surf_pos:e,surf_norm:t,dHdxy:r}=n,i=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),c=o.cross(i),f=i.dot(a).mul(g2),p=f.sign().mul(r.x.mul(a).add(r.y.mul(c)));return f.abs().mul(t).sub(p).normalize()});class _I extends bn{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=gI({textureNode:this.textureNode,bumpScale:e});return yI({surf_pos:Mn,surf_norm:Rt,dHdxy:t})}}const v2=tt(_I).setParameterLength(1,2),ub=new Map;class pe extends Ie{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=ub.get(e);return r===void 0&&(r=$s(e,t),ub.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let i=null;if(r===pe.COLOR){const s=t.color!==void 0?this.getColor(r):Z();t.map&&t.map.isTexture===!0?i=s.mul(this.getTexture("map")):i=s}else if(r===pe.OPACITY){const s=this.getFloat(r);t.alphaMap&&t.alphaMap.isTexture===!0?i=s.mul(this.getTexture("alpha")):i=s}else if(r===pe.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=z(1);else if(r===pe.SPECULAR_INTENSITY){const s=this.getFloat(r);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s}else if(r===pe.SPECULAR_COLOR){const s=this.getColor(r);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=s.mul(this.getTexture(r).rgb):i=s}else if(r===pe.ROUGHNESS){const s=this.getFloat(r);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).g):i=s}else if(r===pe.METALNESS){const s=this.getFloat(r);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=s.mul(this.getTexture(r).b):i=s}else if(r===pe.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(r).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(r)):i=o}else if(r===pe.NORMAL)t.normalMap?(i=hg(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType,(t.normalMap.format==Ws||t.normalMap.format==W0||t.normalMap.format==H0)&&(i.unpackNormalMode=Ux)):t.bumpMap?i=v2(this.getTexture("bump").r,this.getFloat("bumpScale")):i=Rt;else if(r===pe.CLEARCOAT){const s=this.getFloat(r);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===pe.CLEARCOAT_ROUGHNESS){const s=this.getFloat(r);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===pe.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=hg(this.getTexture(r),this.getCache(r+"Scale","vec2")):i=Rt;else if(r===pe.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=s.mul(this.getTexture("sheenColor").rgb):i=s}else if(r===pe.SHEEN_ROUGHNESS){const s=this.getFloat(r);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s,i=i.clamp(1e-4,1)}else if(r===pe.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(r);i=mf(Ml.x,Ml.y,Ml.y.negate(),Ml.x).mul(s.rg.mul(2).sub(we(1)).normalize().mul(s.b))}else i=Ml;else if(r===pe.IRIDESCENCE_THICKNESS){const s=zt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=zt("0","float",t.iridescenceThicknessRange);i=s.sub(o).mul(this.getTexture(r).g).add(o)}else i=s}else if(r===pe.TRANSMISSION){const s=this.getFloat(r);t.transmissionMap?i=s.mul(this.getTexture(r).r):i=s}else if(r===pe.THICKNESS){const s=this.getFloat(r);t.thicknessMap?i=s.mul(this.getTexture(r).g):i=s}else if(r===pe.IOR)i=this.getFloat(r);else if(r===pe.LIGHT_MAP)i=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===pe.AO)i=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===pe.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(r):z(0);else{const s=this.getNodeType(e);i=this.getCache(r,s)}return i}}pe.ALPHA_TEST="alphaTest";pe.COLOR="color";pe.OPACITY="opacity";pe.SHININESS="shininess";pe.SPECULAR="specular";pe.SPECULAR_STRENGTH="specularStrength";pe.SPECULAR_INTENSITY="specularIntensity";pe.SPECULAR_COLOR="specularColor";pe.REFLECTIVITY="reflectivity";pe.ROUGHNESS="roughness";pe.METALNESS="metalness";pe.NORMAL="normal";pe.CLEARCOAT="clearcoat";pe.CLEARCOAT_ROUGHNESS="clearcoatRoughness";pe.CLEARCOAT_NORMAL="clearcoatNormal";pe.EMISSIVE="emissive";pe.ROTATION="rotation";pe.SHEEN="sheen";pe.SHEEN_ROUGHNESS="sheenRoughness";pe.ANISOTROPY="anisotropy";pe.IRIDESCENCE="iridescence";pe.IRIDESCENCE_IOR="iridescenceIOR";pe.IRIDESCENCE_THICKNESS="iridescenceThickness";pe.IOR="ior";pe.TRANSMISSION="transmission";pe.THICKNESS="thickness";pe.ATTENUATION_DISTANCE="attenuationDistance";pe.ATTENUATION_COLOR="attenuationColor";pe.LINE_SCALE="scale";pe.LINE_DASH_SIZE="dashSize";pe.LINE_GAP_SIZE="gapSize";pe.LINE_WIDTH="linewidth";pe.LINE_DASH_OFFSET="dashOffset";pe.POINT_SIZE="size";pe.DISPERSION="dispersion";pe.LIGHT_MAP="light";pe.AO="ao";const E6=Me(pe,pe.ALPHA_TEST),R6=Me(pe,pe.COLOR),N6=Me(pe,pe.SHININESS),C6=Me(pe,pe.EMISSIVE),x2=Me(pe,pe.OPACITY),M6=Me(pe,pe.SPECULAR),fg=Me(pe,pe.SPECULAR_INTENSITY),P6=Me(pe,pe.SPECULAR_COLOR),gA=Me(pe,pe.SPECULAR_STRENGTH),O0=Me(pe,pe.REFLECTIVITY),B6=Me(pe,pe.ROUGHNESS),D6=Me(pe,pe.METALNESS),L6=Me(pe,pe.NORMAL),O6=Me(pe,pe.CLEARCOAT),F6=Me(pe,pe.CLEARCOAT_ROUGHNESS),I6=Me(pe,pe.CLEARCOAT_NORMAL),k6=Me(pe,pe.ROTATION),U6=Me(pe,pe.SHEEN),q6=Me(pe,pe.SHEEN_ROUGHNESS),G6=Me(pe,pe.ANISOTROPY),V6=Me(pe,pe.IRIDESCENCE),z6=Me(pe,pe.IRIDESCENCE_IOR),j6=Me(pe,pe.IRIDESCENCE_THICKNESS),$6=Me(pe,pe.TRANSMISSION),H6=Me(pe,pe.THICKNESS),W6=Me(pe,pe.IOR),Q6=Me(pe,pe.ATTENUATION_DISTANCE),X6=Me(pe,pe.ATTENUATION_COLOR),Y6=Me(pe,pe.LINE_SCALE),K6=Me(pe,pe.LINE_DASH_SIZE),Z6=Me(pe,pe.LINE_GAP_SIZE),bI=Me(pe,pe.LINE_WIDTH),J6=Me(pe,pe.LINE_DASH_OFFSET),ew=Me(pe,pe.POINT_SIZE),tw=Me(pe,pe.DISPERSION),T2=Me(pe,pe.LIGHT_MAP),nw=Me(pe,pe.AO),Ml=Ve(new _t).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),rw=re(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class vI extends Ya{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const r=this.storageBufferNode.structTypeNode;return r?r.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let r;const i=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?r=e.generatePBO(this):r=this.node.build(e):r=super.generate(e),i!==!0){const s=this.getNodeType(e);r=e.format(r,s,t)}return r}}const xI=tt(vI).setParameterLength(2);class TI extends f2{static get type(){return"StorageBufferNode"}constructor(e,t=null,r=0){let i,s=null;t&&t.isStruct?(i="struct",s=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(r=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(i=fT(e.itemSize),r=e.count):i=t,super(e,i,r),this.isStorageBufferNode=!0,this.structTypeNode=s,this.access=ar.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return xI(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(ar.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=u2(this.value),this._varying=Os(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:r}=this.getAttributeData(),i=r.build(e);return e.registerTransform(i,t),i}}const no=(n,e=null,t=0)=>new TI(n,e,t),wI=(n,e,t)=>(De('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),no(n,e,t).setPBO(!0));class ln extends Ie{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let i;if(r===ln.VERTEX)i=e.getVertexIndex();else if(r===ln.INSTANCE)i=e.getInstanceIndex();else if(r===ln.DRAW)i=e.getDrawIndex();else if(r===ln.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(r===ln.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(r===ln.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=i:s=Os(this).build(e,t),s}}ln.VERTEX="vertex";ln.INSTANCE="instance";ln.SUBGROUP="subgroup";ln.INVOCATION_LOCAL="invocationLocal";ln.INVOCATION_SUBGROUP="invocationSubgroup";ln.DRAW="draw";const iw=Me(ln,ln.VERTEX),Es=Me(ln,ln.INSTANCE),SI=Me(ln,ln.SUBGROUP),EI=Me(ln,ln.INVOCATION_SUBGROUP),RI=Me(ln,ln.INVOCATION_LOCAL),sw=Me(ln,ln.DRAW);class ow extends Ie{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=ot.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:r,isStorageMatrix:i,isStorageColor:s}=this,{count:o}=t;let{instanceMatrixNode:a,instanceColorNode:c}=this;if(a===null){if(i)a=no(t,"mat4",Math.max(o,1)).element(Es);else if(o<=1e3)a=ec(t.array,"mat4",Math.max(o,1)).element(Es);else{const p=new Y0(t.array,16,1);this.buffer=p;const g=t.usage===Ba?sg:Uh,b=[g(p,"vec4",16,0),g(p,"vec4",16,4),g(p,"vec4",16,8),g(p,"vec4",16,12)];a=Ho(...b)}this.instanceMatrixNode=a}if(r&&c===null){if(s)c=no(r,"vec3",Math.max(r.count,1)).element(Es);else{const p=new Vo(r.array,3),g=r.usage===Ba?sg:Uh;this.bufferColor=p,c=Z(g(p,"vec3",3,0))}this.instanceColorNode=c}const f=a.mul(pn).xyz;if(pn.assign(f),e.hasGeometryAttribute("normal")){const p=a6(jr,a);jr.assign(p)}this.instanceColorNode!==null&&kA("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Ba&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Ba&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const NI=tt(ow).setParameterLength(2,3);class CI extends ow{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:i}=e;super(t,r,i),this.instancedMesh=e}}const aw=tt(CI).setParameterLength(1);class MI extends Ie{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Es:this.batchingIdNode=sw);const r=re(([T])=>{const S=X(Js(wn(this.batchMesh._indirectTexture),0).x).toConst(),E=X(T).mod(S).toConst(),C=X(T).div(S).toConst();return wn(this.batchMesh._indirectTexture,In(E,C)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(X(this.batchingIdNode)),i=this.batchMesh._matricesTexture,s=X(Js(wn(i),0).x).toConst(),o=z(r).mul(4).toInt().toConst(),a=o.mod(s).toConst(),c=o.div(s).toConst(),f=Ho(wn(i,In(a,c)),wn(i,In(a.add(1),c)),wn(i,In(a.add(2),c)),wn(i,In(a.add(3),c))),p=this.batchMesh._colorsTexture;if(p!==null){const S=re(([E])=>{const C=X(Js(wn(p),0).x).toConst(),P=E,D=P.mod(C).toConst(),L=P.div(C).toConst();return wn(p,In(D,L)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(r);kA("vec3","vBatchColor").assign(S)}const g=ur(f);pn.assign(f.mul(pn));const b=jr.div(Z(g[0].dot(g[0]),g[1].dot(g[1]),g[2].dot(g[2]))),x=g.mul(b).xyz;jr.assign(x),e.hasGeometryAttribute("tangent")&&nc.mulAssign(g)}}const lw=tt(MI).setParameterLength(1),Ab=new WeakMap;class uw extends Ie{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=ot.OBJECT,this.skinIndexNode=Ao("skinIndex","uvec4"),this.skinWeightNode=Ao("skinWeight","vec4"),this.bindMatrixNode=zt("bindMatrix","mat4"),this.bindMatrixInverseNode=zt("bindMatrixInverse","mat4"),this.boneMatricesNode=lg("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=pn,this.toPositionNode=pn,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),f=e.element(r.z),p=e.element(r.w),g=s.mul(t),b=Ln(a.mul(i.x).mul(g),c.mul(i.y).mul(g),f.mul(i.z).mul(g),p.mul(i.w).mul(g));return o.mul(b).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=jr){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),f=e.element(r.z),p=e.element(r.w);let g=Ln(i.x.mul(a),i.y.mul(c),i.z.mul(f),i.w.mul(p));return g=o.mul(g).mul(s),g.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=lg("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,qh)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||pT(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&qh.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const r=this.getSkinnedNormal();jr.assign(r),e.hasGeometryAttribute("tangent")&&nc.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Ab.get(t)!==e.frameId&&(Ab.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const Aw=n=>new uw(n),PI=(n,e=null)=>{const t=new uw(n);return t.positionNode=no(new Vo(n.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(Es).toVar(),t.skinIndexNode=no(new Vo(new Uint32Array(n.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(Es).toVar(),t.skinWeightNode=no(new Vo(n.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(Es).toVar(),t.bindMatrixNode=Ve(n.bindMatrix,"mat4"),t.bindMatrixInverseNode=Ve(n.bindMatrixInverse,"mat4"),t.boneMatricesNode=ec(n.skeleton.boneMatrices,"mat4",n.skeleton.bones.length),t.toPositionNode=e,Pe(t)};class BI extends Ie{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const r={};for(let a=0,c=this.params.length-1;a<c;a++){const f=this.params[a],p=f.isNode!==!0&&f.name||this.getVarName(a),g=f.isNode!==!0&&f.type||"int";r[p]=uo(p,g)}const i=e.addStack(),s=this.params[this.params.length-1](r);t.returnsNode=s.context({nodeLoop:s}),t.stackNode=i;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const a=re(this.params[0].update)(r);t.updateNode=a.context({nodeLoop:a})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),r=this.params,i=t.stackNode;for(let o=0,a=r.length-1;o<a;o++){const c=r[o];let f=!1,p=null,g=null,b=null,x=null,T=null,S=null;c.isNode?c.getNodeType(e)==="bool"?(f=!0,x="bool",g=c.build(e,x)):(x="int",b=this.getVarName(o),p="0",g=c.build(e,x),T="<"):(x=c.type||"int",b=c.name||this.getVarName(o),p=c.start,g=c.end,T=c.condition,S=c.update,typeof p=="number"?p=e.generateConst(x,p):p&&p.isNode&&(p=p.build(e,x)),typeof g=="number"?g=e.generateConst(x,g):g&&g.isNode&&(g=g.build(e,x)),p!==void 0&&g===void 0?(p=p+" - 1",g="0",T=">="):g!==void 0&&p===void 0&&(p="0",T="<"),T===void 0&&(Number(p)>Number(g)?T=">=":T="<"));let E;if(f)E=`while ( ${g} )`;else{const C={start:p,end:g},P=C.start,D=C.end;let L;const k=()=>T.includes("<")?"+=":"-=";if(S!=null)switch(typeof S){case"function":L=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":L=b+" "+k()+" "+e.generateConst(x,S);break;case"string":L=b+" "+S;break;default:S.isNode?L=b+" "+k()+" "+S.build(e):(Be("TSL: 'Loop( { update: ... } )' is not a function, string or number."),L="break /* invalid update */")}else x==="int"||x==="uint"?S=T.includes("<")?"++":"--":S=k()+" 1.",L=b+" "+S;const q=e.getVar(x,b)+" = "+P,I=b+" "+T+" "+D;E=`for ( ${q}; ${I}; ${L} )`}e.addFlowCode((o===0?`
`:"")+e.tab+E+` {

`).addFlowTab()}const s=i.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,a=this.params.length-1;o<a;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const qt=(...n)=>new BI(Ga(n,"int")).toStack(),DI=()=>uo("continue").toStack(),cw=()=>uo("break").toStack(),Kd=new WeakMap,Xr=new $t,cb=re(({bufferMap:n,influence:e,stride:t,width:r,depth:i,offset:s})=>{const o=X(iw).mul(t).add(s),a=o.div(r),c=o.sub(a.mul(r));return wn(n,In(c,a)).depth(i).xyz.mul(e)});function LI(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,r=n.morphAttributes.color!==void 0,i=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=i!==void 0?i.length:0;let o=Kd.get(n);if(o===void 0||o.count!==s){let C=function(){S.dispose(),Kd.delete(n),n.removeEventListener("dispose",C)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],f=n.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),r===!0&&(p=3);let g=n.attributes.position.count*p,b=1;const x=4096;g>x&&(b=Math.ceil(g/x),g=x);const T=new Float32Array(g*b*4*s),S=new FN(T,g,b,s);S.type=gi,S.needsUpdate=!0;const E=p*4;for(let P=0;P<s;P++){const D=a[P],L=c[P],k=f[P],q=g*b*4*P;for(let I=0;I<D.count;I++){const U=I*E;e===!0&&(Xr.fromBufferAttribute(D,I),T[q+U+0]=Xr.x,T[q+U+1]=Xr.y,T[q+U+2]=Xr.z,T[q+U+3]=0),t===!0&&(Xr.fromBufferAttribute(L,I),T[q+U+4]=Xr.x,T[q+U+5]=Xr.y,T[q+U+6]=Xr.z,T[q+U+7]=0),r===!0&&(Xr.fromBufferAttribute(k,I),T[q+U+8]=Xr.x,T[q+U+9]=Xr.y,T[q+U+10]=Xr.z,T[q+U+11]=k.itemSize===4?Xr.w:1)}}o={count:s,texture:S,stride:p,size:new _t(g,b)},Kd.set(n,o),n.addEventListener("dispose",C)}return o}class OI extends Ie{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Ve(1),this.updateType=ot.OBJECT}setup(e){const{geometry:t}=e,r=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:c,size:f}=LI(t);r===!0&&pn.mulAssign(this.morphBaseInfluence),i===!0&&jr.mulAssign(this.morphBaseInfluence);const p=X(f.width);qt(o,({i:g})=>{const b=z(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?b.assign(wn(this.mesh.morphTexture,In(X(g).add(1),X(Es))).r):b.assign(zt("morphTargetInfluences","float").element(g).toVar()),ze(b.notEqual(0),()=>{r===!0&&pn.addAssign(cb({bufferMap:a,influence:b,stride:c,width:p,depth:g,offset:X(0)})),i===!0&&jr.addAssign(cb({bufferMap:a,influence:b,stride:c,width:p,depth:g,offset:X(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,r)=>t+r,0)}}const hw=tt(OI).setParameterLength(1);class pu extends Ie{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class FI extends pu{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class II extends w8{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,i=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r=Z().toVar("directDiffuse"),i=Z().toVar("directSpecular"),s=Z().toVar("indirectDiffuse"),o=Z().toVar("indirectSpecular"),a={directDiffuse:r,directSpecular:i,indirectDiffuse:s,indirectSpecular:o};return{radiance:Z().toVar("radiance"),irradiance:Z().toVar("irradiance"),iblIrradiance:Z().toVar("iblIrradiance"),ambientOcclusion:z(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const fw=tt(II);class kI extends pu{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const yl=new _t;class Pf extends Ms{static get type(){return"ViewportTextureNode"}constructor(e=eo,t=null,r=null){let i=null;r===null?(i=new Vg,i.minFilter=Ua,r=i):i=r,super(r,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=i,this.isOutputTextureNode=!0,this.updateBeforeType=ot.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,r;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,r=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,r=this._cacheTextures),e===null)return t;if(r.has(e)===!1){const i=t.clone();r.set(e,i)}return r.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,r=t.getRenderTarget();r===null?t.getDrawingBufferSize(yl):yl.set(r.width,r.height);const i=this.getTextureForReference(r);(i.image.width!==yl.width||i.image.height!==yl.height)&&(i.image.width=yl.width,i.image.height=yl.height,i.needsUpdate=!0);const s=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const UI=tt(Pf).setParameterLength(0,3),w2=tt(Pf,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Fc=null;class qI extends Pf{static get type(){return"ViewportDepthTextureNode"}constructor(e=eo,t=null){Fc===null&&(Fc=new Wi),super(e,t,Fc)}getTextureForReference(){return Fc}}const S2=tt(qI).setParameterLength(0,2);class Ur extends Ie{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Ur.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let i=null;if(t===Ur.DEPTH_BASE)r!==null&&(i=pw().assign(r));else if(t===Ur.DEPTH)e.isPerspectiveCamera?i=dw(Mn.z,Fo,Io):i=Wl(Mn.z,Fo,Io);else if(t===Ur.LINEAR_DEPTH)if(r!==null)if(e.isPerspectiveCamera){const s=E2(r,Fo,Io);i=Wl(s,Fo,Io)}else i=r;else i=Wl(Mn.z,Fo,Io);return i}}Ur.DEPTH_BASE="depthBase";Ur.DEPTH="depth";Ur.LINEAR_DEPTH="linearDepth";const Wl=(n,e,t)=>n.add(e).div(e.sub(t)),GI=(n,e,t)=>e.sub(t).mul(n).sub(e),dw=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),E2=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),R2=(n,e,t)=>{e=e.max(1e-6).toVar();const r=xs(n.negate().div(e)),i=xs(t.div(e));return r.div(i)},VI=(n,e,t)=>{const r=n.mul(_f(t.div(e)));return z(Math.E).pow(r).mul(e).negate()},pw=tt(Ur,Ur.DEPTH_BASE),N2=Me(Ur,Ur.DEPTH),Gh=tt(Ur,Ur.LINEAR_DEPTH).setParameterLength(0,1),zI=Gh(S2());N2.assign=n=>pw(n);class Ti extends Ie{static get type(){return"ClippingNode"}constructor(e=Ti.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Ti.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,i):this.scope===Ti.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(r,i)}setupAlphaToCoverage(e,t){return re(()=>{const r=z().toVar("distanceToPlane"),i=z().toVar("distanceToGradient"),s=z(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=mr(t).setGroup(Ge);qt(o,({i:f})=>{const p=c.element(f);r.assign(Mn.dot(p.xyz).negate().add(p.w)),i.assign(r.fwidth().div(2)),s.mulAssign(Zi(i.negate(),i,r))})}const a=e.length;if(a>0){const c=mr(e).setGroup(Ge),f=z(1).toVar("intersectionClipOpacity");qt(a,({i:p})=>{const g=c.element(p);r.assign(Mn.dot(g.xyz).negate().add(g.w)),i.assign(r.fwidth().div(2)),f.mulAssign(Zi(i.negate(),i,r).oneMinus())}),s.mulAssign(f.oneMinus())}kt.a.mulAssign(s),kt.a.equal(0).discard()})()}setupDefault(e,t){return re(()=>{const r=t.length;if(this.hardwareClipping===!1&&r>0){const s=mr(t).setGroup(Ge);qt(r,({i:o})=>{const a=s.element(o);Mn.dot(a.xyz).greaterThan(a.w).discard()})}const i=e.length;if(i>0){const s=mr(e).setGroup(Ge),o=Ei(!0).toVar("clipped");qt(i,({i:a})=>{const c=s.element(a);o.assign(Mn.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),re(()=>{const i=mr(e).setGroup(Ge),s=fo(t.getClipDistance());qt(r,({i:o})=>{const a=i.element(o),c=Mn.dot(a.xyz).sub(a.w).negate();s.element(o).assign(c)})})()}}Ti.ALPHA_TO_COVERAGE="alphaToCoverage";Ti.DEFAULT="default";Ti.HARDWARE="hardware";const jI=()=>new Ti,$I=()=>new Ti(Ti.ALPHA_TO_COVERAGE),HI=()=>new Ti(Ti.HARDWARE),WI=.05,hb=re(([n])=>Yi(et(1e4,Cr(et(17,n.x).add(et(.1,n.y)))).mul(Ln(.1,en(Cr(et(13,n.y).add(n.x))))))),fb=re(([n])=>hb(we(hb(n.xy),n.z))),QI=re(([n])=>{const e=_n(ws(Y1(n.xyz)),ws(K1(n.xyz))),t=z(1).div(z(WI).mul(e)).toVar("pixScale"),r=we(ou(Ts(xs(t))),ou(bf(xs(t)))),i=we(fb(Ts(r.x.mul(n.xyz))),fb(Ts(r.y.mul(n.xyz)))),s=Yi(xs(t)),o=Ln(et(s.oneMinus(),i.x),et(s,i.y)),a=zr(s,s.oneMinus()),c=Z(o.mul(o).div(et(2,a).mul(St(1,a))),o.sub(et(.5,a)).div(St(1,a)),St(1,St(1,o).mul(St(1,o)).div(et(2,a).mul(St(1,a))))),f=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return Ki(f,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class XI extends K8{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),r=e.hasGeometryAttribute(t);let i;return r===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new $t(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const mw=(n=0)=>new XI(n),gw=re(([n,e])=>zr(1,n.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),yw=re(([n,e])=>zr(n.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),_w=re(([n,e])=>n.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),bw=re(([n,e])=>Tt(n.mul(2).mul(e),n.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),xf(.5,n))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),YI=re(([n,e])=>{const t=e.a.add(n.a.mul(e.a.oneMinus()));return je(e.rgb.mul(e.a).add(n.rgb.mul(n.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),vw=re(([n])=>je(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"}),KI=re(([n])=>(ze(n.a.equal(0),()=>je(0)),je(n.rgb.div(n.a),n.a)),{color:"vec4",return:"vec4"}),ZI=(...n)=>(De('TSL: "burn" has been renamed. Use "blendBurn" instead.'),gw(n)),JI=(...n)=>(De('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),yw(n)),ek=(...n)=>(De('TSL: "screen" has been renamed. Use "blendScreen" instead.'),_w(n)),tk=(...n)=>(De('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),bw(n));class Rn extends p_{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{De('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const r=this[t];r&&r.isNode===!0&&e.push({property:t,childNode:r})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:r}of this._getNodeChildren())e.push(KA(t.slice(0,-4)),r.getCacheKey());return this.type+fu(e)}build(e){this.setup(e)}setupObserver(e){return new vO(e)}setup(e){e.context.setupNormal=()=>$l(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Be('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Be('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const i=$l(this.setupVertex(e),"VERTEX"),s=this.vertexNode||i;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(r!==null?r.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);a!==null&&e.stack.addToStack(a);const f=je(c,kt.a).max(0);o=this.setupOutput(e,f),jl.assign(o);const p=this.outputNode!==null;if(p&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),r!==null){const g=t.getMRT(),b=this.mrtNode;g!==null?(p&&jl.assign(o),o=g,b!==null&&(o=g.merge(b))):b!==null&&(o=b)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=je(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let i=null;if(t.length>0||r.length>0){const s=e.renderer.currentSamples;this.alphaToCoverage&&s>1?i=$I():e.stack.addToStack(jI())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(HI()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let i=this.depthNode;if(i===null){const s=t.getMRT();s&&s.has("depth")?i=s.get("depth"):t.logarithmicDepthBuffer===!0&&(r.isPerspectiveCamera?i=R2(Mn.z,Fo,Io):i=Wl(Mn.z,Fo,Io))}i!==null&&N2.assign(i).toStack()}setupPositionView(){return ta.mul(pn).xyz}setupModelViewProjection(){return to.mul(Mn)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),rw}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&hw(t).toStack(),t.isSkinnedMesh===!0&&Aw(t).toStack(),this.displacementMap){const i=$s("displacementMap","texture"),s=$s("displacementScale","float"),o=$s("displacementBias","float");pn.addAssign(jr.normalize().mul(i.x.mul(s).add(o)))}return t.isBatchedMesh&&lw(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&aw(t).toStack(),this.positionNode!==null&&pn.assign($l(this.positionNode,"POSITION","vec3")),pn}setupDiffuseColor(e){const{object:t,geometry:r}=e;this.maskNode!==null&&Ei(this.maskNode).not().discard();let i=this.colorNode?je(this.colorNode):R6;this.vertexColors===!0&&r.hasAttribute("color")&&(i=i.mul(mw())),t.instanceColor&&(i=kA("vec3","vInstanceColor").mul(i)),t.isBatchedMesh&&t._colorsTexture&&(i=kA("vec3","vBatchColor").mul(i)),kt.assign(i);const s=this.opacityNode?z(this.opacityNode):x2;kt.a.assign(kt.a.mul(s));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?z(this.alphaTestNode):E6,this.alphaToCoverage===!0?(kt.a=Zi(o,o.add(J1(kt.a)),kt.a),kt.a.lessThanEqual(0).discard()):kt.a.lessThanEqual(o).discard()),this.alphaHash===!0&&kt.a.lessThan(QI(pn)).discard(),e.isOpaque()&&kt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Z(0):kt.rgb}setupNormal(){return this.normalNode?Z(this.normalNode):L6}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?$s("envMap","cubeTexture"):$s("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new kI(T2)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const i=this.setupLightMap(e);i&&i.isLightingNode&&t.push(i);let s=this.aoNode;s===null&&e.material.aoMap&&(s=nw),e.context.getAO&&(s=e.context.getAO(s,e)),s&&t.push(new FI(s));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:i,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const f=this.setupLightingModel(e)||null;c=fw(a,f,r,i)}else r!==null&&(c=Z(i!==null?Tt(c,r,i):r));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(rg.assign(Z(s||C6)),c=c.add(rg)),c}setupFog(e,t){const r=e.fogNode;return r&&(jl.assign(t),t=je(r.toVar())),t}setupPremultipliedAlpha(e,t){return vw(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const r in e){const i=e[r];this[r]===void 0&&(this[r]=i,i&&i.clone&&(this[r]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&t[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const r=p_.prototype.toJSON.call(this,e);r.inputNodes={};for(const{property:s,childNode:o}of this._getNodeChildren())r.inputNodes[s]=o.toJSON(e).uuid;function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images),a=i(e.nodes);s.length>0&&(r.textures=s),o.length>0&&(r.images=o),a.length>0&&(r.nodes=a)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const nk=new of;class rk extends Rn{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(nk),this.setValues(e)}}const ik=new eN;class sk extends Rn{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(ik),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?z(this.offsetNode):J6,t=this.dashScaleNode?z(this.dashScaleNode):Y6,r=this.dashSizeNode?z(this.dashSizeNode):K6,i=this.gapSizeNode?z(this.gapSizeNode):Z6;P0.assign(r),ig.assign(i);const s=Os(Ao("lineDistance").mul(t));(e?s.add(e):s).mod(P0.add(ig)).greaterThan(P0).discard()}}let Ic=null;class ok extends Pf{static get type(){return"ViewportSharedTextureNode"}constructor(e=eo,t=null){Ic===null&&(Ic=new Vg),super(e,t,Ic)}getTextureForReference(){return Ic}updateReference(){return this}}const ak=tt(ok).setParameterLength(0,2),lk=new ZR;class uk extends Rn{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(lk),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?z(this.opacityNode):x2;kt.assign(wf(je(S6(Rt),e),HA))}}const C2=re(([n=m2])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return we(e,t)});class xw extends BN{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new e1(5,5,5),o=C2(m2),a=new Rn;a.colorNode=Ct(t,o,0),a.side=yr,a.blending=Yl;const c=new gn(s,a),f=new Jh;f.add(c),t.minFilter===Ua&&(t.minFilter=Xi);const p=new DN(1,10,this),g=e.getMRT();return e.setMRT(null),p.update(e,f),e.setMRT(g),t.minFilter=r,t.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const yA=new WeakMap;class Ak extends bn{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Mr(null);const t=new Hg;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=ot.RENDER}updateBefore(e){const{renderer:t,material:r}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const s=i.isTextureNode?i.value:r[i.property];if(s&&s.isTexture){const o=s.mapping;if(o===jg||o===$g){if(yA.has(s)){const a=yA.get(s);db(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(ck(a)){const c=new xw(a.height);c.fromEquirectangularTexture(t,s),db(c.texture,s.mapping),this._cubeTexture=c.texture,yA.set(s,c.texture),s.addEventListener("dispose",Tw)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function ck(n){return n==null?!1:n.height>0}function Tw(n){const e=n.target;e.removeEventListener("dispose",Tw);const t=yA.get(e);t!==void 0&&(yA.delete(e),t.dispose())}function db(n,e){e===jg?n.mapping=Q0:e===$g&&(n.mapping=X0)}const ww=tt(Ak).setParameterLength(1);class M2 extends pu{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=ww(this.envNode)}}class hk extends pu{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=z(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Bf{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class Sw extends Bf{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,i=e.irradianceLightMap;r.indirectDiffuse.assign(je(0)),i?r.indirectDiffuse.addAssign(i):r.indirectDiffuse.addAssign(je(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(kt.rgb)}finish(e){const{material:t,context:r}=e,i=r.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case NN:i.rgb.assign(Tt(i.rgb,i.rgb.mul(s.rgb),gA.mul(O0)));break;case RN:i.rgb.assign(Tt(i.rgb,s.rgb,gA.mul(O0)));break;case EN:i.rgb.addAssign(s.rgb.mul(gA.mul(O0)));break;default:De("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const fk=new ds;class dk extends Rn{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(fk),this.setValues(e)}setupNormal(){return du(au)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new M2(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new hk(T2)),t}setupOutgoingLight(){return kt.rgb}setupLightingModel(){return new Sw}}const lu=re(({f0:n,f90:e,dotVH:t})=>{const r=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(r.oneMinus()).add(e.mul(r))}),Qa=re(n=>n.diffuseColor.mul(1/Math.PI)),pk=()=>z(.25),mk=re(({dotNH:n})=>Fh.mul(z(.5)).add(1).mul(z(1/Math.PI)).mul(n.pow(Fh))),gk=re(({lightDirection:n})=>{const e=n.add(Yt).normalize(),t=Rt.dot(e).clamp(),r=Yt.dot(e).clamp(),i=lu({f0:Yo,f90:1,dotVH:r}),s=pk(),o=mk({dotNH:t});return i.mul(s).mul(o)});class Ew extends Sw{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=Rt.dot(e).clamp().mul(t);r.directDiffuse.addAssign(s.mul(Qa({diffuseColor:kt.rgb}))),this.specular===!0&&r.directSpecular.addAssign(s.mul(gk({lightDirection:e})).mul(gA))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul(Qa({diffuseColor:kt}))),i.indirectDiffuse.mulAssign(t)}}const yk=new co;class _k extends Rn{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(yk),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new M2(t):null}setupLightingModel(){return new Ew(!1)}}const bk=new Ox;class vk extends Rn{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(bk),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new M2(t):null}setupLightingModel(){return new Ew}setupVariants(){const e=(this.shininessNode?z(this.shininessNode):N6).max(1e-4);Fh.assign(e);const t=this.specularNode||M6;Yo.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const Rw=re(n=>{if(n.geometry.hasAttribute("normal")===!1)return z(0);const e=au.dFdx().abs().max(au.dFdy().abs());return e.x.max(e.y).max(e.z)}),P2=re(n=>{const{roughness:e}=n,t=Rw();let r=e.max(.0525);return r=r.add(t),r=r.min(1),r}),Nw=re(({alpha:n,dotNL:e,dotNV:t})=>{const r=n.pow2(),i=e.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return oi(.5,i.add(s).max(j1))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),xk=re(({alphaT:n,alphaB:e,dotTV:t,dotBV:r,dotTL:i,dotBL:s,dotNV:o,dotNL:a})=>{const c=a.mul(Z(n.mul(t),e.mul(r),o).length()),f=o.mul(Z(n.mul(i),e.mul(s),a).length());return oi(.5,c.add(f))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Cw=re(({alpha:n,dotNH:e})=>{const t=n.pow2(),r=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Tk=z(1/Math.PI),wk=re(({alphaT:n,alphaB:e,dotNH:t,dotTH:r,dotBH:i})=>{const s=n.mul(e),o=Z(e.mul(r),n.mul(i),s.mul(t)),a=o.dot(o),c=s.div(a);return Tk.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),B2=re(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,normalView:s=Rt,USE_IRIDESCENCE:o,USE_ANISOTROPY:a})=>{const c=r.pow2(),f=n.add(Yt).normalize(),p=s.dot(n).clamp(),g=s.dot(Yt).clamp(),b=s.dot(f).clamp(),x=Yt.dot(f).clamp();let T=lu({f0:e,f90:t,dotVH:x}),S,E;if(FA(o)&&(T=gf.mix(T,i)),FA(a)){const C=pA.dot(n),P=pA.dot(Yt),D=pA.dot(f),L=Va.dot(n),k=Va.dot(Yt),q=Va.dot(f);S=xk({alphaT:Oh,alphaB:c,dotTV:P,dotBV:k,dotTL:C,dotBL:L,dotNV:g,dotNL:p}),E=wk({alphaT:Oh,alphaB:c,dotNH:b,dotTH:D,dotBH:q})}else S=Nw({alpha:c,dotNL:p,dotNV:g}),E=Cw({alpha:c,dotNH:b});return T.mul(S).mul(E)}),Sk=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let os=null;const qA=re(({roughness:n,dotNV:e})=>{os===null&&(os=new Lx(Sk,16,16,Ws,or),os.name="DFG_LUT",os.minFilter=Xi,os.magFilter=Xi,os.wrapS=xA,os.wrapT=xA,os.generateMipmaps=!1,os.needsUpdate=!0);const t=we(n,e);return Ct(os,t).rg}),Ek=re(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o})=>{const a=B2({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o}),c=Rt.dot(n).clamp(),f=Rt.dot(Yt).clamp(),p=qA({roughness:r,dotNV:f}),g=qA({roughness:r,dotNV:c}),b=e.mul(p.x).add(t.mul(p.y)),x=e.mul(g.x).add(t.mul(g.y)),T=p.x.add(p.y),S=g.x.add(g.y),E=z(1).sub(T),C=z(1).sub(S),P=e.add(e.oneMinus().mul(.047619)),D=b.mul(x).mul(P).div(z(1).sub(E.mul(C).mul(P).mul(P)).add(j1)),L=E.mul(C),k=D.mul(L);return a.add(k)}),Mw=re(n=>{const{dotNV:e,specularColor:t,specularF90:r,roughness:i}=n,s=qA({dotNV:e,roughness:i});return t.mul(s.x).add(r.mul(s.y))}),dg=re(({f:n,f90:e,dotVH:t})=>{const r=t.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return n.sub(Z(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Rk=re(({roughness:n,dotNH:e})=>{const t=n.pow2(),r=z(1).div(t),s=e.pow2().oneMinus().max(.0078125);return z(2).add(r).mul(s.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Nk=re(({dotNV:n,dotNL:e})=>z(1).div(z(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Ck=re(({lightDirection:n})=>{const e=n.add(Yt).normalize(),t=Rt.dot(n).clamp(),r=Rt.dot(Yt).clamp(),i=Rt.dot(e).clamp(),s=Rk({roughness:Oo,dotNH:i}),o=Nk({dotNV:r,dotNL:t});return Kr.mul(s).mul(o)}),Mk=re(({N:n,V:e,roughness:t})=>{const s=.0078125,o=n.dot(e).saturate(),a=we(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Pk=re(({f:n})=>{const e=n.length();return _n(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),kc=re(({v1:n,v2:e})=>{const t=n.dot(e),r=t.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(s),a=t.greaterThan(0).select(o,_n(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),pb=re(({N:n,V:e,P:t,mInv:r,p0:i,p1:s,p2:o,p3:a})=>{const c=s.sub(i).toVar(),f=a.sub(i).toVar(),p=c.cross(f),g=Z().toVar();return ze(p.dot(t.sub(i)).greaterThanEqual(0),()=>{const b=e.sub(n.mul(e.dot(n))).normalize(),x=n.cross(b).negate(),T=r.mul(ur(b,x,n).transpose()).toVar(),S=T.mul(i.sub(t)).normalize().toVar(),E=T.mul(s.sub(t)).normalize().toVar(),C=T.mul(o.sub(t)).normalize().toVar(),P=T.mul(a.sub(t)).normalize().toVar(),D=Z(0).toVar();D.addAssign(kc({v1:S,v2:E})),D.addAssign(kc({v1:E,v2:C})),D.addAssign(kc({v1:C,v2:P})),D.addAssign(kc({v1:P,v2:S})),g.assign(Z(Pk({f:D})))}),g}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Df=1/6,Pw=n=>et(Df,et(n,et(n,n.negate().add(3)).sub(3)).add(1)),pg=n=>et(Df,et(n,et(n,et(3,n).sub(6))).add(4)),Bw=n=>et(Df,et(n,et(n,et(-3,n).add(3)).add(3)).add(1)),mg=n=>et(Df,yi(n,3)),mb=n=>Pw(n).add(pg(n)),gb=n=>Bw(n).add(mg(n)),yb=n=>Ln(-1,pg(n).div(Pw(n).add(pg(n)))),_b=n=>Ln(1,mg(n).div(Bw(n).add(mg(n)))),bb=(n,e,t)=>{const r=n.uvNode,i=et(r,e.zw).add(.5),s=Ts(i),o=Yi(i),a=mb(o.x),c=gb(o.x),f=yb(o.x),p=_b(o.x),g=yb(o.y),b=_b(o.y),x=we(s.x.add(f),s.y.add(g)).sub(.5).mul(e.xy),T=we(s.x.add(p),s.y.add(g)).sub(.5).mul(e.xy),S=we(s.x.add(f),s.y.add(b)).sub(.5).mul(e.xy),E=we(s.x.add(p),s.y.add(b)).sub(.5).mul(e.xy),C=mb(o.y).mul(Ln(a.mul(n.sample(x).level(t)),c.mul(n.sample(T).level(t)))),P=gb(o.y).mul(Ln(a.mul(n.sample(S).level(t)),c.mul(n.sample(E).level(t))));return C.add(P)},D2=re(([n,e])=>{const t=we(n.size(X(e))),r=we(n.size(X(e.add(1)))),i=oi(1,t),s=oi(1,r),o=bb(n,je(i,t),Ts(e)),a=bb(n,je(s,r),bf(e));return Yi(e).mix(o,a)}),Bk=re(([n,e])=>{const t=e.mul(c2(n));return D2(n,t)}),vb=re(([n,e,t,r,i])=>{const s=Z(r2(e.negate(),Pr(n),oi(1,r))),o=Z(ws(i[0].xyz),ws(i[1].xyz),ws(i[2].xyz));return Pr(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Dk=re(([n,e])=>n.mul(Ki(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Lk=w2(),Ok=w2(),xb=re(([n,e,t],{material:r})=>{const s=(r.side===yr?Lk:Ok).sample(n),o=xs(Wa.x).mul(Dk(e,t));return D2(s,o)}),Tb=re(([n,e,t])=>(ze(t.notEqual(0),()=>{const r=_f(e).negate().div(t);return $1(r.negate().mul(n))}),Z(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Fk=re(([n,e,t,r,i,s,o,a,c,f,p,g,b,x,T])=>{let S,E;if(T){S=je().toVar(),E=Z().toVar();const k=p.sub(1).mul(T.mul(.025)),q=Z(p.sub(k),p,p.add(k));qt({start:0,end:3},({i:I})=>{const U=q.element(I),j=vb(n,e,g,U,a),J=o.add(j),Q=f.mul(c.mul(je(J,1))),K=we(Q.xy.div(Q.w)).toVar();K.addAssign(1),K.divAssign(2),K.assign(we(K.x,K.y.oneMinus()));const te=xb(K,t,U);S.element(I).assign(te.element(I)),S.a.addAssign(te.a),E.element(I).assign(r.element(I).mul(Tb(ws(j),b,x).element(I)))}),S.a.divAssign(3)}else{const k=vb(n,e,g,p,a),q=o.add(k),I=f.mul(c.mul(je(q,1))),U=we(I.xy.div(I.w)).toVar();U.addAssign(1),U.divAssign(2),U.assign(we(U.x,U.y.oneMinus())),S=xb(U,t,p),E=r.mul(Tb(ws(k),b,x))}const C=E.rgb.mul(S.rgb),P=n.dot(e).clamp(),D=Z(Mw({dotNV:P,specularColor:i,specularF90:s,roughness:t})),L=E.r.add(E.g,E.b).div(3);return je(D.oneMinus().mul(C),S.a.oneMinus().mul(L).oneMinus())}),Ik=ur(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),kk=n=>{const e=n.sqrt();return Z(1).add(e).div(Z(1).sub(e))},wb=(n,e)=>n.sub(e).div(n.add(e)).pow2(),Uk=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),r=Z(54856e-17,44201e-17,52481e-17),i=Z(1681e3,1795300,2208400),s=Z(43278e5,93046e5,66121e5),o=z(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=Z(a.x.add(o),a.y,a.z).div(10685e-11),Ik.mul(a)},Sb=re(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:r,baseF0:i})=>{const s=Tt(n,e,Zi(0,.03,r)),a=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();ze(a.lessThan(0),()=>Z(1));const c=a.sqrt(),f=wb(s,n),p=lu({f0:f,f90:1,dotVH:t}),g=p.oneMinus(),b=s.lessThan(n).select(Math.PI,0),x=z(Math.PI).sub(b),T=kk(i.clamp(0,.9999)),S=wb(T,s.toVec3()),E=lu({f0:S,f90:1,dotVH:c}),C=Z(T.x.lessThan(s).select(Math.PI,0),T.y.lessThan(s).select(Math.PI,0),T.z.lessThan(s).select(Math.PI,0)),P=s.mul(r,c,2),D=Z(x).add(C),L=p.mul(E).clamp(1e-5,.9999),k=L.sqrt(),q=g.pow2().mul(E).div(Z(1).sub(L)),U=p.add(q).toVar(),j=q.sub(g).toVar();return qt({start:1,end:2,condition:"<=",name:"m"},({m:J})=>{j.mulAssign(k);const Q=Uk(z(J).mul(P),z(J).mul(D)).mul(2);U.addAssign(j.mul(Q))}),U.max(Z(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Lu=re(({normal:n,viewDir:e,roughness:t})=>{const r=n.dot(e).saturate(),i=t.mul(t),s=t.add(.1).reciprocal(),o=z(-1.9362).add(t.mul(1.0678)).add(i.mul(.4573)).sub(s.mul(.8469)),a=z(-.6014).add(t.mul(.5538)).sub(i.mul(.467)).sub(s.mul(.1255));return o.mul(r).add(a).exp().saturate()}),Zd=Z(.04),Jd=z(1);class Dw extends Bf{constructor(e=!1,t=!1,r=!1,i=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=i,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Z().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Z().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Z().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Z().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Z().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=Rt.dot(Yt).clamp(),r=Sb({outsideIOR:z(1),eta2:Dh,cosTheta1:t,thinFilmThickness:Lh,baseF0:Yo}),i=Sb({outsideIOR:z(1),eta2:Dh,cosTheta1:t,thinFilmThickness:Lh,baseF0:kt.rgb});this.iridescenceFresnel=Tt(r,i,Qs),this.iridescenceF0Dielectric=dg({f:r,f90:1,dotVH:t}),this.iridescenceF0Metallic=dg({f:i,f90:1,dotVH:t}),this.iridescenceF0=Tt(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,Qs)}if(this.transmission===!0){const t=Ss,r=e6.sub(Ss).normalize(),i=na,s=e.context;s.backdrop=Fk(i,r,ps,Sa,Oa,zl,t,_i,Bi,to,mA,I1,U1,k1,this.dispersion?q1:null),s.backdropAlpha=Ih,kt.a.mulAssign(Tt(1,s.backdrop.a,Ih))}super.start(e)}computeMultiscattering(e,t,r,i,s=null){const o=Rt.dot(Yt).clamp(),a=qA({roughness:ps,dotNV:o}),c=s?gf.mix(i,s):i,f=c.mul(a.x).add(r.mul(a.y)),g=a.x.add(a.y).oneMinus(),b=c.add(c.oneMinus().mul(.047619)),x=f.mul(b).div(g.mul(b).oneMinus());e.addAssign(f),t.addAssign(x.mul(g))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=Rt.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(s.mul(Ck({lightDirection:e})));const o=Lu({normal:Rt,viewDir:Yt,roughness:Oo}),a=Lu({normal:Rt,viewDir:e,roughness:Oo}),c=Kr.r.max(Kr.g).max(Kr.b).mul(o.max(a)).oneMinus();s.mulAssign(c)}if(this.clearcoat===!0){const a=Fa.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(B2({lightDirection:e,f0:Zd,f90:Jd,roughness:UA,normalView:Fa})))}r.directDiffuse.addAssign(s.mul(Qa({diffuseColor:Sa}))),r.directSpecular.addAssign(s.mul(Ek({lightDirection:e,f0:Oa,f90:1,roughness:ps,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:i,reflectedLight:s,ltc_1:o,ltc_2:a}){const c=t.add(r).sub(i),f=t.sub(r).sub(i),p=t.sub(r).add(i),g=t.add(r).add(i),b=Rt,x=Yt,T=Mn.toVar(),S=Mk({N:b,V:x,roughness:ps}),E=o.sample(S).toVar(),C=a.sample(S).toVar(),P=ur(Z(E.x,0,E.y),Z(0,1,0),Z(E.z,0,E.w)).toVar(),D=Oa.mul(C.x).add(Oa.oneMinus().mul(C.y)).toVar();s.directSpecular.addAssign(e.mul(D).mul(pb({N:b,V:x,P:T,mInv:P,p0:c,p1:f,p2:p,p3:g}))),s.directDiffuse.addAssign(e.mul(Sa).mul(pb({N:b,V:x,P:T,mInv:ur(1,0,0,0,1,0,0,0,1),p0:c,p1:f,p2:p,p3:g})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context,i=t.mul(Qa({diffuseColor:Sa})).toVar();if(this.sheen===!0){const s=Lu({normal:Rt,viewDir:Yt,roughness:Oo}),o=Kr.r.max(Kr.g).max(Kr.b).mul(s).oneMinus();i.mulAssign(o)}r.indirectDiffuse.addAssign(i)}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(r.mul(Kr,Lu({normal:Rt,viewDir:Yt,roughness:Oo}))),this.clearcoat===!0){const E=Fa.dot(Yt).clamp(),C=Mw({dotNV:E,specularColor:Zd,specularF90:Jd,roughness:UA});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(C))}const s=Z().toVar("singleScatteringDielectric"),o=Z().toVar("multiScatteringDielectric"),a=Z().toVar("singleScatteringMetallic"),c=Z().toVar("multiScatteringMetallic");this.computeMultiscattering(s,o,zl,Yo,this.iridescenceF0Dielectric),this.computeMultiscattering(a,c,zl,kt.rgb,this.iridescenceF0Metallic);const f=Tt(s,a,Qs),p=Tt(o,c,Qs),g=s.add(o),b=Sa.mul(g.oneMinus()),x=r.mul(1/Math.PI),T=t.mul(f).add(p.mul(x)).toVar(),S=b.mul(x).toVar();if(this.sheen===!0){const E=Lu({normal:Rt,viewDir:Yt,roughness:Oo}),C=Kr.r.max(Kr.g).max(Kr.b).mul(E).oneMinus();T.mulAssign(C),S.mulAssign(C)}i.indirectSpecular.addAssign(T),i.indirectDiffuse.addAssign(S)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,s=Rt.dot(Yt).clamp().add(t),o=ps.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const r=Fa.dot(Yt).clamp(),i=lu({dotVH:r,f0:Zd,f90:Jd}),s=t.mul(Bh.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Bh));t.assign(s)}if(this.sheen===!0){const r=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(r)}}}const Eb=z(1),gg=z(-2),Uc=z(.8),ep=z(-1),qc=z(.4),tp=z(2),Gc=z(.305),np=z(3),Rb=z(.21),qk=z(4),Nb=z(4),Gk=z(16),Vk=re(([n])=>{const e=Z(en(n)).toVar(),t=z(-1).toVar();return ze(e.x.greaterThan(e.z),()=>{ze(e.x.greaterThan(e.y),()=>{t.assign(lr(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(lr(n.y.greaterThan(0),1,4))})}).Else(()=>{ze(e.z.greaterThan(e.y),()=>{t.assign(lr(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(lr(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),zk=re(([n,e])=>{const t=we().toVar();return ze(e.equal(0),()=>{t.assign(we(n.z,n.y).div(en(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(we(n.x.negate(),n.z.negate()).div(en(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(we(n.x.negate(),n.y).div(en(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(we(n.z.negate(),n.y).div(en(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(we(n.x.negate(),n.z).div(en(n.y)))}).Else(()=>{t.assign(we(n.x,n.y).div(en(n.z)))}),et(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),jk=re(([n])=>{const e=z(0).toVar();return ze(n.greaterThanEqual(Uc),()=>{e.assign(Eb.sub(n).mul(ep.sub(gg)).div(Eb.sub(Uc)).add(gg))}).ElseIf(n.greaterThanEqual(qc),()=>{e.assign(Uc.sub(n).mul(tp.sub(ep)).div(Uc.sub(qc)).add(ep))}).ElseIf(n.greaterThanEqual(Gc),()=>{e.assign(qc.sub(n).mul(np.sub(tp)).div(qc.sub(Gc)).add(tp))}).ElseIf(n.greaterThanEqual(Rb),()=>{e.assign(Gc.sub(n).mul(qk.sub(np)).div(Gc.sub(Rb)).add(np))}).Else(()=>{e.assign(z(-2).mul(xs(et(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),Lw=re(([n,e])=>{const t=n.toVar();t.assign(et(2,t).sub(1));const r=Z(t,1).toVar();return ze(e.equal(0),()=>{r.assign(r.zyx)}).ElseIf(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),Ow=re(([n,e,t,r,i,s])=>{const o=z(t),a=Z(e),c=Ki(jk(o),gg,s),f=Yi(c),p=Ts(c),g=Z(GA(n,a,p,r,i,s)).toVar();return ze(f.notEqual(0),()=>{const b=Z(GA(n,a,p.add(1),r,i,s)).toVar();g.assign(Tt(g,b,f))}),g}),GA=re(([n,e,t,r,i,s])=>{const o=z(t).toVar(),a=Z(e),c=z(Vk(a)).toVar(),f=z(_n(Nb.sub(o),0)).toVar();o.assign(_n(o,Nb));const p=z(ou(o)).toVar(),g=we(zk(a,c).mul(p.sub(2)).add(1)).toVar();return ze(c.greaterThan(2),()=>{g.y.addAssign(p),c.subAssign(3)}),g.x.addAssign(c.mul(p)),g.x.addAssign(f.mul(et(3,Gk))),g.y.addAssign(et(4,ou(s).sub(p))),g.x.mulAssign(r),g.y.mulAssign(i),n.sample(g).grad(we(),we())}),rp=re(({envMap:n,mipInt:e,outputDirection:t,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=Ui(r),f=t.mul(c).add(i.cross(t).mul(Cr(r))).add(i.mul(i.dot(t).mul(c.oneMinus())));return GA(n,f,e,s,o,a)}),Fw=re(({n,latitudinal:e,poleAxis:t,outputDirection:r,weights:i,samples:s,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g})=>{const b=Z(lr(e,t,lo(t,r))).toVar();ze(b.equal(Z(0)),()=>{b.assign(Z(r.z,0,r.x.negate()))}),b.assign(Pr(b));const x=Z().toVar();return x.addAssign(i.element(0).mul(rp({theta:0,axis:b,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g}))),qt({start:X(1),end:n},({i:T})=>{ze(T.greaterThanEqual(s),()=>{cw()});const S=z(o.mul(z(T))).toVar();x.addAssign(i.element(T).mul(rp({theta:S.mul(-1),axis:b,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g}))),x.addAssign(i.element(T).mul(rp({theta:S,axis:b,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g})))}),je(x,1)}),$k=re(([n])=>{const e=ye(n).toVar();return e.assign(e.shiftLeft(ye(16)).bitOr(e.shiftRight(ye(16)))),e.assign(e.bitAnd(ye(1431655765)).shiftLeft(ye(1)).bitOr(e.bitAnd(ye(2863311530)).shiftRight(ye(1)))),e.assign(e.bitAnd(ye(858993459)).shiftLeft(ye(2)).bitOr(e.bitAnd(ye(3435973836)).shiftRight(ye(2)))),e.assign(e.bitAnd(ye(252645135)).shiftLeft(ye(4)).bitOr(e.bitAnd(ye(4042322160)).shiftRight(ye(4)))),e.assign(e.bitAnd(ye(16711935)).shiftLeft(ye(8)).bitOr(e.bitAnd(ye(4278255360)).shiftRight(ye(8)))),z(e).mul(23283064365386963e-26)}),Hk=re(([n,e])=>we(z(n).div(z(e)),$k(n))),Wk=re(([n,e,t])=>{const r=Z(e).toVar(),i=z(t),s=i.mul(i).toVar(),o=Pr(Z(s.mul(r.x),s.mul(r.y),r.z)).toVar(),a=o.x.mul(o.x).add(o.y.mul(o.y)),c=lr(a.greaterThan(0),Z(o.y.negate(),o.x,0).div(gr(a)),Z(1,0,0)).toVar(),f=lo(o,c).toVar(),p=gr(n.x),g=et(2,3.14159265359).mul(n.y),b=p.mul(Ui(g)).toVar(),x=p.mul(Cr(g)).toVar(),T=et(.5,o.z.add(1));x.assign(T.oneMinus().mul(gr(b.mul(b).oneMinus())).add(T.mul(x)));const S=c.mul(b).add(f.mul(x)).add(o.mul(gr(_n(0,b.mul(b).add(x.mul(x)).oneMinus()))));return Pr(Z(s.mul(S.x),s.mul(S.y),_n(0,S.z)))}),Iw=re(({roughness:n,mipInt:e,envMap:t,N_immutable:r,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=Z(r).toVar(),f=Z(0).toVar(),p=z(0).toVar();return ze(n.lessThan(.001),()=>{f.assign(GA(t,c,e,s,o,a))}).Else(()=>{const g=lr(en(c.z).lessThan(.999),Z(0,0,1),Z(1,0,0)),b=Pr(lo(g,c)).toVar(),x=lo(c,b).toVar();qt({start:ye(0),end:i},({i:T})=>{const S=Hk(T,i),E=Wk(S,Z(0,0,1),n),C=Pr(b.mul(E.x).add(x.mul(E.y)).add(c.mul(E.z))),P=Pr(C.mul(Ri(c,C).mul(2)).sub(c)),D=_n(Ri(c,P),0);ze(D.greaterThan(0),()=>{const L=GA(t,P,e,s,o,a);f.addAssign(L.mul(D)),p.addAssign(D)})}),ze(p.greaterThan(0),()=>{f.assign(f.div(p))})}),je(f,1)}),Go=4,Cb=[.125,.215,.35,.446,.526,.582],Ea=20,Qk=512,Ou=new zg(-1,1,1,-1,0,1),Xk=new vA(90,1),Mb=new $n;let ip=null,sp=0,op=0;const Yk=new ge,Vh=new WeakMap,Kk=[3,1,5,0,4,2],ap=Lw(Ht(),Ao("faceIndex")).normalize(),Lf=Z(ap.x,ap.y,ap.z);class Zk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,i=100,s={}){const{size:o=256,position:a=Yk,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){De('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const p=c||this._allocateTarget();return s.renderTarget=p,this.fromSceneAsync(e,t,r,i,s),p}ip=this._renderer.getRenderTarget(),sp=this._renderer.getActiveCubeFace(),op=this._renderer.getActiveMipmapLevel();const f=c||this._allocateTarget();return f.depthBuffer=!0,this._init(f),this._sceneToCubeUV(e,r,i,f,a),t>0&&this._blur(f,0,0,t),this._applyPMREM(f),this._cleanup(f),f}async fromSceneAsync(e,t=0,r=.1,i=100,s={}){return fn('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,r,i,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){De('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return fn('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){De("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return fn('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Bb(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Db(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===Q0||e.mapping===X0?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(ip,sp,op),e.scissorTest=!1,_l(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),ip=this._renderer.getRenderTarget(),sp=this._renderer.getActiveCubeFace(),op=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return Pb(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Pb(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=Jk(t)),this._blurMaterial=eU(t,e.width,e.height),this._ggxMaterial=tU(t,e.width,e.height)}}async _compileMaterial(e){const t=new gn(new $r,e);await this._renderer.compile(t,Ou)}_sceneToCubeUV(e,t,r,i,s){const o=Xk;o.near=t,o.far=r;const a=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],f=this._renderer,p=f.autoClear;f.getClearColor(Mb),f.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new gn(new e1,new ds({name:"PMREM.Background",side:yr,depthWrite:!1,depthTest:!1})));const g=this._backgroundBox,b=g.material;let x=!1;const T=e.background;T?T.isColor&&(b.color.copy(T),e.background=null,x=!0):(b.color.copy(Mb),x=!0),f.setRenderTarget(i),f.clear(),x&&f.render(g,o);for(let S=0;S<6;S++){const E=S%3;E===0?(o.up.set(0,a[S],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[S],s.y,s.z)):E===1?(o.up.set(0,0,a[S]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[S],s.z)):(o.up.set(0,a[S],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[S]));const C=this._cubeSize;_l(i,E*C,S>2?C:0,C,C),f.render(e,o)}f.autoClear=p,e.background=T}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Q0||e.mapping===X0;i?this._cubemapMaterial===null&&(this._cubemapMaterial=Bb(e)):this._equirectMaterial===null&&(this._equirectMaterial=Db(e));const s=i?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;_l(t,0,0,3*a,2*a),r.setRenderTarget(t),r.render(o,Ou)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=r}_applyGGXFilter(e,t,r){const i=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[r];a.material=o;const c=Vh.get(o),f=r/(this._lodMeshes.length-1),p=t/(this._lodMeshes.length-1),g=Math.sqrt(f*f-p*p),b=0+f*1.25,x=g*b,{_lodMax:T}=this,S=this._sizeLods[r],E=3*S*(r>T-Go?r-T+Go:0),C=4*(this._cubeSize-S);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=x,c.mipInt.value=T-t,_l(s,E,C,3*S,2*S),i.setRenderTarget(s),i.render(a,Ou),s.texture.frame=(s.texture.frame||0)+1,c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=T-r,_l(e,E,C,3*S,2*S),i.setRenderTarget(e),i.render(a,Ou)}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,f=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Be("blur direction must be either latitudinal or longitudinal!");const p=3,g=this._lodMeshes[i];g.material=f;const b=Vh.get(f),x=this._sizeLods[r]-1,T=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Ea-1),S=s/T,E=isFinite(s)?1+Math.floor(p*S):Ea;E>Ea&&De(`sigmaRadians, ${s}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${Ea}`);const C=[];let P=0;for(let I=0;I<Ea;++I){const U=I/S,j=Math.exp(-U*U/2);C.push(j),I===0?P+=j:I<E&&(P+=2*j)}for(let I=0;I<C.length;I++)C[I]=C[I]/P;e.texture.frame=(e.texture.frame||0)+1,b.envMap.value=e.texture,b.samples.value=E,b.weights.array=C,b.latitudinal.value=o==="latitudinal"?1:0,a&&(b.poleAxis.value=a);const{_lodMax:D}=this;b.dTheta.value=T,b.mipInt.value=D-r;const L=this._sizeLods[i],k=3*L*(i>D-Go?i-D+Go:0),q=4*(this._cubeSize-L);_l(t,k,q,3*L,2*L),c.setRenderTarget(t),c.render(g,Ou)}}function Jk(n){const e=[],t=[],r=[];let i=n;const s=n-Go+1+Cb.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);e.push(a);let c=1/a;o>n-Go?c=Cb[o-n+Go-1]:o===0&&(c=0),t.push(c);const f=1/(a-2),p=-f,g=1+f,b=[p,p,g,p,g,g,p,p,g,g,p,g],x=6,T=6,S=3,E=2,C=1,P=new Float32Array(S*T*x),D=new Float32Array(E*T*x),L=new Float32Array(C*T*x);for(let q=0;q<x;q++){const I=q%3*2/3-1,U=q>2?0:-1,j=[I,U,0,I+2/3,U,0,I+2/3,U+1,0,I,U,0,I+2/3,U+1,0,I,U+1,0],J=Kk[q];P.set(j,S*T*J),D.set(b,E*T*J);const Q=[J,J,J,J,J,J];L.set(Q,C*T*J)}const k=new $r;k.setAttribute("position",new Hi(P,S)),k.setAttribute("uv",new Hi(D,E)),k.setAttribute("faceIndex",new Hi(L,C)),r.push(new gn(k,null)),i>Go&&i--}return{lodMeshes:r,sizeLods:e,sigmas:t}}function Pb(n,e){const t={magFilter:Xi,minFilter:Xi,generateMipmaps:!1,type:or,format:zi,colorSpace:qx},r=new Jo(n,e,t);return r.texture.mapping=Gp,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function _l(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function Of(n){const e=new Rn;return e.depthTest=!1,e.depthWrite=!1,e.blending=Yl,e.name=`PMREM_${n}`,e}function eU(n,e,t){const r=mr(new Array(Ea).fill(0)),i=Ve(new ge(0,1,0)),s=Ve(0),o=z(Ea),a=Ve(0),c=Ve(1),f=Ct(),p=Ve(0),g=z(1/e),b=z(1/t),x=z(n),T={n:o,latitudinal:a,weights:r,poleAxis:i,outputDirection:Lf,dTheta:s,samples:c,envMap:f,mipInt:p,CUBEUV_TEXEL_WIDTH:g,CUBEUV_TEXEL_HEIGHT:b,CUBEUV_MAX_MIP:x},S=Of("blur");return S.fragmentNode=Fw({...T,latitudinal:a.equal(1)}),Vh.set(S,T),S}function tU(n,e,t){const r=Ct(),i=Ve(0),s=Ve(0),o=z(1/e),a=z(1/t),c=z(n),f={envMap:r,roughness:i,mipInt:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c},p=Of("ggx");return p.fragmentNode=Iw({...f,N_immutable:Lf,GGX_SAMPLES:ye(Qk)}),Vh.set(p,f),p}function Bb(n){const e=Of("cubemap");return e.fragmentNode=Mr(n,Lf),e}function Db(n){const e=Of("equirect");return e.fragmentNode=Ct(n,C2(Lf),0),e}const Lb=new WeakMap;function nU(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function rU(n,e,t){const r=iU(e);let i=r.get(n);if((i!==void 0?i.pmremVersion:-1)!==n.pmremVersion){const o=n.image;if(n.isCubeTexture)if(oU(o))i=t.fromCubemap(n,i);else return null;else if(aU(o))i=t.fromEquirectangular(n,i);else return null;i.pmremVersion=n.pmremVersion,r.set(n,i)}return i.texture}function iU(n){let e=Lb.get(n);return e===void 0&&(e=new WeakMap,Lb.set(n,e)),e}class sU extends bn{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const i=new Wg;i.isRenderTargetTexture=!0,this._texture=Ct(i),this._width=Ve(0),this._height=Ve(0),this._maxMip=Ve(0),this.updateBeforeType=ot.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=nU(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,i=this._value;r!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=rU(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Zk(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=_2.mul(Z(t.x,t.y.negate(),t.z));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),Ow(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function oU(n){if(n==null)return!1;let e=0;const t=6;for(let r=0;r<t;r++)n[r]!==void 0&&e++;return e===t}function aU(n){return n==null?!1:n.height>0}const L2=tt(sU).setParameterLength(1,3),Ob=new WeakMap;class lU extends pu{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const g=r.isTextureNode?r.value:t[r.property];let b=Ob.get(g);b===void 0&&(b=L2(g),Ob.set(g,b)),r=b}const s=t.useAnisotropy===!0||t.anisotropy>0?w6:Rt,o=r.context(Fb(ps,s)).mul(L0),a=r.context(uU(na)).mul(Math.PI).mul(L0),c=Hl(o),f=Hl(a);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(f);const p=e.context.lightingModel.clearcoatRadiance;if(p){const g=r.context(Fb(UA,Fa)).mul(L0),b=Hl(g);p.addAssign(b)}}}const Fb=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Yt.negate().reflect(e),t=t2(n).mix(t,e).normalize(),t=t.transformDirection(Bi)),t),getTextureLevel:()=>n}},uU=n=>({getUV:()=>n,getTextureLevel:()=>z(1)}),AU=new XR;class kw extends Rn{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(AU),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new lU(t):null}setupLightingModel(){return new Dw}setupSpecular(){const e=Tt(Z(.04),kt.rgb,Qs);Yo.assign(Z(.04)),Oa.assign(e),zl.assign(1)}setupVariants(){const e=this.metalnessNode?z(this.metalnessNode):D6;Qs.assign(e);let t=this.roughnessNode?z(this.roughnessNode):B6;t=P2({roughness:t}),ps.assign(t),this.setupSpecular(),Sa.assign(kt.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const cU=new YR;class hU extends kw{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(cU),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?z(this.iorNode):W6;mA.assign(e),Yo.assign(zr(e2(mA.sub(1).div(mA.add(1))).mul(P6),Z(1)).mul(fg)),Oa.assign(Tt(Yo,kt.rgb,Qs)),zl.assign(Tt(fg,1,Qs))}setupLightingModel(){return new Dw(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?z(this.clearcoatNode):O6,r=this.clearcoatRoughnessNode?z(this.clearcoatRoughnessNode):F6;Bh.assign(t),UA.assign(P2({roughness:r}))}if(this.useSheen){const t=this.sheenNode?Z(this.sheenNode):U6,r=this.sheenRoughnessNode?z(this.sheenRoughnessNode):q6;Kr.assign(t),Oo.assign(r)}if(this.useIridescence){const t=this.iridescenceNode?z(this.iridescenceNode):V6,r=this.iridescenceIORNode?z(this.iridescenceIORNode):z6,i=this.iridescenceThicknessNode?z(this.iridescenceThicknessNode):j6;gf.assign(t),Dh.assign(r),Lh.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?we(this.anisotropyNode):G6).toVar();Do.assign(t.length()),ze(Do.equal(0),()=>{t.assign(we(1,0))}).Else(()=>{t.divAssign(we(Do)),Do.assign(Do.saturate())}),Oh.assign(Do.pow2().mix(ps.pow2(),1)),pA.assign(Ia[0].mul(t.x).add(Ia[1].mul(t.y))),Va.assign(Ia[1].mul(t.x).sub(Ia[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?z(this.transmissionNode):$6,r=this.thicknessNode?z(this.thicknessNode):H6,i=this.attenuationDistanceNode?z(this.attenuationDistanceNode):Q6,s=this.attenuationColorNode?Z(this.attenuationColorNode):X6;if(Ih.assign(t),I1.assign(r),k1.assign(i),U1.assign(s),this.useDispersion){const o=this.dispersionNode?z(this.dispersionNode):tw;q1.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Z(this.clearcoatNormalNode):I6}setup(e){e.context.setupClearcoatNormal=()=>$l(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const fU=re(({normal:n,lightDirection:e,builder:t})=>{const r=n.dot(e),i=we(r.mul(.5).add(.5),0);if(t.material.gradientMap){const s=$s("gradientMap","texture").context({getUV:()=>i});return Z(s.r)}else{const s=i.fwidth().mul(.5);return Tt(Z(.7),Z(1),Zi(z(.7).sub(s.x),z(.7).add(s.x),i.x))}});class dU extends Bf{direct({lightDirection:e,lightColor:t,reflectedLight:r},i){const s=fU({normal:Ef,lightDirection:e,builder:i}).mul(t);r.directDiffuse.addAssign(s.mul(Qa({diffuseColor:kt.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul(Qa({diffuseColor:kt}))),i.indirectDiffuse.mulAssign(t)}}const pU=new KR;class mU extends Rn{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(pU),this.setValues(e)}setupLightingModel(){return new dU}}const Uw=re(()=>{const n=Z(Yt.z,0,Yt.x.negate()).normalize(),e=Yt.cross(n);return we(n.dot(Rt),e.dot(Rt)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),gU=new JR;class yU extends Rn{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(gU),this.setValues(e)}setupVariants(e){const t=Uw;let r;e.material.matcap?r=$s("matcap","texture").context({getUV:()=>t}):r=Z(Tt(.2,.8,t.y)),kt.rgb.mulAssign(r.rgb)}}class _U extends bn{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return mf(s,o,o.negate(),s).mul(r)}else{const s=t,o=Ho(je(1,0,0,0),je(0,Ui(s.x),Cr(s.x).negate(),0),je(0,Cr(s.x),Ui(s.x),0),je(0,0,0,1)),a=Ho(je(Ui(s.y),0,Cr(s.y),0),je(0,1,0,0),je(Cr(s.y).negate(),0,Ui(s.y),0),je(0,0,0,1)),c=Ho(je(Ui(s.z),Cr(s.z).negate(),0,0),je(Cr(s.z),Ui(s.z),0,0),je(0,0,1,0),je(0,0,0,1));return o.mul(a).mul(c).mul(je(r,1)).xyz}}}const rc=tt(_U).setParameterLength(2),bU=new tN;class qw extends Rn{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(bU),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,{positionNode:i,rotationNode:s,scaleNode:o,sizeAttenuation:a}=this,c=ta.mul(Z(i||0));let f=we(_i[0].xyz.length(),_i[1].xyz.length());o!==null&&(f=f.mul(we(o))),r.isPerspectiveCamera&&a===!1&&(f=f.mul(c.z.negate()));let p=tc.xy;if(t.center&&t.center.isVector2===!0){const x=dF("center","vec2",t);p=p.sub(x.sub(.5))}p=p.mul(f);const g=z(s||k6),b=rc(p,g);return je(c.xy.add(b),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const vU=new Fx,xU=new _t;class TU extends qw{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(vU),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return ta.mul(Z(e||pn)).xyz}setupVertexSprite(e){const{material:t,camera:r}=e,{rotationNode:i,scaleNode:s,sizeNode:o,sizeAttenuation:a}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let f=o!==null?we(o):ew;f=f.mul(Z8),r.isPerspectiveCamera&&a===!0&&(f=f.mul(wU.div(Mn.z.negate()))),s&&s.isNode&&(f=f.mul(we(s)));let p=tc.xy;if(i&&i.isNode){const g=z(i);p=rc(p,g)}return p=p.mul(f),p=p.div(p2.div(2)),p=p.mul(c.w),c=c.add(je(p,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const wU=Ve(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(xU);this.value=.5*e.y});class SU extends Bf{constructor(){super(),this.shadowNode=z(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){kt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(kt.rgb)}}const EU=new nN;class RU extends Rn{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(EU),this.setValues(e)}setupLightingModel(){return new SU}}Zs("vec3");Zs("vec3");Zs("vec3");class NU{constructor(e,t,r){this.renderer=e,this.nodes=t,this.info=r,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,r),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Ji{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let r=this.weakMaps[t];return r===void 0&&(r=new WeakMap,this.weakMaps[t]=r),r}get(e){let t=this._getWeakMap(e);for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let r=this._getWeakMap(e);for(let i=0;i<e.length-1;i++){const s=e[i];r.has(s)===!1&&r.set(s,new WeakMap),r=r.get(s)}return r.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return!1;return t.delete(e[e.length-1])}}let CU=0;function MU(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptors(t);for(const i in r)if(r[i]!==void 0){const s=r[i];s&&typeof s.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class PU{constructor(e,t,r,i,s,o,a,c,f,p){this.id=CU++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=i,this.material=s,this.scene=o,this.camera=a,this.lightsNode=c,this.context=f,this.geometry=i.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=p,this.clippingContextCacheKey=p!==null?p.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],i=new Set,s={};for(const o of e){let a;if(o.node&&o.node.attribute?a=o.node.attribute:(a=t.getAttribute(o.name),s[o.name]=a.version),a===void 0)continue;r.push(a);const c=a.isInterleavedBufferAttribute?a.data:a;i.add(c)}return this.attributes=r,this.attributesId=s,this.vertexBuffers=Array.from(i.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:i,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null;let f=1;if(r.isInstancedBufferGeometry===!0?f=r.instanceCount:e.count!==void 0&&(f=Math.max(0,e.count)),f===0)return null;if(o.instanceCount=f,e.isBatchedMesh===!0)return o;let p=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(p=2);let g=s.start*p,b=(s.start+s.count)*p;i!==null&&(g=Math.max(g,i.start*p),b=Math.min(b,(i.start+i.count)*p));const x=r.attributes.position;let T=1/0;c?T=a.count:x!=null&&(T=x.count),g=Math.max(g,0),b=Math.min(b,T);const S=b-g;return S<0||S===1/0?null:(o.vertexCount=S,o.firstVertex=g,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const i=e.attributes[r];t+=r+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[r];t+="morph-"+r+",";for(let s=0,o=i.length;s<o;s++){const a=i[s];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:r}=this;let i=t.customProgramCacheKey();for(const s of MU(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=t[s];let a;if(o!==null){const c=typeof o;c==="number"?a=o!==0?"1":"0":c==="object"?(a="{",o.isTexture&&(a+=o.mapping,r.backend.isWebGPUBackend===!0&&(a+=o.magFilter,a+=o.minFilter,a+=o.wrapS,a+=o.wrapT,a+=o.wrapR)),a+="}"):a=String(o)}else a=String(o);i+=a+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(i+=e.uuid+","),i+=this.context.id+",",i+=e.receiveShadow+",",KA(i)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const r=this.geometry.getAttribute(t);if(r===void 0||e[t]!==r.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=fA(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=fA(e,1)),e=fA(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const pa=[];class BU{constructor(e,t,r,i,s,o){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=i,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,r,i,s,o,a,c){const f=this.getChainMap(c);pa[0]=e,pa[1]=t,pa[2]=o,pa[3]=s;let p=f.get(pa);return p===void 0?(p=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,i,s,o,a,c),f.set(pa,p)):(p.updateClipping(a),p.needsGeometryUpdate&&p.setGeometry(e.geometry),(p.version!==t.version||p.needsUpdate)&&(p.initialCacheKey!==p.getCacheKey()?(p.dispose(),p=this.get(e,t,r,i,s,o,a,c)):p.version=t.version)),pa.length=0,p}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Ji)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,i,s,o,a,c,f,p,g){const b=this.getChainMap(g),x=new PU(e,t,r,i,s,o,a,c,f,p);return x.onDispose=()=>{this.pipelines.delete(x),this.bindings.deleteForRender(x),this.nodes.delete(x),b.delete(x.getChainArray())},x}}class ra{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const bi={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},ko=16,DU=211,LU=212;class OU extends ra{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(r.version===void 0)t===bi.VERTEX?this.backend.createAttribute(e):t===bi.INDEX?this.backend.createIndexAttribute(e):t===bi.STORAGE?this.backend.createStorageAttribute(e):t===bi.INDIRECT&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(r.version<i.version||i.usage===Ba)&&(this.backend.updateAttribute(e),r.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Gw(n){return n.index!==null?n.index.version:n.attributes.position.version}function Ib(n){const e=[],t=n.index,r=n.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const c=s[o+0],f=s[o+1],p=s[o+2];e.push(c,f,f,p,p,c)}}else{const s=r.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const c=o+0,f=o+1,p=o+2;e.push(c,f,f,p,p,c)}}const i=new(oN(e)?iN:sN)(e,1);return i.version=Gw(n),i}class FU extends ra{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,r=this.get(t);r.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",i),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",i),this._geometryDisposeListeners.set(t,i)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,bi.STORAGE):this.updateAttribute(s,bi.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,bi.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,bi.INDIRECT)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:r}=e;let i=t.index;if(r.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=Ib(t),s.set(t,o)):o.version!==Gw(t)&&(this.attributes.delete(o),o=Ib(t),s.set(t,o)),i=o}return i}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class IU{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):Be("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class Vw{constructor(e){this.cacheKey=e,this.usedTimes=0}}class kU extends Vw{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class UU extends Vw{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let qU=0;class lp{constructor(e,t,r,i=null,s=null){this.id=qU++,this.code=e,this.stage=t,this.name=r,this.transforms=i,this.attributes=s,this.usedTimes=0}}class GU extends ra{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new lp(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),r.createProgram(a));const c=this._getComputeCacheKey(e,a);let f=this.caches.get(c);f===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),f=this._getComputePipeline(e,a,c,t)),f.usedTimes++,a.usedTimes++,i.version=e.version,i.pipeline=f}return i.pipeline}getForRender(e,t=null){const{backend:r}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new lp(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,c),r.createProgram(c));let f=this.programs.fragment.get(o.fragmentShader);f===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),f=new lp(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,f),r.createProgram(f));const p=this._getRenderCacheKey(e,c,f);let g=this.caches.get(p);g===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),g=this._getRenderPipeline(e,c,f,p,t)):e.pipeline=g,g.usedTimes++,c.usedTimes++,f.usedTimes++,i.pipeline=g}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,i){r=r||this._getComputeCacheKey(e,t);let s=this.caches.get(r);return s===void 0&&(s=new UU(r,t),this.caches.set(r,s),this.backend.createComputePipeline(s,i)),s}_getRenderPipeline(e,t,r,i,s){i=i||this._getRenderCacheKey(e,t,r);let o=this.caches.get(i);return o===void 0&&(o=new kU(i,t,r),this.caches.set(i,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class VU extends ra{constructor(e,t,r,i,s,o){super(),this.backend=e,this.textures=r,this.pipelines=s,this.attributes=i,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t)this.backend.deleteBindGroupData(r),this.delete(r)}deleteForRender(e){const t=e.getBindings();for(const r of t)this.backend.deleteBindGroupData(r),this.delete(r)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const r=t.attribute,i=r.isIndirectStorageBufferAttribute?bi.INDIRECT:bi.STORAGE;this.attributes.update(r,i)}}_update(e,t){const{backend:r}=this;let i=!1,s=!0,o=0,a=0;for(const c of e.bindings)if(this.nodes.updateGroup(c)!==!1){if(c.isStorageBuffer){const p=c.attribute,g=p.isIndirectStorageBufferAttribute?bi.INDIRECT:bi.STORAGE;this.attributes.update(p,g)}if(c.isUniformBuffer)c.update()&&r.updateBinding(c);else if(c.isSampledTexture){const p=c.update(),g=c.texture,b=this.textures.get(g);if(p&&(this.textures.updateTexture(g),c.generation!==b.generation&&(c.generation=b.generation,i=!0,s=!1)),r.get(g).externalTexture!==void 0||b.isDefaultTexture?s=!1:(o=o*10+g.id,a+=g.version),g.isStorageTexture===!0&&g.mipmapsAutoUpdate===!0){const T=this.get(g);c.store===!0?T.needsMipmap=!0:this.textures.needsMipmaps(g)&&T.needsMipmap===!0&&(this.backend.generateMipmaps(g),T.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const g=this.textures.updateSampler(c.texture);c.samplerKey!==g&&(c.samplerKey=g,i=!0,s=!1)}}i===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function zU(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function kb(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Ub(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===vi&&n.forceSinglePass===!1}class jU{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,i,s,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:r,groupOrder:i,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=r,c.groupOrder=i,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Ub(r)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Ub(r)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||zU),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||kb),this.transparent.length>1&&this.transparent.sort(t||kb)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}const Fu=[];class $U{constructor(e){this.lighting=e,this.lists=new Ji}get(e,t){const r=this.lists;Fu[0]=e,Fu[1]=t;let i=r.get(Fu);return i===void 0&&(i=new jU(this.lighting,e,t),r.set(Fu,i)),Fu.length=0,i}dispose(){this.lists=new Ji}}let HU=0;class WU{constructor(){this.id=HU++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new $t,this.scissor=!1,this.scissorValue=new $t,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return zw(this)}}function zw(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:r}=n,i=[t,r];for(const s of e)i.push(s.id);return fu(i)}const bl=[],QU=new Jh,XU=new Ug;class YU{constructor(){this.chainMaps={}}get(e,t,r=null,i=null){bl[0]=e,bl[1]=t,i!==null&&(bl[2]=i);let s;if(r===null)s="default";else{const c=r.texture.format;s=`${r.textures.length}:${c}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const o=this._getChainMap(s);let a=o.get(bl);return a===void 0&&(a=new WU,o.set(bl,a)),bl.length=0,r!==null&&(a.sampleCount=r.samples===0?1:r.samples),a}getForClear(e=null){return this.get(QU,XU,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Ji)}dispose(){this.chainMaps={}}}const KU=new ge;class ZU extends ra{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),i=e.samples===0?1:e.samples,s=r.depthTextureMips||(r.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),c=a.width>>t,f=a.height>>t;let p=e.depthTexture||s[t];const g=e.depthBuffer===!0||e.stencilBuffer===!0;let b=!1;p===void 0&&g&&(p=new Wi,p.format=e.stencilBuffer?jo:$o,p.type=e.stencilBuffer?zo:Un,p.image.width=c,p.image.height=f,p.image.depth=a.depth,p.renderTarget=e,p.isArrayTexture=e.multiview===!0&&a.depth>1,s[t]=p),(r.width!==a.width||a.height!==r.height)&&(b=!0,p&&(p.needsUpdate=!0,p.image.width=c,p.image.height=f,p.image.depth=p.isArrayTexture?p.image.depth:1)),r.width=a.width,r.height=a.height,r.textures=o,r.depthTexture=p||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==i&&(b=!0,p&&(p.needsUpdate=!0),r.sampleCount=i);const x={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let T=0;T<o.length;T++){const S=o[T];b&&(S.needsUpdate=!0),this.updateTexture(S,x)}p&&this.updateTexture(p,x)}r.initialized!==!0&&(r.initialized=!0,r.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",r.onDispose))}updateTexture(e,t={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(i&&r.initialized===!0&&s.destroyTexture(e),e.isFramebufferTexture){const f=this.renderer.getRenderTarget();f?e.type=f.texture.type:e.type=ri}const{width:o,height:a,depth:c}=this.getSize(e);if(t.width=o,t.height=a,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,i||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createTexture(e,t),r.generation=e.version;else if(e.version>0){const f=e.image;if(f===void 0)De("Renderer: Texture marked for update but image is undefined.");else if(f.complete===!1)De("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const g=[];for(const b of e.images)g.push(b);t.images=g}else t.image=f;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(s.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t);const p=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!p&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version;r.initialized!==!0&&(r.initialized=!0,r.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&Sn.enabled===!0&&Sn.getTransfer(e.colorSpace)!==ft&&De("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),r.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",r.onDispose)),r.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=KU){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement?(t.width=r.videoWidth||1,t.height=r.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&r instanceof VideoFrame?(t.width=r.displayWidth||1,t.height=r.displayHeight||1,t.depth=1):(t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let i;return e.mipmaps.length>0?i=e.mipmaps.length:e.isCompressedTexture===!0?i=1:i=Math.floor(Math.log2(Math.max(t,r)))+1,i}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),r=t.textures,i=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let s=0;s<r.length;s++)this._destroyTexture(r[s]);i&&this._destroyTexture(i),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const r=t.isDefaultTexture;this.backend.destroyTexture(e,r),this.delete(e),this.info.memory.textures--}}}class O2 extends $n{constructor(e,t,r,i=1){super(e,t,r),this.a=i}set(e,t,r,i=1){return this.a=i,super.set(e,t,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class jw extends Dt{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const r=this.getNodeType(e),i=e.getStructTypeNode(r);let s;return i!==null?s=i.getMemberType(e,t):(Be(`TSL: Member "${t}" not found in struct "${r}".`),s="float"),s}getHash(){return this.uuid}generate(){return this.name}}const JU=(n,e)=>new jw(n,e);class eq extends Ie{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Be("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const r=new kl(t);return this._currentCond=lr(e,r),this.addToStack(this._currentCond)}ElseIf(e,t){const r=new kl(t),i=lr(e,r);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new kl(e),this}Switch(e){return this._expressionNode=Pe(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(Pe(e[a])));else Be("TSL: Invalid parameter length. Case() requires at least two parameters.");const r=e[e.length-1],i=new kl(r);let s=t[0];for(let a=1;a<t.length;a++)s=s.or(t[a]);const o=lr(s,i);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())i.isVarNode&&i.isIntent(e)&&i.isAssign(e)!==!0||(t["node"+r++]=i);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const r=P1(),i=e.buildStage;IA(this),e.setActiveStack(this);const s=f=>{if(this._currentNode=f,!(f.isVarNode&&f.isIntent(e)&&f.isAssign(e)!==!0)){if(i==="setup")f.build(e);else if(i==="analyze")f.build(e,this);else if(i==="generate"){const p=e.getDataFromNode(f,"any").stages,g=p&&p[e.shaderStage];if(f.isVarNode&&g&&g.length===1&&g[0]&&g[0].isStackNode)return;f.build(e,"void")}}},o=[...this.nodes];for(const f of o)s(f);this._currentNode=null;const a=this.nodes.filter(f=>o.indexOf(f)===-1);for(const f of a)s(f);let c;return this.hasOutput?c=this.outputNode.build(e,...t):c=super.build(e,...t),IA(r),e.removeActiveStack(this),c}}const F0=tt(eq).setParameterLength(0,1);function tq(n){return Object.entries(n).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class nq extends Ie{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=tq(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,r=0;for(const i of this.membersLayout){const s=i.type,o=TO(s),a=wO(s)/e;t=Math.max(t,a);const f=r%t%a;f!==0&&(r+=a-f),r+=o}return Math.ceil(r/t)*t}getMemberType(e,t){const r=this.membersLayout.find(i=>i.name===t);return r?r.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class rq extends Ie{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),r=t.type,i=e.getPropertyName(t);return e.addLineFlowCode(`${i} = ${e.generateStruct(r,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const iq=(n,e=null)=>{const t=new nq(n,e),r=(...i)=>{let s=null;if(i.length>0)if(i[0].isNode){s={};const o=Object.keys(n);for(let a=0;a<i.length;a++)s[o[a]]=i[a]}else s=i[0];return new rq(t,s)};return r.layout=t,r.isStruct=!0,r};class $w extends Ie{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const r=this.members,i=[];for(let s=0;s<r.length;s++){const o="m"+s,a=r[s].getNodeType(e);i.push({name:o,type:a,index:s})}t.membersLayout=i,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),r=this.members,i=t!==""?t+".":"";for(let s=0;s<r.length;s++){const o=r[s].build(e);e.addLineFlowCode(`${i}m${s} = ${o}`,this)}return t}}const sq=tt($w);function Hw(n,e){for(let t=0;t<n.length;t++)if(n[t].name===e)return t;return-1}class oq extends $w{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return Ww(t)}setup(e){const t=this.outputNodes,r=e.renderer.getRenderTarget(),i=[],s=r.textures;for(const o in t){const a=Hw(s,o);i[a]=je(t[o])}return this.members=i,super.setup(e)}}const Ww=tt(oq);class ic extends bn{static get type(){return"BitcastNode"}constructor(e,t,r=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=r,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),r=e.getTypeLength(t);return e.getTypeFromLength(r,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let r="";if(this.inputType!==null){const i=this.valueNode.getNodeType(e);r=e.getTypeLength(i)===1?this.inputType:e.changeComponentType(i,this.inputType)}else r=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,r)}( ${this.valueNode.build(e,r)} )`}}const Qw=Se(ic).setParameterLength(2),aq=n=>new ic(n,"int","float"),Xw=n=>new ic(n,"uint","float"),lq=n=>new ic(n,"float","int"),uq=n=>new ic(n,"float","uint"),Vc={};class ii extends ue{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,r){r==="int"?t.assign(Qw(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return ye;case"int":return X;case"uvec2":return B1;case"uvec3":return Ka;case"uvec4":return F1;case"ivec2":return In;case"ivec3":return D1;case"ivec4":return O1}}_createTrailingZerosBaseLayout(e,t){const r=this._returnDataNode(t);return re(([s])=>{const o=ye(0);this._resolveElementType(s,o,t);const a=z(o.bitAnd(X1(o))),f=Xw(a).shiftRight(23).sub(127);return r(f)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const r=this._returnDataNode(t);return re(([s])=>{ze(s.equal(ye(0)),()=>ye(32));const o=ye(0),a=ye(0);return this._resolveElementType(s,o,t),ze(o.shiftRight(16).equal(0),()=>{a.addAssign(16),o.shiftLeftAssign(16)}),ze(o.shiftRight(24).equal(0),()=>{a.addAssign(8),o.shiftLeftAssign(8)}),ze(o.shiftRight(28).equal(0),()=>{a.addAssign(4),o.shiftLeftAssign(4)}),ze(o.shiftRight(30).equal(0),()=>{a.addAssign(2),o.shiftLeftAssign(2)}),ze(o.shiftRight(31).equal(0),()=>{a.addAssign(1)}),r(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const r=this._returnDataNode(t);return re(([s])=>{const o=ye(0);this._resolveElementType(s,o,t),o.assign(o.sub(o.shiftRight(ye(1)).bitAnd(ye(1431655765)))),o.assign(o.bitAnd(ye(858993459)).add(o.shiftRight(ye(2)).bitAnd(ye(858993459))));const a=o.add(o.shiftRight(ye(4))).bitAnd(ye(252645135)).mul(ye(16843009)).shiftRight(ye(24));return r(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,r,i){const s=this._returnDataNode(t);return re(([a])=>{if(r===1)return s(i(a));{const c=s(0),f=["x","y","z","w"];for(let p=0;p<r;p++){const g=f[p];c[g].assign(i(a[g]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:r}=this,{renderer:i}=e;if(i.backend.isWebGPUBackend)return super.setup(e);const s=this.getInputType(e),o=e.getElementType(s),a=e.getTypeLength(s),c=`${t}_base_${o}`,f=`${t}_${s}`;let p=Vc[c];if(p===void 0){switch(t){case ii.COUNT_LEADING_ZEROS:{p=this._createLeadingZerosBaseLayout(c,o);break}case ii.COUNT_TRAILING_ZEROS:{p=this._createTrailingZerosBaseLayout(c,o);break}case ii.COUNT_ONE_BITS:{p=this._createOneBitsBaseLayout(c,o);break}}Vc[c]=p}let g=Vc[f];return g===void 0&&(g=this._createMainLayout(f,s,a,p),Vc[f]=g),re(()=>g(r))()}}ii.COUNT_TRAILING_ZEROS="countTrailingZeros";ii.COUNT_LEADING_ZEROS="countLeadingZeros";ii.COUNT_ONE_BITS="countOneBits";const Aq=Se(ii,ii.COUNT_TRAILING_ZEROS).setParameterLength(1),cq=Se(ii,ii.COUNT_LEADING_ZEROS).setParameterLength(1),hq=Se(ii,ii.COUNT_ONE_BITS).setParameterLength(1),fq=re(([n])=>{const e=n.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),yg=(n,e)=>yi(et(4,n.mul(St(1,n))),e),dq=(n,e)=>n.lessThan(.5)?yg(n.mul(2),e).div(2):St(1,yg(et(St(1,n),2),e).div(2)),pq=(n,e,t)=>yi(oi(yi(n,e),Ln(yi(n,e),yi(St(1,n),t))),1/e),mq=(n,e)=>Cr(kh.mul(e.mul(n).sub(1))).div(kh.mul(e.mul(n).sub(1)));class F2 extends bn{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const gq=Se(F2,"snorm").setParameterLength(1),yq=Se(F2,"unorm").setParameterLength(1),_q=Se(F2,"float16").setParameterLength(1);class I2 extends bn{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const bq=Se(I2,"snorm").setParameterLength(1),vq=Se(I2,"unorm").setParameterLength(1),xq=Se(I2,"float16").setParameterLength(1),zs=re(([n])=>n.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),Tq=re(([n])=>Z(zs(n.z.add(zs(n.y.mul(1)))),zs(n.z.add(zs(n.x.mul(1)))),zs(n.y.add(zs(n.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),wq=re(([n,e,t])=>{const r=Z(n).toVar(),i=z(1.4).toVar(),s=z(0).toVar(),o=Z(r).toVar();return qt({start:z(0),end:z(3),type:"float",condition:"<="},()=>{const a=Z(Tq(o.mul(2))).toVar();r.addAssign(a.add(t.mul(z(.1).mul(e)))),o.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);const c=z(zs(r.z.add(zs(r.x.add(zs(r.y)))))).toVar();s.addAssign(c.div(i)),o.addAssign(.14)}),s}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class Sq extends Ie{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let r=this._candidateFn;if(r===null){let i=null,s=-1;for(const o of this.functionNodes){const c=o.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const f=c.inputs;if(t.length===f.length){let p=0;for(let g=0;g<t.length;g++){const b=t[g],x=f[g];b.getNodeType(e)===x.type&&p++}p>s&&(i=o,s=p)}}this._candidateFn=r=i}return r}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const Eq=tt(Sq),cr=n=>(...e)=>Eq(n,...e),mu=Ve(0).setGroup(Ge).onRenderUpdate(n=>n.time),Rq=Ve(0).setGroup(Ge).onRenderUpdate(n=>n.deltaTime),Yw=Ve(0,"uint").setGroup(Ge).onRenderUpdate(n=>n.frameId),Nq=(n=mu)=>n.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),Cq=(n=mu)=>n.fract().round(),Mq=(n=mu)=>n.add(.5).fract().mul(2).sub(1).abs(),Pq=(n=mu)=>n.fract();function Bq(n,e=null){return ho(e,{getUV:n})}const Dq=re(([n,e,t=we(.5)])=>rc(n.sub(t),e).add(t)),Lq=re(([n,e,t=we(.5)])=>{const r=n.sub(t),i=r.dot(r),o=i.mul(i).mul(e);return n.add(r.mul(o))}),Oq=re(({position:n=null,horizontal:e=!0,vertical:t=!1})=>{let r;n!==null?(r=_i.toVar(),r[3][0]=n.x,r[3][1]=n.y,r[3][2]=n.z):r=_i;const i=Bi.mul(r);return FA(e)&&(i[0][0]=_i[0].length(),i[0][1]=0,i[0][2]=0),FA(t)&&(i[1][0]=0,i[1][1]=_i[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,to.mul(i).mul(pn)}),Fq=re(([n=null])=>{const e=Gh();return Gh(S2(n)).sub(e).lessThan(0).select(eo,n)});class Iq extends Ie{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Ht(),r=z(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=r}setup(){const{frameNode:e,uvNode:t,countNode:r}=this,{width:i,height:s}=r,o=e.mod(i.mul(s)).floor(),a=o.mod(i),c=s.sub(o.add(1).div(i).ceil()),f=r.reciprocal(),p=we(a,c);return t.add(p).mul(f)}}const kq=tt(Iq).setParameterLength(3),Kw=re(([n,e=null,t=null,r=z(1),i=pn,s=jr])=>{let o=s.abs().normalize();o=o.div(o.dot(Z(1)));const a=i.yz.mul(r),c=i.zx.mul(r),f=i.xy.mul(r),p=n.value,g=e!==null?e.value:p,b=t!==null?t.value:p,x=Ct(p,a).mul(o.x),T=Ct(g,c).mul(o.y),S=Ct(b,f).mul(o.z);return Ln(x,T,S)}),Uq=(...n)=>Kw(...n),vl=new Qg,ma=new ge,xl=new ge,up=new ge,Iu=new dn,zc=new ge(0,0,-1),as=new $t,ku=new ge,jc=new ge,Uu=new $t,$c=new _t,zh=new Jo,qq=eo.flipX();zh.depthTexture=new Wi(1,1);let Hc=!1;class k2 extends Ms{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||zh.texture,qq),this._reflectorBaseNode=e.reflector||new Gq(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Pe(new k2({defaultTexture:zh.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class Gq extends Ie{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:r=new Zh,resolutionScale:i=1,generateMipmaps:s=!1,bounces:o=!0,depth:a=!1,samples:c=0}=t;this.textureNode=e,this.target=r,this.resolutionScale=i,t.resolution!==void 0&&(fn('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=s,this.bounces=o,this.depth=a,this.samples=c,this.updateBeforeType=o?ot.RENDER:ot.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const r=this.resolutionScale;t.getDrawingBufferSize($c),e.setSize(Math.round($c.width*r),Math.round($c.height*r))}setup(e){return this._updateResolution(zh,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new Jo(0,0,{type:or,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=IN,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new Wi),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&Hc)return!1;Hc=!0;const{scene:t,camera:r,renderer:i,material:s}=e,{target:o}=this,a=this.getVirtualCamera(r),c=this.getRenderTarget(a);i.getDrawingBufferSize($c),this._updateResolution(c,i),xl.setFromMatrixPosition(o.matrixWorld),up.setFromMatrixPosition(r.matrixWorld),Iu.extractRotation(o.matrixWorld),ma.set(0,0,1),ma.applyMatrix4(Iu),ku.subVectors(xl,up);const f=ku.dot(ma)>0;let p=!1;if(f===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){Hc=!1;return}p=!0}ku.reflect(ma).negate(),ku.add(xl),Iu.extractRotation(r.matrixWorld),zc.set(0,0,-1),zc.applyMatrix4(Iu),zc.add(up),jc.subVectors(xl,zc),jc.reflect(ma).negate(),jc.add(xl),a.coordinateSystem=r.coordinateSystem,a.position.copy(ku),a.up.set(0,1,0),a.up.applyMatrix4(Iu),a.up.reflect(ma),a.lookAt(jc),a.near=r.near,a.far=r.far,a.updateMatrixWorld(),a.projectionMatrix.copy(r.projectionMatrix),vl.setFromNormalAndCoplanarPoint(ma,xl),vl.applyMatrix4(a.matrixWorldInverse),as.set(vl.normal.x,vl.normal.y,vl.normal.z,vl.constant);const g=a.projectionMatrix;Uu.x=(Math.sign(as.x)+g.elements[8])/g.elements[0],Uu.y=(Math.sign(as.y)+g.elements[9])/g.elements[5],Uu.z=-1,Uu.w=(1+g.elements[10])/g.elements[14],as.multiplyScalar(1/as.dot(Uu));const b=0;g.elements[2]=as.x,g.elements[6]=as.y,g.elements[10]=i.coordinateSystem===Wo?as.z-b:as.z+1-b,g.elements[14]=as.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),s.visible=!1;const x=i.getRenderTarget(),T=i.getMRT(),S=i.autoClear;i.setMRT(null),i.setRenderTarget(c),i.autoClear=!0;const E=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",p?(i.clear(),this.hasOutput=!1):(i.render(t,a),this.hasOutput=!0),t.name=E,i.setMRT(T),i.setRenderTarget(x),i.autoClear=S,s.visible=!0,Hc=!1,this.forceUpdate=!1}get resolution(){return fn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){fn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const Vq=n=>new k2(n),Ap=new zg(-1,1,1,-1,0,1);class zq extends $r{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Ns([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ns(t,2))}}const jq=new zq;class Ff extends gn{constructor(e=null){super(jq,e),this.camera=Ap,this.isQuadMesh=!0}async renderAsync(e){fn('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,Ap)}render(e){e.render(this,Ap)}}const $q=new _t;class Hq extends Ms{static get type(){return"RTTNode"}constructor(e,t=null,r=null,i={type:or}){const s=new Jo(t,r,i);super(s.texture,Ht()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=r,this.pixelRatio=1,this.renderTarget=s,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Ff(new Rn),this.updateBeforeType=ot.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const r=e*this.pixelRatio,i=t*this.pixelRatio;this.renderTarget.setSize(r,i),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const i=e.getPixelRatio(),s=e.getSize($q),o=Math.floor(s.width*i),a=Math.floor(s.height*i);(o!==this.renderTarget.width||a!==this.renderTarget.height)&&(this.renderTarget.setSize(o,a),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(r)}clone(){const e=new Ms(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const Zw=(n,...e)=>Pe(new Hq(Pe(n),...e)),Wq=(n,...e)=>n.isSampleNode||n.isTextureNode?n:n.isPassNode?n.getTextureNode():Zw(n,...e),Pl=re(([n,e,t],r)=>{let i;r.renderer.coordinateSystem===Wo?(n=we(n.x,n.y.oneMinus()).mul(2).sub(1),i=je(Z(n,e),1)):i=je(Z(n.x,n.y.oneMinus(),e).mul(2).sub(1),1);const s=je(t.mul(i));return s.xyz.div(s.w)}),Qq=re(([n,e])=>{const t=e.mul(je(n,1)),r=t.xy.div(t.w).mul(.5).add(.5).toVar();return we(r.x,r.y.oneMinus())}),Xq=re(([n,e,t])=>{const r=Js(wn(e)),i=In(n.mul(r)).toVar(),s=wn(e,i).toVar(),o=wn(e,i.sub(In(2,0))).toVar(),a=wn(e,i.sub(In(1,0))).toVar(),c=wn(e,i.add(In(1,0))).toVar(),f=wn(e,i.add(In(2,0))).toVar(),p=wn(e,i.add(In(0,2))).toVar(),g=wn(e,i.add(In(0,1))).toVar(),b=wn(e,i.sub(In(0,1))).toVar(),x=wn(e,i.sub(In(0,2))).toVar(),T=en(St(z(2).mul(a).sub(o),s)).toVar(),S=en(St(z(2).mul(c).sub(f),s)).toVar(),E=en(St(z(2).mul(g).sub(p),s)).toVar(),C=en(St(z(2).mul(b).sub(x),s)).toVar(),P=Pl(n,s,t).toVar(),D=T.lessThan(S).select(P.sub(Pl(n.sub(we(z(1).div(r.x),0)),a,t)),P.negate().add(Pl(n.add(we(z(1).div(r.x),0)),c,t))),L=E.lessThan(C).select(P.sub(Pl(n.add(we(0,z(1).div(r.y))),g,t)),P.negate().add(Pl(n.sub(we(0,z(1).div(r.y))),b,t)));return Pr(lo(D,L))}),U2=re(([n])=>Yi(z(52.9829189).mul(Yi(Ri(n,we(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),Vi=re(([n,e,t])=>{const r=z(2.399963229728653),i=gr(z(n).add(.5).div(z(e))),s=z(n).mul(r).add(t);return we(Ui(s),Cr(s)).mul(i)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class Yq extends Ie{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(Ht())}sample(e){return this.callback(e)}}const Kq=(n,e=null)=>new Yq(n,Pe(e));class qr extends Ie{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===qr.OBJECT?this.updateType=ot.OBJECT:e===qr.MATERIAL?this.updateType=ot.RENDER:e===qr.BEFORE_OBJECT?this.updateBeforeType=ot.OBJECT:e===qr.BEFORE_MATERIAL&&(this.updateBeforeType=ot.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}qr.OBJECT="object";qr.MATERIAL="material";qr.BEFORE_OBJECT="beforeObject";qr.BEFORE_MATERIAL="beforeMaterial";const If=(n,e)=>new qr(n,e).toStack(),Zq=n=>If(qr.OBJECT,n),Jq=n=>If(qr.MATERIAL,n),eG=n=>If(qr.BEFORE_OBJECT,n),tG=n=>If(qr.BEFORE_MATERIAL,n);class I0 extends Vo{constructor(e,t,r=Float32Array){const i=ArrayBuffer.isView(e)?e:new r(e*t);super(i,t),this.isStorageInstancedBufferAttribute=!0}}class nG extends Hi{constructor(e,t,r=Float32Array){const i=ArrayBuffer.isView(e)?e:new r(e*t);super(i,t),this.isStorageBufferAttribute=!0}}const rG=(n,e="float")=>{let t,r;e.isStruct===!0?(t=e.layout.getLength(),r=Ph("float")):(t=dT(e),r=Ph(e));const i=new nG(n,t,r);return no(i,e,n)},iG=(n,e="float")=>{let t,r;e.isStruct===!0?(t=e.layout.getLength(),r=Ph("float")):(t=dT(e),r=Ph(e));const i=new I0(n,t,r);return no(i,e,n)};class sG extends Ie{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const oG=Me(sG),qu=new wA,cp=new dn;class Gr extends Ie{static get type(){return"SceneNode"}constructor(e=Gr.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=this.scene!==null?this.scene:e.scene;let i;return t===Gr.BACKGROUND_BLURRINESS?i=zt("backgroundBlurriness","float",r):t===Gr.BACKGROUND_INTENSITY?i=zt("backgroundIntensity","float",r):t===Gr.BACKGROUND_ROTATION?i=Ve("mat4").setName("backgroundRotation").setGroup(Ge).onRenderUpdate(()=>{const s=r.background;return s!==null&&s.isTexture&&s.mapping!==PN?(qu.copy(r.backgroundRotation),qu.x*=-1,qu.y*=-1,qu.z*=-1,cp.makeRotationFromEuler(qu)):cp.identity(),cp}):Be("SceneNode: Unknown scope:",t),i}}Gr.BACKGROUND_BLURRINESS="backgroundBlurriness";Gr.BACKGROUND_INTENSITY="backgroundIntensity";Gr.BACKGROUND_ROTATION="backgroundRotation";const Jw=Me(Gr,Gr.BACKGROUND_BLURRINESS),_g=Me(Gr,Gr.BACKGROUND_INTENSITY),e5=Me(Gr,Gr.BACKGROUND_ROTATION);class aG extends Ms{static get type(){return"StorageTextureNode"}constructor(e,t,r=null){super(e,t),this.storeNode=r,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=ar.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let r;return this.storeNode!==null?r=this.generateStore(e):r=super.generate(e,t),r}toReadWrite(){return this.setAccess(ar.READ_WRITE)}toReadOnly(){return this.setAccess(ar.READ_ONLY)}toWriteOnly(){return this.setAccess(ar.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:r,storeNode:i,depthNode:s}=t,o=super.generate(e,"property"),a=r.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),c=i.build(e,"vec4"),f=s?s.build(e,"int"):null,p=e.generateTextureStore(e,o,a,f,c);e.addLineFlowCode(p,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const t5=tt(aG).setParameterLength(1,3),lG=(n,e,t)=>{const r=t5(n,e,t);return t!==null&&r.toStack(),r},uG=re(({texture:n,uv:e})=>{const r=Z().toVar();return ze(e.x.lessThan(1e-4),()=>{r.assign(Z(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{r.assign(Z(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{r.assign(Z(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{r.assign(Z(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{r.assign(Z(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{r.assign(Z(0,0,-1))}).Else(()=>{const s=n.sample(e.add(Z(-.01,0,0))).r.sub(n.sample(e.add(Z(.01,0,0))).r),o=n.sample(e.add(Z(0,-.01,0))).r.sub(n.sample(e.add(Z(0,.01,0))).r),a=n.sample(e.add(Z(0,0,-.01))).r.sub(n.sample(e.add(Z(0,0,.01))).r);r.assign(Z(s,o,a))}),r.normalize()});class AG extends Ms{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return Z(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(X(Js(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return uG({texture:this,uv:e})}}const kf=tt(AG).setParameterLength(1,3),cG=(...n)=>kf(...n).setSampler(!1),hG=(n,e,t)=>kf(n,e).level(t);class fG extends Rf{static get type(){return"UserDataNode"}constructor(e,t,r=null){super(e,t,r),this.userData=r}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const dG=(n,e,t)=>new fG(n,e,t),qb=new WeakMap;class pG extends bn{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=ot.OBJECT,this.updateAfterType=ot.OBJECT,this.previousModelWorldMatrix=Ve(new dn),this.previousProjectionMatrix=Ve(new dn).setGroup(Ge),this.previousCameraViewMatrix=Ve(new dn)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:r}){const i=Gb(r);this.previousModelWorldMatrix.value.copy(i);const s=n5(t);s.frameId!==e&&(s.frameId=e,s.previousProjectionMatrix===void 0?(s.previousProjectionMatrix=new dn,s.previousCameraViewMatrix=new dn,s.currentProjectionMatrix=new dn,s.currentCameraViewMatrix=new dn,s.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(s.previousProjectionMatrix.copy(s.currentProjectionMatrix),s.previousCameraViewMatrix.copy(s.currentCameraViewMatrix)),s.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(s.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(s.previousCameraViewMatrix))}updateAfter({object:e}){Gb(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?to:Ve(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),r=e.mul(ta).mul(pn),i=this.previousProjectionMatrix.mul(t).mul(qh),s=r.xy.div(r.w),o=i.xy.div(i.w);return St(s,o)}}function n5(n){let e=qb.get(n);return e===void 0&&(e={},qb.set(n,e)),e}function Gb(n,e=0){const t=n5(n);let r=t[e];return r===void 0&&(t[e]=r=new dn,t[e].copy(n.matrixWorld)),r}const mG=Me(pG),gG=re(([n])=>q2(n.rgb)),yG=re(([n,e=z(1)])=>e.mix(q2(n.rgb),n.rgb)),_G=re(([n,e=z(1)])=>{const t=Ln(n.r,n.g,n.b).div(3),r=n.r.max(n.g.max(n.b)),i=r.sub(t).mul(e).mul(-3);return Tt(n.rgb,r,i)}),bG=re(([n,e=z(1)])=>{const t=Z(.57735,.57735,.57735),r=e.cos();return Z(n.rgb.mul(r).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(Ri(t,n.rgb).mul(r.oneMinus())))))}),q2=(n,e=Z(Sn.getLuminanceCoefficients(new ge)))=>Ri(n,e),vG=re(([n,e=Z(1),t=Z(0),r=Z(1),i=z(1),s=Z(Sn.getLuminanceCoefficients(new ge,qx))])=>{const o=n.rgb.dot(Z(s)),a=_n(n.rgb.mul(e).add(t),0).toVar(),c=a.pow(r).toVar();return ze(a.r.greaterThan(0),()=>{a.r.assign(c.r)}),ze(a.g.greaterThan(0),()=>{a.g.assign(c.g)}),ze(a.b.greaterThan(0),()=>{a.b.assign(c.b)}),a.assign(o.add(a.sub(o).mul(i))),je(a.rgb,n.a)});class xG extends bn{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const TG=tt(xG).setParameterLength(2),Wc=new _t;class r5 extends Ms{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Vb extends r5{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Ps extends bn{static get type(){return"PassNode"}constructor(e,t,r,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new Wi;s.isRenderTargetTexture=!0,s.name="depth";const o=new Jo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:or,...i});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Ve(0),this._cameraFar=Ve(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=ot.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return De("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return De("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const r=this._textures[e],i=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new Vb(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new Vb(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=E2(this.getTextureNode(e),r,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=Wl(s,r,i)}return t}async compileAsync(e){const t=e.getRenderTarget(),r=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(r)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===Ps.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let i,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,i=t.xr.getCamera(),t.xr.updateCamera(i),Wc.set(o.width,o.height)):(i=this.camera,s=t.getPixelRatio(),t.getSize(Wc)),this._pixelRatio=s,this.setSize(Wc.width,Wc.height);const a=t.getRenderTarget(),c=t.getMRT(),f=t.autoClear,p=t.transparent,g=t.opaque,b=i.layers.mask,x=t.contextNode,T=r.overrideMaterial;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const E in this._previousTextures)this.toggleTexture(E);this.overrideMaterial!==null&&(r.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:ho({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const S=r.name;r.name=this.name?this.name:r.name,t.render(r,i),r.name=S,r.overrideMaterial=T,t.setRenderTarget(a),t.setMRT(c),t.autoClear=f,t.transparent=p,t.opaque=g,t.contextNode=x,i.layers.mask=b}setSize(e,t){this._width=e,this._height=t;const r=Math.floor(this._width*this._pixelRatio*this._resolutionScale),i=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(r,i),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,r,i){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new $t),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,r,i),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,r,i){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new $t),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,r,i),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Ps.COLOR="color";Ps.DEPTH="depth";const wG=(n,e,t)=>new Ps(Ps.COLOR,n,e,t),SG=(n,e)=>new r5(n,e),EG=(n,e,t)=>new Ps(Ps.DEPTH,n,e,t);class RG extends Ps{static get type(){return"ToonOutlinePassNode"}constructor(e,t,r,i,s){super(Ps.COLOR,e,t),this.colorNode=r,this.thicknessNode=i,this.alphaNode=s,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,r=t.getRenderObjectFunction();t.setRenderObjectFunction((i,s,o,a,c,f,p,g)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const b=this._getOutlineMaterial(c);t.renderObject(i,s,o,a,b,f,p,g)}t.renderObject(i,s,o,a,c,f,p,g)}),super.updateBefore(e),t.setRenderObjectFunction(r)}_createMaterial(){const e=new Rn;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=yr;const t=jr.negate(),r=to.mul(ta),i=z(1),s=r.mul(je(pn,1)),o=r.mul(je(pn.add(t),1)),a=Pr(s.sub(o));return e.vertexNode=s.add(a.mul(this.thicknessNode).mul(s.w).mul(i)),e.colorNode=je(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const NG=(n,e,t=new $n(0,0,0),r=.003,i=1)=>Pe(new RG(n,e,Pe(t),Pe(r),Pe(i))),i5=re(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),s5=re(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),o5=re(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),r=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),CG=re(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),a5=re(([n,e])=>{const t=ur(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=ur(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=CG(n),n=r.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),MG=ur(Z(1.6605,-.1246,-.0182),Z(-.5876,1.1329,-.1006),Z(-.0728,-.0083,1.1187)),PG=ur(Z(.6274,.0691,.0164),Z(.3293,.9195,.088),Z(.0433,.0113,.8956)),BG=re(([n])=>{const e=Z(n).toVar(),t=Z(e.mul(e)).toVar(),r=Z(t.mul(t)).toVar();return z(15.5).mul(r.mul(t)).sub(et(40.14,r.mul(e))).add(et(31.96,r).sub(et(6.868,t.mul(e))).add(et(.4298,t).add(et(.1191,e).sub(.00232))))}),l5=re(([n,e])=>{const t=Z(n).toVar(),r=ur(Z(.856627153315983,.137318972929847,.11189821299995),Z(.0951212405381588,.761241990602591,.0767994186031903),Z(.0482516061458583,.101439036467562,.811302368396859)),i=ur(Z(1.1271005818144368,-.1413297634984383,-.14132976349843826),Z(-.11060664309660323,1.157823702216272,-.11060664309660294),Z(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=z(-12.47393),o=z(4.026069);return t.mulAssign(e),t.assign(PG.mul(t)),t.assign(r.mul(t)),t.assign(_n(t,1e-10)),t.assign(xs(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Ki(t,0,1)),t.assign(BG(t)),t.assign(i.mul(t)),t.assign(yi(_n(Z(0),t),Z(2.2))),t.assign(MG.mul(t)),t.assign(Ki(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),u5=re(([n,e])=>{const t=z(.76),r=z(.15);n=n.mul(e);const i=zr(n.r,zr(n.g,n.b)),s=lr(i.lessThan(.08),i.sub(et(6.25,i.mul(i))),.04);n.subAssign(s);const o=_n(n.r,_n(n.g,n.b));ze(o.lessThan(t),()=>n);const a=St(1,t),c=St(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(c.div(o));const f=St(1,oi(1,r.mul(o.sub(c)).add(1)));return Tt(n,Z(c),f)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Jn extends Ie{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const Uf=tt(Jn).setParameterLength(1,3),DG=(n,e)=>Uf(n,e,"js"),LG=(n,e)=>Uf(n,e,"wgsl"),OG=(n,e)=>Uf(n,e,"glsl");class A5 extends Jn{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),i=r.name,s=r.type,o=e.getCodeFromNode(this,s);i!==""&&(o.name=i);const a=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(a);return o.code=c+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}const c5=(n,e=[],t="")=>{for(let s=0;s<e.length;s++){const o=e[s];typeof o=="function"&&(e[s]=o.functionNode)}const r=new A5(n,e,t),i=(...s)=>r.call(...s);return i.functionNode=r,i},FG=(n,e)=>c5(n,e,"glsl"),IG=(n,e)=>c5(n,e,"wgsl");class kG extends Ie{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new ef,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:z()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=mT(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=gT(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const k0=tt(kG).setParameterLength(1);class h5 extends Map{get(e,t=null,...r){if(this.has(e))return super.get(e);if(t!==null){const i=t(...r);return this.set(e,i),i}}}class UG{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const U0=new h5;class qG extends Ie{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new h5,this._output=k0(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const r=this._outputs;return r[e]===void 0?r[e]=k0(t):r[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const r=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),r[e]=t,r[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),r[e]=t,r[e].events.addEventListener("refresh",this.onRefresh)):r[e]===void 0?(r[e]=k0(t),r[e].events.addEventListener("refresh",this.onRefresh)):r[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i(...t)}async callAsync(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...t):i(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(f,p)=>this.setOutput(f,p),r=new UG(this),i=U0.get("THREE"),s=U0.get("TSL"),o=this.getMethod(),a=[r,this._local,U0,e,t,i,s];this._object=o(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const f of c.elements){const p=f.id||f.name;f.inputType&&(this.getParameter(p)===void 0&&this.setParameter(p,null),this.getParameter(p).inputType=f.inputType),f.outputType&&(this.getOutput(p)===void 0&&this.setOutput(p,null),this.getOutput(p).outputType=f.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let r=this.parameters[t];r.isScriptableNode&&(r=r.getDefaultOutput()),r.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:z()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],r=["layout","init","main","dispose"].join(", "),i="var "+r+`; var output = {};
`,s=`
return { ...output, `+r+" };",o=i+this.codeNode.code+s;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[KA(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const r in this.parameters)t.push(this.parameters[r].getCacheKey(e));return fu(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const GG=tt(qG).setParameterLength(1,2);function f5(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Mn.z).negate()}const G2=re(([n,e],t)=>{const r=f5(t);return Zi(n,e,r)}),V2=re(([n],e)=>{const t=f5(e);return n.mul(n,t,t).negate().exp().oneMinus()}),VA=re(([n,e])=>je(e.toFloat().mix(jl.rgb,n.toVec3()),jl.a));function VG(n,e,t){return De('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),VA(n,G2(e,t))}function zG(n,e){return De('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),VA(n,V2(e))}let ga=null,ya=null;class jG extends Ie{static get type(){return"RangeNode"}constructor(e=z(),t=z()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),r=this.getConstNode(this.maxNode),i=e.getTypeLength(qo(t.value)),s=e.getTypeLength(qo(r.value));return i>s?i:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(r=>{r.isConstNode===!0&&(t=r)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let r=null;if(t.count>1){const i=this.getConstNode(this.minNode),s=this.getConstNode(this.maxNode),o=i.value,a=s.value,c=e.getTypeLength(qo(o)),f=e.getTypeLength(qo(a));ga=ga||new $t,ya=ya||new $t,ga.setScalar(0),ya.setScalar(0),c===1?ga.setScalar(o):o.isColor?ga.set(o.r,o.g,o.b,1):ga.set(o.x,o.y,o.z||0,o.w||0),f===1?ya.setScalar(a):a.isColor?ya.set(a.r,a.g,a.b,1):ya.set(a.x,a.y,a.z||0,a.w||0);const p=4,g=p*t.count,b=new Float32Array(g);for(let T=0;T<g;T++){const S=T%p,E=ga.getComponent(S),C=ya.getComponent(S);b[T]=Kl.lerp(E,C,Math.random())}const x=this.getNodeType(e);if(t.count<=4096)r=ec(b,"vec4",t.count).element(Es).convert(x);else{const T=new Vo(b,4);e.geometry.setAttribute("__range"+this.id,T),r=Uh(T).convert(x)}}else r=z(0);return r}}const $G=tt(jG).setParameterLength(2);class HG extends Ie{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const r=this.getBuiltinName(e),i=this.getNodeType(e);return e.shaderStage==="compute"?e.format(r,i,t):(De(`ComputeBuiltinNode: Compute built-in value ${r} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(i))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const sc=(n,e)=>new HG(n,e),WG=sc("numWorkgroups","uvec3"),QG=sc("workgroupId","uvec3"),XG=sc("globalId","uvec3"),YG=sc("localId","uvec3"),KG=sc("subgroupSize","uint");class ZG extends Ie{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;r.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const z2=tt(ZG),JG=()=>z2("workgroup").toStack(),eV=()=>z2("storage").toStack(),tV=()=>z2("texture").toStack();class nV extends Ya{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let r;const i=e.context.assign;if(r=super.generate(e),i!==!0){const s=this.getNodeType(e);r=e.format(r,s,t)}return r}}class rV extends Ie{constructor(e,t,r=0){super(t),this.bufferType=t,this.bufferCount=r,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return De('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new nV(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const iV=(n,e)=>new rV("Workgroup",n,e);class Wn extends Ie{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,i=this.method,s=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,c=this.valueNode,f=[];f.push(`&${a.build(e,o)}`),c!==null&&f.push(c.build(e,o));const p=`${e.getMethod(i,s)}( ${f.join(", ")} )`;if(r?r.length===1&&r[0].isStackNode===!0:!1)e.addLineFlowCode(p,this);else return t.constNode===void 0&&(t.constNode=uo(p,s).toConst()),t.constNode.build(e)}}Wn.ATOMIC_LOAD="atomicLoad";Wn.ATOMIC_STORE="atomicStore";Wn.ATOMIC_ADD="atomicAdd";Wn.ATOMIC_SUB="atomicSub";Wn.ATOMIC_MAX="atomicMax";Wn.ATOMIC_MIN="atomicMin";Wn.ATOMIC_AND="atomicAnd";Wn.ATOMIC_OR="atomicOr";Wn.ATOMIC_XOR="atomicXor";const sV=tt(Wn),Fs=(n,e,t)=>sV(n,e,t).toStack(),oV=n=>Fs(Wn.ATOMIC_LOAD,n,null),aV=(n,e)=>Fs(Wn.ATOMIC_STORE,n,e),lV=(n,e)=>Fs(Wn.ATOMIC_ADD,n,e),uV=(n,e)=>Fs(Wn.ATOMIC_SUB,n,e),AV=(n,e)=>Fs(Wn.ATOMIC_MAX,n,e),cV=(n,e)=>Fs(Wn.ATOMIC_MIN,n,e),hV=(n,e)=>Fs(Wn.ATOMIC_AND,n,e),fV=(n,e)=>Fs(Wn.ATOMIC_OR,n,e),dV=(n,e)=>Fs(Wn.ATOMIC_XOR,n,e);class Le extends bn{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=r}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,r=this.bNode?this.bNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(r)?0:e.getTypeLength(r);return i>s?t:r}getNodeType(e){const t=this.method;return t===Le.SUBGROUP_ELECT?"bool":t===Le.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const r=this.method,i=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,a=this.bNode,c=[];if(r===Le.SUBGROUP_BROADCAST||r===Le.SUBGROUP_SHUFFLE||r===Le.QUAD_BROADCAST){const p=a.getNodeType(e);c.push(o.build(e,i),a.build(e,p==="float"?"int":i))}else r===Le.SUBGROUP_SHUFFLE_XOR||r===Le.SUBGROUP_SHUFFLE_DOWN||r===Le.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,i),a.build(e,"uint")):(o!==null&&c.push(o.build(e,s)),a!==null&&c.push(a.build(e,s)));const f=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(r,i)}${f}`,i,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Le.SUBGROUP_ELECT="subgroupElect";Le.SUBGROUP_BALLOT="subgroupBallot";Le.SUBGROUP_ADD="subgroupAdd";Le.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Le.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Le.SUBGROUP_MUL="subgroupMul";Le.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Le.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Le.SUBGROUP_AND="subgroupAnd";Le.SUBGROUP_OR="subgroupOr";Le.SUBGROUP_XOR="subgroupXor";Le.SUBGROUP_MIN="subgroupMin";Le.SUBGROUP_MAX="subgroupMax";Le.SUBGROUP_ALL="subgroupAll";Le.SUBGROUP_ANY="subgroupAny";Le.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Le.QUAD_SWAP_X="quadSwapX";Le.QUAD_SWAP_Y="quadSwapY";Le.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Le.SUBGROUP_BROADCAST="subgroupBroadcast";Le.SUBGROUP_SHUFFLE="subgroupShuffle";Le.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Le.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Le.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Le.QUAD_BROADCAST="quadBroadcast";const pV=Se(Le,Le.SUBGROUP_ELECT).setParameterLength(0),mV=Se(Le,Le.SUBGROUP_BALLOT).setParameterLength(1),gV=Se(Le,Le.SUBGROUP_ADD).setParameterLength(1),yV=Se(Le,Le.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),_V=Se(Le,Le.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),bV=Se(Le,Le.SUBGROUP_MUL).setParameterLength(1),vV=Se(Le,Le.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),xV=Se(Le,Le.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),TV=Se(Le,Le.SUBGROUP_AND).setParameterLength(1),wV=Se(Le,Le.SUBGROUP_OR).setParameterLength(1),SV=Se(Le,Le.SUBGROUP_XOR).setParameterLength(1),EV=Se(Le,Le.SUBGROUP_MIN).setParameterLength(1),RV=Se(Le,Le.SUBGROUP_MAX).setParameterLength(1),NV=Se(Le,Le.SUBGROUP_ALL).setParameterLength(0),CV=Se(Le,Le.SUBGROUP_ANY).setParameterLength(0),MV=Se(Le,Le.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),PV=Se(Le,Le.QUAD_SWAP_X).setParameterLength(1),BV=Se(Le,Le.QUAD_SWAP_Y).setParameterLength(1),DV=Se(Le,Le.QUAD_SWAP_DIAGONAL).setParameterLength(1),LV=Se(Le,Le.SUBGROUP_BROADCAST).setParameterLength(2),OV=Se(Le,Le.SUBGROUP_SHUFFLE).setParameterLength(2),FV=Se(Le,Le.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),IV=Se(Le,Le.SUBGROUP_SHUFFLE_UP).setParameterLength(2),kV=Se(Le,Le.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),UV=Se(Le,Le.QUAD_BROADCAST).setParameterLength(1);let Qc;function qf(n){Qc=Qc||new WeakMap;let e=Qc.get(n);return e===void 0&&Qc.set(n,e={}),e}function Gf(n){const e=qf(n);return e.shadowMatrix||(e.shadowMatrix=Ve("mat4").setGroup(Ge).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function d5(n,e=Ss){const t=Gf(n).mul(e);return t.xyz.div(t.w)}function j2(n){const e=qf(n);return e.position||(e.position=Ve(new ge).setGroup(Ge).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.matrixWorld)))}function p5(n){const e=qf(n);return e.targetPosition||(e.targetPosition=Ve(new ge).setGroup(Ge).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.target.matrixWorld)))}function $2(n){const e=qf(n);return e.viewPosition||(e.viewPosition=Ve(new ge).setGroup(Ge).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new ge,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const H2=n=>Bi.transformDirection(j2(n).sub(p5(n))),qV=n=>n.sort((e,t)=>e.id-t.id),GV=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},hp=new WeakMap,Gu=[];class W2 extends Ie{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Zs("vec3","totalDiffuse"),this.totalSpecularNode=Zs("vec3","totalSpecular"),this.outgoingLightNode=Zs("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const i=e[r];if(Gu.push(i.id),Gu.push(i.castShadow?1:0),i.isSpotLight===!0){const s=i.map!==null?i.map.id:-1,o=i.colorNode?i.colorNode.getCacheKey():-1;Gu.push(s,o)}}const t=fu(Gu);return Gu.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const r of this._lightNodes)t.push(r.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,i=qV(this._lights),s=e.renderer.library;for(const o of i)if(o.isNode)t.push(Pe(o));else{let a=null;if(r!==null&&(a=GV(o.id,r)),a===null){const c=s.getLightNodeClass(o.constructor);if(c===null){De(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let f=null;hp.has(o)?f=hp.get(o):(f=new c(o),hp.set(o,f)),t.push(f)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.direct({...r,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.directRectArea({...r,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const i=e.context,s=i.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:a,totalSpecularNode:c}=this;i.outgoingLight=r;const f=e.addStack();o.nodes=f.nodes,s.start(e);const{backdrop:p,backdropAlpha:g}=i,{directDiffuse:b,directSpecular:x,indirectDiffuse:T,indirectSpecular:S}=i.reflectedLight;let E=b.add(T);p!==null&&(g!==null?E=Z(g.mix(E,p)):E=Z(p)),a.assign(E),c.assign(x.add(S)),r.assign(a.add(c)),s.finish(e),r=r.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const VV=(n=[])=>new W2().setLights(n);class zV extends Ie{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=ot.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){Q2.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Ss)}}const Q2=Zs("vec3","shadowPositionWorld");function jV(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new $n),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function $V(n,e){return e=jV(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function HV(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function WV(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function QV(n,e){return e=WV(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function XV(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function YV(n,e,t){return t=$V(n,t),t=QV(e,t),t}function KV(n,e,t){HV(n,t),XV(e,t)}const jh=new WeakMap,m5=re(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Ct(n,e.xy).setName("t_basic");return n.isArrayTexture&&(r=r.depth(t)),r.compare(e.z)}),g5=re(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(p,g)=>{let b=Ct(n,p);return n.isArrayTexture&&(b=b.depth(r)),b.compare(g)},s=zt("mapSize","vec2",t).setGroup(Ge),o=zt("radius","float",t).setGroup(Ge),a=we(1).div(s),c=o.mul(a.x),f=U2(Za.xy).mul(6.28318530718);return Ln(i(e.xy.add(Vi(0,5,f).mul(c)),e.z),i(e.xy.add(Vi(1,5,f).mul(c)),e.z),i(e.xy.add(Vi(2,5,f).mul(c)),e.z),i(e.xy.add(Vi(3,5,f).mul(c)),e.z),i(e.xy.add(Vi(4,5,f).mul(c)),e.z)).mul(1/5)}),y5=re(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(g,b)=>{let x=Ct(n,g);return n.isArrayTexture&&(x=x.depth(r)),x.compare(b)},s=zt("mapSize","vec2",t).setGroup(Ge),o=we(1).div(s),a=o.x,c=o.y,f=e.xy,p=Yi(f.mul(s).add(.5));return f.subAssign(p.mul(o)),Ln(i(f,e.z),i(f.add(we(a,0)),e.z),i(f.add(we(0,c)),e.z),i(f.add(o),e.z),Tt(i(f.add(we(a.negate(),0)),e.z),i(f.add(we(a.mul(2),0)),e.z),p.x),Tt(i(f.add(we(a.negate(),c)),e.z),i(f.add(we(a.mul(2),c)),e.z),p.x),Tt(i(f.add(we(0,c.negate())),e.z),i(f.add(we(0,c.mul(2))),e.z),p.y),Tt(i(f.add(we(a,c.negate())),e.z),i(f.add(we(a,c.mul(2))),e.z),p.y),Tt(Tt(i(f.add(we(a.negate(),c.negate())),e.z),i(f.add(we(a.mul(2),c.negate())),e.z),p.x),Tt(i(f.add(we(a.negate(),c.mul(2))),e.z),i(f.add(we(a.mul(2),c.mul(2))),e.z),p.x),p.y)).mul(1/9)}),_5=re(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Ct(n).sample(e.xy);n.isArrayTexture&&(r=r.depth(t)),r=r.rg;const i=r.x,s=_n(1e-7,r.y.mul(r.y)),o=xf(e.z,i);ze(o.equal(1),()=>z(1));const a=e.z.sub(i);let c=s.div(s.add(a.mul(a)));return c=Ki(St(c,.3).div(.65)),_n(o,c)}),ZV=re(([n,e,t])=>{let r=Ss.sub(n).length();return r=r.sub(e).div(t.sub(e)),r=r.saturate(),r}),JV=n=>{const e=n.shadow.camera,t=zt("near","float",e).setGroup(Ge),r=zt("far","float",e).setGroup(Ge),i=t6(n);return ZV(i,t,r)},b5=n=>{let e=jh.get(n);if(e===void 0){const t=n.isPointLight?JV(n):null;e=new Rn,e.colorNode=je(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,jh.set(n,e)}return e},v5=n=>{const e=jh.get(n);e!==void 0&&(e.dispose(),jh.delete(n))},zb=new Ji,Tl=[],x5=(n,e,t,r)=>{Tl[0]=n,Tl[1]=e;let i=zb.get(Tl);return(i===void 0||i.shadowType!==t||i.useVelocity!==r)&&(i=(s,o,a,c,f,p,...g)=>{(s.castShadow===!0||s.receiveShadow&&t===x0)&&(r&&(pT(s).useVelocity=!0),s.onBeforeShadow(n,s,a,e.camera,c,o.overrideMaterial,p),n.renderObject(s,o,a,c,f,p,...g),s.onAfterShadow(n,s,a,e.camera,c,o.overrideMaterial,p))},i.shadowType=t,i.useVelocity=r,zb.set(Tl,i)),Tl[0]=null,Tl[1]=null,i},ez=re(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=z(0).toVar("meanVertical"),o=z(0).toVar("squareMeanVertical"),a=n.lessThanEqual(z(1)).select(z(0),z(2).div(n.sub(1))),c=n.lessThanEqual(z(1)).select(z(0),z(-1));qt({start:X(0),end:X(n),type:"int",condition:"<"},({i:p})=>{const g=c.add(z(p).mul(a));let b=r.sample(Ln(Za.xy,we(0,g).mul(e)).div(t));r.value.isArrayTexture&&(b=b.depth(i)),b=b.x,s.addAssign(b),o.addAssign(b.mul(b))}),s.divAssign(n),o.divAssign(n);const f=gr(o.sub(s.mul(s)).max(0));return we(s,f)}),tz=re(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=z(0).toVar("meanHorizontal"),o=z(0).toVar("squareMeanHorizontal"),a=n.lessThanEqual(z(1)).select(z(0),z(2).div(n.sub(1))),c=n.lessThanEqual(z(1)).select(z(0),z(-1));qt({start:X(0),end:X(n),type:"int",condition:"<"},({i:p})=>{const g=c.add(z(p).mul(a));let b=r.sample(Ln(Za.xy,we(g,0).mul(e)).div(t));r.value.isArrayTexture&&(b=b.depth(i)),s.addAssign(b.x),o.addAssign(Ln(b.y.mul(b.y),b.x.mul(b.x)))}),s.divAssign(n),o.divAssign(n);const f=gr(o.sub(s.mul(s)).max(0));return we(s,f)}),nz=[m5,g5,y5,_5];let fp;const Xc=new Ff;class T5 extends zV{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o}){const a=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),c=t({depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o});return a.select(c,z(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:i}=e,s=zt("bias","float",r).setGroup(Ge);let o=t,a;if(r.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,i.coordinateSystem===Wo&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const f=zt("near","float",r.camera).setGroup(Ge),p=zt("far","float",r.camera).setGroup(Ge);a=R2(c.negate(),f,p)}return o=Z(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return nz[e]}setupRenderTarget(e,t){const r=new Wi(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=sf;const i=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return i.texture.name="ShadowMap",i.texture.type=e.mapType,i.depthTexture=r,{shadowMap:i,depthTexture:r}}setupShadow(e){const{renderer:t,camera:r}=e,{light:i,shadow:s}=this,o=t.shadowMap.type,{depthTexture:a,shadowMap:c}=this.setupRenderTarget(s,e);if(s.camera.coordinateSystem=r.coordinateSystem,s.camera.updateProjectionMatrix(),o===x0&&s.isPointLightShadow!==!0){a.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Ws,type:or,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Ws,type:or,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Ws,type:or,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:Ws,type:or,depthBuffer:!1}));let D=Ct(a);a.isArrayTexture&&(D=D.depth(this.depthLayer));let L=Ct(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(L=L.depth(this.depthLayer));const k=zt("blurSamples","float",s).setGroup(Ge),q=zt("radius","float",s).setGroup(Ge),I=zt("mapSize","vec2",s).setGroup(Ge);let U=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Rn);U.fragmentNode=ez({samples:k,radius:q,size:I,shadowPass:D,depthLayer:this.depthLayer}).context(e.getSharedContext()),U.name="VSMVertical",U=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Rn),U.fragmentNode=tz({samples:k,radius:q,size:I,shadowPass:L,depthLayer:this.depthLayer}).context(e.getSharedContext()),U.name="VSMHorizontal"}const f=zt("intensity","float",s).setGroup(Ge),p=zt("normalBias","float",s).setGroup(Ge),g=Gf(i).mul(Q2.add(na.mul(p))),b=this.setupShadowCoord(e,g),x=s.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(x===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const T=o===x0&&s.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,S=this.setupShadowFilter(e,{filterFn:x,shadowTexture:c.texture,depthTexture:T,shadowCoord:b,shadow:s,depthLayer:this.depthLayer});let E;c.texture.isCubeTexture?E=Mr(c.texture,b.xyz):(E=Ct(c.texture,b),a.isArrayTexture&&(E=E.depth(this.depthLayer)));const C=Tt(1,S.rgb.mix(E,1),f.mul(E.a)).toVar();this.shadowMap=c,this.shadow.map=c;const P=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return C.toInspector(`${P} / Color`,()=>this.shadowMap.texture.isCubeTexture?Mr(this.shadowMap.texture):Ct(this.shadowMap.texture)).toInspector(`${P} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Mr(this.shadowMap.texture).r.oneMinus():wn(this.shadowMap.depthTexture,Ht().mul(Js(Ct(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return re(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let r=this._node;return this.setupShadowPosition(e),r===null&&(this._node=r=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&De('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(r=e.material.receivedShadowNode(r)),r})()}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e;t.updateMatrices(i),r.setSize(t.mapSize.width,t.mapSize.height,r.depth);const a=o.name;o.name=`Shadow Map [ ${i.name||"ID: "+i.id} ]`,s.render(o,t.camera),o.name=a}updateShadow(e){const{shadowMap:t,light:r,shadow:i}=this,{renderer:s,scene:o,camera:a}=e,c=s.shadowMap.type,f=t.depthTexture.version;this._depthVersionCached=f;const p=i.camera.layers.mask;i.camera.layers.mask&4294967294||(i.camera.layers.mask=a.layers.mask);const g=s.getRenderObjectFunction(),b=s.getMRT(),x=b?b.has("velocity"):!1;fp=YV(s,o,fp),o.overrideMaterial=b5(r),s.setRenderObjectFunction(x5(s,i,c,x)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(g),c===x0&&i.isPointLightShadow!==!0&&this.vsmPass(s),i.camera.layers.mask=p,KV(s,o,fp)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),Xc.material=this.vsmMaterialVertical,Xc.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Xc.material=this.vsmMaterialHorizontal,Xc.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,v5(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const w5=(n,e)=>new T5(n,e),rz=new $n,jb=new dn,Vu=new ge,dp=new ge,iz=[new ge(1,0,0),new ge(-1,0,0),new ge(0,-1,0),new ge(0,1,0),new ge(0,0,1),new ge(0,0,-1)],sz=[new ge(0,-1,0),new ge(0,-1,0),new ge(0,0,-1),new ge(0,0,1),new ge(0,-1,0),new ge(0,-1,0)],oz=[new ge(1,0,0),new ge(-1,0,0),new ge(0,1,0),new ge(0,-1,0),new ge(0,0,1),new ge(0,0,-1)],az=[new ge(0,-1,0),new ge(0,-1,0),new ge(0,0,1),new ge(0,0,-1),new ge(0,-1,0),new ge(0,-1,0)],S5=re(({depthTexture:n,bd3D:e,dp:t})=>Mr(n,e).compare(t)),E5=re(({depthTexture:n,bd3D:e,dp:t,shadow:r})=>{const i=zt("radius","float",r).setGroup(Ge),s=zt("mapSize","vec2",r).setGroup(Ge),o=i.div(s.x),a=en(e),c=Pr(lo(e,a.x.greaterThan(a.z).select(Z(0,1,0),Z(1,0,0)))),f=lo(e,c),p=U2(Za.xy).mul(6.28318530718),g=Vi(0,5,p),b=Vi(1,5,p),x=Vi(2,5,p),T=Vi(3,5,p),S=Vi(4,5,p);return Mr(n,e.add(c.mul(g.x).add(f.mul(g.y)).mul(o))).compare(t).add(Mr(n,e.add(c.mul(b.x).add(f.mul(b.y)).mul(o))).compare(t)).add(Mr(n,e.add(c.mul(x.x).add(f.mul(x.y)).mul(o))).compare(t)).add(Mr(n,e.add(c.mul(T.x).add(f.mul(T.y)).mul(o))).compare(t)).add(Mr(n,e.add(c.mul(S.x).add(f.mul(S.y)).mul(o))).compare(t)).mul(1/5)}),lz=re(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:r})=>{const i=t.xyz.toVar(),s=i.length(),o=Ve("float").setGroup(Ge).onRenderUpdate(()=>r.camera.near),a=Ve("float").setGroup(Ge).onRenderUpdate(()=>r.camera.far),c=zt("bias","float",r).setGroup(Ge),f=z(1).toVar();return ze(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const p=s.sub(o).div(a.sub(o)).toVar();p.addAssign(c);const g=i.normalize();f.assign(n({depthTexture:e,bd3D:g,dp:p,shadow:r}))}),f});class uz extends T5{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===CN?S5:E5}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s}){return lz({filterFn:t,depthTexture:r,shadowCoord:i,shadow:s})}setupRenderTarget(e,t){const r=new MN(e.mapSize.width);r.name="PointShadowDepthTexture",r.compareFunction=sf;const i=t.createCubeRenderTarget(e.mapSize.width);return i.texture.name="PointShadowMap",i.depthTexture=r,{shadowMap:i,depthTexture:r}}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e,a=t.camera,c=t.matrix,f=s.coordinateSystem===Wo,p=f?iz:oz,g=f?sz:az;r.setSize(t.mapSize.width,t.mapSize.width);const b=s.autoClear,x=s.getClearColor(rz),T=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha);for(let S=0;S<6;S++){s.setRenderTarget(r,S),s.clear();const E=i.distance||a.far;E!==a.far&&(a.far=E,a.updateProjectionMatrix()),Vu.setFromMatrixPosition(i.matrixWorld),a.position.copy(Vu),dp.copy(a.position),dp.add(p[S]),a.up.copy(g[S]),a.lookAt(dp),a.updateMatrixWorld(),c.makeTranslation(-Vu.x,-Vu.y,-Vu.z),jb.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),t._frustum.setFromProjectionMatrix(jb,a.coordinateSystem,a.reversedDepth);const C=o.name;o.name=`Point Light Shadow [ ${i.name||"ID: "+i.id} ] - Face ${S+1}`,s.render(o,a),o.name=C}s.autoClear=b,s.setClearColor(x,T)}}const R5=(n,e)=>new uz(n,e);class Ja extends pu{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new $n,this.colorNode=e&&e.colorNode||Ve(this.color).setGroup(Ge),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=ot.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return $2(this.light).sub(e.context.positionView||Mn)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return w5(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){const i=this.light.shadow.shadowNode;let s;i!==void 0?s=Pe(i):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=r=this.colorNode.mul(s),this.baseColorNode=this.colorNode}e.context.getShadow&&(r=e.context.getShadow(this,e)),this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const X2=re(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const r=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(n.div(e).pow4().oneMinus().clamp().pow2()),r)}),N5=({color:n,lightVector:e,cutoffDistance:t,decayExponent:r})=>{const i=e.normalize(),s=e.length(),o=X2({lightDistance:s,cutoffDistance:t,decayExponent:r}),a=n.mul(o);return{lightDirection:i,lightColor:a}};class Az extends Ja{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Ve(0).setGroup(Ge),this.decayExponentNode=Ve(2).setGroup(Ge)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return R5(this.light)}setupDirect(e){return N5({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const cz=re(([n=Ht()])=>{const e=n.mul(2),t=e.x.floor(),r=e.y.floor();return t.add(r).mod(2).sign()}),hz=re(([n=Ht()],{renderer:e,material:t})=>{const r=n2(n.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.currentSamples>0){const s=z(r.fwidth()).toVar();i=Zi(s.oneMinus(),s.add(1),r).oneMinus()}else i=lr(r.greaterThan(1),0,1);return i}),_A=re(([n,e,t])=>{const r=z(t).toVar(),i=z(e).toVar(),s=Ei(n).toVar();return lr(s,i,r)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),$h=re(([n,e])=>{const t=Ei(e).toVar(),r=z(n).toVar();return lr(t,r.negate(),r)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Dn=re(([n])=>{const e=z(n).toVar();return X(Ts(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),An=re(([n,e])=>{const t=z(n).toVar();return e.assign(Dn(t)),t.sub(z(e))}),fz=re(([n,e,t,r,i,s])=>{const o=z(s).toVar(),a=z(i).toVar(),c=z(r).toVar(),f=z(t).toVar(),p=z(e).toVar(),g=z(n).toVar(),b=z(St(1,a)).toVar();return St(1,o).mul(g.mul(b).add(p.mul(a))).add(o.mul(f.mul(b).add(c.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),dz=re(([n,e,t,r,i,s])=>{const o=z(s).toVar(),a=z(i).toVar(),c=Z(r).toVar(),f=Z(t).toVar(),p=Z(e).toVar(),g=Z(n).toVar(),b=z(St(1,a)).toVar();return St(1,o).mul(g.mul(b).add(p.mul(a))).add(o.mul(f.mul(b).add(c.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),C5=cr([fz,dz]),pz=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=z(p).toVar(),b=z(f).toVar(),x=z(c).toVar(),T=z(a).toVar(),S=z(o).toVar(),E=z(s).toVar(),C=z(i).toVar(),P=z(r).toVar(),D=z(t).toVar(),L=z(e).toVar(),k=z(n).toVar(),q=z(St(1,x)).toVar(),I=z(St(1,b)).toVar();return z(St(1,g)).toVar().mul(I.mul(k.mul(q).add(L.mul(x))).add(b.mul(D.mul(q).add(P.mul(x))))).add(g.mul(I.mul(C.mul(q).add(E.mul(x))).add(b.mul(S.mul(q).add(T.mul(x))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),mz=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=z(p).toVar(),b=z(f).toVar(),x=z(c).toVar(),T=Z(a).toVar(),S=Z(o).toVar(),E=Z(s).toVar(),C=Z(i).toVar(),P=Z(r).toVar(),D=Z(t).toVar(),L=Z(e).toVar(),k=Z(n).toVar(),q=z(St(1,x)).toVar(),I=z(St(1,b)).toVar();return z(St(1,g)).toVar().mul(I.mul(k.mul(q).add(L.mul(x))).add(b.mul(D.mul(q).add(P.mul(x))))).add(g.mul(I.mul(C.mul(q).add(E.mul(x))).add(b.mul(S.mul(q).add(T.mul(x))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),M5=cr([pz,mz]),gz=re(([n,e,t])=>{const r=z(t).toVar(),i=z(e).toVar(),s=ye(n).toVar(),o=ye(s.bitAnd(ye(7))).toVar(),a=z(_A(o.lessThan(ye(4)),i,r)).toVar(),c=z(et(2,_A(o.lessThan(ye(4)),r,i))).toVar();return $h(a,Ei(o.bitAnd(ye(1)))).add($h(c,Ei(o.bitAnd(ye(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),yz=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=z(e).toVar(),a=ye(n).toVar(),c=ye(a.bitAnd(ye(15))).toVar(),f=z(_A(c.lessThan(ye(8)),o,s)).toVar(),p=z(_A(c.lessThan(ye(4)),s,_A(c.equal(ye(12)).or(c.equal(ye(14))),o,i))).toVar();return $h(f,Ei(c.bitAnd(ye(1)))).add($h(p,Ei(c.bitAnd(ye(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),er=cr([gz,yz]),_z=re(([n,e,t])=>{const r=z(t).toVar(),i=z(e).toVar(),s=Ka(n).toVar();return Z(er(s.x,i,r),er(s.y,i,r),er(s.z,i,r))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),bz=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=z(e).toVar(),a=Ka(n).toVar();return Z(er(a.x,o,s,i),er(a.y,o,s,i),er(a.z,o,s,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),di=cr([_z,bz]),vz=re(([n])=>{const e=z(n).toVar();return et(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),xz=re(([n])=>{const e=z(n).toVar();return et(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Tz=re(([n])=>{const e=Z(n).toVar();return et(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),P5=cr([vz,Tz]),wz=re(([n])=>{const e=Z(n).toVar();return et(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),B5=cr([xz,wz]),ti=re(([n,e])=>{const t=X(e).toVar(),r=ye(n).toVar();return r.shiftLeft(t).bitOr(r.shiftRight(X(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),D5=re(([n,e,t])=>{n.subAssign(t),n.bitXorAssign(ti(t,X(4))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ti(n,X(6))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ti(e,X(8))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(ti(t,X(16))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ti(n,X(19))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ti(e,X(4))),e.addAssign(n)}),oc=re(([n,e,t])=>{const r=ye(t).toVar(),i=ye(e).toVar(),s=ye(n).toVar();return r.bitXorAssign(i),r.subAssign(ti(i,X(14))),s.bitXorAssign(r),s.subAssign(ti(r,X(11))),i.bitXorAssign(s),i.subAssign(ti(s,X(25))),r.bitXorAssign(i),r.subAssign(ti(i,X(16))),s.bitXorAssign(r),s.subAssign(ti(r,X(4))),i.bitXorAssign(s),i.subAssign(ti(s,X(14))),r.bitXorAssign(i),r.subAssign(ti(i,X(24))),r}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),_r=re(([n])=>{const e=ye(n).toVar();return z(e).div(z(ye(X(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),Rs=re(([n])=>{const e=z(n).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),Sz=re(([n])=>{const e=X(n).toVar(),t=ye(ye(1)).toVar(),r=ye(ye(X(3735928559)).add(t.shiftLeft(ye(2))).add(ye(13))).toVar();return oc(r.add(ye(e)),r,r)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),Ez=re(([n,e])=>{const t=X(e).toVar(),r=X(n).toVar(),i=ye(ye(2)).toVar(),s=ye().toVar(),o=ye().toVar(),a=ye().toVar();return s.assign(o.assign(a.assign(ye(X(3735928559)).add(i.shiftLeft(ye(2))).add(ye(13))))),s.addAssign(ye(r)),o.addAssign(ye(t)),oc(s,o,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Rz=re(([n,e,t])=>{const r=X(t).toVar(),i=X(e).toVar(),s=X(n).toVar(),o=ye(ye(3)).toVar(),a=ye().toVar(),c=ye().toVar(),f=ye().toVar();return a.assign(c.assign(f.assign(ye(X(3735928559)).add(o.shiftLeft(ye(2))).add(ye(13))))),a.addAssign(ye(s)),c.addAssign(ye(i)),f.addAssign(ye(r)),oc(a,c,f)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Nz=re(([n,e,t,r])=>{const i=X(r).toVar(),s=X(t).toVar(),o=X(e).toVar(),a=X(n).toVar(),c=ye(ye(4)).toVar(),f=ye().toVar(),p=ye().toVar(),g=ye().toVar();return f.assign(p.assign(g.assign(ye(X(3735928559)).add(c.shiftLeft(ye(2))).add(ye(13))))),f.addAssign(ye(a)),p.addAssign(ye(o)),g.addAssign(ye(s)),D5(f,p,g),f.addAssign(ye(i)),oc(f,p,g)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Cz=re(([n,e,t,r,i])=>{const s=X(i).toVar(),o=X(r).toVar(),a=X(t).toVar(),c=X(e).toVar(),f=X(n).toVar(),p=ye(ye(5)).toVar(),g=ye().toVar(),b=ye().toVar(),x=ye().toVar();return g.assign(b.assign(x.assign(ye(X(3735928559)).add(p.shiftLeft(ye(2))).add(ye(13))))),g.addAssign(ye(f)),b.addAssign(ye(c)),x.addAssign(ye(a)),D5(g,b,x),g.addAssign(ye(o)),b.addAssign(ye(s)),oc(g,b,x)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),jt=cr([Sz,Ez,Rz,Nz,Cz]),Mz=re(([n,e])=>{const t=X(e).toVar(),r=X(n).toVar(),i=ye(jt(r,t)).toVar(),s=Ka().toVar();return s.x.assign(i.bitAnd(X(255))),s.y.assign(i.shiftRight(X(8)).bitAnd(X(255))),s.z.assign(i.shiftRight(X(16)).bitAnd(X(255))),s}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Pz=re(([n,e,t])=>{const r=X(t).toVar(),i=X(e).toVar(),s=X(n).toVar(),o=ye(jt(s,i,r)).toVar(),a=Ka().toVar();return a.x.assign(o.bitAnd(X(255))),a.y.assign(o.shiftRight(X(8)).bitAnd(X(255))),a.z.assign(o.shiftRight(X(16)).bitAnd(X(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),pi=cr([Mz,Pz]),Bz=re(([n])=>{const e=we(n).toVar(),t=X().toVar(),r=X().toVar(),i=z(An(e.x,t)).toVar(),s=z(An(e.y,r)).toVar(),o=z(Rs(i)).toVar(),a=z(Rs(s)).toVar(),c=z(C5(er(jt(t,r),i,s),er(jt(t.add(X(1)),r),i.sub(1),s),er(jt(t,r.add(X(1))),i,s.sub(1)),er(jt(t.add(X(1)),r.add(X(1))),i.sub(1),s.sub(1)),o,a)).toVar();return P5(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Dz=re(([n])=>{const e=Z(n).toVar(),t=X().toVar(),r=X().toVar(),i=X().toVar(),s=z(An(e.x,t)).toVar(),o=z(An(e.y,r)).toVar(),a=z(An(e.z,i)).toVar(),c=z(Rs(s)).toVar(),f=z(Rs(o)).toVar(),p=z(Rs(a)).toVar(),g=z(M5(er(jt(t,r,i),s,o,a),er(jt(t.add(X(1)),r,i),s.sub(1),o,a),er(jt(t,r.add(X(1)),i),s,o.sub(1),a),er(jt(t.add(X(1)),r.add(X(1)),i),s.sub(1),o.sub(1),a),er(jt(t,r,i.add(X(1))),s,o,a.sub(1)),er(jt(t.add(X(1)),r,i.add(X(1))),s.sub(1),o,a.sub(1)),er(jt(t,r.add(X(1)),i.add(X(1))),s,o.sub(1),a.sub(1)),er(jt(t.add(X(1)),r.add(X(1)),i.add(X(1))),s.sub(1),o.sub(1),a.sub(1)),c,f,p)).toVar();return B5(g)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),Y2=cr([Bz,Dz]),Lz=re(([n])=>{const e=we(n).toVar(),t=X().toVar(),r=X().toVar(),i=z(An(e.x,t)).toVar(),s=z(An(e.y,r)).toVar(),o=z(Rs(i)).toVar(),a=z(Rs(s)).toVar(),c=Z(C5(di(pi(t,r),i,s),di(pi(t.add(X(1)),r),i.sub(1),s),di(pi(t,r.add(X(1))),i,s.sub(1)),di(pi(t.add(X(1)),r.add(X(1))),i.sub(1),s.sub(1)),o,a)).toVar();return P5(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Oz=re(([n])=>{const e=Z(n).toVar(),t=X().toVar(),r=X().toVar(),i=X().toVar(),s=z(An(e.x,t)).toVar(),o=z(An(e.y,r)).toVar(),a=z(An(e.z,i)).toVar(),c=z(Rs(s)).toVar(),f=z(Rs(o)).toVar(),p=z(Rs(a)).toVar(),g=Z(M5(di(pi(t,r,i),s,o,a),di(pi(t.add(X(1)),r,i),s.sub(1),o,a),di(pi(t,r.add(X(1)),i),s,o.sub(1),a),di(pi(t.add(X(1)),r.add(X(1)),i),s.sub(1),o.sub(1),a),di(pi(t,r,i.add(X(1))),s,o,a.sub(1)),di(pi(t.add(X(1)),r,i.add(X(1))),s.sub(1),o,a.sub(1)),di(pi(t,r.add(X(1)),i.add(X(1))),s,o.sub(1),a.sub(1)),di(pi(t.add(X(1)),r.add(X(1)),i.add(X(1))),s.sub(1),o.sub(1),a.sub(1)),c,f,p)).toVar();return B5(g)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),ac=cr([Lz,Oz]),Fz=re(([n])=>{const e=z(n).toVar(),t=X(Dn(e)).toVar();return _r(jt(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Iz=re(([n])=>{const e=we(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar();return _r(jt(t,r))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),kz=re(([n])=>{const e=Z(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar();return _r(jt(t,r,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Uz=re(([n])=>{const e=je(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar(),s=X(Dn(e.w)).toVar();return _r(jt(t,r,i,s))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),qz=cr([Fz,Iz,kz,Uz]),Gz=re(([n])=>{const e=z(n).toVar(),t=X(Dn(e)).toVar();return Z(_r(jt(t,X(0))),_r(jt(t,X(1))),_r(jt(t,X(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Vz=re(([n])=>{const e=we(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar();return Z(_r(jt(t,r,X(0))),_r(jt(t,r,X(1))),_r(jt(t,r,X(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),zz=re(([n])=>{const e=Z(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar();return Z(_r(jt(t,r,i,X(0))),_r(jt(t,r,i,X(1))),_r(jt(t,r,i,X(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),jz=re(([n])=>{const e=je(n).toVar(),t=X(Dn(e.x)).toVar(),r=X(Dn(e.y)).toVar(),i=X(Dn(e.z)).toVar(),s=X(Dn(e.w)).toVar();return Z(_r(jt(t,r,i,s,X(0))),_r(jt(t,r,i,s,X(1))),_r(jt(t,r,i,s,X(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),Vf=cr([Gz,Vz,zz,jz]),Hh=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar(),c=z(0).toVar(),f=z(1).toVar();return qt(o,()=>{c.addAssign(f.mul(Y2(a))),f.mulAssign(i),a.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),zf=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar(),c=Z(0).toVar(),f=z(1).toVar();return qt(o,()=>{c.addAssign(f.mul(ac(a))),f.mulAssign(i),a.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),$z=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar();return we(Hh(a,o,s,i),Hh(a.add(Z(X(19),X(193),X(17))),o,s,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Hz=re(([n,e,t,r])=>{const i=z(r).toVar(),s=z(t).toVar(),o=X(e).toVar(),a=Z(n).toVar(),c=Z(zf(a,o,s,i)).toVar(),f=z(Hh(a.add(Z(X(19),X(193),X(17))),o,s,i)).toVar();return je(c,f)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Wz=re(([n,e,t,r,i,s,o])=>{const a=X(o).toVar(),c=z(s).toVar(),f=X(i).toVar(),p=X(r).toVar(),g=X(t).toVar(),b=X(e).toVar(),x=we(n).toVar(),T=Z(Vf(we(b.add(p),g.add(f)))).toVar(),S=we(T.x,T.y).toVar();S.subAssign(.5),S.mulAssign(c),S.addAssign(.5);const E=we(we(z(b),z(g)).add(S)).toVar(),C=we(E.sub(x)).toVar();return ze(a.equal(X(2)),()=>en(C.x).add(en(C.y))),ze(a.equal(X(3)),()=>_n(en(C.x),en(C.y))),Ri(C,C)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Qz=re(([n,e,t,r,i,s,o,a,c])=>{const f=X(c).toVar(),p=z(a).toVar(),g=X(o).toVar(),b=X(s).toVar(),x=X(i).toVar(),T=X(r).toVar(),S=X(t).toVar(),E=X(e).toVar(),C=Z(n).toVar(),P=Z(Vf(Z(E.add(x),S.add(b),T.add(g)))).toVar();P.subAssign(.5),P.mulAssign(p),P.addAssign(.5);const D=Z(Z(z(E),z(S),z(T)).add(P)).toVar(),L=Z(D.sub(C)).toVar();return ze(f.equal(X(2)),()=>en(L.x).add(en(L.y)).add(en(L.z))),ze(f.equal(X(3)),()=>_n(en(L.x),en(L.y),en(L.z))),Ri(L,L)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),gu=cr([Wz,Qz]),Xz=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=we(n).toVar(),o=X().toVar(),a=X().toVar(),c=we(An(s.x,o),An(s.y,a)).toVar(),f=z(1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:p})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:g})=>{const b=z(gu(c,p,g,o,a,i,r)).toVar();f.assign(zr(f,b))})}),ze(r.equal(X(0)),()=>{f.assign(gr(f))}),f}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Yz=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=we(n).toVar(),o=X().toVar(),a=X().toVar(),c=we(An(s.x,o),An(s.y,a)).toVar(),f=we(1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:p})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:g})=>{const b=z(gu(c,p,g,o,a,i,r)).toVar();ze(b.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(b)}).ElseIf(b.lessThan(f.y),()=>{f.y.assign(b)})})}),ze(r.equal(X(0)),()=>{f.assign(gr(f))}),f}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Kz=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=we(n).toVar(),o=X().toVar(),a=X().toVar(),c=we(An(s.x,o),An(s.y,a)).toVar(),f=Z(1e6,1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:p})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:g})=>{const b=z(gu(c,p,g,o,a,i,r)).toVar();ze(b.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(b)}).ElseIf(b.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(b)}).ElseIf(b.lessThan(f.z),()=>{f.z.assign(b)})})}),ze(r.equal(X(0)),()=>{f.assign(gr(f))}),f}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Zz=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=Z(n).toVar(),o=X().toVar(),a=X().toVar(),c=X().toVar(),f=Z(An(s.x,o),An(s.y,a),An(s.z,c)).toVar(),p=z(1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:g})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:b})=>{qt({start:-1,end:X(1),name:"z",condition:"<="},({z:x})=>{const T=z(gu(f,g,b,x,o,a,c,i,r)).toVar();p.assign(zr(p,T))})})}),ze(r.equal(X(0)),()=>{p.assign(gr(p))}),p}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Jz=cr([Xz,Zz]),ej=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=Z(n).toVar(),o=X().toVar(),a=X().toVar(),c=X().toVar(),f=Z(An(s.x,o),An(s.y,a),An(s.z,c)).toVar(),p=we(1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:g})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:b})=>{qt({start:-1,end:X(1),name:"z",condition:"<="},({z:x})=>{const T=z(gu(f,g,b,x,o,a,c,i,r)).toVar();ze(T.lessThan(p.x),()=>{p.y.assign(p.x),p.x.assign(T)}).ElseIf(T.lessThan(p.y),()=>{p.y.assign(T)})})})}),ze(r.equal(X(0)),()=>{p.assign(gr(p))}),p}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),tj=cr([Yz,ej]),nj=re(([n,e,t])=>{const r=X(t).toVar(),i=z(e).toVar(),s=Z(n).toVar(),o=X().toVar(),a=X().toVar(),c=X().toVar(),f=Z(An(s.x,o),An(s.y,a),An(s.z,c)).toVar(),p=Z(1e6,1e6,1e6).toVar();return qt({start:-1,end:X(1),name:"x",condition:"<="},({x:g})=>{qt({start:-1,end:X(1),name:"y",condition:"<="},({y:b})=>{qt({start:-1,end:X(1),name:"z",condition:"<="},({z:x})=>{const T=z(gu(f,g,b,x,o,a,c,i,r)).toVar();ze(T.lessThan(p.x),()=>{p.z.assign(p.y),p.y.assign(p.x),p.x.assign(T)}).ElseIf(T.lessThan(p.y),()=>{p.z.assign(p.y),p.y.assign(T)}).ElseIf(T.lessThan(p.z),()=>{p.z.assign(T)})})})}),ze(r.equal(X(0)),()=>{p.assign(gr(p))}),p}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),K2=cr([Kz,nj]),rj=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=X(n).toVar(),b=we(e).toVar(),x=we(t).toVar(),T=we(r).toVar(),S=z(i).toVar(),E=z(s).toVar(),C=z(o).toVar(),P=Ei(a).toVar(),D=X(c).toVar(),L=z(f).toVar(),k=z(p).toVar(),q=b.mul(x).add(T),I=z(0).toVar();return ze(g.equal(X(0)),()=>{I.assign(ac(q))}),ze(g.equal(X(1)),()=>{I.assign(Vf(q))}),ze(g.equal(X(2)),()=>{I.assign(K2(q,S,X(0)))}),ze(g.equal(X(3)),()=>{I.assign(zf(Z(q,0),D,L,k))}),I.assign(I.mul(C.sub(E)).add(E)),ze(P,()=>{I.assign(Ki(I,E,C))}),I}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ij=re(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=X(n).toVar(),b=Z(e).toVar(),x=Z(t).toVar(),T=Z(r).toVar(),S=z(i).toVar(),E=z(s).toVar(),C=z(o).toVar(),P=Ei(a).toVar(),D=X(c).toVar(),L=z(f).toVar(),k=z(p).toVar(),q=b.mul(x).add(T),I=z(0).toVar();return ze(g.equal(X(0)),()=>{I.assign(ac(q))}),ze(g.equal(X(1)),()=>{I.assign(Vf(q))}),ze(g.equal(X(2)),()=>{I.assign(K2(q,S,X(0)))}),ze(g.equal(X(3)),()=>{I.assign(zf(q,D,L,k))}),I.assign(I.mul(C.sub(E)).add(E)),ze(P,()=>{I.assign(Ki(I,E,C))}),I}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),sj=re(([n])=>{const e=n.y,t=n.z,r=Z().toVar();return ze(e.lessThan(1e-4),()=>{r.assign(Z(t,t,t))}).Else(()=>{let i=n.x;i=i.sub(Ts(i)).mul(6).toVar();const s=X(Z1(i)),o=i.sub(z(s)),a=t.mul(e.oneMinus()),c=t.mul(e.mul(o).oneMinus()),f=t.mul(e.mul(o.oneMinus()).oneMinus());ze(s.equal(X(0)),()=>{r.assign(Z(t,f,a))}).ElseIf(s.equal(X(1)),()=>{r.assign(Z(c,t,a))}).ElseIf(s.equal(X(2)),()=>{r.assign(Z(a,t,f))}).ElseIf(s.equal(X(3)),()=>{r.assign(Z(a,c,t))}).ElseIf(s.equal(X(4)),()=>{r.assign(Z(f,a,t))}).Else(()=>{r.assign(Z(t,a,c))})}),r}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),oj=re(([n])=>{const e=Z(n).toVar(),t=z(e.x).toVar(),r=z(e.y).toVar(),i=z(e.z).toVar(),s=z(zr(t,zr(r,i))).toVar(),o=z(_n(t,_n(r,i))).toVar(),a=z(o.sub(s)).toVar(),c=z().toVar(),f=z().toVar(),p=z().toVar();return p.assign(o),ze(o.greaterThan(0),()=>{f.assign(a.div(o))}).Else(()=>{f.assign(0)}),ze(f.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{ze(t.greaterThanEqual(o),()=>{c.assign(r.sub(i).div(a))}).ElseIf(r.greaterThanEqual(o),()=>{c.assign(Ln(2,i.sub(t).div(a)))}).Else(()=>{c.assign(Ln(4,t.sub(r).div(a)))}),c.mulAssign(1/6),ze(c.lessThan(0),()=>{c.addAssign(1)})}),Z(c,f,p)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),aj=re(([n])=>{const e=Z(n).toVar(),t=L1(z1(e,Z(.04045))).toVar(),r=Z(e.div(12.92)).toVar(),i=Z(yi(_n(e.add(Z(.055)),Z(0)).div(1.055),Z(2.4))).toVar();return Tt(r,i,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),L5=(n,e)=>{n=z(n),e=z(e);const t=we(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Zi(n.sub(t),n.add(t),e)},O5=(n,e,t,r)=>Tt(n,e,t[r].clamp()),lj=(n,e,t=Ht())=>O5(n,e,t,"x"),uj=(n,e,t=Ht())=>O5(n,e,t,"y"),Aj=(n,e,t,r,i=Ht())=>{const s=i.x.clamp(),o=i.y.clamp(),a=Tt(n,e,s),c=Tt(t,r,s);return Tt(a,c,o)},F5=(n,e,t,r,i)=>Tt(n,e,L5(t,r[i])),cj=(n,e,t,r=Ht())=>F5(n,e,t,r,"x"),hj=(n,e,t,r=Ht())=>F5(n,e,t,r,"y"),fj=(n=1,e=0,t=Ht())=>t.mul(n).add(e),dj=(n,e=1)=>(n=z(n),n.abs().pow(e).mul(n.sign())),pj=(n,e=1,t=.5)=>z(n).sub(t).mul(e).add(t),mj=(n=Ht(),e=1,t=0)=>Y2(n.convert("vec2|vec3")).mul(e).add(t),gj=(n=Ht(),e=1,t=0)=>ac(n.convert("vec2|vec3")).mul(e).add(t),yj=(n=Ht(),e=1,t=0)=>(n=n.convert("vec2|vec3"),je(ac(n),Y2(n.add(we(19,73)))).mul(e).add(t)),_j=(n,e=Ht(),t=we(1,1),r=we(0,0),i=1,s=0,o=1,a=!1,c=1,f=2,p=.5)=>rj(n,e.convert("vec2|vec3"),t,r,i,s,o,a,c,f,p),bj=(n,e=Ht(),t=we(1,1),r=we(0,0),i=1,s=0,o=1,a=!1,c=1,f=2,p=.5)=>ij(n,e.convert("vec2|vec3"),t,r,i,s,o,a,c,f,p),vj=(n=Ht(),e=1)=>Jz(n.convert("vec2|vec3"),e,X(1)),xj=(n=Ht(),e=1)=>tj(n.convert("vec2|vec3"),e,X(1)),Tj=(n=Ht(),e=1)=>K2(n.convert("vec2|vec3"),e,X(1)),wj=(n=Ht())=>qz(n.convert("vec2|vec3")),Sj=(n=Ht(),e=3,t=2,r=.5,i=1)=>Hh(n,X(e),t,r).mul(i),Ej=(n=Ht(),e=3,t=2,r=.5,i=1)=>$z(n,X(e),t,r).mul(i),Rj=(n=Ht(),e=3,t=2,r=.5,i=1)=>zf(n,X(e),t,r).mul(i),Nj=(n=Ht(),e=3,t=2,r=.5,i=1)=>Hz(n,X(e),t,r).mul(i),Cj=(n,e=z(0))=>Ln(n,e),Mj=(n,e=z(0))=>St(n,e),Pj=(n,e=z(1))=>et(n,e),Bj=(n,e=z(1))=>oi(n,e),Dj=(n,e=z(1))=>JA(n,e),Lj=(n,e=z(1))=>yi(n,e),Oj=(n=z(0),e=z(1))=>vf(n,e),Fj=()=>mu,Ij=()=>Yw,kj=(n,e=z(1))=>St(e,n),Uj=(n,e,t,r)=>n.greaterThan(e).mix(t,r),qj=(n,e,t,r)=>n.greaterThanEqual(e).mix(t,r),Gj=(n,e,t,r)=>n.equal(e).mix(t,r),Vj=(n,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},r=e.replace(/^out/,"").toLowerCase();if(t[r]!==void 0)return n.element(t[r])}if(typeof e=="number")return n.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return n.element(t[e])}return n},zj=(n,e=we(.5,.5),t=we(1,1),r=z(0),i=we(0,0))=>{let s=n;if(e&&(s=s.sub(e)),t&&(s=s.mul(t)),r){const o=r.mul(Math.PI/180),a=o.cos(),c=o.sin();s=we(s.x.mul(a).sub(s.y.mul(c)),s.x.mul(c).add(s.y.mul(a)))}return e&&(s=s.add(e)),i&&(s=s.add(i)),s},jj=(n,e)=>{n=we(n),e=z(e);const t=e.mul(Math.PI/180);return rc(n,t)},$j=(n,e,t)=>{n=Z(n),e=z(e),t=Z(t);const r=e.mul(Math.PI/180),i=t.normalize(),s=r.cos(),o=r.sin(),a=z(1).sub(s);return n.mul(s).add(i.cross(n).mul(o)).add(i.mul(i.dot(n)).mul(a))},Hj=(n,e)=>(n=Z(n),e=z(e),v2(n,e)),Wj=re(([n,e,t])=>{const r=Pr(n).toVar(),i=St(z(.5).mul(e.sub(t)),Ss).div(r).toVar(),s=St(z(-.5).mul(e.sub(t)),Ss).div(r).toVar(),o=Z().toVar();o.x=r.x.greaterThan(z(0)).select(i.x,s.x),o.y=r.y.greaterThan(z(0)).select(i.y,s.y),o.z=r.z.greaterThan(z(0)).select(i.z,s.z);const a=zr(o.x,o.y,o.z).toVar();return Ss.add(r.mul(a)).toVar().sub(t)}),I5=re(([n,e])=>{const t=n.x,r=n.y,i=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(r)),s=s.add(e.element(2).mul(2*.511664).mul(i)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(5).mul(2*.429043).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(8).mul(.429043).mul(et(t,t).sub(et(r,r)))),s});var N=Object.freeze({__proto__:null,BRDF_GGX:B2,BRDF_Lambert:Qa,BasicPointShadowFilter:S5,BasicShadowFilter:m5,Break:cw,Const:M8,Continue:DI,DFGLUT:qA,D_GGX:Cw,Discard:H8,EPSILON:j1,F_Schlick:lu,Fn:re,HALF_PI:sF,INFINITY:nF,If:ze,Loop:qt,NodeAccess:ar,NodeShaderStage:rA,NodeType:SO,NodeUpdateType:ot,OnBeforeMaterialUpdate:tG,OnBeforeObjectUpdate:eG,OnMaterialUpdate:Jq,OnObjectUpdate:Zq,PCFShadowFilter:g5,PCFSoftShadowFilter:y5,PI:kh,PI2:rF,PointShadowFilter:E5,Return:vF,Schlick_to_F0:dg,ScriptableNodeResources:U0,ShaderNode:kl,Stack:pf,Switch:WO,TBNViewMatrix:Ia,TWO_PI:iF,VSMShadowFilter:_5,V_GGX_SmithCorrelated:Nw,Var:C8,VarIntent:P8,abs:en,acesFilmicToneMapping:a5,acos:W1,add:Ln,addMethodChaining:de,addNodeElement:SF,agxToneMapping:l5,all:e8,alphaT:Oh,and:UT,anisotropy:Do,anisotropyB:Va,anisotropyT:pA,any:t8,append:KO,array:BT,arrayBuffer:XO,asin:s8,assign:DT,atan:vf,atan2:T8,atomicAdd:lV,atomicAnd:hV,atomicFunc:Fs,atomicLoad:oV,atomicMax:AV,atomicMin:cV,atomicOr:fV,atomicStore:aV,atomicSub:uV,atomicXor:dV,attenuationColor:U1,attenuationDistance:k1,attribute:Ao,attributeArray:rG,backgroundBlurriness:Jw,backgroundIntensity:_g,backgroundRotation:e5,batch:lw,bentNormalView:w6,billboarding:Oq,bitAnd:zT,bitNot:jT,bitOr:$T,bitXor:HT,bitangentGeometry:cI,bitangentLocal:hI,bitangentView:x6,bitangentWorld:fI,bitcast:Qw,blendBurn:gw,blendColor:YI,blendDodge:yw,blendOverlay:bw,blendScreen:_w,blur:Fw,bool:Ei,buffer:ec,bufferAttribute:u2,builtin:fo,builtinAOContext:R8,builtinShadowContext:E8,bumpMap:v2,burn:ZI,bvec2:ST,bvec3:L1,bvec4:ET,bypass:V8,cache:G8,call:LT,cameraFar:Io,cameraIndex:ea,cameraNear:Fo,cameraNormalMatrix:qF,cameraPosition:e6,cameraProjectionMatrix:to,cameraProjectionMatrixInverse:kF,cameraViewMatrix:Bi,cameraViewport:GF,cameraWorldMatrix:UF,cbrt:y8,cdl:vG,ceil:bf,checker:cz,cineonToneMapping:o5,clamp:Ki,clearcoat:Bh,clearcoatNormalView:Fa,clearcoatRoughness:UA,code:Uf,color:wT,colorSpaceToWorking:wf,colorToDirection:pI,compute:q8,computeKernel:A2,computeSkinning:PI,context:ho,convert:NT,convertColorSpace:hF,convertToTexture:Wq,cos:Ui,countLeadingZeros:cq,countOneBits:hq,countTrailingZeros:Aq,cross:lo,cubeTexture:Mr,cubeTextureBase:b2,dFdx:Y1,dFdy:K1,dashSize:P0,debug:Q8,decrement:ZT,decrementBefore:YT,defaultBuildStages:Jm,defaultShaderStages:yT,defined:FA,degrees:r8,deltaTime:Rq,densityFog:zG,densityFogFactor:V2,depth:N2,depthPass:EG,determinant:A8,difference:p8,diffuseColor:kt,diffuseContribution:Sa,directPointLight:N5,directionToColor:S6,directionToFaceDirection:du,dispersion:q1,disposeShadowMaterial:v5,distance:d8,div:oi,dodge:JI,dot:Ri,drawIndex:sw,dynamicBufferAttribute:gF,element:RT,emissive:rg,equal:V1,equals:h8,equirectUV:C2,exp:$1,exp2:ou,expression:uo,faceDirection:g2,faceForward:i2,faceforward:oF,float:z,floatBitsToInt:aq,floatBitsToUint:Xw,floor:Ts,fog:VA,fract:Yi,frameGroup:PT,frameId:Yw,frontFacing:i6,fwidth:J1,gain:dq,gapSize:ig,getConstNodeType:TT,getCurrentStack:P1,getDirection:Lw,getDistanceAttenuation:X2,getGeometryRoughness:Rw,getNormalFromDepth:Xq,getParallaxCorrectNormal:Wj,getRoughness:P2,getScreenPosition:Qq,getShIrradianceAt:I5,getShadowMaterial:b5,getShadowRenderObjectFunction:x5,getTextureIndex:Hw,getViewPosition:Pl,ggxConvolution:Iw,globalId:XG,glsl:OG,glslFn:FG,grayscale:gG,greaterThan:z1,greaterThanEqual:kT,hash:fq,highpModelNormalViewMatrix:ag,highpModelViewMatrix:og,hue:bG,increment:KT,incrementBefore:XT,inspector:Y8,instance:NI,instanceIndex:Es,instancedArray:iG,instancedBufferAttribute:Uh,instancedDynamicBufferAttribute:sg,instancedMesh:aw,int:X,intBitsToFloat:lq,interleavedGradientNoise:U2,inverse:c8,inverseSqrt:H1,inversesqrt:aF,invocationLocalIndex:RI,invocationSubgroupIndex:EI,ior:mA,iridescence:gf,iridescenceIOR:Dh,iridescenceThickness:Lh,isolate:Hl,ivec2:In,ivec3:D1,ivec4:O1,js:DG,label:N8,length:ws,lengthSq:n2,lessThan:FT,lessThanEqual:IT,lightPosition:j2,lightProjectionUV:d5,lightShadowMatrix:Gf,lightTargetDirection:H2,lightTargetPosition:p5,lightViewPosition:$2,lightingContext:fw,lights:VV,linearDepth:Gh,linearToneMapping:i5,localId:YG,log:_f,log2:xs,logarithmicDepthToViewZ:VI,luminance:q2,mat2:mf,mat3:ur,mat4:Ho,matcapUV:Uw,materialAO:nw,materialAlphaTest:E6,materialAnisotropy:G6,materialAnisotropyVector:Ml,materialAttenuationColor:X6,materialAttenuationDistance:Q6,materialClearcoat:O6,materialClearcoatNormal:I6,materialClearcoatRoughness:F6,materialColor:R6,materialDispersion:tw,materialEmissive:C6,materialEnvIntensity:L0,materialEnvRotation:_2,materialIOR:W6,materialIridescence:V6,materialIridescenceIOR:z6,materialIridescenceThickness:j6,materialLightMap:T2,materialLineDashOffset:J6,materialLineDashSize:K6,materialLineGapSize:Z6,materialLineScale:Y6,materialLineWidth:bI,materialMetalness:D6,materialNormal:L6,materialOpacity:x2,materialPointSize:ew,materialReference:$s,materialReflectivity:O0,materialRefractionRatio:l6,materialRotation:k6,materialRoughness:B6,materialSheen:U6,materialSheenRoughness:q6,materialShininess:N6,materialSpecular:M6,materialSpecularColor:P6,materialSpecularIntensity:fg,materialSpecularStrength:gA,materialThickness:H6,materialTransmission:$6,max:_n,maxMipLevel:c2,mediumpModelViewMatrix:r6,metalness:Qs,min:zr,mix:Tt,mixElement:b8,mod:JA,modInt:JT,modelDirection:WF,modelNormalMatrix:n6,modelPosition:QF,modelRadius:KF,modelScale:XF,modelViewMatrix:ta,modelViewPosition:YF,modelViewProjection:rw,modelWorldMatrix:_i,modelWorldMatrixInverse:ZF,morphReference:hw,mrt:Ww,mul:et,mx_aastep:L5,mx_add:Cj,mx_atan2:Oj,mx_cell_noise_float:wj,mx_contrast:pj,mx_divide:Bj,mx_fractal_noise_float:Sj,mx_fractal_noise_vec2:Ej,mx_fractal_noise_vec3:Rj,mx_fractal_noise_vec4:Nj,mx_frame:Ij,mx_heighttonormal:Hj,mx_hsvtorgb:sj,mx_ifequal:Gj,mx_ifgreater:Uj,mx_ifgreatereq:qj,mx_invert:kj,mx_modulo:Dj,mx_multiply:Pj,mx_noise_float:mj,mx_noise_vec3:gj,mx_noise_vec4:yj,mx_place2d:zj,mx_power:Lj,mx_ramp4:Aj,mx_ramplr:lj,mx_ramptb:uj,mx_rgbtohsv:oj,mx_rotate2d:jj,mx_rotate3d:$j,mx_safepower:dj,mx_separate:Vj,mx_splitlr:cj,mx_splittb:hj,mx_srgb_texture_to_lin_rec709:aj,mx_subtract:Mj,mx_timer:Fj,mx_transform_uv:fj,mx_unifiednoise2d:_j,mx_unifiednoise3d:bj,mx_worley_noise_float:vj,mx_worley_noise_vec2:xj,mx_worley_noise_vec3:Tj,negate:X1,neutralToneMapping:u5,nodeArray:Ga,nodeImmutable:Me,nodeObject:Pe,nodeObjectIntent:iA,nodeObjects:df,nodeProxy:tt,nodeProxyIntent:Se,normalFlat:s6,normalGeometry:Ef,normalLocal:jr,normalMap:hg,normalView:Rt,normalViewGeometry:au,normalWorld:na,normalWorldGeometry:o6,normalize:Pr,not:GT,notEqual:OT,numWorkgroups:WG,objectDirection:VF,objectGroup:G1,objectPosition:t6,objectRadius:HF,objectScale:jF,objectViewPosition:$F,objectWorldMatrix:zF,oneMinus:o8,or:qT,orthographicDepthToViewZ:GI,oscSawtooth:Pq,oscSine:Nq,oscSquare:Cq,oscTriangle:Mq,output:jl,outputStruct:sq,overlay:tk,overloadingFn:cr,packHalf2x16:_q,packSnorm2x16:gq,packUnorm2x16:yq,parabola:yg,parallaxDirection:T6,parallaxUV:dI,parameter:JU,pass:wG,passTexture:SG,pcurve:pq,perspectiveDepthToViewZ:E2,pmremTexture:L2,pointShadow:R5,pointUV:oG,pointWidth:ZO,positionGeometry:tc,positionLocal:pn,positionPrevious:qh,positionView:Mn,positionViewDirection:Yt,positionWorld:Ss,positionWorldDirection:m2,posterize:TG,pow:yi,pow2:e2,pow3:m8,pow4:t2,premultiplyAlpha:vw,property:Zs,quadBroadcast:UV,quadSwapDiagonal:DV,quadSwapX:PV,quadSwapY:BV,radians:n8,rand:_8,range:$G,rangeFog:VG,rangeFogFactor:G2,reciprocal:l8,reference:zt,referenceBuffer:lg,reflect:f8,reflectVector:c6,reflectView:u6,reflector:Vq,refract:r2,refractVector:h6,refractView:A6,reinhardToneMapping:s5,remap:j8,remapClamp:$8,renderGroup:Ge,renderOutput:W8,rendererReference:I8,replaceDefaultUV:Bq,rotate:rc,rotateUV:Dq,roughness:ps,round:a8,rtt:Zw,sRGBTransferEOTF:D8,sRGBTransferOETF:L8,sample:Kq,sampler:PF,samplerComparison:BF,saturate:Tf,saturation:yG,screen:ek,screenCoordinate:Za,screenDPR:Z8,screenSize:Wa,screenUV:eo,scriptable:GG,scriptableValue:k0,select:lr,setCurrentStack:IA,setName:s2,shaderStages:eg,shadow:w5,shadowPositionWorld:Q2,shapeCircle:hz,sharedUniformGroup:yf,sheen:Kr,sheenRoughness:Oo,shiftLeft:WT,shiftRight:QT,shininess:Fh,sign:Q1,sin:Cr,sinc:mq,skinning:Aw,smoothstep:Zi,smoothstepElement:v8,specularColor:Yo,specularColorBlended:Oa,specularF90:zl,spherizeUV:Lq,split:YO,spritesheetUV:kq,sqrt:gr,stack:F0,step:xf,stepElement:x8,storage:no,storageBarrier:eV,storageObject:wI,storageTexture:t5,string:QO,struct:iq,sub:St,subBuild:$l,subgroupAdd:gV,subgroupAll:NV,subgroupAnd:TV,subgroupAny:CV,subgroupBallot:mV,subgroupBroadcast:LV,subgroupBroadcastFirst:MV,subgroupElect:pV,subgroupExclusiveAdd:_V,subgroupExclusiveMul:xV,subgroupInclusiveAdd:yV,subgroupInclusiveMul:vV,subgroupIndex:SI,subgroupMax:RV,subgroupMin:EV,subgroupMul:bV,subgroupOr:wV,subgroupShuffle:OV,subgroupShuffleDown:kV,subgroupShuffleUp:IV,subgroupShuffleXor:FV,subgroupSize:KG,subgroupXor:SV,tan:i8,tangentGeometry:Nf,tangentLocal:nc,tangentView:Cf,tangentWorld:v6,texture:Ct,texture3D:kf,texture3DLevel:hG,texture3DLoad:cG,textureBarrier:tV,textureBicubic:Bk,textureBicubicLevel:D2,textureCubeUV:Ow,textureLevel:MF,textureLoad:wn,textureSize:Js,textureStore:lG,thickness:I1,time:mu,toneMapping:k8,toneMappingExposure:U8,toonOutlinePass:NG,transformDirection:g8,transformNormal:a6,transformNormalToView:y2,transformedClearcoatNormalView:nI,transformedNormalView:eI,transformedNormalWorld:tI,transmission:Ih,transpose:u8,triNoise3D:wq,triplanarTexture:Uq,triplanarTextures:Kw,trunc:Z1,uint:ye,uintBitsToFloat:uq,uniform:Ve,uniformArray:mr,uniformCubeTexture:iI,uniformFlow:S8,uniformGroup:MT,uniformTexture:CF,unpackHalf2x16:xq,unpackNormal:cg,unpackSnorm2x16:bq,unpackUnorm2x16:vq,unpremultiplyAlpha:KI,userData:dG,uv:Ht,uvec2:B1,uvec3:Ka,uvec4:F1,varying:Os,varyingProperty:kA,vec2:we,vec3:Z,vec4:je,vectorComponents:Xa,velocity:mG,vertexColor:mw,vertexIndex:iw,vertexStage:B8,vibrance:_G,viewZToLogarithmicDepth:R2,viewZToOrthographicDepth:Wl,viewZToPerspectiveDepth:dw,viewport:d2,viewportCoordinate:J8,viewportDepthTexture:S2,viewportLinearDepth:zI,viewportMipTexture:w2,viewportResolution:IF,viewportSafeUV:Fq,viewportSharedTexture:ak,viewportSize:p2,viewportTexture:UI,viewportUV:FF,vogelDiskSample:Vi,wgsl:LG,wgslFn:IG,workgroupArray:iV,workgroupBarrier:JG,workgroupId:QG,workingToColorSpace:O8,xor:VT});const Li=new O2;class Qj extends ra{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const i=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)i._clearColor.getRGB(Li),Li.a=i._clearColor.a;else if(s.isColor===!0)s.getRGB(Li),Li.a=1,o=!0;else if(s.isNode===!0){const c=this.get(e),f=s;Li.copy(i._clearColor);let p=c.backgroundMesh;if(p===void 0){let P=function(){s.removeEventListener("dispose",P),p.material.dispose(),p.geometry.dispose()};const b=je(f).mul(_g).context({getUV:()=>e5.mul(o6),getTextureLevel:()=>Jw}),x=to.element(3).element(3).equal(1),T=oi(1,to.element(1).element(1)).mul(3),S=x.select(pn.mul(T),pn);let E=to.mul(ta.mul(je(S,0)));E=E.setZ(E.w);const C=new Rn;C.name="Background.material",C.side=yr,C.depthTest=!1,C.depthWrite=!1,C.allowOverride=!1,C.fog=!1,C.lights=!1,C.vertexNode=E,C.colorNode=b,c.backgroundMeshNode=b,c.backgroundMesh=p=new gn(new Zo(1,32,32),C),p.frustumCulled=!1,p.name="Background.mesh",s.addEventListener("dispose",P)}const g=f.getCacheKey();c.backgroundCacheKey!==g&&(c.backgroundMeshNode.node=je(f).mul(_g),c.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,c.backgroundCacheKey=g),t.unshift(p,p.geometry,p.material,0,0,null,null)}else Be("Renderer: Unsupported background configuration.",s);const a=i.xr.getEnvironmentBlendMode();if(a==="additive"?Li.set(0,0,0,1):a==="alpha-blend"&&Li.set(0,0,0,0),i.autoClear===!0||o===!0){const c=r.clearColorValue;c.r=Li.r,c.g=Li.g,c.b=Li.b,c.a=Li.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),r.depthClearValue=i._clearDepth,r.stencilClearValue=i._clearStencil,r.clearColor=i.autoClearColor===!0,r.clearDepth=i.autoClearDepth===!0,r.clearStencil=i.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let Xj=0;class bg{constructor(e="",t=[],r=0,i=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=i,this.id=Xj++}}class Yj{constructor(e,t,r,i,s,o,a,c,f,p=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=p,this.nodeAttributes=i,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.observer=f,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new bg(t.name,[],t.index,t.bindingsReference);e.push(i);for(const s of t.bindings)i.bindings.push(s.clone())}else e.push(t);return e}}class $b{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class Kj{constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class k5{constructor(e,t,r=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=i}}class Zj extends k5{constructor(e,t,r=null,i=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=i}}class Jj{constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let e$=0;class pp{constructor(e=null){this.id=e$++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class t${constructor(e,t){this.name=e,this.members=t,this.output=!1}}class ia{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class n$ extends ia{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class r$ extends ia{constructor(e,t=new _t){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class i$ extends ia{constructor(e,t=new ge){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class s$ extends ia{constructor(e,t=new $t){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class o$ extends ia{constructor(e,t=new $n){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class a$ extends ia{constructor(e,t=new Ix){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class l$ extends ia{constructor(e,t=new WA){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class u$ extends ia{constructor(e,t=new dn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class A$ extends n${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class c$ extends r${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class h$ extends i${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class f$ extends s${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class d$ extends o${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class p$ extends a${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class m$ extends l${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class g$ extends u${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let y$=0;const _$=new WeakMap,Hb=new WeakMap,b$=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Yc=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class U5{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=F0(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new pp,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:y$++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===Xs&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=Hb.get(this.renderer);return e===void 0&&(e=new Ji,Hb.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new Jo(e,t,r)}createCubeRenderTarget(e,t){return new xw(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),i=[];let s=!0;for(const a of t)i.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=r.get(i),o===void 0&&(o=new bg(e,i,this.bindingsIndexes[e].group,i),r.set(i,o))):o=new bg(e,i,this.bindingsIndexes[e].group,i),o}getBindGroupArray(e,t){const r=this.bindings[t];let i=r[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},r=this.bindings;for(const i of eg)for(const s in r[i]){const o=r[i][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const i in t){const s=t[i],o=this._getBindGroup(i,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,r)=>t.bindings[0].groupNode.order-r.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==ot.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==ot.NONE&&this.updateBeforeNodes.push(e),r!==ot.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Xi||e.magFilter===Vp||e.magFilter===TA||e.magFilter===Ua||e.minFilter===Xi||e.minFilter===Vp||e.minFilter===TA||e.minFilter===Ua}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return r.cache===void 0&&(r.cache=new pp(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){De("Abstract function.")}getInstanceIndex(){De("Abstract function.")}getDrawIndex(){De("Abstract function.")}getFrontFacing(){De("Abstract function.")}getFragCoord(){De("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){De("Abstract function.")}generateTextureLod(){De("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=r?r[s]:null;o!==null?i+=o.build(this,e):i+=this.generateConst(e),s<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,r=null){const i=[];for(const s of t){const{name:o,type:a}=s;r&&r[o]&&r[o].isNode?i.push(r[o].build(this,a)):i.push(this.generateConst(a))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new $n:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new _t:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new ge:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new $t)),e==="float")return Yc(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Yc(t.r)}, ${Yc(t.g)}, ${Yc(t.b)} )`;const r=this.getTypeLength(e),i=this.getComponentType(e),s=o=>this.generateConst(i,o);if(r===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(r===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(r===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const r=this.attributes;for(const s of r)if(s.name===e)return s;const i=new $b(e,t);return this.registerDeclaration(i),r.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Sr)return"int";if(t===Un)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let r=fT(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(r=r.replace("vec","mat")),i+r}getTypeFromArray(e){return b$.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,i=e.itemSize,s=e.normalized;let o;return!(e instanceof kx)&&s!==!0&&(o=this.getTypeFromArray(r)),this.getTypeFromLength(i,o)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return r!==null?Number(r[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=F0(this.stack);const e=P1();return this.stacks.push(e),IA(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const r=this.getDataFromNode(t);r.stack=e}return this.stack=e.parent,IA(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let i=r.getData(e);i===void 0&&(i={},r.setData(e,i)),i[t]===void 0&&(i[t]={});let s=i[t];const o=i.any?i.any.subBuilds:null,a=this.getClosestSubBuild(o);return a&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[a]||(s.subBuildsCache[a]={}),s.subBuilds=o),s}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e,"vertex");let i=r.bufferAttribute;if(i===void 0){const s=this.uniforms.index++;i=new $b("nodeAttribute"+s,t,e),this.bufferAttributes.push(i),r.bufferAttribute=i}return i}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,r=null,i=this.shaderStage){const s=this.getDataFromNode(e,i,this.globalCache);let o=s.structType;if(o===void 0){const a=this.structs.index++;r===null&&(r="StructType"+a),o=new t$(r,t),this.structs[i].push(o),this.types[i][r]=e,s.structType=o}return o}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,i=null){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new Kj(i||"nodeUniform"+a,t,e),this.uniforms[r].push(o),this.registerDeclaration(o),s.uniform=o}return o}getVarFromNode(e,t=null,r=e.getNodeType(this),i=this.shaderStage,s=!1){const o=this.getDataFromNode(e,i),a=this.getSubBuildProperty("variable",o.subBuilds);let c=o[a];if(c===void 0){const f=s?"_const":"_var",p=this.vars[i]||(this.vars[i]=[]),g=this.vars[f]||(this.vars[f]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+g,this.vars[f]++),a!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const b=e.getArrayCount(this);c=new k5(t,r,s,b),s||p.push(c),this.registerDeclaration(c),o[a]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,r=e.getNodeType(this),i=null,s=null){const o=this.getDataFromNode(e,"any"),a=this.getSubBuildProperty("varying",o.subBuilds);let c=o[a];if(c===void 0){const f=this.varyings,p=f.length;t===null&&(t="nodeVarying"+p),a!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new Zj(t,r,i,s),f.push(c),this.registerDeclaration(c),o[a]=c}return c}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let s=1,o=i;for(;r[o]!==void 0;)o=i+"_"+s++;s>1&&(e.name=o,De(`TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${o}'.`)),r[o]=e}getCodeFromNode(e,t,r=this.shaderStage){const i=this.getDataFromNode(e);let s=i.code;if(s===void 0){const o=this.codes[r]||(this.codes[r]=[]),a=o.length;s=new Jj("nodeCode"+a,t),o.push(s),i.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:i}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(i.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of r)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,r){const i=this.getDataFromNode(e),s=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);s.push(t),o.set(r,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new A5,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)r[o.name]=new jw(o.type,o.name);e.layout=null;const i=e.call(r),s=this.flowStagesNode(i,t.type);return e.layout=t,s}flowBuildStage(e,t,r=null){const i=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,r);return this.setBuildStage(i),s}flowStagesNode(e,t=null){const r=this.flow,i=this.vars,s=this.declarations,o=this.cache,a=this.buildStage,c=this.stack,f={code:""};this.flow=f,this.vars={},this.declarations={},this.cache=new pp,this.stack=F0();for(const p of Jm)this.setBuildStage(p),f.result=e.build(this,t);return f.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=i,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(a),f}getFunctionOperator(){return null}buildFunctionCode(){De("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=r,i}flowNodeFromShaderStage(e,t,r=null,i=null){const s=this.tab,o=this.cache,a=this.shaderStage,c=this.context;this.setShaderStage(e);const f={...this.context};delete f.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=f;let p=null;if(this.buildStage==="generate"){const g=this.flowChildNode(t,r);i!==null&&(g.code+=`${this.tab+i} = ${g.result};
`),this.flowCode[e]=this.flowCode[e]+g.code,p=g}else p=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=s,this.context=c,p}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){De("Abstract function.")}getVaryings(){De("Abstract function.")}getVar(e,t,r=null){return`${r!==null?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(r!==void 0)for(const i of r)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){De("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(t!==void 0)for(const i of t)r+=i.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){De("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const r=this.subBuildLayers;for(let i=t.length-1;i>=0;i--){const s=t[i];if(r.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let r;t!==null?r=this.getClosestSubBuild(t):r=this.subBuildFn;let i;return r?i=e?r+"_"+e:r:i=e,i}build(){const{object:e,material:t,renderer:r}=this;if(t!==null){let i=r.library.fromMaterial(t);i===null&&(Be(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new Rn),i.build(this)}else this.addFlow("compute",e);for(const i of Jm){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of eg){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)i==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=_$.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const r=this.getSharedDataFromNode(e);let i=r.cache;if(i===void 0){if(t==="float"||t==="int"||t==="uint")i=new A$(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")i=new c$(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")i=new h$(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")i=new f$(e);else if(t==="color")i=new d$(e);else if(t==="mat2")i=new p$(e);else if(t==="mat3")i=new m$(e);else if(t==="mat4")i=new g$(e);else throw new Error(`Uniform "${t}" not implemented.`);r.cache=i}return i}format(e,t,r){if(t=this.getVectorType(t),r=this.getVectorType(r),t===r||r===null||this.isReference(r))return e;const i=this.getTypeLength(t),s=this.getTypeLength(r);return i===16&&s===9?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&s===4?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||s>4||s===0?e:i===s?`${this.getType(r)}( ${e} )`:i>s?(e=r==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),r)):s===4&&i>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&s>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${tf} - Node System
`}}class Wb{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return r===void 0&&(r={renderId:0,frameId:0},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===ot.FRAME){const i=this._getMaps(this.updateBeforeMap,r);if(i.frameId!==this.frameId){const s=i.frameId;i.frameId=this.frameId,e.updateBefore(this)===!1&&(i.frameId=s)}}else if(t===ot.RENDER){const i=this._getMaps(this.updateBeforeMap,r);if(i.renderId!==this.renderId){const s=i.renderId;i.renderId=this.renderId,e.updateBefore(this)===!1&&(i.renderId=s)}}else t===ot.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===ot.FRAME){const i=this._getMaps(this.updateAfterMap,r);i.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(i.frameId=this.frameId)}else if(t===ot.RENDER){const i=this._getMaps(this.updateAfterMap,r);i.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(i.renderId=this.renderId)}else t===ot.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===ot.FRAME){const i=this._getMaps(this.updateMap,r);i.frameId!==this.frameId&&e.update(this)!==!1&&(i.frameId=this.frameId)}else if(t===ot.RENDER){const i=this._getMaps(this.updateMap,r);i.renderId!==this.renderId&&e.update(this)!==!1&&(i.renderId=this.renderId)}else t===ot.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class Z2{constructor(e,t,r=null,i="",s=!1){this.type=e,this.name=t,this.count=r,this.qualifier=i,this.isConst=s}}Z2.isNodeFunctionInput=!0;class v$ extends Ja{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:H2(this.light),lightColor:e}}}const mp=new dn,Kc=new dn;let zu=null;class x$ extends Ja{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Ve(new ge).setGroup(Ge),this.halfWidth=Ve(new ge).setGroup(Ge),this.updateType=ot.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;Kc.identity(),mp.copy(t.matrixWorld),mp.premultiply(r),Kc.extractRotation(mp),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Kc),this.halfHeight.value.applyMatrix4(Kc)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=Ct(zu.LTC_FLOAT_1),r=Ct(zu.LTC_FLOAT_2)):(t=Ct(zu.LTC_HALF_1),r=Ct(zu.LTC_HALF_2));const{colorNode:i,light:s}=this,o=$2(s);return{lightColor:i,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){zu=e}}class J2 extends Ja{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Ve(0).setGroup(Ge),this.penumbraCosNode=Ve(0).setGroup(Ge),this.cutoffDistanceNode=Ve(0).setGroup(Ge),this.decayExponentNode=Ve(0).setGroup(Ge),this.colorNode=Ve(this.color).setGroup(Ge)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:i}=this;return Zi(r,i,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return r===void 0&&(r=d5(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,o=this.getLightVector(e),a=o.normalize(),c=a.dot(H2(s)),f=this.getSpotAttenuation(e,c),p=o.length(),g=X2({lightDistance:p,cutoffDistance:r,decayExponent:i});let b=t.mul(f).mul(g),x,T;return s.colorNode?(T=this.getLightCoord(e),x=s.colorNode(T)):s.map&&(T=this.getLightCoord(e),x=Ct(s.map,T.xy).onRenderUpdate(()=>s.map)),x&&(b=T.mul(2).sub(1).abs().lessThan(1).all().select(b.mul(x),b)),{lightColor:b,lightDirection:a}}}class T$ extends J2{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let i=null;if(r&&r.isTexture===!0){const s=t.acos().mul(1/Math.PI);i=Ct(r,we(s,0),0).r}else i=super.getSpotAttenuation(t);return i}}const w$=re(([n,e])=>{const t=n.abs().sub(e);return ws(_n(t,0)).add(zr(_n(t.x,t.y),0))});class S$ extends J2{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let r=1;t.map!==null&&(r=t.map.width/t.map.height),t.shadow.aspect=r}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=z(0),r=this.penumbraCosNode,i=Gf(this.light).mul(e.context.positionWorld||Ss);return ze(i.w.greaterThan(0),()=>{const s=i.xyz.div(i.w),o=w$(s.xy.sub(we(.5)),we(.5)),a=oi(-1,St(1,W1(r)).sub(1));t.assign(Tf(o.mul(-2).mul(a)))}),t}}class E$ extends Ja{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class R$ extends Ja{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=j2(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Ve(new $n).setGroup(Ge)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:i}=this,o=na.dot(i).mul(.5).add(.5),a=Tt(r,t,o);e.context.irradiance.addAssign(a)}}class N$ extends Ja{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new ge);this.lightProbe=mr(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=I5(na,this.lightProbe);e.context.irradiance.addAssign(t)}}class q5{parseFunction(){De("Abstract function.")}}class ey{constructor(e,t,r="",i=""){this.type=e,this.inputs=t,this.name=r,this.precision=i}getCode(){De("Abstract function.")}}ey.isNodeFunction=!0;const C$=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,M$=/[a-z_0-9]+/ig,Qb="#pragma main",P$=n=>{n=n.trim();const e=n.indexOf(Qb),t=e!==-1?n.slice(e+Qb.length):n,r=t.match(C$);if(r!==null&&r.length===5){const i=r[4],s=[];let o=null;for(;(o=M$.exec(i))!==null;)s.push(o);const a=[];let c=0;for(;c<s.length;){const T=s[c][0]==="const";T===!0&&c++;let S=s[c][0];S==="in"||S==="out"||S==="inout"?c++:S="";const E=s[c++][0];let C=Number.parseInt(s[c][0]);Number.isNaN(C)===!1?c++:C=null;const P=s[c++][0];a.push(new Z2(E,P,C,S,T))}const f=t.substring(r[0].length),p=r[3]!==void 0?r[3]:"",g=r[2],b=r[1]!==void 0?r[1]:"",x=e!==-1?n.slice(0,e):"";return{type:g,inputs:a,name:p,precision:b,inputsCode:i,blockCode:f,headerCode:x}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class B$ extends ey{constructor(e){const{type:t,inputs:r,name:i,precision:s,inputsCode:o,blockCode:a,headerCode:c}=P$(e);super(t,r,i,s),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(e=this.name){let t;const r=this.blockCode;if(r!==""){const{type:i,inputsCode:s,headerCode:o,precision:a}=this;let c=`${i} ${e} ( ${s.trim()} )`;a!==""&&(c=`${a} ${c}`),t=o+c+r}else t="";return t}}class D$ extends q5{parseFunction(e){return new B$(e)}}const Xb=new WeakMap,ls=[],Eo=[];class L$ extends ra{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new Wb,this.nodeBuilderCache=new Map,this.callHashCache=new Ji,this.groupsData=new Ji,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===G1.name)return!0;if(r===Ge.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(r===PT.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}ls[0]=t,ls[1]=e;let i=this.groupsData.get(ls);return i===void 0&&this.groupsData.set(ls,i={}),ls.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:i}=this,s=this.getForRenderCacheKey(e);if(r=i.get(s),r===void 0){const o=c=>{const f=this.backend.createNodeBuilder(e.object,this.renderer);return f.scene=e.scene,f.material=c,f.camera=e.camera,f.context.material=c,f.lightsNode=e.lightsNode,f.environmentNode=this.getEnvironmentNode(e.scene),f.fogNode=this.getFogNode(e.scene),f.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&f.enableMultiview(),f};let a=o(e.material);try{a.build()}catch(c){a=o(new Rn),a.build(),Be("TSL: "+c)}r=this._createNodeBuilderState(a),i.set(s,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),r=this._createNodeBuilderState(i),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new Yj(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){ls[0]=e,ls[1]=t;const r=this.renderer.info.calls,i=this.callHashCache.get(ls)||{};if(i.callId!==r){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&Eo.push(t.getCacheKey(!0)),s&&Eo.push(s.getCacheKey()),o&&Eo.push(o.getCacheKey()),Eo.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Eo.push(this.renderer.shadowMap.enabled?1:0),Eo.push(this.renderer.shadowMap.type),i.callId=r,i.cacheKey=fu(Eo),this.callHashCache.set(ls,i),Eo.length=0}return ls.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==r||i){const s=this.getCacheNode("background",r,()=>{if(r.isCubeTexture===!0||r.mapping===jg||r.mapping===$g||r.mapping===Gp){if(e.backgroundBlurriness>0||r.mapping===Gp)return L2(r);{let o;return r.isCubeTexture===!0?o=Mr(r):o=Ct(r),ww(o)}}else{if(r.isTexture===!0)return Ct(r,eo.flipY()).setUpdateMatrix(!0);r.isColor!==!0&&Be("WebGPUNodes: Unsupported background configuration.",r)}},i);t.backgroundNode=s,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,i=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||i)&&(o=r(),s.set(t,o)),o}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const i=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const s=zt("color","color",r).setGroup(Ge),o=zt("density","float",r).setGroup(Ge);return VA(s,V2(o))}else if(r.isFog){const s=zt("color","color",r).setGroup(Ge),o=zt("near","float",r).setGroup(Ge),a=zt("far","float",r).setGroup(Ge);return VA(s,G2(o,a))}else Be("Renderer: Unsupported fog configuration.",r)});t.fogNode=i,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const i=this.getCacheNode("environment",r,()=>{if(r.isCubeTexture===!0)return Mr(r);if(r.isTexture===!0)return Ct(r);Be("Nodes: Unsupported environment configuration.",r)});t.environmentNode=i,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,i=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=r,o.camera=i,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return Xb.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),i=e.isArrayTexture?kf(e,Z(eo,fo("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Ct(e,eo).renderOutput(t.toneMapping,t.currentColorSpace);return Xb.set(e,r),i}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const i of r.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const i of r.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new Wb,this.nodeBuilderCache=new Map,this.cacheLib={}}}const gp=new Qg;class Wh{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new WA,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const i=e.length;for(let s=0;s<i;s++){gp.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[r+s],a=gp.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=gp.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,s=i.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let c=0;c<s;c++)o[a+c]=new $t;r=!0}this.projectPlanes(i,o,a),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new Wh(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class O${constructor(e,t){this.bundleGroup=e,this.camera=t}}const ju=[];class F${constructor(){this.bundles=new Ji}get(e,t){const r=this.bundles;ju[0]=e,ju[1]=t;let i=r.get(ju);return i===void 0&&(i=new O$(e,t),r.set(ju,i)),ju.length=0,i}dispose(){this.bundles=new Ji}}class G5{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(r!==null){t=new r;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t)){De(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}addClass(e,t,r){if(r.has(t)){De(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}const I$=new W2,$u=[];class k$ extends Ji{constructor(){super()}createNode(e=[]){return new W2().setLights(e)}getNode(e,t){if(e.isQuadMesh)return I$;$u[0]=e,$u[1]=t;let r=this.get($u);return r===void 0&&(r=this.createNode(),this.set($u,r)),$u.length=0,r}}class sA extends Jo{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const Yb=new ge,Kb=new ge;class U$ extends ef{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new vA,this._cameraL.viewport=new $t,this._cameraR=new vA,this._cameraR.viewport=new $t,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new kR,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=$$.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new _t,this._onSessionEvent=V$.bind(this),this._onSessionEnd=z$.bind(this),this._onInputSourcesChange=j$.bind(this),this._onAnimationFrame=H$.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&De("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&De("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,i,s,o,a,c={}){const f=new UR(e,t),p=new sA(s,o,{format:zi,type:ri,depthTexture:new Wi(s,o,c.stencil?zo:Un,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?jo:$o),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new ds({color:16777215,side:oA});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const b=new gn(f,g);b.position.copy(r),b.quaternion.copy(i);const x={type:"quad",width:e,height:t,translation:r,quaternion:i,pixelwidth:s,pixelheight:o,plane:b,material:g,rendercall:a,renderTarget:p};if(this._layers.push(x),this._session!==null){x.plane.material=new ds({color:16777215,side:oA}),x.plane.material.blending=aA,x.plane.material.blendEquation=js,x.plane.material.blendSrc=Po,x.plane.material.blendDst=Po,x.xrlayer=this._createXRLayer(x);const T=this._session.renderState.layers;T.unshift(x.xrlayer),this._session.updateRenderState({layers:T})}else p.isXRRenderTarget=!1;return b}createCylinderLayer(e,t,r,i,s,o,a,c,f={}){const p=new rx(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),g=new sA(o,a,{format:zi,type:ri,depthTexture:new Wi(o,a,f.stencil?zo:Un,void 0,void 0,void 0,void 0,void 0,void 0,f.stencil?jo:$o),stencilBuffer:f.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});g._autoAllocateDepthBuffer=!0;const b=new ds({color:16777215,side:yr});b.map=g.texture,b.map.offset.y=1,b.map.repeat.y=-1;const x=new gn(p,b);x.position.copy(i),x.quaternion.copy(s);const T={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:i,quaternion:s,pixelwidth:o,pixelheight:a,plane:x,material:b,rendercall:c,renderTarget:g};if(this._layers.push(T),this._session!==null){T.plane.material=new ds({color:16777215,side:yr}),T.plane.material.blending=aA,T.plane.material.blendEquation=js,T.plane.material.blendSrc=Po,T.plane.material.blendDst=Po,T.xrlayer=this._createXRLayer(T);const S=this._session.renderState.layers;S.unshift(T.xrlayer),this._session.updateRenderState({layers:S})}else g.isXRRenderTarget=!1;return x}renderLayers(){const e=new ge,t=new Ql,r=this._renderer,i=this.isPresenting,s=r.getOutputRenderTarget(),o=r._frameBufferTarget;this.isPresenting=!1;const a=new _t;r.getSize(a);const c=r._quad;for(const f of this._layers)if(f.renderTarget.isXRRenderTarget=this._session!==null,f.renderTarget._hasExternalTextures=f.renderTarget.isXRRenderTarget,f.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){f.xrlayer.transform=new XRRigidTransform(f.plane.getWorldPosition(e),f.plane.getWorldQuaternion(t));const p=this._glBinding.getSubImage(f.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(f.renderTarget,p.colorTexture,void 0),r._setXRLayerSize(f.renderTarget.width,f.renderTarget.height),r.setOutputRenderTarget(f.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:g,quad:b}=this._frameBufferTargets.get(f.renderTarget)||{frameBufferTarget:null,quad:null};g?(r._frameBufferTarget=g,r._quad=b):(r._quad=new Ff(new Rn),this._frameBufferTargets.set(f.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),f.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(f.renderTarget),f.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(s),r._frameBufferTarget=o,r._setXRLayerSize(a.x,a.y),r._quad=c,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const i=this._gl,s=i.getContextAttributes();if(this._session=e,e!==null){if(r.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,a=null,c=null;t.depth&&(c=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,o=t.stencil?jo:$o,a=t.stencil?zo:Un);const f={colorFormat:i.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(f.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const p=this._glBinding.createProjectionLayer(f),g=[p];this._glProjLayer=p,t.setPixelRatio(1),t._setXRLayerSize(p.textureWidth,p.textureHeight);const b=this._useMultiview?2:1,x=new Wi(p.textureWidth,p.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,b);if(this._xrRenderTarget=new sA(p.textureWidth,p.textureHeight,{format:zi,type:ri,colorSpace:t.outputColorSpace,depthTexture:x,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const T of this._layers)T.plane.material=new ds({color:16777215,side:T.type==="cylinder"?yr:oA}),T.plane.material.blending=aA,T.plane.material.blendEquation=js,T.plane.material.blendSrc=Po,T.plane.material.blendDst=Po,T.xrlayer=this._createXRLayer(T),g.unshift(T.xrlayer);e.updateRenderState({layers:g})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,i,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new sA(a.framebufferWidth,a.framebufferHeight,{format:zi,type:ri,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const r=e.near,i=e.far,s=this._cameraXR,o=this._cameraL,a=this._cameraR;s.near=a.near=o.near=r,s.far=a.far=o.far=i,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,o.layers.mask=s.layers.mask&3,a.layers.mask=s.layers.mask&5;const c=e.parent,f=s.cameras;Zb(s,c);for(let p=0;p<f.length;p++)Zb(f[p],c);f.length===2?q$(s,o,a):s.projectionMatrix.copy(o.projectionMatrix),G$(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new qR,this._controllers[e]=t),t}}function q$(n,e,t){Yb.setFromMatrixPosition(e.matrixWorld),Kb.setFromMatrixPosition(t.matrixWorld);const r=Yb.distanceTo(Kb),i=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],f=(i[9]-1)/i[5],p=(i[8]-1)/i[0],g=(s[8]+1)/s[0],b=o*p,x=o*g,T=r/(-p+g),S=T*-p;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(S),n.translateZ(T),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),i[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const E=o+T,C=a+T,P=b-S,D=x+(r-S),L=c*a/C*E,k=f*a/C*E;n.projectionMatrix.makePerspective(P,D,L,k,E,C),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function Zb(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function G$(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=rN*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function V$(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const r=this.getReferenceSpace();t.update(n.inputSource,n.frame,r),t.dispatchEvent({type:n.type,data:n.inputSource})}}function z$(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const r=this._controllerInputSources[t];r!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(r))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new sA(t.pixelwidth,t.pixelheight,{format:zi,type:ri,depthTexture:new Wi(t.pixelwidth,t.pixelheight,t.stencilBuffer?zo:Un,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?jo:$o),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function j$(n){const e=this._controllers,t=this._controllerInputSources;for(let r=0;r<n.removed.length;r++){const i=n.removed[r],s=t.indexOf(i);s>=0&&(t[s]=null,e[s].disconnect(i))}for(let r=0;r<n.added.length;r++){const i=n.added[r];let s=t.indexOf(i);if(s===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(i),s=a;break}else if(t[a]===null){t[a]=i,s=a;break}if(s===-1)break}const o=e[s];o&&o.connect(i)}}function $$(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function H$(n,e){if(e===void 0)return;const t=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const c=a.views;this._glBaseLayer!==null&&i.setXRTarget(s.framebuffer);let f=!1;c.length!==t.cameras.length&&(t.cameras.length=0,f=!0);for(let p=0;p<c.length;p++){const g=c[p];let b;if(this._supportsLayers===!0){const T=this._glBinding.getViewSubImage(this._glProjLayer,g);b=T.viewport,p===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,T.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:T.depthStencilTexture)}else b=s.getViewport(g);let x=this._cameras[p];x===void 0&&(x=new vA,x.layers.enable(p),x.viewport=new $t,this._cameras[p]=x),x.matrix.fromArray(g.transform.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale),x.projectionMatrix.fromArray(g.projectionMatrix),x.projectionMatrixInverse.copy(x.projectionMatrix).invert(),x.viewport.set(b.x,b.y,b.width,b.height),p===0&&(t.matrix.copy(x.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),f===!0&&t.cameras.push(x)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const f=this._controllerInputSources[c],p=this._controllers[c];f!==null&&p!==void 0&&p.update(f,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class W$ extends ef{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new $t(0,0,this._width,this._height),this._scissor=new $t(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new Vg,this.depthTexture=new Wi}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,i){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,r,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,i,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,r,i),a.minDepth=s,a.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const Jb=new Jh,wl=new _t,yp=new $t,_p=new Jv,bp=new RR,Zc=new dn,Gs=new $t;class Q${constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:i=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:f=null,outputBufferType:p=or,multiview:g=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=r,this.outputColorSpace=HA,this.toneMapping=Pa,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new IU,this.contextNode=ho(),this.library=new G5,this.lighting=new k$,this._samples=c||a===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new W$(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new X8,this._inspector.setRenderer(this),this._getFallback=f,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Ff(new Rn),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const b=this.alpha===!0?0:1;this._clearColor=new O2(0,0,0,b),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=p,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:ER},this.xr=new U$(this,g),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(x,T,S)=>{await this.compileAsync(x,T);const E=this._renderLists.get(x,T),C=this._renderContexts.get(x,T,this._renderTarget,this._mrt),P=x.overrideMaterial||S.material,D=this._objects.get(S,P,x,T,E.lightsNode,C,C.clippingContext),{fragmentShader:L,vertexShader:k}=D.getNodeBuilderState();return{fragmentShader:L,vertexShader:k}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=r=this._getFallback(i),await r.init(this)}catch(s){t(s);return}else{t(i);return}}this._nodes=new L$(this,r),this._animation=new NU(this,this._nodes,this.info),this._attributes=new OU(r),this._background=new Qj(this,this._nodes),this._geometries=new FU(this._attributes,this.info),this._textures=new ZU(this,r,this.info),this._pipelines=new GU(r,this._nodes),this._bindings=new VU(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new BU(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new $U(this.lighting),this._bundles=new F$,this._renderContexts=new YU,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,s=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,f=e.isScene===!0?e:Jb;r===null&&(r=e);const p=this._renderTarget,g=this._renderContexts.get(r,t,p,this._mrt),b=this._activeMipmapLevel,x=[];this._currentRenderContext=g,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,i.renderId++,i.update(),g.depth=this.depth,g.stencil=this.stencil,g.clippingContext||(g.clippingContext=new Wh),g.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,p);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,g.clippingContext),r!==e&&r.traverseVisible(function(D){D.isLight&&D.layers.test(t.layers)&&T.pushLight(D)}),T.finish(),p!==null){this._textures.updateRenderTarget(p,b);const D=this._textures.get(p);g.textures=D.textures,g.depthTexture=D.depthTexture}else g.textures=null,g.depthTexture=null;this._background.update(f,T,g);const S=T.opaque,E=T.transparent,C=T.transparentDoublePass,P=T.lightsNode;this.opaque===!0&&S.length>0&&this._renderObjects(S,t,f,P),this.transparent===!0&&E.length>0&&this._renderTransparents(E,C,t,f,P),i.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(x)}async renderAsync(e,t){fn('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Be("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=og,t.modelNormalViewMatrix=ag):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===og&&e.modelNormalViewMatrix===ag}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return fn('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Be(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:i,camera:s,renderList:o}=e,a=this._currentRenderContext,c=this._bundles.get(i,s),f=this.backend.get(c);f.renderContexts===void 0&&(f.renderContexts=new Set);const p=i.version!==f.version,g=f.renderContexts.has(a)===!1||p;if(f.renderContexts.add(a),g){this.backend.beginBundle(a),(f.renderObjects===void 0||p)&&(f.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:b,transparent:x,opaque:T}=o;this.opaque===!0&&T.length>0&&this._renderObjects(T,s,t,r),this.transparent===!0&&x.length>0&&this._renderTransparents(x,b,s,t,r),this._currentRenderBundle=null,this.backend.finishBundle(a,c),f.version=i.version}else{const{renderObjects:b}=f;for(let x=0,T=b.length;x<T;x++){const S=b[x];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(a,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,r=e!==Pa,i=t!==Sn.workingColorSpace;if(r===!1&&i===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(wl),{depth:a,stencil:c}=this;let f=this._frameBufferTarget;f===null&&(f=new Jo(s,o,{depthBuffer:a,stencilBuffer:c,type:this._outputBufferType,format:zi,colorSpace:Sn.workingColorSpace,generateMipmaps:!1,minFilter:Xi,magFilter:Xi,samples:this.samples}),f.isPostProcessingRenderTarget=!0,this._frameBufferTarget=f);const p=this.getOutputRenderTarget();f.depthBuffer=a,f.stencilBuffer=c,p!==null?f.setSize(p.width,p.height,p.depth):f.setSize(s,o,1);const g=this._canvasTarget;return f.viewport.copy(g._viewport),f.scissor.copy(g._scissor),f.viewport.multiplyScalar(g._pixelRatio),f.scissor.multiplyScalar(g._pixelRatio),f.scissorTest=g._scissorTest,f.multiview=p!==null?p.multiview:!1,f.resolveDepthBuffer=p!==null?p.resolveDepthBuffer:!0,f._autoAllocateDepthBuffer=p!==null?p._autoAllocateDepthBuffer:!1,f}_renderScene(e,t,r=!0){if(this._isDeviceLost===!0)return;const i=r?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,f=e.isScene===!0?e:Jb,p=this._renderTarget||this._outputRenderTarget,g=this._activeCubeFace,b=this._activeMipmapLevel;let x;i!==null?(x=i,this.setRenderTarget(x)):x=p;const T=this._renderContexts.get(e,t,x,this._mrt);this._currentRenderContext=T,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(T),this.inspector.beginRender(this.backend.getTimestampUID(T),e,t,x);const S=this.coordinateSystem,E=this.xr;if(t.coordinateSystem!==S&&E.isPresenting===!1&&(t.coordinateSystem=S,t.updateProjectionMatrix(),t.isArrayCamera))for(const oe of t.cameras)oe.coordinateSystem=S,oe.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),E.enabled===!0&&E.isPresenting===!0&&(E.cameraAutoUpdate===!0&&E.updateCamera(t),t=E.getCamera());const C=this._canvasTarget;let P=C._viewport,D=C._scissor,L=C._pixelRatio;x!==null&&(P=x.viewport,D=x.scissor,L=1),this.getDrawingBufferSize(wl),yp.set(0,0,wl.width,wl.height);const k=P.minDepth===void 0?0:P.minDepth,q=P.maxDepth===void 0?1:P.maxDepth;T.viewportValue.copy(P).multiplyScalar(L).floor(),T.viewportValue.width>>=b,T.viewportValue.height>>=b,T.viewportValue.minDepth=k,T.viewportValue.maxDepth=q,T.viewport=T.viewportValue.equals(yp)===!1,T.scissorValue.copy(D).multiplyScalar(L).floor(),T.scissor=C._scissorTest&&T.scissorValue.equals(yp)===!1,T.scissorValue.width>>=b,T.scissorValue.height>>=b,T.clippingContext||(T.clippingContext=new Wh),T.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,x);const I=t.isArrayCamera?bp:_p;t.isArrayCamera||(Zc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(Zc,t.coordinateSystem,t.reversedDepth));const U=this._renderLists.get(e,t);if(U.begin(),this._projectObject(e,t,0,U,T.clippingContext),U.finish(),this.sortObjects===!0&&U.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,b);const oe=this._textures.get(x);T.textures=oe.textures,T.depthTexture=oe.depthTexture,T.width=oe.width,T.height=oe.height,T.renderTarget=x,T.depth=x.depthBuffer,T.stencil=x.stencilBuffer}else T.textures=null,T.depthTexture=null,T.width=wl.width,T.height=wl.height,T.depth=this.depth,T.stencil=this.stencil;T.width>>=b,T.height>>=b,T.activeCubeFace=g,T.activeMipmapLevel=b,T.occlusionQueryCount=U.occlusionQueryCount,T.scissorValue.max(Gs.set(0,0,0,0)),T.scissorValue.x+T.scissorValue.width>T.width&&(T.scissorValue.width=Math.max(T.width-T.scissorValue.x,0)),T.scissorValue.y+T.scissorValue.height>T.height&&(T.scissorValue.height=Math.max(T.height-T.scissorValue.y,0)),this._background.update(f,U,T),T.camera=t,this.backend.beginRender(T);const{bundles:j,lightsNode:J,transparentDoublePass:Q,transparent:K,opaque:te}=U;return j.length>0&&this._renderBundles(j,f,J),this.opaque===!0&&te.length>0&&this._renderObjects(te,t,f,J),this.transparent===!0&&K.length>0&&this._renderTransparents(K,Q,t,f,J),this.backend.finishRender(T),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,i!==null&&(this.setRenderTarget(p,g,b),this._renderOutput(x)),f.onAfterRender(this,e,t,x),this.inspector.finishRender(this.backend.getTimestampUID(T)),T}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,r)}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,r)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,r,i){this._canvasTarget.setScissor(e,t,r,i)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,r,i,s=0,o=1){this._canvasTarget.setViewport(e,t,r,i,s,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const i=this._renderTarget||this._getFrameBufferTarget();let s=null;if(i!==null){this._textures.updateRenderTarget(i);const o=this._textures.get(i);s=this._renderContexts.getForClear(i),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=i,s.depth=i.depthBuffer,s.stencil=i.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,s),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){fn('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,r)}async clearColorAsync(){fn('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){fn('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){fn('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Pa,t=this.currentColorSpace!==Sn.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Pa}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Sn.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return De("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const r=this._nodes.nodeFrame,i=r.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const s=this.backend,o=this._pipelines,a=this._bindings,c=this._nodes,f=Array.isArray(e)?e:[e];if(f[0]===void 0||f[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const p of f){if(o.has(p)===!1){const x=()=>{p.removeEventListener("dispose",x),o.delete(p),a.deleteForCompute(p),c.delete(p)};p.addEventListener("dispose",x);const T=p.onInitFunction;T!==null&&T.call(p,{renderer:this})}c.updateForCompute(p),a.updateForCompute(p);const g=a.getForCompute(p),b=o.getForCompute(p,g);s.compute(e,p,g,b,t)}s.finishCompute(e),r.renderId=i,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return fn('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){fn('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Gs.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Gs.copy(t).floor();else{Be("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Gs.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext,i;r!==null?i=r.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),r=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,r,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,i,s,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,r,i,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,r,i,s,a)}_projectObject(e,t,r,i,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?bp:_p;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&Gs.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Zc);const{geometry:f,material:p}=e;p.visible&&i.push(e,f,p,r,Gs.z,null,s)}}else if(e.isLineLoop)Be("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?bp:_p;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:f,material:p}=e;if(this.sortObjects===!0&&(f.boundingSphere===null&&f.computeBoundingSphere(),Gs.copy(f.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Zc)),Array.isArray(p)){const g=f.groups;for(let b=0,x=g.length;b<x;b++){const T=g[b],S=p[T.materialIndex];S&&S.visible&&i.push(e,f,S,r,Gs.z,T,s)}}else p.visible&&i.push(e,f,p,r,Gs.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(e,t),i.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const a=e.children;for(let c=0,f=a.length;c<f;c++)this._projectObject(a[c],t,r,i,s)}_renderBundles(e,t,r){for(const i of e)this._renderBundle(i,t,r)}_renderTransparents(e,t,r,i,s){if(t.length>0){for(const{material:o}of t)o.side=yr;this._renderObjects(t,r,i,s,"backSide");for(const{material:o}of t)o.side=oA;this._renderObjects(e,r,i,s);for(const{material:o}of t)o.side=vi}else this._renderObjects(e,r,i,s)}_renderObjects(e,t,r,i,s=null){for(let o=0,a=e.length;o<a;o++){const{object:c,geometry:f,material:p,group:g,clippingContext:b}=e[o];this._currentRenderObjectFunction(c,r,t,f,p,g,i,b,s)}}_getShadowNodes(e){const t=e.version;let r=this._cacheShadowNodes.get(e);if(r===void 0||r.version!==t){const i=e.map!==null,s=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let a=null,c=null,f=null;if(i||s||o){let p,g;o?(p=e.castShadowNode.rgb,g=e.castShadowNode.a):(p=Z(0),g=z(1)),i&&(g=g.mul(zt("map","texture",e).a)),s&&(g=g.mul(e.colorNode.a)),c=je(p,g)}e.depthNode&&e.depthNode.isNode&&(f=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?a=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(a=e.positionNode),r={version:t,colorNode:c,depthNode:f,positionNode:a},this._cacheShadowNodes.set(e,r)}return r}renderObject(e,t,r,i,s,o,a,c=null,f=null){let p=!1,g,b,x,T;if(e.onBeforeRender(this,t,r,i,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const S=t.overrideMaterial;if(p=!0,g=t.overrideMaterial.colorNode,b=t.overrideMaterial.depthNode,x=t.overrideMaterial.positionNode,T=t.overrideMaterial.side,s.positionNode&&s.positionNode.isNode&&(S.positionNode=s.positionNode),S.alphaTest=s.alphaTest,S.alphaMap=s.alphaMap,S.transparent=s.transparent||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode,S.isShadowPassMaterial){const{colorNode:E,depthNode:C,positionNode:P}=this._getShadowNodes(s);S.side=s.shadowSide===null?s.side:s.shadowSide,E!==null&&(S.colorNode=E),C!==null&&(S.depthNode=C),P!==null&&(S.positionNode=P)}s=S}s.transparent===!0&&s.side===vi&&s.forceSinglePass===!1?(s.side=yr,this._handleObjectFunction(e,s,t,r,a,o,c,"backSide"),s.side=oA,this._handleObjectFunction(e,s,t,r,a,o,c,f),s.side=vi):this._handleObjectFunction(e,s,t,r,a,o,c,f),p&&(t.overrideMaterial.colorNode=g,t.overrideMaterial.depthNode=b,t.overrideMaterial.positionNode=x,t.overrideMaterial.side=T),e.onAfterRender(this,t,r,i,s,o)}_renderObjectDirect(e,t,r,i,s,o,a,c){const f=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);f.drawRange=e.geometry.drawRange,f.group=o;const p=this._nodes.needsRefresh(f);p&&(this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f)),this._pipelines.updateForRender(f),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(f),f.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(f,this.info),p&&this._nodes.updateAfter(f)}_createObjectPipeline(e,t,r,i,s,o,a,c){const f=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);f.drawRange=e.geometry.drawRange,f.group=o,this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f),this._pipelines.getForRender(f,this._compilationPromises),this._nodes.updateAfter(f)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class V5{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function X$(n){return n+(ko-n%ko)%ko}class z5 extends V5{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return X$(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class j5 extends z5{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let Y$=0;class $5 extends j5{constructor(e,t){super("UniformBuffer_"+Y$++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class K$ extends j5{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,i=this.uniforms.length;r<i;r++){const s=this.uniforms[r],o=s.boundary,a=s.itemSize*e,c=t%ko,f=c%o,p=c+f;t+=f,p!==0&&ko-p<a&&(t+=ko-p),s.offset=t/e,t+=a}return Math.ceil(t/ko)*ko}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Be("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s]!==i){const a=this._getBufferForType(o);a[s]=r[s]=i,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z||r[s+4]!==i.w){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,a[s+3]=r[s+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset;if(r[s+0]!==i.r||r[s+1]!==i.g||r[s+2]!==i.b){const o=this.buffer;o[s+0]=r[s+0]=i.r,o[s+1]=r[s+1]=i.g,o[s+2]=r[s+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;if(r[s+0]!==i[0]||r[s+1]!==i[1]||r[s+2]!==i[2]||r[s+4]!==i[3]||r[s+5]!==i[4]||r[s+6]!==i[5]||r[s+8]!==i[6]||r[s+9]!==i[7]||r[s+10]!==i[8]){const o=this.buffer;o[s+0]=r[s+0]=i[0],o[s+1]=r[s+1]=i[1],o[s+2]=r[s+2]=i[2],o[s+4]=r[s+4]=i[3],o[s+5]=r[s+5]=i[4],o[s+6]=r[s+6]=i[5],o[s+8]=r[s+8]=i[6],o[s+9]=r[s+9]=i[7],o[s+10]=r[s+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;return J$(r,i,s)===!1&&(this.buffer.set(i,s),Z$(r,i,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Z$(n,e,t){for(let r=0,i=e.length;r<i;r++)n[t+r]=e[r]}function J$(n,e,t){for(let r=0,i=e.length;r<i;r++)if(n[t+r]!==e[r])return!1;return!0}let eH=0;class H5 extends K${constructor(e,t){super(e),this.id=eH++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class W5 extends V5{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let tH=0;class nH extends W5{constructor(e,t){super(e,t),this.id=tH++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class jf extends nH{constructor(e,t,r,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=i}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Q5 extends jf{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledCubeTexture=!0}}class vg extends jf{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledTexture3D=!0}}const ev={bitcast_int_uint:new Jn("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Jn("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},rH={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},iH={low:"lowp",medium:"mediump",high:"highp"},tv={swizzleAssign:!0,storageBuffer:!1},nv={perspective:"smooth",linear:"noperspective"},rv={centroid:"centroid"},iv=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class sH extends U5{constructor(e,t){super(e,t,new D$),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Xl}_include(e){const t=ev[e];return t.build(this),this.addInclude(t),t}getMethod(e){return ev[e]!==void 0&&this._include(e),rH[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,r){return`${e} ? ${t} : ${r}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const r=t.array,i=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?Kg:Yg;s===2?a=o?Zg:Ws:s===3?a=o?SN:Xg:s===4&&(a=o?Jg:zi);const c={Float32Array:gi,Uint8Array:ri,Uint16Array:Bl,Uint32Array:Un,Int8Array:lA,Int16Array:uA,Int32Array:Sr,Uint8ClampedArray:ri},f=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/s))));let p=Math.ceil(i/s/f);f*p*s<i&&p++;const g=f*p*s,b=new r.constructor(g);b.set(r,0),t.array=b;const x=new Lx(t.array,f,p,a,c[t.array.constructor.name]||gi);x.needsUpdate=!0,x.isPBOTexture=!0;const T=new Ms(x,null,null);T.setPrecision("high"),t.pboNode=T,t.pbo=T.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,i=t.value;if(this.renderer.backend.has(i)){const p=this.renderer.backend.get(i);p.pbo=i.pbo}const s=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(s);this.increaseUsage(r);const a=r.build(this,"uint"),c=this.getDataFromNode(e);let f=c.propertyName;if(f===void 0){const p=this.getVarFromNode(e);f=this.getPropertyName(p);const g=this.getDataFromNode(t);let b=g.propertySizeName;b===void 0&&(b=f+"Size",this.getVarFromNode(t,b,"uint"),this.addLineFlowCode(`${b} = uint( textureSize( ${o}, 0 ).x )`,e),g.propertySizeName=b);const{itemSize:x}=i,T="."+Xa.join("").slice(0,x),S=`ivec2(${a} % ${b}, ${a} / ${b})`,E=this.generateTextureLoad(null,o,S,"0",null,null);let C="vec4";i.pbo.type===Un?C="uvec4":i.pbo.type===Sr&&(C="ivec4"),this.addLineFlowCode(`${f} = ${C}(${E})${T}`,e),c.propertyName=f}return f}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0");let a;return s?o?a=`texelFetchOffset( ${t}, ivec3( ${r}, ${s} ), ${i}, ${o} )`:a=`texelFetch( ${t}, ivec3( ${r}, ${s} ), ${i} )`:o?a=`texelFetchOffset( ${t}, ${r}, ${i}, ${o} )`:a=`texelFetch( ${t}, ${r}, ${i} )`,e!==null&&e.isDepthTexture&&(a+=".x"),a}generateTexture(e,t,r,i,s){return i&&(r=`vec3( ${r}, ${i} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${r}, ${s} ).x`:`texture( ${t}, ${r} ).x`:s?`textureOffset( ${t}, ${r}, ${s} )`:`texture( ${t}, ${r} )`}generateTextureLevel(e,t,r,i,s){return s?`textureLodOffset( ${t}, ${r}, ${i}, ${s} )`:`textureLod( ${t}, ${r}, ${i} )`}generateTextureBias(e,t,r,i,s){return s?`textureOffset( ${t}, ${r}, ${s}, ${i} )`:`texture( ${t}, ${r}, ${i} )`}generateTextureGrad(e,t,r,i,s){return s?`textureGradOffset( ${t}, ${r}, ${i[0]}, ${i[1]}, ${s} )`:`textureGrad( ${t}, ${r}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${r}, ${i} ) )`:s?o?`textureOffset( ${t}, vec4( ${r}, ${s}, ${i} ), ${o} )`:`texture( ${t}, vec4( ${r}, ${s}, ${i} ) )`:o?`textureOffset( ${t}, vec3( ${r}, ${i} ), ${o} )`:`texture( ${t}, vec3( ${r}, ${i} ) )`;Be(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],r=[],i={};for(const o of t){let a=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const p=o.node.value;let g="";(p.isDataTexture===!0||p.isData3DTexture===!0)&&(p.type===Un?g="u":p.type===Sr&&(g="i")),o.type==="texture3D"&&p.isArrayTexture===!1?a=`${g}sampler3D ${o.name};`:p.compareFunction?p.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0?a=`${g}sampler2DArray ${o.name};`:a=`${g}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="cubeDepthTexture")a=`samplerCubeShadow ${o.name};`;else if(o.type==="buffer"){const p=o.node,g=this.getType(p.bufferType),b=p.bufferCount,x=b>0?b:"";a=`${p.name} {
	${g} ${o.name}[${x}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const f=o.node.precision;if(f!==null&&(a=iH[f]+" "+a),c){a="	"+a;const p=o.groupNode.name;(i[p]||(i[p]=[])).push(a)}else a="uniform "+a,r.push(a)}let s="";for(const o in i){const a=i[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=r.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Sr){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const i=r.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let i=0;for(const s of r)t+=`layout( location = ${i++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`	${r.type} ${r.name};`);return t.join(`
`)}getStructs(e){const t=[],r=this.structs[e],i=[];for(const s of r)if(s.output)for(const o of s.members)i.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const i of r){e==="compute"&&(i.needsInterpolation=!0);const s=this.getType(i.type);if(i.needsInterpolation)if(i.interpolationType){const o=nv[i.interpolationType]||i.interpolationType,a=rv[i.interpolationSampling]||"";t+=`${o} ${a} out ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${i.name};
`}else t+=`${s} ${i.name};
`}else if(e==="fragment"){for(const i of r)if(i.needsInterpolation){const s=this.getType(i.type);if(i.interpolationType){const o=nv[i.interpolationType]||i.interpolationType,a=rv[i.interpolationSampling]||"";t+=`${o} ${a} in ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${i.name};
`}}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((r,i)=>r*i,1)}u`}getSubgroupSize(){Be("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Be("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Be("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const i=this.extensions[r]||(this.extensions[r]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(r!==void 0)for(const{name:i,behavior:s}of r.values())t.push(`#extension ${i} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=tv[e];if(t===void 0){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance";break}if(r!==void 0){const i=this.renderer.backend.extensions;i.has(r)&&(i.get(r),t=!0)}tv[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const i=e[r],s=this.getPropertyName(i.attributeNode);s&&(t+=`${i.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${iv}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${iv}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1];for(const a of i){const c=this.getFlowData(a),f=a.name;f&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${f}
	`),r+=`${c.code}
	`,a===s&&t!=="compute"&&(r+=`// result
	`,t==="vertex"?(r+="gl_Position = ",r+=`${c.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=e.groupNode,f=c.name,p=this.getBindGroupArray(f,r);if(t==="texture")a=new jf(s.name,s.node,c),p.push(a);else if(t==="cubeTexture"||t==="cubeDepthTexture")a=new Q5(s.name,s.node,c),p.push(a);else if(t==="texture3D")a=new vg(s.name,s.node,c),p.push(a);else if(t==="buffer"){s.name=`buffer${e.id}`;const g=this.getSharedDataFromNode(e);let b=g.buffer;b===void 0&&(e.name=`NodeBuffer_${e.id}`,b=new $5(e,c),b.name=e.name,g.buffer=b),p.push(b),a=b}else{const g=this.uniformGroups[r]||(this.uniformGroups[r]={});let b=g[f];b===void 0&&(b=new H5(r+"_"+f,c),g[f]=b,p.push(b)),a=this.getNodeUniform(s,t),b.addUniform(a)}o.uniformGPU=a}return s}}let vp=null,Sl=null;class X5{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[gs.RENDER]:null,[gs.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),r=this.renderer.info.frame;let i;e.isComputeNode===!0?i="c:"+this.renderer.info.compute.frameCalls:i="r:"+this.renderer.info.render.frameCalls,t.timestampUID=i+":"+e.id+":f"+r}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?gs.COMPUTE:gs.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){fn("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return vp=vp||new _t,this.renderer.getDrawingBufferSize(vp)}setScissorTest(){}getClearColor(){const e=this.renderer;return Sl=Sl||new O2,e.getClearColor(Sl),Sl.getRGB(Sl),Sl}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:GR(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${tf} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let oH=0;class aH{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class lH{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:i}=r,s=e.array,o=e.usage||i.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,c=r.get(a);let f=c.bufferGPU;f===void 0&&(f=this._createBuffer(i,t,s,o),c.bufferGPU=f,c.bufferType=t,c.version=a.version);let p;if(s instanceof Float32Array)p=i.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)p=i.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?p=i.HALF_FLOAT:p=i.UNSIGNED_SHORT;else if(s instanceof Int16Array)p=i.SHORT;else if(s instanceof Uint32Array)p=i.UNSIGNED_INT;else if(s instanceof Int32Array)p=i.INT;else if(s instanceof Int8Array)p=i.BYTE;else if(s instanceof Uint8Array)p=i.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)p=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let g={bufferGPU:f,bufferType:t,type:p,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:p===i.INT||p===i.UNSIGNED_INT||e.gpuType===Sr,id:oH++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const b=this._createBuffer(i,t,s,o);g=new aH(g,b)}r.set(e,g)}updateAttribute(e){const t=this.backend,{gl:r}=t,i=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(a,o.bufferGPU),c.length===0)r.bufferSubData(a,0,i);else{for(let f=0,p=c.length;f<p;f++){const g=c[f];r.bufferSubData(a,g.start*i.BYTES_PER_ELEMENT,i,g.start,g.count)}s.clearUpdateRanges()}r.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);r.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(i),o=e.array,a=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,s);const c=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.bufferData(r.COPY_WRITE_BUFFER,a,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const f=new e.array.constructor(o.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,f),r.deleteBuffer(c),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),f.buffer}_createBuffer(e,t,r,i){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,r,i),e.bindBuffer(t,null),s}}let xp,Hu;class uH{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;xp={[js]:e.FUNC_ADD,[fx]:e.FUNC_SUBTRACT,[hx]:e.FUNC_REVERSE_SUBTRACT},Hu={[Po]:e.ZERO,[Tx]:e.ONE,[xx]:e.SRC_COLOR,[vx]:e.SRC_ALPHA,[bx]:e.SRC_ALPHA_SATURATE,[_x]:e.DST_COLOR,[yx]:e.DST_ALPHA,[gx]:e.ONE_MINUS_SRC_COLOR,[mx]:e.ONE_MINUS_SRC_ALPHA,[px]:e.ONE_MINUS_DST_COLOR,[dx]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=new $t().fromArray(t),this.currentViewport=new $t().fromArray(r),this._tempVec4=new $t}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==zR?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===jR?t.cullFace(t.BACK):e===$R?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,r=this.backend.drawBuffersIndexedExt;if(r)for(let i=1;i<e.length;i++)r.blendFuncSeparateiOES(i,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,r,i,s,o,a,c){const{gl:f}=this;if(e===Yl){this.currentBlendingEnabled===!0&&(this.disable(f.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(f.BLEND),this.currentBlendingEnabled=!0),e!==aA){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==js||this.currentBlendEquationAlpha!==js)&&(f.blendEquation(f.FUNC_ADD),this.currentBlendEquation=js,this.currentBlendEquationAlpha=js),c)switch(e){case Xs:f.blendFuncSeparate(f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case $0:f.blendFunc(f.ONE,f.ONE);break;case j0:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case z0:f.blendFuncSeparate(f.DST_COLOR,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE);break;default:Be("WebGLState: Invalid blending: ",e);break}else switch(e){case Xs:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case $0:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE,f.ONE,f.ONE);break;case j0:Be("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case z0:Be("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Be("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||r,a=a||i,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(f.blendEquationSeparate(xp[t],xp[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(r!==this.currentBlendSrc||i!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(f.blendFuncSeparate(Hu[r],Hu[i],Hu[o],Hu[a]),this.currentBlendSrc=r,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Px:t.depthFunc(t.NEVER);break;case Mx:t.depthFunc(t.ALWAYS);break;case Cx:t.depthFunc(t.LESS);break;case Nx:t.depthFunc(t.LEQUAL);break;case Rx:t.depthFunc(t.EQUAL);break;case Ex:t.depthFunc(t.GEQUAL);break;case Sx:t.depthFunc(t.GREATER);break;case wx:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:i}=this;e.side===vi?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let s=e.side===yr;t&&(s=!s),this.setFlipSided(s),e.blending===Xs&&e.transparent===!1?this.setBlending(Yl):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r)for(let c=0;c<8;c++)c<r?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,r){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==r)&&(i.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const r=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(r.bindVertexArray(e),t!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:i}=this;return i[e]!==t?(r.bindFramebuffer(e,t),i[e]=t,e===r.DRAW_FRAMEBUFFER&&(i[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(i[r.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:r}=this;let i=[],s=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const o=e.textures;if(i.length!==o.length||i[0]!==r.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)i[a]=r.COLOR_ATTACHMENT0+a;i.length=o.length,s=!0}}else i[0]!==r.BACK&&(i[0]=r.BACK,s=!0);s&&r.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:i,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;r===void 0&&(s===null?r=i.TEXTURE0+a-1:r=s);let c=o[r];c===void 0&&(c={type:void 0,texture:void 0},o[r]=c),(c.type!==e||c.texture!==t)&&(s!==r&&(i.activeTexture(r),this.currentTextureSlot=r),i.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,r){const{gl:i}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==r?(i.bindBufferBase(e,t,r),this.currentBoundBufferBases[s]=r,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,i=r[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class AH{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Xl){const{gl:r,extensions:i}=this;let s;const o=Sn.getTransfer(t);if(e===ri)return r.UNSIGNED_BYTE;if(e===HR)return r.UNSIGNED_SHORT_4_4_4_4;if(e===WR)return r.UNSIGNED_SHORT_5_5_5_1;if(e===Bx)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===Dx)return r.UNSIGNED_INT_10F_11F_11F_REV;if(e===lA)return r.BYTE;if(e===uA)return r.SHORT;if(e===Bl)return r.UNSIGNED_SHORT;if(e===Sr)return r.INT;if(e===Un)return r.UNSIGNED_INT;if(e===gi)return r.FLOAT;if(e===or)return r.HALF_FLOAT;if(e===QR)return r.ALPHA;if(e===Xg)return r.RGB;if(e===zi)return r.RGBA;if(e===$o)return r.DEPTH_COMPONENT;if(e===jo)return r.DEPTH_STENCIL;if(e===Yg)return r.RED;if(e===Kg)return r.RED_INTEGER;if(e===Ws)return r.RG;if(e===Zg)return r.RG_INTEGER;if(e===Jg)return r.RGBA_INTEGER;if(e===y0||e===_0||e===b0||e===v0)if(o===ft)if(s=i.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===y0)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===_0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===b0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===v0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=i.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===y0)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===_0)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===b0)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===v0)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===g_||e===y_||e===__||e===b_)if(s=i.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===g_)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===y_)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===__)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===b_)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===zp||e===jp||e===$p||e===Hp||e===Wp||e===H0||e===Qp)if(s=i.get("WEBGL_compressed_texture_etc"),s!==null){if(e===zp||e===jp)return o===ft?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===$p)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(e===Hp)return s.COMPRESSED_R11_EAC;if(e===Wp)return s.COMPRESSED_SIGNED_R11_EAC;if(e===H0)return s.COMPRESSED_RG11_EAC;if(e===Qp)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===Xp||e===Yp||e===Kp||e===Zp||e===Jp||e===em||e===tm||e===nm||e===rm||e===im||e===sm||e===om||e===am||e===lm)if(s=i.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Xp)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Yp)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Kp)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Zp)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Jp)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===em)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===tm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===nm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===rm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===im)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===sm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===om)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===am)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===lm)return o===ft?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===um)if(s=i.get("EXT_texture_compression_bptc"),s!==null){if(e===um)return o===ft?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Am||e===cm||e===W0||e===hm)if(s=i.get("EXT_texture_compression_rgtc"),s!==null){if(e===Am)return s.COMPRESSED_RED_RGTC1_EXT;if(e===cm)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===W0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===hm)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===zo?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,i)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),i();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),r()}s()})}}let sv=!1,Jc,Tp,ov;class cH{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,sv===!1&&(this._init(),sv=!0)}_init(){const e=this.gl;Jc={[rf]:e.REPEAT,[xA]:e.CLAMP_TO_EDGE,[nf]:e.MIRRORED_REPEAT},Tp={[qi]:e.NEAREST,[ix]:e.NEAREST_MIPMAP_NEAREST,[TA]:e.NEAREST_MIPMAP_LINEAR,[Xi]:e.LINEAR,[Vp]:e.LINEAR_MIPMAP_NEAREST,[Ua]:e.LINEAR_MIPMAP_LINEAR},ov={[cx]:e.NEVER,[Ax]:e.ALWAYS,[sf]:e.LESS,[ux]:e.LEQUAL,[lx]:e.EQUAL,[ax]:e.GEQUAL,[ox]:e.GREATER,[sx]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return e.isCubeTexture===!0?r=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?r=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=t.TEXTURE_3D:r=t.TEXTURE_2D,r}getInternalFormat(e,t,r,i,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];De("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(r===o.FLOAT&&(c=o.R32F),r===o.HALF_FLOAT&&(c=o.R16F),r===o.UNSIGNED_BYTE&&(c=o.R8),r===o.UNSIGNED_SHORT&&(c=o.R16),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.R8UI),r===o.UNSIGNED_SHORT&&(c=o.R16UI),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RG&&(r===o.FLOAT&&(c=o.RG32F),r===o.HALF_FLOAT&&(c=o.RG16F),r===o.UNSIGNED_BYTE&&(c=o.RG8),r===o.UNSIGNED_SHORT&&(c=o.RG16),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RG8UI),r===o.UNSIGNED_SHORT&&(c=o.RG16UI),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RGB){const f=s?m_:Sn.getTransfer(i);r===o.FLOAT&&(c=o.RGB32F),r===o.HALF_FLOAT&&(c=o.RGB16F),r===o.UNSIGNED_BYTE&&(c=o.RGB8),r===o.UNSIGNED_SHORT&&(c=o.RGB16),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I),r===o.UNSIGNED_BYTE&&(c=f===ft?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),r===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGB8UI),r===o.UNSIGNED_SHORT&&(c=o.RGB16UI),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I)),t===o.RGBA){const f=s?m_:Sn.getTransfer(i);r===o.FLOAT&&(c=o.RGBA32F),r===o.HALF_FLOAT&&(c=o.RGBA16F),r===o.UNSIGNED_BYTE&&(c=o.RGBA8),r===o.UNSIGNED_SHORT&&(c=o.RGBA16),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I),r===o.UNSIGNED_BYTE&&(c=f===ft?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),r===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),r===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),r===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:r,extensions:i,backend:s}=this,o=Sn.getPrimaries(Sn.workingColorSpace),a=t.colorSpace===Xl?null:Sn.getPrimaries(t.colorSpace),c=t.colorSpace===Xl||o===a?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),r.texParameteri(e,r.TEXTURE_WRAP_S,Jc[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,Jc[t.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,Jc[t.wrapR])),r.texParameteri(e,r.TEXTURE_MAG_FILTER,Tp[t.magFilter]);const f=t.mipmaps!==void 0&&t.mipmaps.length>0,p=t.minFilter===Xi&&f?Ua:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,Tp[p]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,ov[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===qi||t.minFilter!==TA&&t.minFilter!==Ua||t.type===gi&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const g=i.get("EXT_texture_filter_anisotropic");r.texParameterf(e,g.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:i}=this,s=this.getGLTextureType(e);let o=i[s];o===void 0&&(o=t.createTexture(),r.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),i[s]=o),r.set(e,{textureGPU:o,glTextureType:s})}createTexture(e,t){const{gl:r,backend:i}=this,{levels:s,width:o,height:a,depth:c}=t,f=i.utils.convert(e.format,e.colorSpace),p=i.utils.convert(e.type),g=this.getInternalFormat(e.internalFormat,f,p,e.colorSpace,e.isVideoTexture),b=r.createTexture(),x=this.getGLTextureType(e);i.state.bindTexture(x,b),this.setTextureParameters(x,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,s,g,o,a,c):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,s,g,o,a,c):e.isVideoTexture||r.texStorage2D(x,s,g,o,a),i.set(e,{textureGPU:b,glTextureType:x,glFormat:f,glType:p,glInternalFormat:g})}copyBufferToTexture(e,t){const{gl:r,backend:i}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:c}=i.get(t),{width:f,height:p}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(o,s),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,f,p,a,c,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:i,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:c,glType:f,glInternalFormat:p}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const g=e.mipmaps,b=t.image;for(let x=0;x<g.length;x++){const T=g[x];e.isCompressedArrayTexture?e.format!==r.RGBA?c!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,b.depth,c,T.data):De("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,x,0,0,0,T.width,T.height,b.depth,c,f,T.data):c!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,x,0,0,T.width,T.height,c,T.data):De("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const g=t.images,b=e.mipmaps;for(let x=0;x<6;x++){const T=e0(g[x]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,0,0,i,s,c,f,T);for(let S=0;S<b.length;S++){const E=b[S],C=e0(E.images[x]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+x,S+1,0,0,C.width,C.height,c,f,C)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const g=t.image;if(e.layerUpdates.size>0){const b=VR(g.width,g.height,e.format,e.type);for(const x of e.layerUpdates){const T=g.data.subarray(x*b/g.data.BYTES_PER_ELEMENT,(x+1)*b/g.data.BYTES_PER_ELEMENT);r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,x,g.width,g.height,1,c,f,T)}e.clearLayerUpdates()}else r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isData3DTexture){const g=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(a,0,p,c,f,t.image);else{const g=e.mipmaps;if(g.length>0)for(let b=0,x=g.length;b<x;b++){const T=g[b],S=e0(T);r.texSubImage2D(a,b,0,0,T.width,T.height,c,f,S)}else{const b=e0(t.image);r.texSubImage2D(a,0,0,0,i,s,c,f,b)}}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:i,glTextureType:s}=r.get(e);r.state.bindTexture(s,i),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const i=r.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const s in i.framebuffers)t.deleteFramebuffer(i.framebuffers[s]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let s=0;s<i.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(i.msaaRenderbuffers[s]);delete i.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:r,backend:i}=this,{textureGPU:s,renderTarget:o}=i.get(e);this.deallocateRenderBuffers(o),t===!1&&r.deleteTexture(s),i.delete(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){const{gl:a,backend:c}=this,{state:f}=this.backend,{textureGPU:p,glTextureType:g,glType:b,glFormat:x}=c.get(t);f.bindTexture(g,p);let T,S,E,C,P,D,L,k,q;const I=e.isCompressedTexture?e.mipmaps[o]:e.image;if(r!==null)T=r.max.x-r.min.x,S=r.max.y-r.min.y,E=r.isBox3?r.max.z-r.min.z:1,C=r.min.x,P=r.min.y,D=r.isBox3?r.min.z:0;else{const Y=Math.pow(2,-s);T=Math.floor(I.width*Y),S=Math.floor(I.height*Y),e.isDataArrayTexture||e.isArrayTexture?E=I.depth:e.isData3DTexture?E=Math.floor(I.depth*Y):E=1,C=0,P=0,D=0}i!==null?(L=i.x,k=i.y,q=i.z):(L=0,k=0,q=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const U=a.getParameter(a.UNPACK_ROW_LENGTH),j=a.getParameter(a.UNPACK_IMAGE_HEIGHT),J=a.getParameter(a.UNPACK_SKIP_PIXELS),Q=a.getParameter(a.UNPACK_SKIP_ROWS),K=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,I.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,I.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,C),a.pixelStorei(a.UNPACK_SKIP_ROWS,P),a.pixelStorei(a.UNPACK_SKIP_IMAGES,D);const te=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,oe=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const Y=c.get(e),ae=c.get(t),he=c.get(Y.renderTarget),xe=c.get(ae.renderTarget),me=he.framebuffers[Y.cacheKey],Oe=xe.framebuffers[ae.cacheKey];f.bindFramebuffer(a.READ_FRAMEBUFFER,me),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,Oe);for(let ke=0;ke<E;ke++)te&&(a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,Y.textureGPU,s,D+ke),a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,p,o,q+ke)),a.blitFramebuffer(C,P,T,S,L,k,T,S,a.DEPTH_BUFFER_BIT,a.NEAREST);f.bindFramebuffer(a.READ_FRAMEBUFFER,null),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else if(s!==0||e.isRenderTargetTexture||c.has(e)){const Y=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=a.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=a.createFramebuffer()),f.bindFramebuffer(a.READ_FRAMEBUFFER,this._srcFramebuffer),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let ae=0;ae<E;ae++)te?a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,Y.textureGPU,s,D+ae):a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Y.textureGPU,s),oe?a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,p,o,q+ae):a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,p,o),s!==0?a.blitFramebuffer(C,P,T,S,L,k,T,S,a.COLOR_BUFFER_BIT,a.NEAREST):oe?a.copyTexSubImage3D(g,o,L,k,q+ae,C,P,T,S):a.copyTexSubImage2D(g,o,L,k,C,P,T,S);f.bindFramebuffer(a.READ_FRAMEBUFFER,null),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else oe?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(g,o,L,k,q,T,S,E,x,b,I.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(g,o,L,k,q,T,S,E,x,I.data):a.texSubImage3D(g,o,L,k,q,T,S,E,x,b,I):e.isDataTexture?a.texSubImage2D(a.TEXTURE_2D,o,L,k,T,S,x,b,I.data):e.isCompressedTexture?a.compressedTexSubImage2D(a.TEXTURE_2D,o,L,k,I.width,I.height,x,I.data):a.texSubImage2D(a.TEXTURE_2D,o,L,k,T,S,x,b,I);a.pixelStorei(a.UNPACK_ROW_LENGTH,U),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,j),a.pixelStorei(a.UNPACK_SKIP_PIXELS,J),a.pixelStorei(a.UNPACK_SKIP_ROWS,Q),a.pixelStorei(a.UNPACK_SKIP_IMAGES,K),o===0&&t.generateMipmaps&&a.generateMipmap(g),f.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:i}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:c,z:f,w:p}=r,g=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,b=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(g){const x=a!==0||c!==0;let T,S;if(e.isDepthTexture===!0?(T=i.DEPTH_BUFFER_BIT,S=i.DEPTH_ATTACHMENT,t.stencil&&(T|=i.STENCIL_BUFFER_BIT)):(T=i.COLOR_BUFFER_BIT,S=i.COLOR_ATTACHMENT0),x){const E=this.backend.get(t.renderTarget),C=E.framebuffers[t.getCacheKey()],P=E.msaaFrameBuffer;s.bindFramebuffer(i.DRAW_FRAMEBUFFER,C),s.bindFramebuffer(i.READ_FRAMEBUFFER,P);const D=b-c-p;i.blitFramebuffer(a,D,a+f,D+p,a,D,a+f,D+p,T,i.NEAREST),s.bindFramebuffer(i.READ_FRAMEBUFFER,C),s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,D,f,p),s.unbindTexture()}else{const E=i.createFramebuffer();s.bindFramebuffer(i.DRAW_FRAMEBUFFER,E),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,S,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,f,p,0,0,f,p,T,i.NEAREST),i.deleteFramebuffer(E)}}else s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,b-p-c,f,p),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,i=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:c,stencilBuffer:f,width:p,height:g}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!f){let b=s.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,b,p,g):r>0?(a&&a.isDepthTexture&&a.type===s.FLOAT&&(b=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,r,b,p,g)):s.renderbufferStorage(s.RENDERBUFFER,b,p,g),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&f&&(r>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,r,s.DEPTH24_STENCIL8,p,g):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,p,g),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,r,i,s,o){const{backend:a,gl:c}=this,{textureGPU:f,glFormat:p,glType:g}=this.backend.get(e),b=c.createFramebuffer();a.state.bindFramebuffer(c.READ_FRAMEBUFFER,b);const x=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,x,f,0);const T=this._getTypedArrayType(g),S=this._getBytesPerTexel(g,p),C=i*s*S,P=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,P),c.bufferData(c.PIXEL_PACK_BUFFER,C,c.STREAM_READ),c.readPixels(t,r,i,s,p,g,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const D=new T(C/T.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,P),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,D),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),a.state.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(b),D}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let i=0;if(e===r.UNSIGNED_BYTE&&(i=1),(e===r.UNSIGNED_SHORT_4_4_4_4||e===r.UNSIGNED_SHORT_5_5_5_1||e===r.UNSIGNED_SHORT_5_6_5||e===r.UNSIGNED_SHORT||e===r.HALF_FLOAT)&&(i=2),(e===r.UNSIGNED_INT||e===r.FLOAT)&&(i=4),t===r.RGBA)return i*4;if(t===r.RGB)return i*3;if(t===r.ALPHA)return i}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function e0(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class hH{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class fH{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const av={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class dH{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:i,object:s,type:o,info:a,index:c}=this;c!==0?r.drawElements(i,t,o,e):r.drawArrays(i,e,t),a.update(s,t,1)}renderInstances(e,t,r){const{gl:i,mode:s,type:o,index:a,object:c,info:f}=this;r!==0&&(a!==0?i.drawElementsInstanced(s,t,o,e,r):i.drawArraysInstanced(s,e,t,r),f.update(c,t,r))}renderMultiDraw(e,t,r){const{extensions:i,mode:s,object:o,info:a}=this;if(r===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let f=0;f<r;f++)this.render(e[f],t[f]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,r):c.multiDrawArraysWEBGL(s,e,0,t,0,r);let f=0;for(let p=0;p<r;p++)f+=t[p];a.update(o,f,1)}}renderMultiDrawInstances(e,t,r,i){const{extensions:s,mode:o,object:a,info:c}=this;if(r===0)return;const f=s.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<r;p++)this.renderInstances(e[p],t[p],i[p]);else{this.index!==0?f.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,i,0,r):f.multiDrawArraysInstancedWEBGL(o,e,0,t,0,i,0,r);let p=0;for(let g=0;g<r;g++)p+=t[g]*i[g];c.update(a,p,1)}}}class Y5{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(De(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class pH extends Y5{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){De("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return fn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const r=this.queries[t];if(r)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){Be("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){Be("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[s,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(s,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},r=[];for(const[s,o]of e){const a=s.match(/^(.*):f(\d+)$/),c=parseInt(a[2]);r.includes(c)===!1&&r.push(c),t[c]===void 0&&(t[c]=0);const f=await o;this.timestamps.set(s,f),t[c]+=f}const i=t[r[r.length-1]];return this.lastValue=i,this.frames=r,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,i}catch(e){return Be("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let r,i=!1;const s=()=>{r&&(clearTimeout(r),r=null)},o=c=>{i||(i=!0,s(),t(c))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){r=setTimeout(a,1);return}const p=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(p)/1e6)}catch(c){Be("Error checking query:",c),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class lv extends X5{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",r);function s(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=i,this.extensions=new hH(this),this.capabilities=new fH(this),this.attributeUtils=new lH(this),this.textureUtils=new cH(this),this.bufferRenderer=new dH(this),this.state=new uH(this),this.utils=new AH(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return G0}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),r!==null){const s=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&De("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new pH(this.gl,e,2048));const r=this.timestampQueryPool[e];r.allocateQueriesForContext(t)!==null&&r.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize();t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:a,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,a,c)}this.initTimestampQuery(gs.RENDER,this.getTimestampUID(e)),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,i=this.get(e),s=i.previousContext;r.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let c=0;c<a.length;c++){const f=a[c];f.generateMipmaps&&this.generateMipmaps(f)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:f}=this.getDrawingBufferSize();r.viewport(0,0,c,f)}this.prepareTimestampBuffer(gs.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let c=0;for(let f=0;f<r.length;f++){const p=r[f];p!==null&&o.getQueryParameter(p,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(p,o.QUERY_RESULT)===0&&s.add(i[f]),r[f]=null,o.deleteQuery(p),c++)}c<r.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:i,width:s,height:o}=e.viewportValue;t.viewport(r,e.height-o-i,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,i=null,s=!0,o=!0){const{gl:a,renderer:c}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let f=0;if(e&&(f|=a.COLOR_BUFFER_BIT),t&&(f|=a.DEPTH_BUFFER_BIT),r&&(f|=a.STENCIL_BUFFER_BIT),f!==0){let p;i.clearColorValue?p=i.clearColorValue:p=this.getClearColor();const g=c.getClearDepth(),b=c.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)a.clearColor(p.r,p.g,p.b,p.a),a.clear(f);else{if(s&&this._setFramebuffer(i),e)for(let x=0;x<i.textures.length;x++)x===0?a.clearBufferfv(a.COLOR,x,[p.r,p.g,p.b,p.a]):a.clearBufferfv(a.COLOR,x,[0,0,0,1]);t&&r?a.clearBufferfi(a.DEPTH_STENCIL,0,g,b):t?a.clearBufferfv(a.DEPTH,0,[g]):r&&a.clearBufferiv(a.STENCIL,0,[b]),s&&o&&this._resolveRenderTarget(i)}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(gs.COMPUTE,this.getTimestampUID(e))}compute(e,t,r,i,s=null){const{state:o,gl:a}=this;this.discard===!1&&(o.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:f,attributes:p}=this.get(i),g=this._getVaoKey(p),b=this.vaoCache[g];b===void 0?this.vaoCache[g]=this._createVao(p):o.setVertexState(b),o.useProgram(c),this._bindUniforms(r);const x=this._getTransformFeedback(f);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,x),a.beginTransformFeedback(a.POINTS),s=s!==null?s:t.count,Array.isArray(s)?(fn("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]):s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute&&(fn("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),s=t.count),p[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,s):a.drawArrays(a.POINTS,0,s),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let T=0;T<f.length;T++){const S=f[T];S.pbo&&this.has(S.pbo)&&this.textureUtils.copyBufferToTexture(S.transformBuffer,S.pbo),S.switchBuffers()}}finishCompute(e){const{state:t,gl:r}=this;this.discard=!1,t.disable(r.RASTERIZER_DISCARD),this.prepareTimestampBuffer(gs.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:i,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(r),{gl:c,state:f}=this,p=this.get(s),g=e.getDrawParameters();if(g===null)return;this._bindUniforms(e.getBindings());const b=t.isMesh&&t.matrixWorld.determinant()<0;f.setMaterial(i,b,o),s.textures!==null&&s.textures.length>1&&f.setMRTBlending(s.textures),f.useProgram(a);const x=e.getAttributes(),T=this.get(x);let S=T.vaoGPU;if(S===void 0){const U=this._getVaoKey(x);S=this.vaoCache[U],S===void 0&&(S=this._createVao(x),this.vaoCache[U]=S,T.vaoGPU=S)}const E=e.getIndex(),C=E!==null?this.get(E).bufferGPU:null;f.setVertexState(S,C);const P=p.lastOcclusionObject;if(P!==t&&P!==void 0){if(P!==null&&P.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),p.occlusionQueryIndex++),t.occlusionTest===!0){const U=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,U),p.occlusionQueries[p.occlusionQueryIndex]=U,p.occlusionQueryObjects[p.occlusionQueryIndex]=t}p.lastOcclusionObject=t}const D=this.bufferRenderer;t.isPoints?D.mode=c.POINTS:t.isLineSegments?D.mode=c.LINES:t.isLine?D.mode=c.LINE_STRIP:t.isLineLoop?D.mode=c.LINE_LOOP:i.wireframe===!0?(f.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),D.mode=c.LINES):D.mode=c.TRIANGLES;const{vertexCount:L,instanceCount:k}=g;let{firstVertex:q}=g;if(D.object=t,E!==null){q*=E.array.BYTES_PER_ELEMENT;const U=this.get(E);D.index=E.count,D.type=U.type}else D.index=0;const I=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(fn("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),D.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?D.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):fn("WebGLBackend: WEBGL_multi_draw not supported."):k>1?D.renderInstances(q,L,k):D.render(q,L)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const U=this.get(e.camera),j=e.camera.cameras,J=e.getBindingGroup("cameraIndex").bindings[0];if(U.indexesGPU===void 0||U.indexesGPU.length!==j.length){const ae=new Uint32Array([0,0,0,0]),he=[];for(let xe=0,me=j.length;xe<me;xe++){const Oe=c.createBuffer();ae[0]=xe,c.bindBuffer(c.UNIFORM_BUFFER,Oe),c.bufferData(c.UNIFORM_BUFFER,ae,c.STATIC_DRAW),he.push(Oe)}U.indexesGPU=he}const Q=this.get(J),K=this.renderer.getPixelRatio(),te=this._currentContext.renderTarget,oe=this._isRenderCameraDepthArray(this._currentContext),Y=this._currentContext.activeCubeFace;if(oe){const ae=this.get(te.depthTexture);if(ae.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){ae.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:he}=te;for(let xe=0,me=j.length;xe<me;xe++)this.renderer._activeCubeFace=xe,this._currentContext.activeCubeFace=xe,this._setFramebuffer(this._currentContext),this.clear(!1,!0,he,this._currentContext,!1,!1);this.renderer._activeCubeFace=Y,this._currentContext.activeCubeFace=Y}}for(let ae=0,he=j.length;ae<he;ae++){const xe=j[ae];if(t.layers.test(xe.layers)){oe&&(this.renderer._activeCubeFace=ae,this._currentContext.activeCubeFace=ae,this._setFramebuffer(this._currentContext));const me=xe.viewport;if(me!==void 0){const Oe=me.x*K,ke=me.y*K,Ke=me.width*K,Ye=me.height*K;f.viewport(Math.floor(Oe),Math.floor(e.context.height-Ye-ke),Math.floor(Ke),Math.floor(Ye))}f.bindBufferBase(c.UNIFORM_BUFFER,Q.index,U.indexesGPU[ae]),I()}this._currentContext.activeCubeFace=Y,this.renderer._activeCubeFace=Y}}else I()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}updateSampler(){return""}createNodeBuilder(e,t){return new sH(e,t)}createProgram(e){const t=this.gl,{stage:r,code:i}=e,s=r==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,i=e.pipeline,{fragmentProgram:s,vertexProgram:o}=i,a=r.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU;if(r.attachShader(a,c),r.attachShader(a,f),r.linkProgram(a),this.set(i,{programGPU:a,fragmentShader:c,vertexShader:f}),t!==null&&this.parallel){const p=new Promise(g=>{const b=this.parallel,x=()=>{r.getProgramParameter(a,b.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),g()):requestAnimationFrame(x)};x()});t.push(p);return}this._completeCompile(e,i)}_handleSource(e,t){const r=e.split(`
`),i=[],s=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let a=s;a<o;a++){const c=a+1;i.push(`${c===t?">":" "} ${c}: ${r[a]}`)}return i.join(`
`)}_getShaderErrors(e,t,r){const i=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(i&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const c=parseInt(a[1]);return r.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const i=this.gl,o=(i.getProgramInfoLog(e)||"").trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,r,t);else{const a=this._getShaderErrors(i,r,"vertex"),c=this._getShaderErrors(i,t,"fragment");Be("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+a+`
`+c)}else o!==""&&De("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:r,gl:i}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:c}=s;i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,a,c),r.useProgram(o);const f=e.getBindings();this._setupBindings(f,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:r,gl:i}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=i.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU,p=o.transforms,g=[],b=[];for(let E=0;E<p.length;E++){const C=p[E];g.push(C.varyingName),b.push(C.attributeNode)}i.attachShader(a,c),i.attachShader(a,f),i.transformFeedbackVaryings(a,g,i.SEPARATE_ATTRIBS),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,c,f),r.useProgram(a),this._setupBindings(t,a);const x=o.attributes,T=[],S=[];for(let E=0;E<x.length;E++){const C=x[E].node.attribute;T.push(C),this.has(C)||this.attributeUtils.createAttribute(C,i.ARRAY_BUFFER)}for(let E=0;E<b.length;E++){const C=b[E].attribute;this.has(C)||this.attributeUtils.createAttribute(C,i.ARRAY_BUFFER);const P=this.get(C);S.push(P)}this.set(e,{programGPU:a,transformBuffers:S,attributes:T})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let r=0,i=0;for(const s of t){this.set(s,{textures:i,uniformBuffers:r});for(const o of s.bindings)o.isUniformBuffer&&r++,o.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let i=r.uniformBuffers,s=r.textures;for(const o of e.bindings){const a=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:f}=this.get(c);f===void 0?(f=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,f),t.bufferData(t.UNIFORM_BUFFER,c.byteLength,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:f})):t.bindBuffer(t.UNIFORM_BUFFER,f);const p=o.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,f),p.length===0)t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW);else{const g=V0(c),b=g?1:c.BYTES_PER_ELEMENT;for(let x=0,T=p.length;x<T;x++){const S=p[x],E=S.start*b,C=S.count*b,P=E*(g?c.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,P,c,E,C)}}a.index=i++,a.bufferGPU=f,this.set(o,a)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:f}=this.get(o.texture);a.index=s++,a.textureGPU=c,a.glTextureType=f,this.set(o,a)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,s=e.buffer,o=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,i),o.length===0)t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW);else{const a=V0(s),c=a?1:s.BYTES_PER_ELEMENT;for(let f=0,p=o.length;f<p;f++){const g=o[f],b=g.start*c,x=g.count*c,T=b*(a?s.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,T,s,b,x)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(av).filter(i=>av[i]===e),r=this.extensions;for(let i=0;i<t.length;i++)if(r.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,r,i,s,o)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let i=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:c,stencilBuffer:f}=s,p=s.isWebGLCubeRenderTarget===!0,g=s.isRenderTarget3D===!0,b=s.depth>1,x=s.isXRRenderTarget===!0,T=x===!0&&s._hasExternalTextures===!0;let S=o.msaaFrameBuffer,E=o.depthRenderbuffer;const C=this.extensions.get("WEBGL_multisampled_render_to_texture"),P=this.extensions.get("OVR_multiview2"),D=this._useMultisampledExtension(s),L=zw(e);let k;if(p?(o.cubeFramebuffers||(o.cubeFramebuffers={}),k=o.cubeFramebuffers[L]):x&&T===!1?k=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),k=o.framebuffers[L]),k===void 0){k=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,k);const q=e.textures,I=[];if(p){o.cubeFramebuffers[L]=k;const{textureGPU:j}=this.get(q[0]),J=this.renderer._activeCubeFace,Q=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+J,j,Q)}else{o.framebuffers[L]=k;for(let j=0;j<q.length;j++){const J=q[j],Q=this.get(J);Q.renderTarget=e.renderTarget,Q.cacheKey=L;const K=t.COLOR_ATTACHMENT0+j;if(s.multiview)P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,K,Q.textureGPU,0,a,0,2);else if(g||b){const te=this.renderer._activeCubeFace,oe=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,K,Q.textureGPU,oe,te)}else if(D)C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,K,t.TEXTURE_2D,Q.textureGPU,0,a);else{const te=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,K,t.TEXTURE_2D,Q.textureGPU,te)}}}const U=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const j=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(j,e,0,D),o.xrDepthRenderbuffer=j,I.push(f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,j),t.framebufferRenderbuffer(t.FRAMEBUFFER,U,t.RENDERBUFFER,j)}else if(e.depthTexture!==null){I.push(f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const j=this.get(e.depthTexture);if(j.renderTarget=e.renderTarget,j.cacheKey=L,s.multiview)P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,j.textureGPU,0,a,0,2);else if(T&&D)C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const J=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,U,j.textureGPU,0,J)}else if(e.depthTexture.isCubeTexture){const J=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_CUBE_MAP_POSITIVE_X+J,j.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0)}o.depthInvalidationArray=I}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,k);const I=this.renderer._activeCubeFace,U=this.get(e.depthTexture),j=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,j,U.textureGPU,0,I)}if((x||D||s.multiview)&&s._isOpaqueFramebuffer!==!0){r.bindFramebuffer(t.FRAMEBUFFER,k);const I=this.get(e.textures[0]);s.multiview?P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,I.textureGPU,0,a,0,2):D?C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,I.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,I.textureGPU,0);const U=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const j=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,j),t.framebufferRenderbuffer(t.FRAMEBUFFER,U,t.RENDERBUFFER,j)}else{const j=this.get(e.depthTexture);s.multiview?P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,U,j.textureGPU,0,a,0,2):D?C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,U,t.TEXTURE_2D,j.textureGPU,0)}}}if(a>0&&D===!1&&!s.multiview){if(S===void 0){const q=[];S=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,S);const I=[],U=e.textures;for(let j=0;j<U.length;j++){I[j]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,I[j]),q.push(t.COLOR_ATTACHMENT0+j);const J=e.textures[j],Q=this.get(J);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,Q.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+j,t.RENDERBUFFER,I[j])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=S,o.msaaRenderbuffers=I,c&&E===void 0){E=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(E,e,a),o.depthRenderbuffer=E;const j=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;q.push(j)}o.invalidationArray=q}i=o.msaaFrameBuffer}else i=k;r.drawBuffers(e,k)}r.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){const i=this.get(e[r]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();t.bindVertexArray(r);for(let i=0;i<e.length;i++){const s=e[i],o=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(i);let a,c;s.isInterleavedBufferAttribute===!0?(a=s.data.stride*o.bytesPerElement,c=s.offset*o.bytesPerElement):(a=0,c=0),o.isInteger?t.vertexAttribIPointer(i,s.itemSize,o.type,a,c):t.vertexAttribPointer(i,s.itemSize,o.type,s.normalized,a,c),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(i,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(i,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),r}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let r=this.transformFeedbackCache[t];if(r!==void 0)return r;const{gl:i}=this;r=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r);for(let s=0;s<e.length;s++){const o=e[s];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const i of e)for(const s of i.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=r.getUniformBlockIndex(t,s.name);r.uniformBlockBinding(t,c,a)}else if(s.isSampledTexture){const c=r.getUniformLocation(t,s.name);r.uniform1i(c,a)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const i of e)for(const s of i.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&r.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_resolveRenderTarget(e){const{gl:t,state:r}=this,i=e.renderTarget;if(e.textures!==null&&i){const s=this.get(i);if(i.samples>0&&this._useMultisampledExtension(i)===!1){const o=s.framebuffers[e.getCacheKey()];let a=t.COLOR_BUFFER_BIT;i.resolveDepthBuffer&&(i.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT));const c=s.msaaFrameBuffer,f=s.msaaRenderbuffers,p=e.textures,g=p.length>1;if(r.bindFramebuffer(t.READ_FRAMEBUFFER,c),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),g)for(let b=0;b<p.length;b++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.TEXTURE_2D,null,0);for(let b=0;b<p.length;b++){if(g){const{textureGPU:x}=this.get(p[b]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,f[b]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,x,0)}if(e.scissor){const{x,y:T,width:S,height:E}=e.scissorValue,C=e.height-E-T;t.blitFramebuffer(x,C,x+S,C+E,x,C,x+S,C+E,a,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST)}if(g)for(let b=0;b<p.length;b++){const{textureGPU:x}=this.get(p[b]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.RENDERBUFFER,f[b]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+b,t.TEXTURE_2D,x,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(i.resolveDepthBuffer===!1&&s.framebuffers){const o=s.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Ul={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},ka=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},nr={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},wr={Store:"store"},It={Load:"load",Clear:"clear"},uv={CCW:"ccw",CW:"cw"},Av={None:"none",Back:"back"},uu={Uint16:"uint16",Uint32:"uint32"},ee={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},wp={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Ra={Linear:"linear",Nearest:"nearest"},Et={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},_a={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},cv={None:0,All:15},Ro={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},Sp={Storage:"storage",ReadOnlyStorage:"read-only-storage"},Ep={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},hv={NonFiltering:"non-filtering",Comparison:"comparison"},ba={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},fv={TwoD:"2d",ThreeD:"3d"},kn={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},mH={All:"all"},t0={Vertex:"vertex",Instance:"instance"},xg={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},dv={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class gH extends W5{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class yH extends z5{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let _H=0;class bH extends yH{constructor(e,t){super("StorageBuffer_"+_H++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:ar.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class vH extends ra{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Ra.Linear}),this.flipYSampler=e.createSampler({minFilter:Ra.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Ul.TriangleStrip,stripIndexFormat:uu.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Ul.TriangleStrip,stripIndexFormat:uu.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const i=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),f=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),p=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:r}),g=f.createView({baseMipLevel:0,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:0}),b=this.device.createCommandEncoder({}),x=(T,S,E)=>{const C=T.getBindGroupLayout(0),P=this.device.createBindGroup({layout:C,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:S}]}),D=b.beginRenderPass({colorAttachments:[{view:E,loadOp:It.Clear,storeOp:wr.Store,clearValue:[0,0,0,0]}]});D.setPipeline(T),D.setBindGroup(0,P),D.draw(4,1,0,0),D.end()};x(a,p,g),x(c,g,p),this.device.queue.submit([b.finish()]),f.destroy()}generateMipmaps(e,t,r=0,i=null){const s=this.get(e);s.layers===void 0&&(s.layers=[]);const o=s.layers[r]||this._mipmapCreateBundles(e,t,r),a=i||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,o),i===null&&this.device.queue.submit([a.finish()]),s.layers[r]=o}_mipmapCreateBundles(e,t,r){const i=this.getTransferPipeline(t.format),s=i.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:r});const a=[];for(let c=1;c<t.mipLevelCount;c++){const f=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),p=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:kn.TwoD,baseArrayLayer:r}),g={colorAttachments:[{view:p,loadOp:It.Clear,storeOp:wr.Store,clearValue:[0,0,0,0]}]},b=this.device.createRenderBundleEncoder({colorFormats:[t.format]});b.setPipeline(i),b.setBindGroup(0,f),b.draw(4,1,0,0),a.push({renderBundles:[b.finish()],passDescriptor:g}),o=p}return a}_mipmapRunBundles(e,t){const r=t.length;for(let i=0;i<r;i++){const s=t[i],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const xH={[cx]:"never",[sf]:"less",[lx]:"equal",[ux]:"less-equal",[ox]:"greater",[ax]:"greater-equal",[Ax]:"always",[sx]:"not-equal"},TH=[0,1,3,2,4,5];class wH{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,r=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let i=this._samplerCache.get(r);if(i===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===Ra.Linear&&o.minFilter===Ra.Linear&&o.mipmapFilter===Ra.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=xH[e.compareFunction]),i={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(r,i)}const s=t.get(e);if(s.sampler!==i.sampler){if(s.sampler!==void 0){const o=this._samplerCache.get(s.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(s.samplerKey)}s.samplerKey=r,s.sampler=i.sampler,i.usedTimes++}return r}createDefaultTexture(e){let t;const r=Tg(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,i=r.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){i.texture=e.sourceTexture,i.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const f=this._getDimension(e),p=e.internalFormat||t.format||Tg(e,r.device);i.format=p;const{samples:g,primarySamples:b,isMSAA:x}=r.utils.getTextureSampleData(e);let T=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(T|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&p!==ee.RGB9E5UFloat&&(T|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:b,dimension:f,format:p,usage:T};if(p===void 0){De("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(S.textureBindingViewDimension=kn.Cube),i.texture=r.device.createTexture(S),x){const E=Object.assign({},S);E.label=E.label+"-msaa",E.sampleCount=g,E.mipLevelCount=1,i.msaaTexture=r.device.createTexture(E)}i.initialized=!0,i.textureDescriptorGPU=S}destroyTexture(e,t=!1){const r=this.backend,i=r.get(e);i.texture!==void 0&&t===!1&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),r.delete(e)}generateMipmaps(e,t=null){const r=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,i,t);else{const i=e.image.depth||1;for(let s=0;s<i;s++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,s,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:r,height:i}=e.getDrawingBufferSize(),s=e.renderer.currentSamples,o=t.colorTexture,a=e.get(o);if(o.width===r&&o.height===i&&o.samples===s)return a.texture;let c=a.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:r,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=r,o.source.height=i,o.samples=s,a.texture=c,c}getDepthBuffer(e=!0,t=!1){const r=this.backend,i=r.renderer.getCanvasTarget(),{width:s,height:o}=r.getDrawingBufferSize(),a=r.renderer.currentSamples,c=i.depthTexture;if(c.width===s&&c.height===o&&c.samples===a&&c.depth===e&&c.stencil===t)return r.get(c).texture;const f=r.get(c).texture;let p,g;if(t?(p=jo,g=zo):e&&(p=$o,g=Un),f!==void 0){if(c.image.width===s&&c.image.height===o&&c.format===p&&c.type===g&&c.samples===a)return f;this.destroyTexture(c)}return c.name="depthBuffer",c.format=p,c.type=g,c.image.width=s,c.image.height=o,c.samples=a,this.createTexture(c,{width:s,height:o}),r.get(c).texture}updateTexture(e,t){const r=this.backend.get(e),i=e.mipmaps,{textureDescriptorGPU:s}=r;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyBufferToTexture(c,r.texture,s,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,r.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,r.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,r.texture,s);else if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyImageToTexture(c,r.texture,s,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,r.texture,s,0,e.flipY,e.premultiplyAlpha);r.version=e.version}}async copyTextureToBuffer(e,t,r,i,s,o){const a=this.backend.device,c=this.backend.get(e),f=c.texture,p=c.textureDescriptorGPU.format,g=this._getBytesPerTexel(p);let b=i*g;b=Math.ceil(b/256)*256;const x=a.createBuffer({size:(s-1)*b+i*g,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),T=a.createCommandEncoder();T.copyTextureToBuffer({texture:f,origin:{x:t,y:r,z:o}},{buffer:x,bytesPerRow:b},{width:i,height:s});const S=this._getTypedArrayType(p);a.queue.submit([T.finish()]),await x.mapAsync(GPUMapMode.READ);const E=x.getMappedRange();return new S(E)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new Wg;r.minFilter=qi,r.magFilter=qi,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const r=new Hg;r.minFilter=qi,r.magFilter=qi,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,r){const i=e.images,s=e.mipmaps;for(let o=0;o<6;o++){const a=i[o],c=e.flipY===!0?TH[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,r,c,e.flipY):this._copyImageToTexture(a,t,r,c,e.flipY,e.premultiplyAlpha);for(let f=0;f<s.length;f++){const g=s[f].images[o];g.isDataTexture?this._copyBufferToTexture(g.image,t,r,c,e.flipY,0,f+1):this._copyImageToTexture(g,t,r,c,e.flipY,e.premultiplyAlpha,f+1)}}}_copyImageToTexture(e,t,r,i,s,o,a=0){const c=this.backend.device,f=a>0?e.width:r.size.width,p=a>0?e.height:r.size.height;try{c.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:a,origin:{x:0,y:0,z:i},premultipliedAlpha:o},{width:f,height:p,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new vH(this.backend.device)),e}_generateMipmaps(e,t,r=0,i=null){this._getPassUtils().generateMipmaps(e,t,r,i)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,i,s,o=0,a=0){const c=this.backend.device,f=e.data,p=this._getBytesPerTexel(r.format),g=e.width*p;c.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:i}},f,{offset:e.width*e.height*p*o,bytesPerRow:g},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,r,i)}_copyCompressedBufferToTexture(e,t,r){const i=this.backend.device,s=this._getBlockData(r.format),o=r.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const c=e[a],f=c.width,p=c.height,g=o?r.size.depthOrArrayLayers:1,b=Math.ceil(f/s.width)*s.byteLength,x=b*Math.ceil(p/s.height);for(let T=0;T<g;T++)i.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:T}},c.data,{offset:T*x,bytesPerRow:b,rowsPerImage:Math.ceil(p/s.height)},{width:Math.ceil(f/s.width)*s.width,height:Math.ceil(p/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ee.BC1RGBAUnorm||e===ee.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ee.BC2RGBAUnorm||e===ee.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.BC3RGBAUnorm||e===ee.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.BC4RUnorm||e===ee.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===ee.BC5RGUnorm||e===ee.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ee.BC6HRGBUFloat||e===ee.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ee.BC7RGBAUnorm||e===ee.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.ETC2RGB8Unorm||e===ee.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ee.ETC2RGB8A1Unorm||e===ee.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ee.ETC2RGBA8Unorm||e===ee.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ee.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ee.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ee.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ee.ASTC4x4Unorm||e===ee.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ee.ASTC5x4Unorm||e===ee.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ee.ASTC5x5Unorm||e===ee.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ee.ASTC6x5Unorm||e===ee.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ee.ASTC6x6Unorm||e===ee.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ee.ASTC8x5Unorm||e===ee.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ee.ASTC8x6Unorm||e===ee.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ee.ASTC8x8Unorm||e===ee.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ee.ASTC10x5Unorm||e===ee.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ee.ASTC10x6Unorm||e===ee.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ee.ASTC10x8Unorm||e===ee.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ee.ASTC10x10Unorm||e===ee.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ee.ASTC12x10Unorm||e===ee.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ee.ASTC12x12Unorm||e===ee.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=wp.ClampToEdge;return e===rf?t=wp.Repeat:e===nf&&(t=wp.MirrorRepeat),t}_convertFilterMode(e){let t=Ra.Linear;return(e===qi||e===ix||e===TA)&&(t=Ra.Nearest),t}_getBytesPerTexel(e){if(e===ee.R8Unorm||e===ee.R8Snorm||e===ee.R8Uint||e===ee.R8Sint)return 1;if(e===ee.R16Uint||e===ee.R16Sint||e===ee.R16Float||e===ee.RG8Unorm||e===ee.RG8Snorm||e===ee.RG8Uint||e===ee.RG8Sint)return 2;if(e===ee.R32Uint||e===ee.R32Sint||e===ee.R32Float||e===ee.RG16Uint||e===ee.RG16Sint||e===ee.RG16Float||e===ee.RGBA8Unorm||e===ee.RGBA8UnormSRGB||e===ee.RGBA8Snorm||e===ee.RGBA8Uint||e===ee.RGBA8Sint||e===ee.BGRA8Unorm||e===ee.BGRA8UnormSRGB||e===ee.RGB9E5UFloat||e===ee.RGB10A2Unorm||e===ee.RG11B10UFloat||e===ee.Depth32Float||e===ee.Depth24Plus||e===ee.Depth24PlusStencil8||e===ee.Depth32FloatStencil8)return 4;if(e===ee.RG32Uint||e===ee.RG32Sint||e===ee.RG32Float||e===ee.RGBA16Uint||e===ee.RGBA16Sint||e===ee.RGBA16Float)return 8;if(e===ee.RGBA32Uint||e===ee.RGBA32Sint||e===ee.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ee.R8Uint)return Uint8Array;if(e===ee.R8Sint)return Int8Array;if(e===ee.R8Unorm)return Uint8Array;if(e===ee.R8Snorm)return Int8Array;if(e===ee.RG8Uint)return Uint8Array;if(e===ee.RG8Sint)return Int8Array;if(e===ee.RG8Unorm)return Uint8Array;if(e===ee.RG8Snorm)return Int8Array;if(e===ee.RGBA8Uint)return Uint8Array;if(e===ee.RGBA8Sint)return Int8Array;if(e===ee.RGBA8Unorm||e===ee.RGBA8UnormSRGB)return Uint8Array;if(e===ee.RGBA8Snorm)return Int8Array;if(e===ee.R16Uint)return Uint16Array;if(e===ee.R16Sint)return Int16Array;if(e===ee.RG16Uint)return Uint16Array;if(e===ee.RG16Sint)return Int16Array;if(e===ee.RGBA16Uint)return Uint16Array;if(e===ee.RGBA16Sint)return Int16Array;if(e===ee.R16Float||e===ee.RG16Float||e===ee.RGBA16Float)return Uint16Array;if(e===ee.R32Uint)return Uint32Array;if(e===ee.R32Sint)return Int32Array;if(e===ee.R32Float)return Float32Array;if(e===ee.RG32Uint)return Uint32Array;if(e===ee.RG32Sint)return Int32Array;if(e===ee.RG32Float)return Float32Array;if(e===ee.RGBA32Uint)return Uint32Array;if(e===ee.RGBA32Sint)return Int32Array;if(e===ee.RGBA32Float)return Float32Array;if(e===ee.BGRA8Unorm||e===ee.BGRA8UnormSRGB)return Uint8Array;if(e===ee.RGB10A2Unorm||e===ee.RGB9E5UFloat||e===ee.RG11B10UFloat)return Uint32Array;if(e===ee.Depth32Float)return Float32Array;if(e===ee.Depth24Plus||e===ee.Depth24PlusStencil8)return Uint32Array;if(e===ee.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=fv.ThreeD:t=fv.TwoD,t}}function Tg(n,e=null){const t=n.format,r=n.type,i=n.colorSpace,s=Sn.getTransfer(i);let o;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case y0:case _0:o=s===ft?ee.BC1RGBAUnormSRGB:ee.BC1RGBAUnorm;break;case b0:o=s===ft?ee.BC2RGBAUnormSRGB:ee.BC2RGBAUnorm;break;case v0:o=s===ft?ee.BC3RGBAUnormSRGB:ee.BC3RGBAUnorm;break;case Am:o=ee.BC4RUnorm;break;case cm:o=ee.BC4RSnorm;break;case W0:o=ee.BC5RGUnorm;break;case hm:o=ee.BC5RGSnorm;break;case um:o=s===ft?ee.BC7RGBAUnormSRGB:ee.BC7RGBAUnorm;break;case jp:case zp:o=s===ft?ee.ETC2RGB8UnormSRGB:ee.ETC2RGB8Unorm;break;case $p:o=s===ft?ee.ETC2RGBA8UnormSRGB:ee.ETC2RGBA8Unorm;break;case Hp:o=ee.EACR11Unorm;break;case Wp:o=ee.EACR11Snorm;break;case H0:o=ee.EACRG11Unorm;break;case Qp:o=ee.EACRG11Snorm;break;case Xp:o=s===ft?ee.ASTC4x4UnormSRGB:ee.ASTC4x4Unorm;break;case Yp:o=s===ft?ee.ASTC5x4UnormSRGB:ee.ASTC5x4Unorm;break;case Kp:o=s===ft?ee.ASTC5x5UnormSRGB:ee.ASTC5x5Unorm;break;case Zp:o=s===ft?ee.ASTC6x5UnormSRGB:ee.ASTC6x5Unorm;break;case Jp:o=s===ft?ee.ASTC6x6UnormSRGB:ee.ASTC6x6Unorm;break;case em:o=s===ft?ee.ASTC8x5UnormSRGB:ee.ASTC8x5Unorm;break;case tm:o=s===ft?ee.ASTC8x6UnormSRGB:ee.ASTC8x6Unorm;break;case nm:o=s===ft?ee.ASTC8x8UnormSRGB:ee.ASTC8x8Unorm;break;case rm:o=s===ft?ee.ASTC10x5UnormSRGB:ee.ASTC10x5Unorm;break;case im:o=s===ft?ee.ASTC10x6UnormSRGB:ee.ASTC10x6Unorm;break;case sm:o=s===ft?ee.ASTC10x8UnormSRGB:ee.ASTC10x8Unorm;break;case om:o=s===ft?ee.ASTC10x10UnormSRGB:ee.ASTC10x10Unorm;break;case am:o=s===ft?ee.ASTC12x10UnormSRGB:ee.ASTC12x10Unorm;break;case lm:o=s===ft?ee.ASTC12x12UnormSRGB:ee.ASTC12x12Unorm;break;case zi:o=s===ft?ee.RGBA8UnormSRGB:ee.RGBA8Unorm;break;default:Be("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case zi:switch(r){case lA:o=ee.RGBA8Snorm;break;case uA:o=ee.RGBA16Sint;break;case Bl:o=ee.RGBA16Uint;break;case Un:o=ee.RGBA32Uint;break;case Sr:o=ee.RGBA32Sint;break;case ri:o=s===ft?ee.RGBA8UnormSRGB:ee.RGBA8Unorm;break;case or:o=ee.RGBA16Float;break;case gi:o=ee.RGBA32Float;break;default:Be("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case Xg:switch(r){case Bx:o=ee.RGB9E5UFloat;break;case Dx:o=ee.RG11B10UFloat;break;default:Be("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case Yg:switch(r){case lA:o=ee.R8Snorm;break;case uA:o=ee.R16Sint;break;case Bl:o=ee.R16Uint;break;case Un:o=ee.R32Uint;break;case Sr:o=ee.R32Sint;break;case ri:o=ee.R8Unorm;break;case or:o=ee.R16Float;break;case gi:o=ee.R32Float;break;default:Be("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case Ws:switch(r){case lA:o=ee.RG8Snorm;break;case uA:o=ee.RG16Sint;break;case Bl:o=ee.RG16Uint;break;case Un:o=ee.RG32Uint;break;case Sr:o=ee.RG32Sint;break;case ri:o=ee.RG8Unorm;break;case or:o=ee.RG16Float;break;case gi:o=ee.RG32Float;break;default:Be("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case $o:switch(r){case Bl:o=ee.Depth16Unorm;break;case Un:o=ee.Depth24Plus;break;case gi:o=ee.Depth32Float;break;default:Be("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case jo:switch(r){case zo:o=ee.Depth24PlusStencil8;break;case gi:e&&e.features.has(xg.Depth32FloatStencil8)===!1&&Be('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=ee.Depth32FloatStencil8;break;default:Be("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case Kg:switch(r){case Sr:o=ee.R32Sint;break;case Un:o=ee.R32Uint;break;default:Be("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case Zg:switch(r){case Sr:o=ee.RG32Sint;break;case Un:o=ee.RG32Uint;break;default:Be("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case Jg:switch(r){case Sr:o=ee.RGBA32Sint;break;case Un:o=ee.RGBA32Uint;break;default:Be("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:Be("WebGPURenderer: Unsupported texture format.",t)}return o}const SH=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,EH=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,pv={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},RH=n=>{n=n.trim();const e=n.match(SH);if(e!==null&&e.length===4){const t=e[2],r=[];let i=null;for(;(i=EH.exec(t))!==null;)r.push({name:i[1],type:i[2]});const s=[];for(let p=0;p<r.length;p++){const{name:g,type:b}=r[p];let x=b;x.startsWith("ptr")?x="pointer":(x.startsWith("texture")&&(x=b.split("<")[0]),x=pv[x]),s.push(new Z2(x,g))}const o=n.substring(e[0].length),a=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:pv[a]||a,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class NH extends ey{constructor(e){const{type:t,inputs:r,name:i,inputsCode:s,blockCode:o,outputType:a}=RH(e);super(t,r,i),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class CH extends q5{parseFunction(e){return new NH(e)}}const MH={[ar.READ_ONLY]:"read",[ar.WRITE_ONLY]:"write",[ar.READ_WRITE]:"read_write"},mv={[rf]:"repeat",[xA]:"clamp",[nf]:"mirror"},n0={vertex:ka.VERTEX,fragment:ka.FRAGMENT,compute:ka.COMPUTE},gv={instance:!0,swizzleAssign:!1,storageBuffer:!0},PH={"^^":"tsl_xor"},BH={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},yv={},Wu={tsl_xor:new Jn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Jn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Jn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Jn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Jn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Jn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Jn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Jn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Jn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Jn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Jn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Jn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Jn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},DH={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let K5="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(K5+=`diagnostic( off, derivative_uniformity );
`);class LH extends U5{constructor(e,t){super(e,t,new CH),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,r,i,s,o=this.shaderStage){return o==="fragment"?i?s?`textureSample( ${t}, ${t}_sampler, ${r}, ${i}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r}, ${i} )`:s?`textureSample( ${t}, ${t}_sampler, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this.generateTextureSampleLevel(e,t,r,"0",i)}generateTextureSampleLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateWrapFunction(e){const t=`tsl_coord_${mv[e.wrapS]}S_${mv[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let r=yv[t];if(r===void 0){const i=[],s=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(c,f)=>{c===rf?(i.push(Wu.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${f} )`):c===xA?(i.push(Wu.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${f} )`):c===nf?(i.push(Wu.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${f} )`):(o+=`		coord.${f}`,De(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,yv[t]=r=new Jn(o,i)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let s=i.dimensionsSnippet[r];if(i.dimensionsSnippet[r]===void 0){let o,a;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),f=c>1;e.is3DTexture||e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",f||e.isStorageTexture?o=t:o=`${t}${r?`, u32( ${r} )`:""}`,s=new B0(new D0(`textureDimensions( ${o} )`,a)),i.dimensionsSnippet[r]=s,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(i.arrayLayerCount=new B0(new D0(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new B0(new D0("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,r,i,s="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s);return i&&(r=`${r} + vec2<f32>(${i}) / ${a}`),`tsl_biquadraticTexture( ${t}, ${o}( ${r} ), ${a}, u32( ${s} ) )`}generateTextureLod(e,t,r,i,s,o="0u"){const a=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),f=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";s&&(r=`${r} + ${f}<f32>(${s}) / ${f}<f32>( ${c} )`);const p=`${f}<u32>( ${a}( ${r} ) * ${f}<f32>( ${c} ) )`;return this.generateTextureLoad(e,t,p,o,i,null)}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0u"),o&&(r=`${r} + ${o}`);let a;return s?a=`textureLoad( ${t}, ${r}, ${s}, u32( ${i} ) )`:(a=`textureLoad( ${t}, ${r}, u32( ${i} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,r,i,s){let o;return i?o=`textureStore( ${t}, ${r}, ${i}, ${s} )`:o=`textureStore( ${t}, ${r}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===gi||this.isSampleCompare(e)===!1&&e.minFilter===qi&&e.magFilter===qi||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,i,s,o=this.shaderStage){let a=null;return this.isUnfilterable(e)?a=this.generateTextureLod(e,t,r,i,s,"0",o):a=this._generateTextureSample(e,t,r,i,s,o),a}generateTextureGrad(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]} )`;Be(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i} )`;Be(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateTextureBias(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i} )`;Be(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="cubeDepthTexture"||i==="storageTexture"||i==="texture3D"?r:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?r:r+".value":e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=PH[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(De("WebGPURenderer: Atomic operations are only supported in compute shaders."),ar.READ_WRITE):ar.READ_ONLY:e.access}getStorageAccess(e,t){return MH[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);if(o.uniformGPU===void 0){let a;const c=e.groupNode,f=c.name,p=this.getBindGroupArray(f,r);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let g=null;const b=this.getNodeAccess(e,r);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?g=new vg(s.name,s.node,c,b):g=new jf(s.name,s.node,c,b):t==="cubeTexture"||t==="cubeDepthTexture"?g=new Q5(s.name,s.node,c,b):t==="texture3D"&&(g=new vg(s.name,s.node,c,b)),g.store=e.isStorageTextureNode===!0,g.mipLevel=g.store?e.mipLevel:0,g.setVisibility(n0[r]),this.isUnfilterable(e.value)===!1&&g.store===!1){const x=new gH(`${s.name}_sampler`,s.node,c);x.setVisibility(n0[r]),p.push(x,g),a=[x,g]}else p.push(g),a=[g]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const g=this.getSharedDataFromNode(e);let b=g.buffer;if(b===void 0){const x=t==="buffer"?$5:bH;b=new x(e,c),g.buffer=b}b.setVisibility(b.getVisibility()|n0[r]),p.push(b),a=b,s.name=i||"NodeBuffer_"+s.id}else{const g=this.uniformGroups[r]||(this.uniformGroups[r]={});let b=g[f];b===void 0&&(b=new H5(f,c),b.setVisibility(n0[r]),g[f]=b,p.push(b)),a=this.getNodeUniform(s,t),b.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,r,i=this.shaderStage){const s=this.builtins[i]||(this.builtins[i]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${r.vars}
${r.code}
`;return r.result&&(s+=`	return ${r.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(r!==void 0)for(const i of r)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(r!==void 0)for(const{name:i,property:s,type:o}of r.values())t.push(`@builtin( ${i} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,r,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:r,scope:i,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${i}> ${r}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&t.push(r);const i=this.getAttributesArray();for(let s=0,o=i.length;s<o;s++){const a=i[s],c=a.name,f=this.getType(a.type);t.push(`@location( ${s} ) ${c} : ${f}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const r of e.members){const i=e.output?"@location( "+r.index+" ) ":"";let s=this.getType(r.type);r.atomic&&(s="atomic< "+s+" >"),t.push(`	${i+r.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const i=[];for(const s of r){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,i.push(o)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,r=null){let i=`var ${t} : `;return r!==null?i+=this.generateArrayDeclaration(e,r):i+=this.getType(e),i}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const c=s[a];if(c.needsInterpolation){let f=`@location( ${a} )`;if(c.interpolationType){const p=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";f+=` @interpolate( ${c.interpolationType}${p}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(f+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${f} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const r=this.getBuiltins(e);r&&t.push(r);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){const t=e.value,r=e.node,i=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&r.structTypeNode!==null,s=r.value&&r.value.array&&typeof r.value.itemSize=="number"&&r.value.array.length>r.value.itemSize;return i&&!s}getUniforms(e){const t=this.uniforms[e],r=[],i=[],s=[],o={};for(const c of t){const f=c.groupNode.name,p=this.bindingsIndexes[f];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="cubeDepthTexture"||c.type==="storageTexture"||c.type==="texture3D"){const g=c.node.value;this.isUnfilterable(g)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(g)?r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler_comparison;`):r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler;`));let b,x="";const{primarySamples:T}=this.renderer.backend.utils.getTextureSampleData(g);if(T>1&&(x="_multisampled"),g.isCubeTexture===!0&&g.isDepthTexture===!0)b="texture_depth_cube";else if(g.isCubeTexture===!0)b="texture_cube<f32>";else if(g.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&g.compareFunction===null?b=`texture${x}_2d<f32>`:b=`texture_depth${x}_2d${g.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const S=Tg(g),E=this.getStorageAccess(c.node,e),C=c.node.value.is3DTexture,P=c.node.value.isArrayTexture;b=`texture_storage_${C?"3d":`2d${P?"_array":""}`}<${S}, ${E}>`}else if(g.isArrayTexture===!0||g.isDataArrayTexture===!0||g.isCompressedArrayTexture===!0)b="texture_2d_array<f32>";else if(g.is3DTexture===!0||g.isData3DTexture===!0)b="texture_3d<f32>";else{const S=this.getComponentTypeFromTexture(g).charAt(0);b=`texture${x}_2d<${S}32>`}r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name} : ${b};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const g=c.node,b=this.getType(g.getNodeType(this)),x=g.bufferCount,T=x>0&&c.type==="buffer"?", "+x:"",S=g.isStorageBufferNode?`storage, ${this.getStorageAccess(g,e)}`:"uniform";if(this.isCustomStruct(c))i.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var<${S}> ${c.name} : ${b};`);else{const C=`	value : array< ${g.isAtomic?`atomic<${b}>`:`${b}`}${T} >`;i.push(this._getWGSLStructBinding(c.name,C,S,p.binding++,p.group))}}else{const g=this.getType(this.getVectorType(c.type)),b=c.groupNode.name;(o[b]||(o[b]={index:p.binding++,id:p.group,snippets:[]})).snippets.push(`	${c.name} : ${g}`)}}for(const c in o){const f=o[c];s.push(this._getWGSLStructBinding(c,f.snippets.join(`,
`),"uniform",f.index,f.id))}return[...r,...i,...s].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const f of s){const p=this.getFlowData(f),g=f.name;if(g&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${g}
`),i+=`${p.code}
	`,f===o&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${p.result};`;else if(t==="fragment")if(c)r.returnType=a.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",i+=`return ${p.result};`;else{let b="	@location(0) color: vec4<f32>";const x=this.getBuiltins("output");x&&(b+=`,
	`+x),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",b),r.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${p.result};

	return output;`}}}r.flow=i}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let r;return t!==null&&(r=this._getWGSLMethod(e+"_"+t)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,r){return`select( ${r}, ${t}, ${e} )`}getType(e){return BH[e]||e}isAvailable(e){let t=gv[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),gv[e]=t),t}_getWGSLMethod(e){return Wu[e]!==void 0&&this._include(e),DH[e]}_include(e){const t=Wu[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${K5}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[r,i,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${r}, ${i}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${r} * numWorkgroups.x )
		+ globalId.z * ( ${r} * numWorkgroups.x ) * ( ${i} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,r,i=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${i} ) @group( ${s} )
var<${r}> ${e} : ${o};`}}class OH{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=ee.Depth24PlusStencil8:e.depth&&(t=ee.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Ul.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Ul.LineList;if(e.isLine)return Ul.LineStrip;if(e.isMesh)return Ul.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===ri)return ee.BGRA8Unorm;if(t===or)return ee.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const Z5=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&Z5.set(Float16Array,["float16"]);const FH=new Map([[kx,["float16"]]]),IH=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class kH{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),i=this.backend,s=i.get(r);let o=s.buffer;if(o===void 0){const a=i.device;let c=r.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let g=0;g<c.length;g++)c[g]===65535&&(c[g]=4294967295)}if(r.array=c,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){c=new c.constructor(r.count*4);for(let g=0;g<r.count;g++)c.set(r.array.subarray(g*3,g*3+3),g*4);r.itemSize=4,r.array=c,s._force3to4BytesAlignment=!0}const f=c.byteLength,p=f+(4-f%4)%4;o=a.createBuffer({label:r.name,size:p,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,i=r.device,s=r.get(t),o=r.get(t).buffer;let a=t.array;if(s._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let f=0;f<t.count;f++)a.set(t.array.subarray(f*3,f*3+3),f*4);t.array=a}const c=t.updateRanges;if(c.length===0)i.queue.writeBuffer(o,0,a,0);else{const f=V0(a),p=f?1:a.BYTES_PER_ELEMENT;for(let g=0,b=c.length;g<b;g++){const x=c[g];let T,S;if(s._force3to4BytesAlignment===!0){const C=Math.floor(x.start/3),P=Math.ceil(x.count/3);T=C*4*p,S=P*4*p}else T=x.start*p,S=x.count*p;const E=T*(f?a.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(o,E,a,T,S)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let i=0;i<t.length;i++){const s=t[i],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let c=r.get(a);if(c===void 0){let g,b;s.isInterleavedBufferAttribute===!0?(g=s.data.stride*o,b=s.data.isInstancedInterleavedBuffer?t0.Instance:t0.Vertex):(g=s.itemSize*o,b=s.isInstancedBufferAttribute?t0.Instance:t0.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(g=4),c={arrayStride:g,attributes:[],stepMode:b},r.set(a,c)}const f=this._getVertexFormat(s),p=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:i,offset:p,format:f})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=r.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=r.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,a,0,o);const f=c.finish();r.queue.submit([f]),await a.mapAsync(GPUMapMode.READ);const p=a.getMappedRange(),g=new e.array.constructor(p.slice(0));return a.unmap(),g.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,i=e.array.constructor,s=e.constructor;let o;if(t===1)o=IH.get(i);else{const c=(FH.get(s)||Z5.get(i))[r?1:0];if(c){const f=i.BYTES_PER_ELEMENT*t,g=Math.floor((f+3)/4)*4/i.BYTES_PER_ELEMENT;if(g%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${g}`}}return o||Be("WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class UH{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class qH{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,r=t.device,i=t.get(e);if(i.layout)return i.layout.layoutGPU;const s=this._createLayoutEntries(e),o=JSON.stringify(s);let a=this._bindGroupLayoutCache.get(o);return a===void 0&&(a=new UH(r.createBindGroupLayout({entries:s})),this._bindGroupLayoutCache.set(o,a)),a.usedTimes++,i.layout=a,i.layoutKey=o,a.layoutGPU}createBindings(e,t,r,i=0){const{backend:s}=this,o=s.get(e),a=this.createBindingsLayout(e);let c;r>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[r]===i&&(c=o.groups[r])),c===void 0&&(c=this.createBindGroup(e,a),r>0&&(o.groups[r]=c,o.versions[r]=i)),o.group=c}updateBinding(e){const t=this.backend,r=t.device,i=e.buffer,s=t.get(e).buffer,o=e.updateRanges;if(o.length===0)r.queue.writeBuffer(s,0,i,0);else{const a=V0(i),c=a?1:i.BYTES_PER_ELEMENT;for(let f=0,p=o.length;f<p;f++){const g=o[f],b=g.start*c,x=g.count*c,T=b*(a?i.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(s,T,i,b,x)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const i=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=i.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});i.queue.writeBuffer(a,0,e,0);const c=[{binding:0,resource:{buffer:a}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const r=this.backend,i=r.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const c=r.get(a);if(c.buffer===void 0){const f=a.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,g=[];a.visibility&ka.VERTEX&&g.push("vertex"),a.visibility&ka.FRAGMENT&&g.push("fragment"),a.visibility&ka.COMPUTE&&g.push("compute");const b=`(${g.join(",")})`,x=i.createBuffer({label:`bindingBuffer${a.id}_${a.name}_${b}`,size:f,usage:p});c.buffer=x}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=r.get(a);if(c.buffer===void 0){const f=a.attribute;c.buffer=r.get(f).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isSampledTexture){const c=r.get(a.texture);let f;if(c.externalTexture!==void 0)f=i.importExternalTexture({source:c.externalTexture});else{const p=a.store?1:c.texture.mipLevelCount,g=a.store?a.mipLevel:0;let b=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(b+=`-${c.texture.depthOrArrayLayers}`),b+=`-${p}-${g}`,f=c[b],f===void 0){const x=mH.All;let T;a.isSampledCubeTexture?T=kn.Cube:a.isSampledTexture3D?T=kn.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?T=kn.TwoDArray:T=kn.TwoD,f=c[b]=c.texture.createView({aspect:x,dimension:T,mipLevelCount:p,baseMipLevel:g})}}o.push({binding:s,resource:f})}else if(a.isSampler){const c=r.get(a.texture);o.push({binding:s,resource:c.sampler})}s++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}_createLayoutEntries(e){const t=[];let r=0;for(const i of e.bindings){const s=this.backend,o={binding:r,visibility:i.visibility};if(i.isUniformBuffer||i.isStorageBuffer){const a={};i.isStorageBuffer&&(i.visibility&ka.COMPUTE&&(i.access===ar.READ_WRITE||i.access===ar.WRITE_ONLY)?a.type=Sp.Storage:a.type=Sp.ReadOnlyStorage),o.buffer=a}else if(i.isSampledTexture&&i.store){const a={};a.format=this.backend.get(i.texture).texture.format;const c=i.access;c===ar.READ_WRITE?a.access=Ep.ReadWrite:c===ar.WRITE_ONLY?a.access=Ep.WriteOnly:a.access=Ep.ReadOnly,i.texture.isArrayTexture?a.viewDimension=kn.TwoDArray:i.texture.is3DTexture&&(a.viewDimension=kn.ThreeD),o.storageTexture=a}else if(i.isSampledTexture){const a={},{primarySamples:c}=s.utils.getTextureSampleData(i.texture);if(c>1&&(a.multisampled=!0,i.texture.isDepthTexture||(a.sampleType=ba.UnfilterableFloat)),i.texture.isDepthTexture)s.compatibilityMode&&i.texture.compareFunction===null?a.sampleType=ba.UnfilterableFloat:a.sampleType=ba.Depth;else if(i.texture.isDataTexture||i.texture.isDataArrayTexture||i.texture.isData3DTexture){const f=i.texture.type;f===Sr?a.sampleType=ba.SInt:f===Un?a.sampleType=ba.UInt:f===gi&&(this.backend.hasFeature("float32-filterable")?a.sampleType=ba.Float:a.sampleType=ba.UnfilterableFloat)}i.isSampledCubeTexture?a.viewDimension=kn.Cube:i.texture.isArrayTexture||i.texture.isDataArrayTexture||i.texture.isCompressedArrayTexture?a.viewDimension=kn.TwoDArray:i.isSampledTexture3D&&(a.viewDimension=kn.ThreeD),o.texture=a}else if(i.isSampler){const a={};i.texture.isDepthTexture&&(i.texture.compareFunction!==null?a.type=hv.Comparison:s.compatibilityMode&&(a.type=hv.NonFiltering)),o.sampler=a}else Be(`WebGPUBindingUtils: Unsupported binding "${i}".`);t.push(o),r++}return t}deleteBindGroupData(e){const{backend:t}=this,r=t.get(e);r.layout&&(r.layout.usedTimes--,r.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(r.layoutKey),r.layout=void 0,r.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class GH{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:i,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:c}=o,f=this.backend,p=f.device,g=f.utils,b=f.get(o),x=[];for(const te of e.getBindings()){const oe=f.get(te),{layoutGPU:Y}=oe.layout;x.push(Y)}const T=f.attributeUtils.createShaderVertexBuffers(e);let S;i.blending!==Yl&&(i.blending!==Xs||i.transparent!==!1)&&(S=this._getBlending(i));let E={};i.stencilWrite===!0&&(E={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const C=this._getColorWriteMask(i),P=[];if(e.context.textures!==null){const te=e.context.textures;for(let oe=0;oe<te.length;oe++){const Y=g.getTextureFormatGPU(te[oe]);oe===0?P.push({format:Y,blend:S,writeMask:C}):P.push({format:Y,writeMask:C})}}else{const te=g.getCurrentColorFormat(e.context);P.push({format:te,blend:S,writeMask:C})}const D=f.get(a).module,L=f.get(c).module,k=this._getPrimitiveState(r,s,i),q=this._getDepthCompare(i),I=g.getCurrentDepthStencilFormat(e.context),U=this._getSampleCount(e.context),j={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},D,{buffers:T}),fragment:Object.assign({},L,{targets:P}),primitive:k,multisample:{count:U,alphaToCoverageEnabled:i.alphaToCoverage&&U>1},layout:p.createPipelineLayout({bindGroupLayouts:x})},J={},Q=e.context.depth,K=e.context.stencil;if((Q===!0||K===!0)&&(Q===!0&&(J.format=I,J.depthWriteEnabled=i.depthWrite,J.depthCompare=q),K===!0&&(J.stencilFront=E,J.stencilBack={},J.stencilReadMask=i.stencilFuncMask,J.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(J.depthBias=i.polygonOffsetUnits,J.depthBiasSlopeScale=i.polygonOffsetFactor,J.depthBiasClamp=0),j.depthStencil=J),p.pushErrorScope("validation"),t===null)b.pipeline=p.createRenderPipeline(j),p.popErrorScope().then(te=>{te!==null&&(b.error=!0,Be(te.message))});else{const te=new Promise(async oe=>{try{b.pipeline=await p.createRenderPipelineAsync(j)}catch{}const Y=await p.popErrorScope();Y!==null&&(b.error=!0,Be(Y.message)),oe()});t.push(te)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:i,device:s}=r,o=i.getCurrentDepthStencilFormat(e),a=i.getCurrentColorFormats(e),c=this._getSampleCount(e),f={label:t,colorFormats:a,depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(f)}createComputePipeline(e,t){const r=this.backend,i=r.device,s=r.get(e.computeProgram).module,o=r.get(e),a=[];for(const c of t){const f=r.get(c),{layoutGPU:p}=f.layout;a.push(p)}o.pipeline=i.createComputePipeline({compute:s,layout:i.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,r;const i=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(i===aA){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,f=e.blendDstAlpha!==null?e.blendDstAlpha:o,p=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},r={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(f),operation:this._getBlendOperation(p)}}else{const c=e.premultipliedAlpha,f=(p,g,b,x)=>{t={srcFactor:p,dstFactor:g,operation:_a.Add},r={srcFactor:b,dstFactor:x,operation:_a.Add}};if(c)switch(i){case Xs:f(Et.One,Et.OneMinusSrcAlpha,Et.One,Et.OneMinusSrcAlpha);break;case $0:f(Et.One,Et.One,Et.One,Et.One);break;case j0:f(Et.Zero,Et.OneMinusSrc,Et.Zero,Et.One);break;case z0:f(Et.Dst,Et.OneMinusSrcAlpha,Et.Zero,Et.One);break}else switch(i){case Xs:f(Et.SrcAlpha,Et.OneMinusSrcAlpha,Et.One,Et.OneMinusSrcAlpha);break;case $0:f(Et.SrcAlpha,Et.One,Et.One,Et.One);break;case j0:Be("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case z0:Be("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&r!==void 0)return{color:t,alpha:r};Be("WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case Po:t=Et.Zero;break;case Tx:t=Et.One;break;case xx:t=Et.Src;break;case gx:t=Et.OneMinusSrc;break;case vx:t=Et.SrcAlpha;break;case mx:t=Et.OneMinusSrcAlpha;break;case _x:t=Et.Dst;break;case px:t=Et.OneMinusDst;break;case yx:t=Et.DstAlpha;break;case dx:t=Et.OneMinusDstAlpha;break;case bx:t=Et.SrcAlphaSaturated;break;case DU:t=Et.Constant;break;case LU:t=Et.OneMinusConstant;break;default:Be("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case dN:t=nr.Never;break;case fN:t=nr.Always;break;case hN:t=nr.Less;break;case cN:t=nr.LessEqual;break;case AN:t=nr.Equal;break;case uN:t=nr.GreaterEqual;break;case lN:t=nr.Greater;break;case aN:t=nr.NotEqual;break;default:Be("WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case xN:t=Ro.Keep;break;case vN:t=Ro.Zero;break;case bN:t=Ro.Replace;break;case _N:t=Ro.Invert;break;case yN:t=Ro.IncrementClamp;break;case gN:t=Ro.DecrementClamp;break;case mN:t=Ro.IncrementWrap;break;case pN:t=Ro.DecrementWrap;break;default:Be("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case js:t=_a.Add;break;case fx:t=_a.Subtract;break;case hx:t=_a.ReverseSubtract;break;case wN:t=_a.Min;break;case TN:t=_a.Max;break;default:Be("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const i={},s=this.backend.utils;i.topology=s.getPrimitiveTopology(e,r),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?uu.Uint16:uu.Uint32);let o=r.side===yr;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),i.frontFace=o===!0?uv.CW:uv.CCW,i.cullMode=r.side===vi?Av.None:Av.Back,i}_getColorWriteMask(e){return e.colorWrite===!0?cv.All:cv.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=nr.Always;else{const r=e.depthFunc;switch(r){case Px:t=nr.Never;break;case Mx:t=nr.Always;break;case Cx:t=nr.Less;break;case Nx:t=nr.LessEqual;break;case Rx:t=nr.Equal;break;case Ex:t=nr.GreaterEqual;break;case Sx:t=nr.Greater;break;case wx:t=nr.NotEqual;break;default:Be("WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class VH extends Y5{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return fn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const s=i.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,r)),a={},c=[];for(const[p,g]of e){const b=p.match(/^(.*):f(\d+)$/),x=parseInt(b[2]);c.includes(x)===!1&&c.push(x),a[x]===void 0&&(a[x]=0);const T=o[g],S=o[g+1],E=Number(S-T)/1e6;this.timestamps.set(p,E),a[x]+=E}const f=a[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=f,this.frames=c,f}catch(e){return Be("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Be("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Be("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class zH extends X5{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new OH(this),this.attributeUtils=new kH(this),this.bindingUtils=new qH(this),this.pipelineUtils=new GH(this),this.textureUtils=new wH(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(t.device===void 0){const i={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},s=typeof navigator<"u"?await navigator.gpu.requestAdapter(i):null;if(s===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(xg),a=[];for(const f of o)s.features.has(f)&&a.push(f);const c={requiredFeatures:a,requiredLimits:t.requiredLimits};r=await s.requestDevice(c)}else r=t.device;r.lost.then(i=>{if(i.reason==="destroyed")return;const s={api:"WebGPU",message:i.message||"Unknown reason",reason:i.reason||null,originalEvent:i};e.onDeviceLost(s)}),this.device=r,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(xg.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let r=t.context;if(r===void 0){const i=this.parameters;e.isDefaultCanvasTarget===!0&&i.context!==void 0?r=i.context:r=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${tf} webgpu`);const s=i.alpha?"premultiplied":"opaque",o=i.outputType===or?"extended":"standard";r.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:o}}),t.context=r}return r}get coordinateSystem(){return Wo}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),r=this.get(t),i=e.currentSamples;let s=r.descriptor;if(s===void 0||r.samples!==i){s={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(s.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const a=s.colorAttachments[0];i>0?a.view=this.textureUtils.getColorBuffer().createView():a.resolveTarget=void 0,r.descriptor=s,r.samples=i}const o=s.colorAttachments[0];return i>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),s}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,i=this.get(r);let s=i.descriptors;(s===void 0||i.width!==r.width||i.height!==r.height||i.samples!==r.samples)&&(s={},i.descriptors=s);const o=e.getCacheKey();let a=s[o];if(a===void 0){const f=e.textures,p=[];let g;const b=this._isRenderCameraDepthArray(e);for(let x=0;x<f.length;x++){const T=this.get(f[x]),S={label:`colorAttachment_${x}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:kn.TwoD};if(r.isRenderTarget3D)g=e.activeCubeFace,S.baseArrayLayer=0,S.dimension=kn.ThreeD,S.depthOrArrayLayers=f[x].image.depth;else if(r.isRenderTarget&&f[x].image.depth>1)if(b===!0){const E=e.camera.cameras;for(let C=0;C<E.length;C++){const P={...S,baseArrayLayer:C,arrayLayerCount:1,dimension:kn.TwoD},D=T.texture.createView(P);p.push({view:D,resolveTarget:void 0,depthSlice:void 0})}}else S.dimension=kn.TwoDArray,S.depthOrArrayLayers=f[x].image.depth;if(b!==!0){const E=T.texture.createView(S);let C,P;T.msaaTexture!==void 0?(C=T.msaaTexture.createView(),P=E):(C=E,P=void 0),p.push({view:C,resolveTarget:P,depthSlice:g})}}if(a={textureViews:p},e.depth){const x=this.get(e.depthTexture),T={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(T.dimension=kn.TwoD,T.arrayLayerCount=1,T.baseArrayLayer=e.activeCubeFace),a.depthStencilView=x.texture.createView(T)}s[o]=a,i.width=r.width,i.height=r.height,i.samples=r.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let f=0;f<a.textureViews.length;f++){const p=a.textureViews[f];let g={r:0,g:0,b:0,a:1};f===0&&t.clearValue&&(g=t.clearValue),c.colorAttachments.push({view:p.view,depthSlice:p.depthSlice,resolveTarget:p.resolveTarget,loadOp:t.loadOp||It.Load,storeOp:t.storeOp||wr.Store,clearValue:g})}return a.depthStencilView&&(c.depthStencilAttachment={view:a.depthStencilView}),c}beginRender(e){const t=this.get(e),r=this.device,i=e.occlusionQueryCount;let s;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=r.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:It.Load}),this.initTimestampQuery(gs.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const f=o.colorAttachments;for(let p=0;p<f.length;p++){const g=f[p];e.clearColor?(g.clearValue=p===0?e.clearColorValue:{r:0,g:0,b:0,a:1},g.loadOp=It.Clear):g.loadOp=It.Load,g.storeOp=wr.Store}}else{const f=o.colorAttachments[0];e.clearColor?(f.clearValue=e.clearColorValue,f.loadOp=It.Clear):f.loadOp=It.Load,f.storeOp=wr.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=It.Clear):a.depthLoadOp=It.Load,a.depthStoreOp=wr.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=It.Clear):a.stencilLoadOp=It.Load,a.stencilStoreOp=wr.Store);const c=r.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const f=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==f.length?this._createDepthLayerDescriptors(e,t,o,f):this._updateDepthLayerDescriptors(e,t,f),t.bundleEncoders=[],t.bundleSets=[];for(let p=0;p<f.length;p++){const g=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+p),b={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(g),t.bundleSets.push(b)}t.currentPass=null}else{const f=c.beginRenderPass(o);t.currentPass=f,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,i){const s=r.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<i.length;a++){const c={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[a].view}]};if(r.depthStencilAttachment){const f=a;o.viewCache[f]||(o.viewCache[f]=o.texture.createView({dimension:kn.TwoD,baseArrayLayer:a,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[f],depthLoadOp:s.depthLoadOp||It.Clear,depthStoreOp:s.depthStoreOp||wr.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,r){for(let i=0;i<r.length;i++){const s=t.layerDescriptors[i];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=It.Clear):o.depthLoadOp=It.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=It.Clear):o.stencilLoadOp=It.Load)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const i=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];s.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const a=t.layerDescriptors[o],c=i.beginRenderPass(a);if(e.viewport){const{x:f,y:p,width:g,height:b,minDepth:x,maxDepth:T}=e.viewportValue;c.setViewport(f,p,g,b,x,T)}if(e.scissor){const{x:f,y:p,width:g,height:b}=e.scissorValue;c.setScissorRect(f,p,g,b)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const s=r*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const a=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,s),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const a=s[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const o=r.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<i.length;c++)a[c]===BigInt(0)&&s.add(i[c]);r.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o,minDepth:a,maxDepth:c}=e.viewportValue;t.setViewport(r,i,s,o,a,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o}=e.scissorValue;t.setScissorRect(r,i,s,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,i=null){const s=this.device,o=this.renderer;let a=[],c,f,p,g;if(e){const T=this.getClearColor();f={r:T.r,g:T.g,b:T.b,a:T.a}}if(i===null){p=o.depth,g=o.stencil;const T=this._getDefaultRenderPassDescriptor();if(e){a=T.colorAttachments;const S=a[0];S.clearValue=f,S.loadOp=It.Clear,S.storeOp=wr.Store}(p||g)&&(c=T.depthStencilAttachment)}else{p=i.depth,g=i.stencil;const T={loadOp:e?It.Clear:It.Load,clearValue:e?f:void 0};p&&(T.depthLoadOp=t?It.Clear:It.Load,T.depthClearValue=t?o.getClearDepth():void 0,T.depthStoreOp=wr.Store),g&&(T.stencilLoadOp=r?It.Clear:It.Load,T.stencilClearValue=r?o.getClearStencil():void 0,T.stencilStoreOp=wr.Store);const S=this._getRenderPassDescriptor(i,T);a=S.colorAttachments,c=S.depthStencilAttachment}p&&c&&(t?(c.depthLoadOp=It.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=wr.Store):(c.depthLoadOp=It.Load,c.depthStoreOp=wr.Store)),g&&c&&(r?(c.stencilLoadOp=It.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=wr.Store):(c.stencilLoadOp=It.Load,c.stencilStoreOp=wr.Store));const b=s.createCommandEncoder({label:"clear"});b.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),s.queue.submit([b.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(gs.COMPUTE,this.getTimestampUID(e),r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,i,s=null){const o=this.get(t),{passEncoderGPU:a}=this.get(e),c=this.get(i).pipeline;this.pipelineUtils.setPipeline(a,c);for(let f=0,p=r.length;f<p;f++){const g=r[f],b=this.get(g);a.setBindGroup(f,b.group)}if(s===null&&(s=t.count),s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute){const f=this.get(s).buffer;a.dispatchWorkgroupsIndirect(f,0);return}if(typeof s=="number"){const f=s;if(o.dispatchSize===void 0||o.count!==f){o.dispatchSize=[0,1,1],o.count=f;const p=t.workgroupSize;let g=p[0];for(let T=1;T<p.length;T++)g*=p[T];const b=Math.ceil(f/g),x=this.device.limits.maxComputeWorkgroupsPerDimension;s=[b,1,1],b>x&&(s[0]=Math.min(b,x),s[1]=Math.ceil(b/x)),o.dispatchSize=s}s=o.dispatchSize}a.dispatchWorkgroups(s[0],s[1]||1,s[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:r,material:i,context:s,pipeline:o}=e,a=e.getBindings(),c=this.get(s),f=this.get(o),p=f.pipeline;if(f.error===!0)return;const g=e.getIndex(),b=g!==null,x=e.getDrawParameters();if(x===null)return;const T=(E,C)=>{this.pipelineUtils.setPipeline(E,p),C.pipeline=p;const P=C.bindingGroups;for(let L=0,k=a.length;L<k;L++){const q=a[L],I=this.get(q);P[q.index]!==q.id&&(E.setBindGroup(q.index,I.group),P[q.index]=q.id)}if(b===!0&&C.index!==g){const L=this.get(g).buffer,k=g.array instanceof Uint16Array?uu.Uint16:uu.Uint32;E.setIndexBuffer(L,k),C.index=g}const D=e.getVertexBuffers();for(let L=0,k=D.length;L<k;L++){const q=D[L];if(C.attributes[L]!==q){const I=this.get(q).buffer;E.setVertexBuffer(L,I),C.attributes[L]=q}}s.stencil===!0&&i.stencilWrite===!0&&c.currentStencilRef!==i.stencilRef&&(E.setStencilReference(i.stencilRef),c.currentStencilRef=i.stencilRef)},S=(E,C)=>{if(T(E,C),r.isBatchedMesh===!0){const P=r._multiDrawStarts,D=r._multiDrawCounts,L=r._multiDrawCount,k=r._multiDrawInstances;k!==null&&fn("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let q=0;q<L;q++){const I=k?k[q]:1,U=I>1?0:q;b===!0?E.drawIndexed(D[q],I,P[q]/g.array.BYTES_PER_ELEMENT,0,U):E.draw(D[q],I,P[q],U),t.update(r,D[q],I)}}else if(b===!0){const{vertexCount:P,instanceCount:D,firstVertex:L}=x,k=e.getIndirect();if(k!==null){const q=this.get(k).buffer,I=e.getIndirectOffset(),U=Array.isArray(I)?I:[I];for(let j=0;j<U.length;j++)E.drawIndexedIndirect(q,U[j])}else E.drawIndexed(P,D,L,0,0);t.update(r,P,D)}else{const{vertexCount:P,instanceCount:D,firstVertex:L}=x,k=e.getIndirect();if(k!==null){const q=this.get(k).buffer,I=e.getIndirectOffset(),U=Array.isArray(I)?I:[I];for(let j=0;j<U.length;j++)E.drawIndirect(q,U[j])}else E.draw(P,D,L,0);t.update(r,P,D)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const E=this.get(e.camera),C=e.camera.cameras,P=e.getBindingGroup("cameraIndex");if(E.indexesGPU===void 0||E.indexesGPU.length!==C.length){const L=this.get(P),k=[],q=new Uint32Array([0,0,0,0]);for(let I=0,U=C.length;I<U;I++){q[0]=I;const{layoutGPU:j}=L.layout,J=this.bindingUtils.createBindGroupIndex(q,j);k.push(J)}E.indexesGPU=k}const D=this.renderer.getPixelRatio();for(let L=0,k=C.length;L<k;L++){const q=C[L];if(r.layers.test(q.layers)){const I=q.viewport;let U=c.currentPass,j=c.currentSets;if(c.bundleEncoders){const J=c.bundleEncoders[L],Q=c.bundleSets[L];U=J,j=Q}I&&U.setViewport(Math.floor(I.x*D),Math.floor(I.y*D),Math.floor(I.width*D),Math.floor(I.height*D),s.viewportValue.minDepth,s.viewportValue.maxDepth),P&&E.indexesGPU&&(U.setBindGroup(P.index,E.indexesGPU[L]),j.bindingGroups[P.index]=P.id),S(U,j)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const E=c.lastOcclusionObject;E!==r&&(E!==null&&E.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),r.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=r),c.lastOcclusionObject=r)}S(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:i}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),f=s.getCurrentDepthStencilFormat(e.context),p=s.getPrimitiveTopology(r,i);let g=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==c||t.depthStencilFormat!==f||t.primitiveTopology!==p||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=c,t.depthStencilFormat=f,t.primitiveTopology=p,t.clippingContextCacheKey=e.clippingContextCacheKey,g=!0),g}getRenderCacheKey(e){const{object:t,material:r}=e,i=this.utils,s=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,o,i.getSampleCountRenderContext(s),i.getCurrentColorSpace(s),i.getCurrentColorFormat(s),i.getCurrentDepthStencilFormat(s),i.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}initTimestampQuery(e,t,r){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new VH(this.device,e,2048));const i=this.timestampQueryPool[e],s=i.allocateQueriesForContext(t);r.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new LH(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),s=r.currentPass.finish();this.get(t).bundleGPU=s,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return dv[e]!==void 0&&(e=dv[e]),this.device.features.has(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){let a=0,c=0,f=0,p=0,g=0,b=0,x=e.image.width,T=e.image.height,S=1;r!==null&&(r.isBox3===!0?(p=r.min.x,g=r.min.y,b=r.min.z,x=r.max.x-r.min.x,T=r.max.y-r.min.y,S=r.max.z-r.min.z):(p=r.min.x,g=r.min.y,x=r.max.x-r.min.x,T=r.max.y-r.min.y,S=1)),i!==null&&(a=i.x,c=i.y,f=i.z||0);const E=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),C=this.get(e).texture,P=this.get(t).texture;E.copyTextureToTexture({texture:C,mipLevel:s,origin:{x:p,y:g,z:b}},{texture:P,mipLevel:o,origin:{x:a,y:c,z:f}},[x,T,S]),this.device.queue.submit([E.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const i=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){Be("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(i.currentPass?(i.currentPass.end(),a=i.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[r.x,r.y,0]},{texture:o},[r.z,r.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,a),i.currentPass){const{descriptor:c}=i;for(let f=0;f<c.colorAttachments.length;f++)c.colorAttachments[f].loadOp=It.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=It.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=It.Load),i.currentPass=a.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([a.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class jH extends Gg{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class $H extends Gg{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class HH extends G5{constructor(){super(),this.addMaterial(vk,"MeshPhongMaterial"),this.addMaterial(kw,"MeshStandardMaterial"),this.addMaterial(hU,"MeshPhysicalMaterial"),this.addMaterial(mU,"MeshToonMaterial"),this.addMaterial(dk,"MeshBasicMaterial"),this.addMaterial(_k,"MeshLambertMaterial"),this.addMaterial(uk,"MeshNormalMaterial"),this.addMaterial(yU,"MeshMatcapMaterial"),this.addMaterial(rk,"LineBasicMaterial"),this.addMaterial(sk,"LineDashedMaterial"),this.addMaterial(TU,"PointsMaterial"),this.addMaterial(qw,"SpriteMaterial"),this.addMaterial(RU,"ShadowMaterial"),this.addLight(Az,NR),this.addLight(v$,tx),this.addLight(x$,CR),this.addLight(J2,Gg),this.addLight(E$,nx),this.addLight(R$,MR),this.addLight(N$,PR),this.addLight(T$,jH),this.addLight(S$,$H),this.addToneMapping(i5,BR),this.addToneMapping(s5,DR),this.addToneMapping(o5,LR),this.addToneMapping(a5,OR),this.addToneMapping(l5,FR),this.addToneMapping(u5,IR)}}class J5 extends Q${constructor(e={}){let t;e.forceWebGL?t=lv:(t=zH,e.getFallback=()=>(De("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new lv(e)));const r=new t(e);super(r,e),this.library=new HH,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */N.BRDF_GGX;N.BRDF_Lambert;N.BasicPointShadowFilter;N.BasicShadowFilter;N.Break;N.Const;N.Continue;N.DFGLUT;N.D_GGX;N.Discard;N.EPSILON;N.F_Schlick;const WH=N.Fn;N.INFINITY;const QH=N.If,XH=N.Loop;N.NodeAccess;N.NodeShaderStage;N.NodeType;N.NodeUpdateType;N.PCFShadowFilter;N.PCFSoftShadowFilter;N.PI;N.PI2;N.TWO_PI;N.HALF_PI;N.PointShadowFilter;N.Return;N.Schlick_to_F0;N.ScriptableNodeResources;N.ShaderNode;N.Stack;N.Switch;N.TBNViewMatrix;N.VSMShadowFilter;N.V_GGX_SmithCorrelated;N.Var;N.VarIntent;N.abs;N.acesFilmicToneMapping;N.acos;N.add;N.addMethodChaining;N.addNodeElement;N.agxToneMapping;N.all;N.alphaT;N.and;N.anisotropy;N.anisotropyB;N.anisotropyT;N.any;N.append;N.array;N.arrayBuffer;const YH=N.asin;N.assign;N.atan;N.atan2;N.atomicAdd;N.atomicAnd;N.atomicFunc;N.atomicLoad;N.atomicMax;N.atomicMin;N.atomicOr;N.atomicStore;N.atomicSub;N.atomicXor;N.attenuationColor;N.attenuationDistance;N.attribute;N.attributeArray;N.backgroundBlurriness;N.backgroundIntensity;N.backgroundRotation;N.batch;N.bentNormalView;N.billboarding;N.bitAnd;N.bitNot;N.bitOr;N.bitXor;N.bitangentGeometry;N.bitangentLocal;N.bitangentView;N.bitangentWorld;N.bitcast;N.blendBurn;N.blendColor;N.blendDodge;N.blendOverlay;N.blendScreen;N.blur;N.bool;N.buffer;N.bufferAttribute;N.bumpMap;N.burn;N.builtin;N.builtinAOContext;N.builtinShadowContext;N.bvec2;N.bvec3;N.bvec4;N.bypass;N.cache;N.call;N.cameraFar;N.cameraIndex;N.cameraNear;N.cameraNormalMatrix;N.cameraPosition;N.cameraProjectionMatrix;N.cameraProjectionMatrixInverse;N.cameraViewMatrix;N.cameraViewport;N.cameraWorldMatrix;N.cbrt;N.cdl;N.ceil;N.checker;N.cineonToneMapping;N.clamp;N.clearcoat;N.clearcoatNormalView;N.clearcoatRoughness;N.code;N.color;N.colorSpaceToWorking;N.colorToDirection;N.compute;N.computeKernel;N.computeSkinning;N.context;N.convert;N.convertColorSpace;N.convertToTexture;N.countLeadingZeros;N.countOneBits;N.countTrailingZeros;const KH=N.cos;N.cross;N.cubeTexture;N.cubeTextureBase;N.dFdx;N.dFdy;N.dashSize;N.debug;N.decrement;N.decrementBefore;N.defaultBuildStages;N.defaultShaderStages;N.defined;N.degrees;N.deltaTime;N.densityFog;N.densityFogFactor;N.depth;N.depthPass;N.determinant;N.difference;N.diffuseColor;N.directPointLight;N.directionToColor;N.directionToFaceDirection;N.dispersion;N.distance;N.div;N.dodge;N.dot;N.drawIndex;N.dynamicBufferAttribute;N.element;N.emissive;N.equal;N.equals;N.equirectUV;const ZH=N.exp;N.exp2;N.expression;N.faceDirection;N.faceForward;N.faceforward;const JH=N.float;N.floatBitsToInt;N.floatBitsToUint;N.floor;N.fog;N.fract;N.frameGroup;N.frameId;N.frontFacing;N.fwidth;N.gain;N.gapSize;N.getConstNodeType;N.getCurrentStack;N.getDirection;N.getDistanceAttenuation;N.getGeometryRoughness;N.getNormalFromDepth;N.interleavedGradientNoise;N.vogelDiskSample;N.getParallaxCorrectNormal;N.getRoughness;N.getScreenPosition;N.getShIrradianceAt;N.getShadowMaterial;N.getShadowRenderObjectFunction;N.getTextureIndex;N.getViewPosition;N.globalId;N.glsl;N.glslFn;N.grayscale;N.greaterThan;N.greaterThanEqual;N.hash;N.highpModelNormalViewMatrix;N.highpModelViewMatrix;N.hue;N.increment;N.incrementBefore;N.instance;const eW=N.instanceIndex;N.instancedArray;N.instancedBufferAttribute;N.instancedDynamicBufferAttribute;N.instancedMesh;N.int;N.intBitsToFloat;N.inverse;N.inverseSqrt;N.inversesqrt;N.invocationLocalIndex;N.invocationSubgroupIndex;N.ior;N.iridescence;N.iridescenceIOR;N.iridescenceThickness;N.ivec2;N.ivec3;N.ivec4;N.js;N.label;N.length;N.lengthSq;N.lessThan;N.lessThanEqual;N.lightPosition;N.lightProjectionUV;N.lightShadowMatrix;N.lightTargetDirection;N.lightTargetPosition;N.lightViewPosition;N.lightingContext;N.lights;N.linearDepth;N.linearToneMapping;N.localId;N.log;N.log2;N.logarithmicDepthToViewZ;N.luminance;N.mat2;N.mat3;N.mat4;N.matcapUV;N.materialAO;N.materialAlphaTest;N.materialAnisotropy;N.materialAnisotropyVector;N.materialAttenuationColor;N.materialAttenuationDistance;N.materialClearcoat;N.materialClearcoatNormal;N.materialClearcoatRoughness;N.materialColor;N.materialDispersion;N.materialEmissive;N.materialEnvIntensity;N.materialEnvRotation;N.materialIOR;N.materialIridescence;N.materialIridescenceIOR;N.materialIridescenceThickness;N.materialLightMap;N.materialLineDashOffset;N.materialLineDashSize;N.materialLineGapSize;N.materialLineScale;N.materialLineWidth;N.materialMetalness;N.materialNormal;N.materialOpacity;N.materialPointSize;N.materialReference;N.materialReflectivity;N.materialRefractionRatio;N.materialRotation;N.materialRoughness;N.materialSheen;N.materialSheenRoughness;N.materialShininess;N.materialSpecular;N.materialSpecularColor;N.materialSpecularIntensity;N.materialSpecularStrength;N.materialThickness;N.materialTransmission;N.max;N.maxMipLevel;N.mediumpModelViewMatrix;N.metalness;N.min;N.mix;N.mixElement;N.mod;N.modInt;N.modelDirection;N.modelNormalMatrix;N.modelPosition;N.modelRadius;N.modelScale;N.modelViewMatrix;N.modelViewPosition;N.modelViewProjection;N.modelWorldMatrix;N.modelWorldMatrixInverse;N.morphReference;N.mrt;N.mul;N.mx_aastep;N.mx_add;N.mx_atan2;N.mx_cell_noise_float;N.mx_contrast;N.mx_divide;N.mx_fractal_noise_float;N.mx_fractal_noise_vec2;N.mx_fractal_noise_vec3;N.mx_fractal_noise_vec4;N.mx_frame;N.mx_heighttonormal;N.mx_hsvtorgb;N.mx_ifequal;N.mx_ifgreater;N.mx_ifgreatereq;N.mx_invert;N.mx_modulo;N.mx_multiply;N.mx_noise_float;N.mx_noise_vec3;N.mx_noise_vec4;N.mx_place2d;N.mx_power;N.mx_ramp4;N.mx_ramplr;N.mx_ramptb;N.mx_rgbtohsv;N.mx_rotate2d;N.mx_rotate3d;N.mx_safepower;N.mx_separate;N.mx_splitlr;N.mx_splittb;N.mx_srgb_texture_to_lin_rec709;N.mx_subtract;N.mx_timer;N.mx_transform_uv;N.mx_unifiednoise2d;N.mx_unifiednoise3d;N.mx_worley_noise_float;N.mx_worley_noise_vec2;N.mx_worley_noise_vec3;const tW=N.negate;N.neutralToneMapping;N.nodeArray;N.nodeImmutable;N.nodeObject;N.nodeObjectIntent;N.nodeObjects;N.nodeProxy;N.nodeProxyIntent;N.normalFlat;N.normalGeometry;N.normalLocal;N.normalMap;N.normalView;N.normalViewGeometry;N.normalWorld;N.normalWorldGeometry;N.normalize;N.not;N.notEqual;N.numWorkgroups;N.objectDirection;N.objectGroup;N.objectPosition;N.objectRadius;N.objectScale;N.objectViewPosition;N.objectWorldMatrix;N.OnBeforeObjectUpdate;N.OnBeforeMaterialUpdate;N.OnObjectUpdate;N.OnMaterialUpdate;N.oneMinus;N.or;N.orthographicDepthToViewZ;N.oscSawtooth;N.oscSine;N.oscSquare;N.oscTriangle;N.output;N.outputStruct;N.overlay;N.overloadingFn;N.packHalf2x16;N.packSnorm2x16;N.packUnorm2x16;N.parabola;N.parallaxDirection;N.parallaxUV;N.parameter;N.pass;N.passTexture;N.pcurve;N.perspectiveDepthToViewZ;N.pmremTexture;N.pointShadow;N.pointUV;N.pointWidth;N.positionGeometry;N.positionLocal;N.positionPrevious;N.positionView;N.positionViewDirection;N.positionWorld;N.positionWorldDirection;N.posterize;N.pow;N.pow2;N.pow3;N.pow4;N.premultiplyAlpha;N.property;N.radians;N.rand;N.range;N.rangeFog;N.rangeFogFactor;N.reciprocal;N.reference;N.referenceBuffer;N.reflect;N.reflectVector;N.reflectView;N.reflector;N.refract;N.refractVector;N.refractView;N.reinhardToneMapping;N.remap;N.remapClamp;N.renderGroup;N.renderOutput;N.rendererReference;N.replaceDefaultUV;N.rotate;N.rotateUV;N.roughness;N.round;N.rtt;N.sRGBTransferEOTF;N.sRGBTransferOETF;N.sample;N.sampler;N.samplerComparison;N.saturate;N.saturation;N.screen;N.screenCoordinate;N.screenDPR;N.screenSize;N.screenUV;N.scriptable;N.scriptableValue;N.select;N.setCurrentStack;N.setName;N.shaderStages;N.shadow;N.shadowPositionWorld;N.shapeCircle;N.sharedUniformGroup;N.sheen;N.sheenRoughness;N.shiftLeft;N.shiftRight;N.shininess;N.sign;const nW=N.sin;N.sinc;N.skinning;N.smoothstep;N.smoothstepElement;N.specularColor;N.specularF90;N.spherizeUV;N.split;N.spritesheetUV;const rW=N.sqrt;N.stack;N.step;N.stepElement;const iW=N.storage;N.storageBarrier;N.storageObject;N.storageTexture;N.string;N.struct;N.sub;N.subgroupAdd;N.subgroupAll;N.subgroupAnd;N.subgroupAny;N.subgroupBallot;N.subgroupBroadcast;N.subgroupBroadcastFirst;N.subBuild;N.subgroupElect;N.subgroupExclusiveAdd;N.subgroupExclusiveMul;N.subgroupInclusiveAdd;N.subgroupInclusiveMul;N.subgroupIndex;N.subgroupMax;N.subgroupMin;N.subgroupMul;N.subgroupOr;N.subgroupShuffle;N.subgroupShuffleDown;N.subgroupShuffleUp;N.subgroupShuffleXor;N.subgroupSize;N.subgroupXor;N.tan;N.tangentGeometry;N.tangentLocal;N.tangentView;N.tangentWorld;N.texture;N.texture3D;N.textureBarrier;N.textureBicubic;N.textureBicubicLevel;N.textureCubeUV;N.textureLoad;N.textureSize;N.textureLevel;N.textureStore;N.thickness;N.time;N.toneMapping;N.toneMappingExposure;N.toonOutlinePass;N.transformDirection;N.transformNormal;N.transformNormalToView;N.transformedClearcoatNormalView;N.transformedNormalView;N.transformedNormalWorld;N.transmission;N.transpose;N.triNoise3D;N.triplanarTexture;N.triplanarTextures;N.trunc;N.uint;N.uintBitsToFloat;const sW=N.uniform;N.uniformArray;N.uniformCubeTexture;N.uniformGroup;N.uniformFlow;N.uniformTexture;N.unpackHalf2x16;N.unpackSnorm2x16;N.unpackUnorm2x16;N.unpremultiplyAlpha;N.userData;N.uv;N.uvec2;N.uvec3;N.uvec4;N.varying;N.varyingProperty;N.vec2;N.vec3;N.vec4;N.vectorComponents;N.velocity;N.vertexColor;N.vertexIndex;N.vertexStage;N.vibrance;N.viewZToLogarithmicDepth;N.viewZToOrthographicDepth;N.viewZToPerspectiveDepth;N.viewport;N.viewportCoordinate;N.viewportDepthTexture;N.viewportLinearDepth;N.viewportMipTexture;N.viewportResolution;N.viewportSafeUV;N.viewportSharedTexture;N.viewportSize;N.viewportTexture;N.viewportUV;N.wgsl;N.wgslFn;N.workgroupArray;N.workgroupBarrier;N.workgroupId;N.workingToColorSpace;N.xor;const _v=new af,r0=new ge;class eS extends UN{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Ns(e,3)),this.setAttribute("uv",new Ns(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new Y0(t,6,1);return this.setAttribute("instanceStart",new Uo(r,3,0)),this.setAttribute("instanceEnd",new Uo(r,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new Y0(t,6,1);return this.setAttribute("instanceColorStart",new Uo(r,3,0)),this.setAttribute("instanceColorEnd",new Uo(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new qN(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new af);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),_v.setFromBufferAttribute(t),this.boundingBox.union(_v))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new t1),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)r0.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(r0)),r0.fromBufferAttribute(t,s),i=Math.max(i,r.distanceToSquared(r0));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}w0.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new _t(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};T0.line={uniforms:r1.merge([w0.common,w0.fog,w0.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			float alpha = opacity;
			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class ty extends Zl{constructor(e){super({type:"LineMaterial",uniforms:r1.clone(T0.line.uniforms),vertexShader:T0.line.vertexShader,fragmentShader:T0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Rp=new $t,bv=new ge,vv=new ge,rr=new $t,ir=new $t,us=new $t,Np=new ge,Cp=new dn,sr=new GN,xv=new ge,i0=new af,s0=new t1,As=new $t;let ms,za;function Tv(n,e,t){return As.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),As.multiplyScalar(1/As.w),As.x=za/t.width,As.y=za/t.height,As.applyMatrix4(n.projectionMatrixInverse),As.multiplyScalar(1/As.w),Math.abs(Math.max(As.x,As.y))}function oW(n,e){const t=n.matrixWorld,r=n.geometry,i=r.attributes.instanceStart,s=r.attributes.instanceEnd,o=Math.min(r.instanceCount,i.count);for(let a=0,c=o;a<c;a++){sr.start.fromBufferAttribute(i,a),sr.end.fromBufferAttribute(s,a),sr.applyMatrix4(t);const f=new ge,p=new ge;ms.distanceSqToSegment(sr.start,sr.end,p,f),p.distanceTo(f)<za*.5&&e.push({point:p,pointOnLine:f,distance:ms.origin.distanceTo(p),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function aW(n,e,t){const r=e.projectionMatrix,s=n.material.resolution,o=n.matrixWorld,a=n.geometry,c=a.attributes.instanceStart,f=a.attributes.instanceEnd,p=Math.min(a.instanceCount,c.count),g=-e.near;ms.at(1,us),us.w=1,us.applyMatrix4(e.matrixWorldInverse),us.applyMatrix4(r),us.multiplyScalar(1/us.w),us.x*=s.x/2,us.y*=s.y/2,us.z=0,Np.copy(us),Cp.multiplyMatrices(e.matrixWorldInverse,o);for(let b=0,x=p;b<x;b++){if(rr.fromBufferAttribute(c,b),ir.fromBufferAttribute(f,b),rr.w=1,ir.w=1,rr.applyMatrix4(Cp),ir.applyMatrix4(Cp),rr.z>g&&ir.z>g)continue;if(rr.z>g){const D=rr.z-ir.z,L=(rr.z-g)/D;rr.lerp(ir,L)}else if(ir.z>g){const D=ir.z-rr.z,L=(ir.z-g)/D;ir.lerp(rr,L)}rr.applyMatrix4(r),ir.applyMatrix4(r),rr.multiplyScalar(1/rr.w),ir.multiplyScalar(1/ir.w),rr.x*=s.x/2,rr.y*=s.y/2,ir.x*=s.x/2,ir.y*=s.y/2,sr.start.copy(rr),sr.start.z=0,sr.end.copy(ir),sr.end.z=0;const S=sr.closestPointToPointParameter(Np,!0);sr.at(S,xv);const E=Kl.lerp(rr.z,ir.z,S),C=E>=-1&&E<=1,P=Np.distanceTo(xv)<za*.5;if(C&&P){sr.start.fromBufferAttribute(c,b),sr.end.fromBufferAttribute(f,b),sr.start.applyMatrix4(o),sr.end.applyMatrix4(o);const D=new ge,L=new ge;ms.distanceSqToSegment(sr.start,sr.end,L,D),t.push({point:L,pointOnLine:D,distance:ms.origin.distanceTo(L),object:n,face:null,faceIndex:b,uv:null,uv1:null})}}}class lW extends gn{constructor(e=new eS,t=new ty({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,a=0,c=t.count;o<c;o++,a+=2)bv.fromBufferAttribute(t,o),vv.fromBufferAttribute(r,o),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+bv.distanceTo(vv);const s=new Y0(i,2,1);return e.setAttribute("instanceDistanceStart",new Uo(s,1,0)),e.setAttribute("instanceDistanceEnd",new Uo(s,1,1)),this}raycast(e,t){const r=this.material.worldUnits,i=e.camera;i===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ms=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;za=c.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),s0.copy(a.boundingSphere).applyMatrix4(o);let f;if(r)f=za*.5;else{const g=Math.max(i.near,s0.distanceToPoint(ms.origin));f=Tv(i,g,c.resolution)}if(s0.radius+=f,ms.intersectsSphere(s0)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),i0.copy(a.boundingBox).applyMatrix4(o);let p;if(r)p=za*.5;else{const g=Math.max(i.near,i0.distanceToPoint(ms.origin));p=Tv(i,g,c.resolution)}i0.expandByScalar(p),ms.intersectsBox(i0)!==!1&&(r?oW(this,t):aW(this,i,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Rp),this.material.uniforms.resolution.value.set(Rp.z,Rp.w))}}class tS extends eS{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setColors(r),this}setFromPoints(e){const t=e.length-1,r=new Float32Array(6*t);for(let i=0;i<t;i++)r[6*i]=e[i].x,r[6*i+1]=e[i].y,r[6*i+2]=e[i].z||0,r[6*i+3]=e[i+1].x,r[6*i+4]=e[i+1].y,r[6*i+5]=e[i+1].z||0;return super.setPositions(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class uW extends lW{constructor(e=new tS,t=new ty({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class wv extends VN{constructor(e,t={}){const r=t.font;if(r===void 0)super();else{const i=r.generateShapes(e,t.size,t.direction);t.depth===void 0&&(t.depth=50),t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(i,t)}this.type="TextGeometry"}}class AW{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100,r="ltr"){const i=[],s=cW(e,t,this.data,r);for(let o=0,a=s.length;o<a;o++)i.push(...s[o].toShapes());return i}}function cW(n,e,t,r){const i=Array.from(n),s=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let c=0,f=0;(r=="rtl"||r=="tb")&&i.reverse();for(let p=0;p<i.length;p++){const g=i[p];if(g===`
`)c=0,f-=o;else{const b=hW(g,s,c,f,t);r=="tb"?(c=0,f+=t.ascender*s):c+=b.offsetX,a.push(b.path)}}return a}function hW(n,e,t,r,i){const s=i.glyphs[n]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+n+'" does not exists in font family '+i.familyName+".");return}const o=new zN;let a,c,f,p,g,b,x,T;if(s.o){const S=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let E=0,C=S.length;E<C;)switch(S[E++]){case"m":a=S[E++]*e+t,c=S[E++]*e+r,o.moveTo(a,c);break;case"l":a=S[E++]*e+t,c=S[E++]*e+r,o.lineTo(a,c);break;case"q":f=S[E++]*e+t,p=S[E++]*e+r,g=S[E++]*e+t,b=S[E++]*e+r,o.quadraticCurveTo(g,b,f,p);break;case"b":f=S[E++]*e+t,p=S[E++]*e+r,g=S[E++]*e+t,b=S[E++]*e+r,x=S[E++]*e+t,T=S[E++]*e+r,o.bezierCurveTo(g,b,x,T,f,p);break}}return{offsetX:s.ha*e,path:o}}function wg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function fW(n){if(Array.isArray(n))return n}function dW(n){if(Array.isArray(n))return wg(n)}function nS(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function pW(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Sv(n,e,t,r,i,s,o){try{var a=n[s](o),c=a.value}catch(f){return void t(f)}a.done?e(c):Promise.resolve(c).then(r,i)}function mW(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(c){Sv(s,r,i,o,a,"next",c)}function a(c){Sv(s,r,i,o,a,"throw",c)}o(void 0)})}}function $f(n,e,t){return e=Au(e),SW(n,ry()?Reflect.construct(e,t||[],Au(n).constructor):e.apply(n,t))}function gW(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Hf(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Qu(n,e){return n.get(nS(n,e))}function Mp(n,e,t){gW(n,e),e.set(n,t)}function Pp(n,e,t){return n.set(nS(n,e),t),t}function ny(n,e,t){if(ry())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return i}function yW(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,rS(r.key),r)}}function Wf(n,e,t){return e&&yW(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function tr(n,e,t){return(e=rS(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Sg(){return Sg=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=EW(n,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?n:t):i.value}},Sg.apply(null,arguments)}function Au(n){return Au=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Au(n)}function Qf(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Rg(n,e)}function ry(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ry=function(){return!!n})()}function _W(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function bW(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function vW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ev(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Vt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ev(Object(t),!0).forEach(function(r){tr(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Ev(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function TW(n,e){if(n==null)return{};var t,r,i=wW(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function wW(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function SW(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pW(n)}function Eg(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,e,t=typeof Symbol=="function"?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function s(x,T,S,E){var C=T&&T.prototype instanceof a?T:a,P=Object.create(C.prototype);return Zr(P,"_invoke",function(D,L,k){var q,I,U,j=0,J=k||[],Q=!1,K={p:0,n:0,v:n,a:te,f:te.bind(n,4),d:function(oe,Y){return q=oe,I=0,U=n,K.n=Y,o}};function te(oe,Y){for(I=oe,U=Y,e=0;!Q&&j&&!ae&&e<J.length;e++){var ae,he=J[e],xe=K.p,me=he[2];oe>3?(ae=me===Y)&&(U=he[(I=he[4])?5:(I=3,3)],he[4]=he[5]=n):he[0]<=xe&&((ae=oe<2&&xe<he[1])?(I=0,K.v=Y,K.n=he[1]):xe<me&&(ae=oe<3||he[0]>Y||Y>me)&&(he[4]=oe,he[5]=Y,K.n=me,I=0))}if(ae||oe>1)return o;throw Q=!0,Y}return function(oe,Y,ae){if(j>1)throw TypeError("Generator is already running");for(Q&&Y===1&&te(Y,ae),I=Y,U=ae;(e=I<2?n:U)||!Q;){q||(I?I<3?(I>1&&(K.n=-1),te(I,U)):K.n=U:K.v=U);try{if(j=2,q){if(I||(oe="next"),e=q[oe]){if(!(e=e.call(q,U)))throw TypeError("iterator result is not an object");if(!e.done)return e;U=e.value,I<2&&(I=0)}else I===1&&(e=q.return)&&e.call(q),I<2&&(U=TypeError("The iterator does not provide a '"+oe+"' method"),I=1);q=n}else if((e=(Q=K.n<0)?U:D.call(L,K))!==o)break}catch(he){q=n,I=1,U=he}finally{j=1}}return{value:e,done:Q}}}(x,S,E),!0),P}var o={};function a(){}function c(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(Zr(e={},r,function(){return this}),e),g=f.prototype=a.prototype=Object.create(p);function b(x){return Object.setPrototypeOf?Object.setPrototypeOf(x,f):(x.__proto__=f,Zr(x,i,"GeneratorFunction")),x.prototype=Object.create(g),x}return c.prototype=f,Zr(g,"constructor",f),Zr(f,"constructor",c),c.displayName="GeneratorFunction",Zr(f,i,"GeneratorFunction"),Zr(g),Zr(g,i,"Generator"),Zr(g,r,function(){return this}),Zr(g,"toString",function(){return"[object Generator]"}),(Eg=function(){return{w:s,m:b}})()}function Zr(n,e,t,r){var i=Object.defineProperty;try{i({},"",{})}catch{i=0}Zr=function(s,o,a,c){function f(p,g){Zr(s,p,function(b){return this._invoke(p,g,b)})}o?i?i(s,o,{value:a,enumerable:!c,configurable:!c,writable:!c}):s[o]=a:(f("next",0),f("throw",1),f("return",2))},Zr(n,e,t,r)}function Rg(n,e){return Rg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Rg(n,e)}function un(n,e){return fW(n)||bW(n,e)||iS(n,e)||vW()}function EW(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=Au(n))!==null;);return n}function Bp(n,e,t,r){var i=Sg(Au(n.prototype),e,t);return typeof i=="function"?function(s){return i.apply(t,s)}:i}function Kt(n){return dW(n)||_W(n)||iS(n)||xW()}function RW(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function rS(n){var e=RW(n,"string");return typeof e=="symbol"?e:e+""}function iS(n,e){if(n){if(typeof n=="string")return wg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?wg(n,e):void 0}}var sS=function(e){e instanceof Array?e.forEach(sS):(e.map&&e.map.dispose(),e.dispose())},iy=function(e){e.geometry&&e.geometry.dispose(),e.material&&sS(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(iy)},tn=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),iy(t)}};function Br(n,e){var t=new e;return{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),f=1;f<a;f++)c[f-1]=arguments[f];var p=o[i].apply(o,c);return p===o?this:p}}}}var on=100;function Rv(){return on}function Ci(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180,s=on*(1+t),o=Math.sin(r);return{x:s*o*Math.cos(i),y:s*Math.cos(r),z:s*o*Math.sin(i)}}function oS(n){var e=n.x,t=n.y,r=n.z,i=Math.sqrt(e*e+t*t+r*r),s=Math.acos(t/i),o=Math.atan2(r,e);return{lat:90-s*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),altitude:i/on-1}}function Na(n){return n*Math.PI/180}var zA=window.THREE?window.THREE:{BackSide:yr,BufferAttribute:Hi,Color:$n,Mesh:gn,ShaderMaterial:Zl},NW=`
uniform float hollowRadius;

varying vec3 vVertexWorldPosition;
varying vec3 vVertexNormal;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {    
  vVertexNormal	= normalize(normalMatrix * normal);
  vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;
  
  vec4 objCenterViewPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);
  vCameraDistanceToObjCenter = length(objCenterViewPosition);
  
  float edgeAngle = atan(hollowRadius / vCameraDistanceToObjCenter);
  float vertexAngle = acos(dot(normalize(modelViewMatrix * vec4(position, 1.0)), normalize(objCenterViewPosition)));
  vVertexAngularDistanceToHollowRadius = vertexAngle - edgeAngle;

  gl_Position	= projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,CW=`
uniform vec3 color;
uniform float coefficient;
uniform float power;
uniform float hollowRadius;

varying vec3 vVertexNormal;
varying vec3 vVertexWorldPosition;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {
  if (vCameraDistanceToObjCenter < hollowRadius) discard; // inside the hollowRadius
  if (vVertexAngularDistanceToHollowRadius < 0.0) discard; // frag position is within the hollow radius

  vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;
  vec3 viewCameraToVertex	= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;
  viewCameraToVertex = normalize(viewCameraToVertex);
  float intensity	= pow(
    coefficient + dot(vVertexNormal, viewCameraToVertex),
    power
  );
  gl_FragColor = vec4(color, intensity);
}`;function MW(n,e,t,r){return new zA.ShaderMaterial({depthWrite:!1,transparent:!0,vertexShader:NW,fragmentShader:CW,uniforms:{coefficient:{value:n},color:{value:new zA.Color(e)},power:{value:t},hollowRadius:{value:r}}})}function PW(n,e){for(var t=n.clone(),r=new Float32Array(n.attributes.position.count*3),i=0,s=r.length;i<s;i++){var o=n.attributes.normal.array[i],a=n.attributes.position.array[i];r[i]=a+o*e}return t.setAttribute("position",new zA.BufferAttribute(r,3)),t}var BW=function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.color,o=s===void 0?"gold":s,a=i.size,c=a===void 0?2:a,f=i.coefficient,p=f===void 0?.5:f,g=i.power,b=g===void 0?1:g,x=i.hollowRadius,T=x===void 0?0:x,S=i.backside,E=S===void 0?!0:S;Hf(this,e),r=$f(this,e);var C=PW(t,c),P=MW(p,o,b,T);return E&&(P.side=zA.BackSide),r.geometry=C,r.material=P,r}return Qf(e,n),Wf(e)}(zA.Mesh),cs=window.THREE?window.THREE:{Color:$n,Group:Ls,LineBasicMaterial:of,LineSegments:Vx,Mesh:gn,MeshPhongMaterial:Ox,SphereGeometry:Zo,SRGBColorSpace:HA,TextureLoader:qg},aS=Hn({props:{globeImageUrl:{},bumpImageUrl:{},showGlobe:{default:!0,onChange:function(e,t){t.globeGroup.visible=!!e},triggerUpdate:!1},showGraticules:{default:!1,onChange:function(e,t){t.graticulesObj.visible=!!e},triggerUpdate:!1},showAtmosphere:{default:!0,onChange:function(e,t){t.atmosphereObj&&(t.atmosphereObj.visible=!!e)},triggerUpdate:!1},atmosphereColor:{default:"lightskyblue"},atmosphereAltitude:{default:.15},globeCurvatureResolution:{default:4},globeTileEngineUrl:{onChange:function(e,t){t.tileEngine.tileUrl=e}},globeTileEngineMaxLevel:{default:17,onChange:function(e,t){t.tileEngine.maxLevel=e},triggerUpdate:!1},updatePov:{onChange:function(e,t){t.tileEngine.updatePov(e)},triggerUpdate:!1},onReady:{default:function(){},triggerUpdate:!1}},methods:{globeMaterial:function(e,t){return t!==void 0?(e.globeObj.material=t||e.defaultGlobeMaterial,this):e.globeObj.material},globeTileEngineClearCache:function(e){e.tileEngine.clearTiles()},_destructor:function(e){tn(e.globeObj),tn(e.tileEngine),tn(e.graticulesObj)}},stateInit:function(){var e=new cs.MeshPhongMaterial({color:0}),t=new cs.Mesh(void 0,e);t.rotation.y=-Math.PI/2;var r=new IP(on),i=new cs.Group;i.__globeObjType="globe",i.add(t),i.add(r);var s=new cs.LineSegments(new j4(tP(),on,2),new cs.LineBasicMaterial({color:"lightgrey",transparent:!0,opacity:.1}));return{globeGroup:i,globeObj:t,graticulesObj:s,defaultGlobeMaterial:e,tileEngine:r}},init:function(e,t){tn(e),t.scene=e,t.scene.add(t.globeGroup),t.scene.add(t.graticulesObj),t.ready=!1},update:function(e,t){var r=e.globeObj.material;if(e.tileEngine.visible=!(e.globeObj.visible=!e.globeTileEngineUrl),t.hasOwnProperty("globeCurvatureResolution")){var i;(i=e.globeObj.geometry)===null||i===void 0||i.dispose();var s=Math.max(4,Math.round(360/e.globeCurvatureResolution));e.globeObj.geometry=new cs.SphereGeometry(on,s,s/2),e.tileEngine.curvatureResolution=e.globeCurvatureResolution}if(t.hasOwnProperty("globeImageUrl")&&(e.globeImageUrl?new cs.TextureLoader().load(e.globeImageUrl,function(a){a.colorSpace=cs.SRGBColorSpace,r.map=a,r.color=null,r.needsUpdate=!0,!e.ready&&(e.ready=!0)&&setTimeout(e.onReady)}):!r.color&&(r.color=new cs.Color(0))),t.hasOwnProperty("bumpImageUrl")&&(e.bumpImageUrl?e.bumpImageUrl&&new cs.TextureLoader().load(e.bumpImageUrl,function(a){r.bumpMap=a,r.needsUpdate=!0}):(r.bumpMap=null,r.needsUpdate=!0)),(t.hasOwnProperty("atmosphereColor")||t.hasOwnProperty("atmosphereAltitude"))&&(e.atmosphereObj&&(e.scene.remove(e.atmosphereObj),tn(e.atmosphereObj)),e.atmosphereColor&&e.atmosphereAltitude)){var o=e.atmosphereObj=new BW(e.globeObj.geometry,{color:e.atmosphereColor,size:on*e.atmosphereAltitude,hollowRadius:on,coefficient:.1,power:3.5});o.visible=!!e.showAtmosphere,o.__globeObjType="atmosphere",e.scene.add(o)}!e.ready&&(!e.globeImageUrl||e.globeTileEngineUrl)&&(e.ready=!0,e.onReady())}}),Bs=function(e){return isNaN(e)?parseInt(Xe(e).toHex(),16):e},Qi=function(e){return e&&isNaN(e)?ja(e).opacity:1},Ko=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i,s=1,o=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.eE+-]+)\s*\)$/.exec(e.trim().toLowerCase());if(o){var a=o.slice(1),c=un(a,4),f=c[0],p=c[1],g=c[2],b=c[3];i=new $n("rgb(".concat(+f,",").concat(+p,",").concat(+g,")")),s=Math.min(+b,1)}else i=new $n(e);r&&i.convertLinearToSRGB();var x=i.toArray();return t?[].concat(Kt(x),[s]):x};function DW(n,e,t){return n.opacity=e,n.transparent=e<1,n.depthWrite=e>=1,n}var Nv=window.THREE?window.THREE:{BufferAttribute:Hi};function Ds(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float32Array;if(e===1)return new Nv.BufferAttribute(new t(n),e);for(var r=new Nv.BufferAttribute(new t(n.length*e),e),i=0,s=n.length;i<s;i++)r.set(n[i],i*e);return r}function LW(n){for(var e=n.itemSize,t=[],r=0;r<n.count;r++)t.push(n.array.slice(r*e,(r+1)*e));return t}var Dp=new WeakMap,o0=new WeakMap,a0=new WeakMap,Hr=function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.dataBindAttr,o=s===void 0?"__data":s,a=i.objBindAttr,c=a===void 0?"__threeObj":a,f=i.removeDelay,p=f===void 0?0:f;return Hf(this,e),r=$f(this,e),tr(r,"scene",void 0),Mp(r,Dp,void 0),Mp(r,o0,void 0),Mp(r,a0,void 0),r.scene=t,Pp(Dp,r,o),Pp(o0,r,c),Pp(a0,r,p),r.onRemoveObj(function(){}),r}return Qf(e,n),Wf(e,[{key:"onCreateObj",value:function(r){var i=this;return Bp(e,"onCreateObj",this)([function(s){var o=r(s);return s[Qu(o0,i)]=o,o[Qu(Dp,i)]=s,i.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(r){var i=this;return Bp(e,"onRemoveObj",this)([function(s,o){var a=Bp(e,"getData",i)([s]);r(s,o);var c=function(){i.scene.remove(s),tn(s),delete a[Qu(o0,i)]};Qu(a0,i)?setTimeout(c,Qu(a0,i)):c()}]),this}}])}(hD),Oi=window.THREE?window.THREE:{BufferGeometry:$r,CylinderGeometry:rx,Matrix4:dn,Mesh:gn,MeshLambertMaterial:co,Object3D:Zh,Vector3:ge},Cv=Object.assign({},y1),Mv=Cv.BufferGeometryUtils||Cv,lS=Hn({props:{pointsData:{default:[]},pointLat:{default:"lat"},pointLng:{default:"lng"},pointColor:{default:function(){return"#ffffaa"}},pointAltitude:{default:.1},pointRadius:{default:.25},pointResolution:{default:12,triggerUpdate:!1},pointsMerge:{default:!1},pointsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjPoint"})},update:function(e,t){var r=ve(e.pointLat),i=ve(e.pointLng),s=ve(e.pointAltitude),o=ve(e.pointRadius),a=ve(e.pointColor),c=new Oi.CylinderGeometry(1,1,1,e.pointResolution);c.applyMatrix4(new Oi.Matrix4().makeRotationX(Math.PI/2)),c.applyMatrix4(new Oi.Matrix4().makeTranslation(0,0,-.5));var f=2*Math.PI*on/360,p={};if(!e.pointsMerge&&t.hasOwnProperty("pointsMerge")&&tn(e.scene),e.dataMapper.scene=e.pointsMerge?new Oi.Object3D:e.scene,e.dataMapper.onCreateObj(x).onUpdateObj(T).digest(e.pointsData),e.pointsMerge){var g=e.pointsData.length?(Mv.mergeGeometries||Mv.mergeBufferGeometries)(e.pointsData.map(function(S){var E=e.dataMapper.getObj(S),C=E.geometry.clone();E.updateMatrix(),C.applyMatrix4(E.matrix);var P=Ko(a(S));return C.setAttribute("color",Ds(Array(C.getAttribute("position").count).fill(P),4)),C})):new Oi.BufferGeometry,b=new Oi.Mesh(g,new Oi.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0}));b.__globeObjType="points",b.__data=e.pointsData,e.dataMapper.clear(),tn(e.scene),e.scene.add(b)}function x(){var S=new Oi.Mesh(c);return S.__globeObjType="point",S}function T(S,E){var C=function(U){var j=S.__currentTargetD=U,J=j.r,Q=j.alt,K=j.lat,te=j.lng;Object.assign(S.position,Ci(K,te));var oe=e.pointsMerge?new Oi.Vector3(0,0,0):e.scene.localToWorld(new Oi.Vector3(0,0,0));S.lookAt(oe),S.scale.x=S.scale.y=Math.min(30,J)*f,S.scale.z=Math.max(Q*on,.1)},P={alt:+s(E),r:+o(E),lat:+r(E),lng:+i(E)},D=S.__currentTargetD||Object.assign({},P,{alt:-.001});if(Object.keys(P).some(function(I){return D[I]!==P[I]})&&(e.pointsMerge||!e.pointsTransitionDuration||e.pointsTransitionDuration<0?C(P):e.tweenGroup.add(new br(D).to(P,e.pointsTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(C).start())),!e.pointsMerge){var L=a(E),k=L?Qi(L):0,q=!!k;S.visible=q,q&&(p.hasOwnProperty(L)||(p[L]=new Oi.MeshLambertMaterial({color:Bs(L),transparent:k<1,opacity:k})),S.material=p[L])}}}}),uS=function(){return{uniforms:{dashOffset:{value:0},dashSize:{value:1},gapSize:{value:0},dashTranslate:{value:0}},vertexShader:`
    `.concat(Eu.common,`
    `).concat(Eu.logdepthbuf_pars_vertex,`
  
    uniform float dashTranslate; 

    attribute vec4 color;
    varying vec4 vColor;
    
    attribute float relDistance;
    varying float vRelDistance;

    void main() {
      // pass through colors and distances
      vColor = color;
      vRelDistance = relDistance + dashTranslate;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  
      `).concat(Eu.logdepthbuf_vertex,`
    }
  `),fragmentShader:`
    `.concat(Eu.logdepthbuf_pars_fragment,`

    uniform float dashOffset; 
    uniform float dashSize;
    uniform float gapSize; 
    
    varying vec4 vColor;
    varying float vRelDistance;
    
    void main() {
      // ignore pixels in the gap
      if (vRelDistance < dashOffset) discard;
      if (mod(vRelDistance - dashOffset, dashSize + gapSize) > dashSize) discard;
    
      // set px color: [r, g, b, a], interpolated between vertices 
      gl_FragColor = vColor; 
  
      `).concat(Eu.logdepthbuf_fragment,`
    }
  `)}},Ng=function(e){return e.uniforms.uSurfaceRadius={type:"float",value:0},e.vertexShader=(`attribute float surfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.vertexShader).replace("void main() {",["void main() {","vSurfaceRadius = surfaceRadius;","vPos = position;"].join(`
`)),e.fragmentShader=(`uniform float uSurfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.fragmentShader).replace("void main() {",["void main() {","if (length(vPos) < max(uSurfaceRadius, vSurfaceRadius)) discard;"].join(`
`)),e},OW=function(e){return e.vertexShader=`
    attribute float r;
    
    const float PI = 3.1415926535897932384626433832795;
    float toRad(in float a) {
      return a * PI / 180.0;
    }
    
    vec3 Polar2Cartesian(in vec3 c) { // [lat, lng, r]
      float phi = toRad(90.0 - c.x);
      float theta = toRad(90.0 - c.y);
      float r = c.z;
      return vec3( // x,y,z
        r * sin(phi) * cos(theta),
        r * cos(phi),
        r * sin(phi) * sin(theta)
      );
    }
    
    vec2 Cartesian2Polar(in vec3 p) {
      float r = sqrt(p.x * p.x + p.y * p.y + p.z * p.z);
      float phi = acos(p.y / r);
      float theta = atan(p.z, p.x);
      return vec2( // lat,lng
        90.0 - phi * 180.0 / PI,
        90.0 - theta * 180.0 / PI - (theta < -PI / 2.0 ? 360.0 : 0.0)
      );
    }
    `.concat(e.vertexShader.replace("}",`                  
        vec3 pos = Polar2Cartesian(vec3(Cartesian2Polar(position), r));
        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
      }
    `),`
  `),e},sy=function(e,t){return e.onBeforeCompile=function(r){e.userData.shader=t(r)},e},FW=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(i){return i};if(e.userData.shader)t(e.userData.shader.uniforms);else{var r=e.onBeforeCompile;e.onBeforeCompile=function(i){r(i),t(i.uniforms)}}},IW=["stroke"],Fi=window.THREE?window.THREE:{BufferGeometry:$r,CubicBezierCurve3:HN,Curve:WN,Group:Ls,Line:i1,Mesh:gn,NormalBlending:Xs,ShaderMaterial:Zl,TubeGeometry:$N,Vector3:ge},kW=iu.default||iu,AS=Hn({props:{arcsData:{default:[]},arcStartLat:{default:"startLat"},arcStartLng:{default:"startLng"},arcStartAltitude:{default:0},arcEndLat:{default:"endLat"},arcEndLng:{default:"endLng"},arcEndAltitude:{default:0},arcColor:{default:function(){return"#ffffaa"}},arcAltitude:{},arcAltitudeAutoScale:{default:.5},arcStroke:{},arcCurveResolution:{default:64,triggerUpdate:!1},arcCircularResolution:{default:6,triggerUpdate:!1},arcDashLength:{default:1},arcDashGap:{default:0},arcDashInitialGap:{default:0},arcDashAnimateTime:{default:0},arcsTransitionDuration:{default:1e3,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;e.sharedMaterial.dispose(),(t=e.ticker)===null||t===void 0||t.dispose()}},stateInit:function(e){var t=e.tweenGroup;return{tweenGroup:t,ticker:new kW,sharedMaterial:new Fi.ShaderMaterial(Vt(Vt({},uS()),{},{transparent:!0,blending:Fi.NormalBlending}))}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjArc"}).onCreateObj(function(){var r=new Fi.Group;return r.__globeObjType="arc",r}),t.ticker.onTick.add(function(r,i){t.dataMapper.entries().map(function(s){var o=un(s,2),a=o[1];return a}).filter(function(s){return s.children.length&&s.children[0].material&&s.children[0].__dashAnimateStep}).forEach(function(s){var o=s.children[0],a=o.__dashAnimateStep*i,c=o.material.uniforms.dashTranslate.value%1e9;o.material.uniforms.dashTranslate.value=c+a})})},update:function(e){var t=ve(e.arcStartLat),r=ve(e.arcStartLng),i=ve(e.arcStartAltitude),s=ve(e.arcEndLat),o=ve(e.arcEndLng),a=ve(e.arcEndAltitude),c=ve(e.arcAltitude),f=ve(e.arcAltitudeAutoScale),p=ve(e.arcStroke),g=ve(e.arcColor),b=ve(e.arcDashLength),x=ve(e.arcDashGap),T=ve(e.arcDashInitialGap),S=ve(e.arcDashAnimateTime);e.dataMapper.onUpdateObj(function(D,L){var k=p(L),q=k!=null;if(!D.children.length||q!==(D.children[0].type==="Mesh")){tn(D);var I=q?new Fi.Mesh:new Fi.Line(new Fi.BufferGeometry);I.material=e.sharedMaterial.clone(),D.add(I)}var U=D.children[0];Object.assign(U.material.uniforms,{dashSize:{value:b(L)},gapSize:{value:x(L)},dashOffset:{value:T(L)}});var j=S(L);U.__dashAnimateStep=j>0?1e3/j:0;var J=C(g(L),e.arcCurveResolution,q?e.arcCircularResolution+1:1),Q=P(e.arcCurveResolution,q?e.arcCircularResolution+1:1,!0);U.geometry.setAttribute("color",J),U.geometry.setAttribute("relDistance",Q);var K=function(ae){var he=D.__currentTargetD=ae,xe=he.stroke,me=TW(he,IW),Oe=E(me);q?(U.geometry&&U.geometry.dispose(),U.geometry=new Fi.TubeGeometry(Oe,e.arcCurveResolution,xe/2,e.arcCircularResolution),U.geometry.setAttribute("color",J),U.geometry.setAttribute("relDistance",Q)):U.geometry.setFromPoints(Oe.getPoints(e.arcCurveResolution))},te={stroke:k,alt:c(L),altAutoScale:+f(L),startLat:+t(L),startLng:+r(L),startAlt:+i(L),endLat:+s(L),endLng:+o(L),endAlt:+a(L)},oe=D.__currentTargetD||Object.assign({},te,{altAutoScale:-.001});Object.keys(te).some(function(Y){return oe[Y]!==te[Y]})&&(!e.arcsTransitionDuration||e.arcsTransitionDuration<0?K(te):e.tweenGroup.add(new br(oe).to(te,e.arcsTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(K).start()))}).digest(e.arcsData);function E(D){var L=D.alt,k=D.altAutoScale,q=D.startLat,I=D.startLng,U=D.startAlt,j=D.endLat,J=D.endLng,Q=D.endAlt,K=function(Lt){var Wt=un(Lt,3),Pn=Wt[0],Vn=Wt[1],vn=Wt[2],xn=Ci(Vn,Pn,vn),Bn=xn.x,zn=xn.y,Wr=xn.z;return new Fi.Vector3(Bn,zn,Wr)},te=[I,q],oe=[J,j],Y=L;if(Y==null&&(Y=Qo(te,oe)/2*k+Math.max(U,Q)),Y||U||Q){var ae=f1(te,oe),he=function(Lt,Wt){return Wt+(Wt-Lt)*(Lt<Wt?.5:.25)},xe=[.25,.75].map(function(mt){return[].concat(Kt(ae(mt)),[he(mt<.5?U:Q,Y)])}),me=un(xe,2),Oe=me[0],ke=me[1],Ke=ny(Fi.CubicBezierCurve3,Kt([[].concat(te,[U]),Oe,ke,[].concat(oe,[Q])].map(K)));return Ke}else{var Ye=.001;return Ft.apply(void 0,Kt([[].concat(te,[Ye]),[].concat(oe,[Ye])].map(K)))}function Ft(mt,Lt){var Wt=mt.angleTo(Lt),Pn=Wt===0?function(){return mt.clone()}:function(vn){return new Fi.Vector3().addVectors(mt.clone().multiplyScalar(Math.sin((1-vn)*Wt)),Lt.clone().multiplyScalar(Math.sin(vn*Wt))).divideScalar(Math.sin(Wt))},Vn=new Fi.Curve;return Vn.getPoint=Pn,Vn}}function C(D,L){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,q=L+1,I;if(D instanceof Array||D instanceof Function){var U=D instanceof Array?ro().domain(D.map(function(Y,ae){return ae/(D.length-1)})).range(D):D;I=function(ae){return Ko(U(ae),!0,!0)}}else{var j=Ko(D,!0,!0);I=function(){return j}}for(var J=[],Q=0,K=q;Q<K;Q++)for(var te=I(Q/(K-1)),oe=0;oe<k;oe++)J.push(te);return Ds(J,4)}function P(D){for(var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,q=D+1,I=[],U=0,j=q;U<j;U++)for(var J=U/(j-1),Q=0;Q<L;Q++)I.push(J);return k&&I.reverse(),Ds(I,1)}}}),No=window.THREE?window.THREE:{BufferGeometry:$r,DoubleSide:vi,Mesh:gn,MeshLambertMaterial:co,Object3D:Zh},Pv=Object.assign({},y1),Bv=Pv.BufferGeometryUtils||Pv,cS=Hn({props:{hexBinPointsData:{default:[]},hexBinPointLat:{default:"lat"},hexBinPointLng:{default:"lng"},hexBinPointWeight:{default:1},hexBinResolution:{default:4},hexMargin:{default:.2},hexTopCurvatureResolution:{default:5},hexTopColor:{default:function(){return"#ffffaa"}},hexSideColor:{default:function(){return"#ffffaa"}},hexAltitude:{default:function(e){var t=e.sumWeight;return t*.01}},hexBinMerge:{default:!1},hexTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjHexbin"})},update:function(e,t){var r=ve(e.hexBinPointLat),i=ve(e.hexBinPointLng),s=ve(e.hexBinPointWeight),o=ve(e.hexAltitude),a=ve(e.hexTopColor),c=ve(e.hexSideColor),f=ve(e.hexMargin),p=BL(e.hexBinPointsData.map(function(P){return Vt(Vt({},P),{},{h3Idx:gO(r(P),i(P),e.hexBinResolution)})}),"h3Idx"),g=Object.entries(p).map(function(P){var D=un(P,2),L=D[0],k=D[1];return{h3Idx:L,points:k,sumWeight:k.reduce(function(q,I){return q+ +s(I)},0)}}),b={};if(!e.hexBinMerge&&t.hasOwnProperty("hexBinMerge")&&tn(e.scene),e.dataMapper.scene=e.hexBinMerge?new No.Object3D:e.scene,e.dataMapper.id(function(P){return P.h3Idx}).onCreateObj(E).onUpdateObj(C).digest(g),e.hexBinMerge){var x=g.length?(Bv.mergeGeometries||Bv.mergeBufferGeometries)(g.map(function(P){var D=e.dataMapper.getObj(P),L=D.geometry.toNonIndexed();D.updateMatrix(),L.applyMatrix4(D.matrix);var k=Ko(a(P)),q=Ko(c(P)),I=L.getAttribute("position").count,U=L.groups[0].count;return L.setAttribute("color",Ds(Kt(new Array(I)).map(function(j,J){return J>=U?k:q}),4)),L})):new No.BufferGeometry,T=new No.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0,side:No.DoubleSide});T.onBeforeCompile=function(P){T.userData.shader=Ng(P)};var S=new No.Mesh(x,T);S.__globeObjType="hexBinPoints",S.__data=g,e.dataMapper.clear(),tn(e.scene),e.scene.add(S)}function E(P){var D=new No.Mesh;D.__hexCenter=AT(P.h3Idx),D.__hexGeoJson=cT(P.h3Idx,!0).reverse();var L=D.__hexCenter[1];return D.__hexGeoJson.forEach(function(k){var q=k[0];Math.abs(L-q)>170&&(k[0]+=L>q?360:-360)}),D.__globeObjType="hexbin",D}function C(P,D){var L=function(he,xe,me){return he-(he-xe)*me},k=Math.max(0,Math.min(1,+f(D))),q=un(P.__hexCenter,2),I=q[0],U=q[1],j=k===0?P.__hexGeoJson:P.__hexGeoJson.map(function(ae){var he=un(ae,2),xe=he[0],me=he[1];return[[xe,U],[me,I]].map(function(Oe){var ke=un(Oe,2),Ke=ke[0],Ye=ke[1];return L(Ke,Ye,k)})}),J=e.hexTopCurvatureResolution;P.geometry&&P.geometry.dispose(),P.geometry=new T1([j],0,on,!1,!0,!0,J);var Q={alt:+o(D)},K=function(he){var xe=P.__currentTargetD=he,me=xe.alt;P.scale.x=P.scale.y=P.scale.z=1+me;var Oe=on/(me+1);P.geometry.setAttribute("surfaceRadius",Ds(Array(P.geometry.getAttribute("position").count).fill(Oe),1))},te=P.__currentTargetD||Object.assign({},Q,{alt:-.001});if(Object.keys(Q).some(function(ae){return te[ae]!==Q[ae]})&&(e.hexBinMerge||!e.hexTransitionDuration||e.hexTransitionDuration<0?K(Q):e.tweenGroup.add(new br(te).to(Q,e.hexTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(K).start())),!e.hexBinMerge){var oe=c(D),Y=a(D);[oe,Y].forEach(function(ae){if(!b.hasOwnProperty(ae)){var he=Qi(ae);b[ae]=sy(new No.MeshLambertMaterial({color:Bs(ae),transparent:he<1,opacity:he,side:No.DoubleSide}),Ng)}}),P.material=[oe,Y].map(function(ae){return b[ae]})}}}}),hS=function(e){return e*e},Hs=function(e){return e*Math.PI/180};function UW(n,e){var t=Math.sqrt,r=Math.cos,i=function(p){return hS(Math.sin(p/2))},s=Hs(n[1]),o=Hs(e[1]),a=Hs(n[0]),c=Hs(e[0]);return 2*Math.asin(t(i(o-s)+r(s)*r(o)*i(c-a)))}var qW=Math.sqrt(2*Math.PI);function GW(n,e){return Math.exp(-hS(n/e)/2)/(e*qW)}var VW=function(e){var t=un(e,2),r=t[0],i=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=o.lngAccessor,c=a===void 0?function(E){return E[0]}:a,f=o.latAccessor,p=f===void 0?function(E){return E[1]}:f,g=o.weightAccessor,b=g===void 0?function(){return 1}:g,x=o.bandwidth,T=[r,i],S=x*Math.PI/180;return PM(s.map(function(E){var C=b(E);if(!C)return 0;var P=UW(T,[c(E),p(E)]);return GW(P,S)*C}))},zW=function(){var n=mW(Eg().m(function e(t){var r,i,s,o,a,c,f,p,g,b,x,T,S,E,C,P,D,L,k,q,I,U,j,J,Q,K,te,oe,Y,ae,he,xe,me,Oe,ke,Ke,Ye,Ft,mt,Lt,Wt=arguments,Pn,Vn,vn;return Eg().w(function(xn){for(;;)switch(xn.n){case 0:if(i=Wt.length>1&&Wt[1]!==void 0?Wt[1]:[],s=Wt.length>2&&Wt[2]!==void 0?Wt[2]:{},o=s.lngAccessor,a=o===void 0?function(Bn){return Bn[0]}:o,c=s.latAccessor,f=c===void 0?function(Bn){return Bn[1]}:c,p=s.weightAccessor,g=p===void 0?function(){return 1}:p,b=s.bandwidth,(r=navigator)!==null&&r!==void 0&&r.gpu){xn.n=1;break}return console.warn("WebGPU not enabled in browser. Please consider enabling it to improve performance."),xn.a(2,t.map(function(Bn){return VW(Bn,i,{lngAccessor:a,latAccessor:f,weightAccessor:g,bandwidth:b})}));case 1:return x=4,T=WH,S=QH,E=sW,C=iW,P=JH,D=eW,L=XH,k=rW,q=nW,I=KH,U=YH,j=ZH,J=tW,Q=C(new I0(new Float32Array(t.flat().map(Hs)),2),"vec2",t.length),K=C(new I0(new Float32Array(i.map(function(Bn){return[Hs(a(Bn)),Hs(f(Bn)),g(Bn)]}).flat()),3),"vec3",i.length),te=new I0(t.length,1),oe=C(te,"float",t.length),Y=P(Math.PI),ae=k(Y.mul(2)),he=function(zn){return zn.mul(zn)},xe=function(zn){return he(q(zn.div(2)))},me=function(zn,Wr){var po=P(zn[1]),aa=P(Wr[1]),li=P(zn[0]),Di=P(Wr[0]);return P(2).mul(U(k(xe(aa.sub(po)).add(I(po).mul(I(aa)).mul(xe(Di.sub(li)))))))},Oe=function(zn,Wr){return j(J(he(zn.div(Wr)).div(2))).div(Wr.mul(ae))},ke=E(Hs(b)),Ke=E(Hs(b*x)),Ye=E(i.length),Ft=T(function(){var Bn=Q.element(D),zn=oe.element(D);zn.assign(0),L(Ye,function(Wr){var po=Wr.i,aa=K.element(po),li=aa.z;S(li,function(){var Di=me(aa.xy,Bn.xy);S(Di&&Di.lessThan(Ke),function(){zn.addAssign(Oe(Di,ke).mul(li))})})})}),mt=Ft().compute(t.length),Lt=new J5,xn.n=2,Lt.computeAsync(mt);case 2:return Pn=Array,Vn=Float32Array,xn.n=3,Lt.getArrayBufferAsync(te);case 3:return vn=xn.v,xn.a(2,Pn.from.call(Pn,new Vn(vn)))}},e)}));return function(t){return n.apply(this,arguments)}}(),l0=window.THREE?window.THREE:{Mesh:gn,MeshLambertMaterial:co,SphereGeometry:Zo},jW=3.5,$W=.1,Dv=100,HW=function(e){var t=ja(_O(e));return t.opacity=Math.cbrt(e),t.formatRgb()},fS=Hn({props:{heatmapsData:{default:[]},heatmapPoints:{default:function(e){return e}},heatmapPointLat:{default:function(e){return e[0]}},heatmapPointLng:{default:function(e){return e[1]}},heatmapPointWeight:{default:1},heatmapBandwidth:{default:2.5},heatmapColorFn:{default:function(){return HW}},heatmapColorSaturation:{default:1.5},heatmapBaseAltitude:{default:.01},heatmapTopAltitude:{},heatmapsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjHeatmap"}).onCreateObj(function(){var s=new l0.Mesh(new l0.SphereGeometry(on),sy(new l0.MeshLambertMaterial({vertexColors:!0,transparent:!0}),OW));return s.__globeObjType="heatmap",s})},update:function(e){var t=ve(e.heatmapPoints),r=ve(e.heatmapPointLat),i=ve(e.heatmapPointLng),s=ve(e.heatmapPointWeight),o=ve(e.heatmapBandwidth),a=ve(e.heatmapColorFn),c=ve(e.heatmapColorSaturation),f=ve(e.heatmapBaseAltitude),p=ve(e.heatmapTopAltitude);e.dataMapper.onUpdateObj(function(g,b){var x=o(b),T=a(b),S=c(b),E=f(b),C=p(b),P=t(b).map(function(I){var U=r(I),j=i(I),J=Ci(U,j),Q=J.x,K=J.y,te=J.z;return{x:Q,y:K,z:te,lat:U,lng:j,weight:s(I)}}),D=Math.max($W,x/jW),L=Math.ceil(360/(D||-1));g.geometry.parameters.widthSegments!==L&&(g.geometry.dispose(),g.geometry=new l0.SphereGeometry(on,L,L/2));var k=LW(g.geometry.getAttribute("position")),q=k.map(function(I){var U=un(I,3),j=U[0],J=U[1],Q=U[2],K=oS({x:j,y:J,z:Q}),te=K.lng,oe=K.lat;return[te,oe]});zW(q,P,{latAccessor:function(U){return U.lat},lngAccessor:function(U){return U.lng},weightAccessor:function(U){return U.weight},bandwidth:x}).then(function(I){var U=Kt(new Array(Dv)).map(function(K,te){return Ko(T(te/(Dv-1)))}),j=function(te){var oe=g.__currentTargetD=te,Y=oe.kdeVals,ae=oe.topAlt,he=oe.saturation,xe=NM(Y.map(Math.abs))||1e-15,me=A4([0,xe/he],U);g.geometry.setAttribute("color",Ds(Y.map(function(ke){return me(Math.abs(ke))}),4));var Oe=ro([0,xe],[on*(1+E),on*(1+(ae||E))]);g.geometry.setAttribute("r",Ds(Y.map(Oe)))},J={kdeVals:I,topAlt:C,saturation:S},Q=g.__currentTargetD||Object.assign({},J,{kdeVals:I.map(function(){return 0}),topAlt:C&&E,saturation:.5});Q.kdeVals.length!==I.length&&(Q.kdeVals=I.slice()),Object.keys(J).some(function(K){return Q[K]!==J[K]})&&(!e.heatmapsTransitionDuration||e.heatmapsTransitionDuration<0?j(J):e.tweenGroup.add(new br(Q).to(J,e.heatmapsTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(j).start()))})}).digest(e.heatmapsData)}}),Co=window.THREE?window.THREE:{DoubleSide:vi,Group:Ls,LineBasicMaterial:of,LineSegments:Vx,Mesh:gn,MeshBasicMaterial:ds},dS=Hn({props:{polygonsData:{default:[]},polygonGeoJsonGeometry:{default:"geometry"},polygonSideColor:{default:function(){return"#ffffaa"}},polygonSideMaterial:{},polygonCapColor:{default:function(){return"#ffffaa"}},polygonCapMaterial:{},polygonStrokeColor:{},polygonAltitude:{default:.01},polygonCapCurvatureResolution:{default:5},polygonsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjPolygon"}).id(function(s){return s.id}).onCreateObj(function(){var s=new Co.Group;return s.__defaultSideMaterial=sy(new Co.MeshBasicMaterial({side:Co.DoubleSide,depthWrite:!0}),Ng),s.__defaultCapMaterial=new Co.MeshBasicMaterial({side:Co.DoubleSide,depthWrite:!0}),s.add(new Co.Mesh(void 0,[s.__defaultSideMaterial,s.__defaultCapMaterial])),s.add(new Co.LineSegments(void 0,new Co.LineBasicMaterial)),s.__globeObjType="polygon",s})},update:function(e){var t=ve(e.polygonGeoJsonGeometry),r=ve(e.polygonAltitude),i=ve(e.polygonCapCurvatureResolution),s=ve(e.polygonCapColor),o=ve(e.polygonCapMaterial),a=ve(e.polygonSideColor),c=ve(e.polygonSideMaterial),f=ve(e.polygonStrokeColor),p=[];e.polygonsData.forEach(function(g){var b={data:g,capColor:s(g),capMaterial:o(g),sideColor:a(g),sideMaterial:c(g),strokeColor:f(g),altitude:+r(g),capCurvatureResolution:+i(g)},x=t(g),T=g.__id||"".concat(Math.round(Math.random()*1e9));g.__id=T,x.type==="Polygon"?p.push(Vt({id:"".concat(T,"_0"),coords:x.coordinates},b)):x.type==="MultiPolygon"?p.push.apply(p,Kt(x.coordinates.map(function(S,E){return Vt({id:"".concat(T,"_").concat(E),coords:S},b)}))):console.warn("Unsupported GeoJson geometry type: ".concat(x.type,". Skipping geometry..."))}),e.dataMapper.onUpdateObj(function(g,b){var x=b.coords,T=b.capColor,S=b.capMaterial,E=b.sideColor,C=b.sideMaterial,P=b.strokeColor,D=b.altitude,L=b.capCurvatureResolution,k=un(g.children,2),q=k[0],I=k[1],U=!!P;I.visible=U;var j=!!(T||S),J=!!(E||C);WW(q.geometry.parameters||{},{polygonGeoJson:x,curvatureResolution:L,closedTop:j,includeSides:J})||(q.geometry&&q.geometry.dispose(),q.geometry=new T1(x,0,on,!1,j,J,L)),U&&(!I.geometry.parameters||I.geometry.parameters.geoJson.coordinates!==x||I.geometry.parameters.resolution!==L)&&(I.geometry&&I.geometry.dispose(),I.geometry=new j4({type:"Polygon",coordinates:x},on,L));var Q=J?0:-1,K=j?J?1:0:-1;if(Q>=0&&(q.material[Q]=C||g.__defaultSideMaterial),K>=0&&(q.material[K]=S||g.__defaultCapMaterial),[[!C&&E,Q],[!S&&T,K]].forEach(function(xe){var me=un(xe,2),Oe=me[0],ke=me[1];if(!(!Oe||ke<0)){var Ke=q.material[ke],Ye=Qi(Oe);Ke.color.set(Bs(Oe)),Ke.transparent=Ye<1,Ke.opacity=Ye}}),U){var te=I.material,oe=Qi(P);te.color.set(Bs(P)),te.transparent=oe<1,te.opacity=oe}var Y={alt:D},ae=function(me){var Oe=g.__currentTargetD=me,ke=Oe.alt;q.scale.x=q.scale.y=q.scale.z=1+ke,U&&(I.scale.x=I.scale.y=I.scale.z=1+ke+1e-4),FW(g.__defaultSideMaterial,function(Ke){return Ke.uSurfaceRadius.value=on/(ke+1)})},he=g.__currentTargetD||Object.assign({},Y,{alt:-.001});Object.keys(Y).some(function(xe){return he[xe]!==Y[xe]})&&(!e.polygonsTransitionDuration||e.polygonsTransitionDuration<0||he.alt===Y.alt?ae(Y):e.tweenGroup.add(new br(he).to(Y,e.polygonsTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(ae).start()))}).digest(p)}});function WW(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return function(r,i){return r===i}};return Object.entries(e).every(function(r){var i=un(r,2),s=i[0],o=i[1];return n.hasOwnProperty(s)&&t(s)(n[s],o)})}var El=window.THREE?window.THREE:{BufferGeometry:$r,DoubleSide:vi,Mesh:gn,MeshLambertMaterial:co,Vector3:ge},Lv=Object.assign({},y1),Ov=Lv.BufferGeometryUtils||Lv,pS=Hn({props:{hexPolygonsData:{default:[]},hexPolygonGeoJsonGeometry:{default:"geometry"},hexPolygonColor:{default:function(){return"#ffffaa"}},hexPolygonAltitude:{default:.001},hexPolygonResolution:{default:3},hexPolygonMargin:{default:.2},hexPolygonUseDots:{default:!1},hexPolygonCurvatureResolution:{default:5},hexPolygonDotResolution:{default:12},hexPolygonsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjHexPolygon"}).onCreateObj(function(){var s=new El.Mesh(void 0,new El.MeshLambertMaterial({side:El.DoubleSide}));return s.__globeObjType="hexPolygon",s})},update:function(e){var t=ve(e.hexPolygonGeoJsonGeometry),r=ve(e.hexPolygonColor),i=ve(e.hexPolygonAltitude),s=ve(e.hexPolygonResolution),o=ve(e.hexPolygonMargin),a=ve(e.hexPolygonUseDots),c=ve(e.hexPolygonCurvatureResolution),f=ve(e.hexPolygonDotResolution);e.dataMapper.onUpdateObj(function(p,g){var b=t(g),x=s(g),T=i(g),S=Math.max(0,Math.min(1,+o(g))),E=a(g),C=c(g),P=f(g),D=r(g),L=Qi(D);p.material.color.set(Bs(D)),p.material.transparent=L<1,p.material.opacity=L;var k={alt:T,margin:S,curvatureResolution:C},q={geoJson:b,h3Res:x},I=p.__currentTargetD||Object.assign({},k,{alt:-.001}),U=p.__currentMemD||q;if(Object.keys(k).some(function(K){return I[K]!==k[K]})||Object.keys(q).some(function(K){return U[K]!==q[K]})){p.__currentMemD=q;var j=[];b.type==="Polygon"?K3(b.coordinates,x,!0).forEach(function(K){return j.push(K)}):b.type==="MultiPolygon"?b.coordinates.forEach(function(K){return K3(K,x,!0).forEach(function(te){return j.push(te)})}):console.warn("Unsupported GeoJson geometry type: ".concat(b.type,". Skipping geometry..."));var J=j.map(function(K){var te=AT(K),oe=cT(K,!0).reverse(),Y=te[1];return oe.forEach(function(ae){var he=ae[0];Math.abs(Y-he)>170&&(ae[0]+=Y>he?360:-360)}),{h3Idx:K,hexCenter:te,hexGeoJson:oe}}),Q=function(te){var oe=p.__currentTargetD=te,Y=oe.alt,ae=oe.margin,he=oe.curvatureResolution;p.geometry&&p.geometry.dispose(),p.geometry=J.length?(Ov.mergeGeometries||Ov.mergeBufferGeometries)(J.map(function(xe){var me=un(xe.hexCenter,2),Oe=me[0],ke=me[1];if(E){var Ke=Ci(Oe,ke,Y),Ye=Ci(xe.hexGeoJson[0][1],xe.hexGeoJson[0][0],Y),Ft=.85*(1-ae)*new El.Vector3(Ke.x,Ke.y,Ke.z).distanceTo(new El.Vector3(Ye.x,Ye.y,Ye.z)),mt=new Gx(Ft,P);return mt.rotateX(Na(-Oe)),mt.rotateY(Na(ke)),mt.translate(Ke.x,Ke.y,Ke.z),mt}else{var Lt=function(Vn,vn,xn){return Vn-(Vn-vn)*xn},Wt=ae===0?xe.hexGeoJson:xe.hexGeoJson.map(function(Pn){var Vn=un(Pn,2),vn=Vn[0],xn=Vn[1];return[[vn,ke],[xn,Oe]].map(function(Bn){var zn=un(Bn,2),Wr=zn[0],po=zn[1];return Lt(Wr,po,ae)})});return new T1([Wt],on,on*(1+Y),!1,!0,!1,he)}})):new El.BufferGeometry};!e.hexPolygonsTransitionDuration||e.hexPolygonsTransitionDuration<0?Q(k):e.tweenGroup.add(new br(I).to(k,e.hexPolygonsTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(Q).start())}}).digest(e.hexPolygonsData)}}),QW=window.THREE?window.THREE:{Vector3:ge};function XW(n,e){var t=function(o,a){var c=o[o.length-1];return[].concat(Kt(o),Kt(Array(a-o.length).fill(c)))},r=Math.max(n.length,e.length),i=WM.apply(void 0,Kt([n,e].map(function(s){return s.map(function(o){var a=o.x,c=o.y,f=o.z;return[a,c,f]})}).map(function(s){return t(s,r)})));return function(s){return s===0?n:s===1?e:i(s).map(function(o){var a=un(o,3),c=a[0],f=a[1],p=a[2];return new QW.Vector3(c,f,p)})}}var va=window.THREE?window.THREE:{BufferGeometry:$r,Color:$n,Group:Ls,Line:i1,NormalBlending:Xs,ShaderMaterial:Zl,Vector3:ge},YW=iu.default||iu,mS=Hn({props:{pathsData:{default:[]},pathPoints:{default:function(e){return e}},pathPointLat:{default:function(e){return e[0]}},pathPointLng:{default:function(e){return e[1]}},pathPointAlt:{default:.001},pathResolution:{default:2},pathColor:{default:function(){return"#ffffaa"}},pathStroke:{},pathDashLength:{default:1},pathDashGap:{default:0},pathDashInitialGap:{default:0},pathDashAnimateTime:{default:0},pathTransitionDuration:{default:1e3,triggerUpdate:!1},rendererSize:{}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;(t=e.ticker)===null||t===void 0||t.dispose()}},stateInit:function(e){var t=e.tweenGroup;return{tweenGroup:t,ticker:new YW,sharedMaterial:new va.ShaderMaterial(Vt(Vt({},uS()),{},{transparent:!0,blending:va.NormalBlending}))}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjPath"}).onCreateObj(function(){var r=new va.Group;return r.__globeObjType="path",r}),t.ticker.onTick.add(function(r,i){t.dataMapper.entries().map(function(s){var o=un(s,2),a=o[1];return a}).filter(function(s){return s.children.length&&s.children[0].material&&s.children[0].__dashAnimateStep}).forEach(function(s){var o=s.children[0],a=o.__dashAnimateStep*i;if(o.type==="Line"){var c=o.material.uniforms.dashTranslate.value%1e9;o.material.uniforms.dashTranslate.value=c+a}else if(o.type==="Line2"){for(var f=o.material.dashOffset-a,p=o.material.dashSize+o.material.gapSize;f<=-p;)f+=p;o.material.dashOffset=f}})})},update:function(e){var t=ve(e.pathPoints),r=ve(e.pathPointLat),i=ve(e.pathPointLng),s=ve(e.pathPointAlt),o=ve(e.pathStroke),a=ve(e.pathColor),c=ve(e.pathDashLength),f=ve(e.pathDashGap),p=ve(e.pathDashInitialGap),g=ve(e.pathDashAnimateTime);e.dataMapper.onUpdateObj(function(E,C){var P=o(C),D=P!=null;if(!E.children.length||D===(E.children[0].type==="Line")){tn(E);var L=D?new uW(new tS,new ty):new va.Line(new va.BufferGeometry,e.sharedMaterial.clone());E.add(L)}var k=E.children[0],q=x(t(C),r,i,s,e.pathResolution),I=g(C);if(k.__dashAnimateStep=I>0?1e3/I:0,D){k.material.resolution=e.rendererSize;{var J=c(C),Q=f(C),K=p(C);k.material.dashed=Q>0,k.material.dashed?k.material.defines.USE_DASH="":delete k.material.defines.USE_DASH,k.material.dashed&&(k.material.dashScale=1/b(q),k.material.dashSize=J,k.material.gapSize=Q,k.material.dashOffset=-K)}{var te=a(C);if(te instanceof Array){var oe=T(a(C),q.length-1,1,!1);k.geometry.setColors(oe.array),k.material.vertexColors=!0}else{var Y=te,ae=Qi(Y);k.material.color=new va.Color(Bs(Y)),k.material.transparent=ae<1,k.material.opacity=ae,k.material.vertexColors=!1}}k.material.needsUpdate=!0}else{Object.assign(k.material.uniforms,{dashSize:{value:c(C)},gapSize:{value:f(C)},dashOffset:{value:p(C)}});var U=T(a(C),q.length),j=S(q.length,1,!0);k.geometry.setAttribute("color",U),k.geometry.setAttribute("relDistance",j)}var he=XW(E.__currentTargetD&&E.__currentTargetD.points||[q[0]],q),xe=function(Ke){var Ye=E.__currentTargetD=Ke,Ft=Ye.stroke,mt=Ye.interpolK,Lt=E.__currentTargetD.points=he(mt);if(D){var Wt;k.geometry.setPositions((Wt=[]).concat.apply(Wt,Kt(Lt.map(function(Pn){var Vn=Pn.x,vn=Pn.y,xn=Pn.z;return[Vn,vn,xn]})))),k.material.linewidth=Ft,k.material.dashed&&k.computeLineDistances()}else k.geometry.setFromPoints(Lt),k.geometry.computeBoundingSphere()},me={stroke:P,interpolK:1},Oe=Object.assign({},E.__currentTargetD||me,{interpolK:0});Object.keys(me).some(function(ke){return Oe[ke]!==me[ke]})&&(!e.pathTransitionDuration||e.pathTransitionDuration<0?xe(me):e.tweenGroup.add(new br(Oe).to(me,e.pathTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(xe).start()))}).digest(e.pathsData);function b(E){var C=0,P;return E.forEach(function(D){P&&(C+=P.distanceTo(D)),P=D}),C}function x(E,C,P,D,L){var k=function(j,J,Q){for(var K=[],te=1;te<=Q;te++)K.push(j+(J-j)*te/(Q+1));return K},q=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,Q=[],K=null;return j.forEach(function(te){if(K){for(;Math.abs(K[1]-te[1])>180;)K[1]+=360*(K[1]<te[1]?1:-1);var oe=Math.sqrt(Math.pow(te[0]-K[0],2)+Math.pow(te[1]-K[1],2));if(oe>J)for(var Y=Math.floor(oe/J),ae=k(K[0],te[0],Y),he=k(K[1],te[1],Y),xe=k(K[2],te[2],Y),me=0,Oe=ae.length;me<Oe;me++)Q.push([ae[me],he[me],xe[me]])}Q.push(K=te)}),Q},I=function(j){var J=un(j,3),Q=J[0],K=J[1],te=J[2],oe=Ci(Q,K,te),Y=oe.x,ae=oe.y,he=oe.z;return new va.Vector3(Y,ae,he)};return q(E.map(function(U){return[C(U),P(U),D(U)]}),L).map(I)}function T(E,C){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,L=C+1,k;if(E instanceof Array||E instanceof Function){var q=E instanceof Array?ro().domain(E.map(function(te,oe){return oe/(E.length-1)})).range(E):E;k=function(oe){return Ko(q(oe),D,!0)}}else{var I=Ko(E,D,!0);k=function(){return I}}for(var U=[],j=0,J=L;j<J;j++)for(var Q=k(j/(J-1)),K=0;K<P;K++)U.push(Q);return Ds(U,D?4:3)}function S(E){for(var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,D=E+1,L=[],k=0,q=D;k<q;k++)for(var I=k/(q-1),U=0;U<C;U++)L.push(I);return P&&L.reverse(),Ds(L,1)}}}),u0=window.THREE?window.THREE:{Euler:wA,Mesh:gn,MeshLambertMaterial:co,SphereGeometry:Zo},gS=Hn({props:{tilesData:{default:[]},tileLat:{default:"lat"},tileLng:{default:"lng"},tileAltitude:{default:.01},tileWidth:{default:1},tileHeight:{default:1},tileUseGlobeProjection:{default:!0},tileMaterial:{default:function(){return new u0.MeshLambertMaterial({color:"#ffbb88",opacity:.4,transparent:!0})}},tileCurvatureResolution:{default:5},tilesTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjTile"}).onCreateObj(function(){var s=new u0.Mesh;return s.__globeObjType="tile",s})},update:function(e){var t=ve(e.tileLat),r=ve(e.tileLng),i=ve(e.tileAltitude),s=ve(e.tileWidth),o=ve(e.tileHeight),a=ve(e.tileUseGlobeProjection),c=ve(e.tileMaterial),f=ve(e.tileCurvatureResolution);e.dataMapper.onUpdateObj(function(p,g){p.material=c(g);var b=a(g),x=f(g),T=function(P){var D=p.__currentTargetD=P,L=D.lat,k=D.lng,q=D.alt,I=D.width,U=D.height,j=Rl(k),J=Rl(-L);p.geometry&&p.geometry.dispose(),p.geometry=new u0.SphereGeometry(on*(1+q),Math.ceil(I/(x||-1)),Math.ceil(U/(x||-1)),Rl(90-I/2)+(b?j:0),Rl(I),Rl(90-U/2)+(b?J:0),Rl(U)),b||p.setRotationFromEuler(new u0.Euler(J,j,0,"YXZ"))},S={lat:+t(g),lng:+r(g),alt:+i(g),width:+s(g),height:+o(g)},E=p.__currentTargetD||Object.assign({},S,{width:0,height:0});Object.keys(S).some(function(C){return E[C]!==S[C]})&&(!e.tilesTransitionDuration||e.tilesTransitionDuration<0?T(S):e.tweenGroup.add(new br(E).to(S,e.tilesTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(T).start()))}).digest(e.tilesData)}}),Rl=function(e){return e*Math.PI/180},Xu=window.THREE?window.THREE:{BufferGeometry:$r,Color:$n,Points:jN,PointsMaterial:Fx},yS=Hn({props:{particlesData:{default:[]},particlesList:{default:function(e){return e}},particleLat:{default:"lat"},particleLng:{default:"lng"},particleAltitude:{default:.01},particlesSize:{default:.5},particlesSizeAttenuation:{default:!0},particlesColor:{default:function(){return"white"}},particlesTexture:{}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjParticles"}).onCreateObj(function(){var r=new Xu.Points(new Xu.BufferGeometry,new Xu.PointsMaterial);return r.__globeObjType="particles",r}).onUpdateObj(function(r,i){var s=ve(t.particlesList),o=ve(t.particleLat),a=ve(t.particleLng),c=ve(t.particleAltitude);r.geometry.setAttribute("position",Ds(s(i).map(function(f){return Object.values(Ci(o(f),a(f),c(f)))}),3))})},update:function(e,t){["particlesData","particlesList","particleLat","particleLng","particleAltitude"].some(function(a){return t.hasOwnProperty(a)})&&e.dataMapper.digest(e.particlesData);var r=ve(e.particlesColor),i=ve(e.particlesSize),s=ve(e.particlesSizeAttenuation),o=ve(e.particlesTexture);e.dataMapper.entries().forEach(function(a){var c=un(a,2),f=c[0],p=c[1];if(p.material.size=i(f),p.material.sizeAttenuation=s(f),e.particlesTexture)p.material.color=new Xu.Color(16777215),p.material.transparent=!1,p.material.alphaTest=.5,p.material.map=o(f);else{var g=r(f),b=Qi(g);p.material.color=new Xu.Color(Bs(g)),p.material.transparent=b<1,p.material.opacity=b,p.material.alphaTest=0}})}}),KW=window.THREE?window.THREE:{BufferGeometry:$r},ZW=function(n){function e(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32;Hf(this,e),t=$f(this,e),t.type="CircleLineGeometry",t.parameters={radius:r,segmentCount:i};for(var s=[],o=0;o<=i;o++){var a=(o/i-.25)*Math.PI*2;s.push({x:Math.cos(a)*r,y:Math.sin(a)*r,z:0})}return t.setFromPoints(s),t}return Qf(e,n),Wf(e)}(KW.BufferGeometry),Nl=window.THREE?window.THREE:{Color:$n,Group:Ls,Line:i1,LineBasicMaterial:of,Vector3:ge},JW=iu.default||iu,_S=Hn({props:{ringsData:{default:[]},ringLat:{default:"lat"},ringLng:{default:"lng"},ringAltitude:{default:.0015},ringColor:{default:function(){return"#ffffaa"},triggerUpdate:!1},ringResolution:{default:64,triggerUpdate:!1},ringMaxRadius:{default:2,triggerUpdate:!1},ringPropagationSpeed:{default:1,triggerUpdate:!1},ringRepeatPeriod:{default:700,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;(t=e.ticker)===null||t===void 0||t.dispose()}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjRing",removeDelay:3e4}).onCreateObj(function(){var s=new Nl.Group;return s.__globeObjType="ring",s}),t.ticker=new JW,t.ticker.onTick.add(function(s){if(t.ringsData.length){var o=ve(t.ringColor),a=ve(t.ringAltitude),c=ve(t.ringMaxRadius),f=ve(t.ringPropagationSpeed),p=ve(t.ringRepeatPeriod);t.dataMapper.entries().filter(function(g){var b=un(g,2),x=b[1];return x}).forEach(function(g){var b=un(g,2),x=b[0],T=b[1];if((T.__nextRingTime||0)<=s){var S=p(x)/1e3;T.__nextRingTime=s+(S<=0?1/0:S);var E=new Nl.Line(new ZW(1,t.ringResolution),new Nl.LineBasicMaterial),C=o(x),P=C instanceof Array||C instanceof Function,D;P?C instanceof Array?(D=ro().domain(C.map(function(Q,K){return K/(C.length-1)})).range(C),E.material.transparent=C.some(function(Q){return Qi(Q)<1})):(D=C,E.material.transparent=!0):(E.material.color=new Nl.Color(Bs(C)),DW(E.material,Qi(C)));var L=on*(1+a(x)),k=c(x),q=k*Math.PI/180,I=f(x),U=I<=0,j=function(K){var te=K.t,oe=(U?1-te:te)*q;if(E.scale.x=E.scale.y=L*Math.sin(oe),E.position.z=L*(1-Math.cos(oe)),P){var Y=D(te);E.material.color=new Nl.Color(Bs(Y)),E.material.transparent&&(E.material.opacity=Qi(Y))}};if(I===0)j({t:0}),T.add(E);else{var J=Math.abs(k/I)*1e3;t.tweenGroup.add(new br({t:0}).to({t:1},J).onUpdate(j).onStart(function(){return T.add(E)}).onComplete(function(){T.remove(E),iy(E)}).start())}}})}})},update:function(e){var t=ve(e.ringLat),r=ve(e.ringLng),i=ve(e.ringAltitude),s=e.scene.localToWorld(new Nl.Vector3(0,0,0));e.dataMapper.onUpdateObj(function(o,a){var c=t(a),f=r(a),p=i(a);Object.assign(o.position,Ci(c,f,p)),o.lookAt(s)}).digest(e.ringsData)}}),eQ={0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},:{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},:{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},:{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},:{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},:{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},:{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},:{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},:{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},:{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},:{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},:{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},:{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},:{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},:{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},:{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},:{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},:{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},:{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},:{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},:{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},"":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},:{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},:{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},:{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},:{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},:{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},:{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},:{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},:{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},:{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},:{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},:{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "},"":{x_min:0,x_max:0,ha:853},:{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},"":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},:{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},:{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},:{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},:{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},:{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},:{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},:{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},:{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},:{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},:{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},:{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},:{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},:{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},:{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},:{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},:{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},:{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},:{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},:{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},:{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},:{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},:{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},:{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},:{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},:{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},:{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},:{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},"":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},:{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},:{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},:{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},:{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},:{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},:{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},:{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},:{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},"":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},:{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},:{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},:{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},:{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},:{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},:{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},tQ="normal",nQ=1189,rQ=-100,iQ="normal",sQ={yMin:-334,xMin:-111,yMax:1189,xMax:1672},oQ=1e3,aQ={postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) agenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"agenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:`Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r
\r
Permission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r
\r
The above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r
\r
The Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r
\r
This License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r
\r
The Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r
\r
THE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.`,manufacturer_name:"agenta ltd",font_sub_family_name:"Regular"},lQ=-334,uQ="Helvetiker",AQ=1522,cQ=50,hQ={glyphs:eQ,cssFontWeight:tQ,ascender:nQ,underlinePosition:rQ,cssFontStyle:iQ,boundingBox:sQ,resolution:oQ,original_font_information:aQ,descender:lQ,familyName:uQ,lineHeight:AQ,underlineThickness:cQ},Ii=Vt(Vt({},window.THREE?window.THREE:{BoxGeometry:e1,CircleGeometry:Gx,DoubleSide:vi,Group:Ls,Mesh:gn,MeshLambertMaterial:co,TextGeometry:wv,Vector3:ge}),{},{Font:AW,TextGeometry:wv}),bS=Hn({props:{labelsData:{default:[]},labelLat:{default:"lat"},labelLng:{default:"lng"},labelAltitude:{default:.002},labelText:{default:"text"},labelSize:{default:.5},labelTypeFace:{default:hQ,onChange:function(e,t){t.font=new Ii.Font(e)}},labelColor:{default:function(){return"lightgrey"}},labelRotation:{default:0},labelResolution:{default:3},labelIncludeDot:{default:!0},labelDotRadius:{default:.1},labelDotOrientation:{default:function(){return"bottom"}},labelsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i;var s=new Ii.CircleGeometry(1,32);t.dataMapper=new Hr(e,{objBindAttr:"__threeObjLabel"}).onCreateObj(function(){var o=new Ii.MeshLambertMaterial;o.side=vi;var a=new Ii.Group;a.add(new Ii.Mesh(s,o));var c=new Ii.Mesh(void 0,o);a.add(c);var f=new Ii.Mesh;return f.visible=!1,c.add(f),a.__globeObjType="label",a})},update:function(e){var t=ve(e.labelLat),r=ve(e.labelLng),i=ve(e.labelAltitude),s=ve(e.labelText),o=ve(e.labelSize),a=ve(e.labelRotation),c=ve(e.labelColor),f=ve(e.labelIncludeDot),p=ve(e.labelDotRadius),g=ve(e.labelDotOrientation),b=new Set(["right","top","bottom"]),x=2*Math.PI*on/360;e.dataMapper.onUpdateObj(function(T,S){var E=un(T.children,2),C=E[0],P=E[1],D=un(P.children,1),L=D[0],k=c(S),q=Qi(k);P.material.color.set(Bs(k)),P.material.transparent=q<1,P.material.opacity=q;var I=f(S),U=g(S);!I||!b.has(U)&&(U="bottom");var j=I?+p(S)*x:1e-12;C.scale.x=C.scale.y=j;var J=+o(S)*x;if(P.geometry&&P.geometry.dispose(),P.geometry=new Ii.TextGeometry(s(S),{font:e.font,size:J,depth:0,bevelEnabled:!0,bevelThickness:0,bevelSize:0,curveSegments:e.labelResolution}),L.geometry&&L.geometry.dispose(),P.geometry.computeBoundingBox(),L.geometry=ny(Ii.BoxGeometry,Kt(new Ii.Vector3().subVectors(P.geometry.boundingBox.max,P.geometry.boundingBox.min).clampScalar(0,1/0).toArray())),U!=="right"&&P.geometry.center(),I){var Q=j+J/2;U==="right"&&(P.position.x=Q),P.position.y={right:-J/2,top:Q+J/2,bottom:-Q-J/2}[U]}var K=function(ae){var he=T.__currentTargetD=ae,xe=he.lat,me=he.lng,Oe=he.alt,ke=he.rot,Ke=he.scale;Object.assign(T.position,Ci(xe,me,Oe)),T.lookAt(e.scene.localToWorld(new Ii.Vector3(0,0,0))),T.rotateY(Math.PI),T.rotateZ(-ke*Math.PI/180),T.scale.x=T.scale.y=T.scale.z=Ke},te={lat:+t(S),lng:+r(S),alt:+i(S),rot:+a(S),scale:1},oe=T.__currentTargetD||Object.assign({},te,{scale:1e-12});Object.keys(te).some(function(Y){return oe[Y]!==te[Y]})&&(!e.labelsTransitionDuration||e.labelsTransitionDuration<0?K(te):e.tweenGroup.add(new br(oe).to(te,e.labelsTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(K).start()))}).digest(e.labelsData)}}),fQ=Vt(Vt({},window.THREE?window.THREE:{}),{},{CSS2DObject:gC}),vS=Hn({props:{htmlElementsData:{default:[]},htmlLat:{default:"lat"},htmlLng:{default:"lng"},htmlAltitude:{default:0},htmlElement:{},htmlElementVisibilityModifier:{triggerUpdate:!1},htmlTransitionDuration:{default:1e3,triggerUpdate:!1},isBehindGlobe:{onChange:function(){this.updateObjVisibility()},triggerUpdate:!1}},methods:{updateObjVisibility:function(e,t){if(e.dataMapper){var r=t?[t]:e.dataMapper.entries().map(function(i){var s=un(i,2),o=s[1];return o}).filter(function(i){return i});r.forEach(function(i){var s=!e.isBehindGlobe||!e.isBehindGlobe(i.position);e.htmlElementVisibilityModifier?(i.visible=!0,e.htmlElementVisibilityModifier(i.element,s)):i.visible=s})}}},init:function(e,t,r){var i=r.tweenGroup;tn(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjHtml"}).onCreateObj(function(s){var o=ve(t.htmlElement)(s),a=new fQ.CSS2DObject(o);return a.__globeObjType="html",a})},update:function(e,t){var r=this,i=ve(e.htmlLat),s=ve(e.htmlLng),o=ve(e.htmlAltitude);t.hasOwnProperty("htmlElement")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(a,c){var f=function(b){var x=a.__currentTargetD=b,T=x.alt,S=x.lat,E=x.lng;Object.assign(a.position,Ci(S,E,T)),r.updateObjVisibility(a)},p={lat:+i(c),lng:+s(c),alt:+o(c)};!e.htmlTransitionDuration||e.htmlTransitionDuration<0||!a.__currentTargetD?f(p):e.tweenGroup.add(new br(a.__currentTargetD).to(p,e.htmlTransitionDuration).easing(qn.Quadratic.InOut).onUpdate(f).start())}).digest(e.htmlElementsData)}}),A0=window.THREE?window.THREE:{Group:Ls,Mesh:gn,MeshLambertMaterial:co,SphereGeometry:Zo},xS=Hn({props:{objectsData:{default:[]},objectLat:{default:"lat"},objectLng:{default:"lng"},objectAltitude:{default:.01},objectFacesSurface:{default:!0},objectRotation:{},objectThreeObject:{default:new A0.Mesh(new A0.SphereGeometry(1,16,8),new A0.MeshLambertMaterial({color:"#ffffaa",transparent:!0,opacity:.7}))}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjObject"}).onCreateObj(function(r){var i=ve(t.objectThreeObject)(r);t.objectThreeObject===i&&(i=i.clone());var s=new A0.Group;return s.add(i),s.__globeObjType="object",s})},update:function(e,t){var r=ve(e.objectLat),i=ve(e.objectLng),s=ve(e.objectAltitude),o=ve(e.objectFacesSurface),a=ve(e.objectRotation);t.hasOwnProperty("objectThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(c,f){var p=+r(f),g=+i(f),b=+s(f);Object.assign(c.position,Ci(p,g,b)),o(f)?c.setRotationFromEuler(new wA(Na(-p),Na(g),0,"YXZ")):c.rotation.set(0,0,0);var x=c.children[0],T=a(f);T&&x.setRotationFromEuler(new wA(Na(T.x||0),Na(T.y||0),Na(T.z||0)))}).digest(e.objectsData)}}),TS=Hn({props:{customLayerData:{default:[]},customThreeObject:{},customThreeObjectUpdate:{triggerUpdate:!1}},init:function(e,t){tn(e),t.scene=e,t.dataMapper=new Hr(e,{objBindAttr:"__threeObjCustom"}).onCreateObj(function(r){var i=ve(t.customThreeObject)(r,on);return i&&(t.customThreeObject===i&&(i=i.clone()),i.__globeObjType="custom"),i})},update:function(e,t){e.customThreeObjectUpdate||tn(e.scene);var r=ve(e.customThreeObjectUpdate);t.hasOwnProperty("customThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(i,s){return r(i,s,on)}).digest(e.customLayerData)}}),c0=window.THREE?window.THREE:{Camera:Ug,Group:Ls,Vector2:_t,Vector3:ge},dQ=["globeLayer","pointsLayer","arcsLayer","hexBinLayer","heatmapsLayer","polygonsLayer","hexedPolygonsLayer","pathsLayer","tilesLayer","particlesLayer","ringsLayer","labelsLayer","htmlElementsLayer","objectsLayer","customLayer"],wS=Br("globeLayer",aS),pQ=Object.assign.apply(Object,Kt(["globeImageUrl","bumpImageUrl","globeCurvatureResolution","globeTileEngineUrl","globeTileEngineMaxLevel","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude"].map(function(n){return tr({},n,wS.linkProp(n))}))),mQ=Object.assign.apply(Object,Kt(["globeMaterial","globeTileEngineClearCache"].map(function(n){return tr({},n,wS.linkMethod(n))}))),gQ=Br("pointsLayer",lS),yQ=Object.assign.apply(Object,Kt(["pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration"].map(function(n){return tr({},n,gQ.linkProp(n))}))),_Q=Br("arcsLayer",AS),bQ=Object.assign.apply(Object,Kt(["arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration"].map(function(n){return tr({},n,_Q.linkProp(n))}))),vQ=Br("hexBinLayer",cS),xQ=Object.assign.apply(Object,Kt(["hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration"].map(function(n){return tr({},n,vQ.linkProp(n))}))),TQ=Br("heatmapsLayer",fS),wQ=Object.assign.apply(Object,Kt(["heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration"].map(function(n){return tr({},n,TQ.linkProp(n))}))),SQ=Br("hexedPolygonsLayer",pS),EQ=Object.assign.apply(Object,Kt(["hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration"].map(function(n){return tr({},n,SQ.linkProp(n))}))),RQ=Br("polygonsLayer",dS),NQ=Object.assign.apply(Object,Kt(["polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration"].map(function(n){return tr({},n,RQ.linkProp(n))}))),CQ=Br("pathsLayer",mS),MQ=Object.assign.apply(Object,Kt(["pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration"].map(function(n){return tr({},n,CQ.linkProp(n))}))),PQ=Br("tilesLayer",gS),BQ=Object.assign.apply(Object,Kt(["tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration"].map(function(n){return tr({},n,PQ.linkProp(n))}))),DQ=Br("particlesLayer",yS),LQ=Object.assign.apply(Object,Kt(["particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture"].map(function(n){return tr({},n,DQ.linkProp(n))}))),OQ=Br("ringsLayer",_S),FQ=Object.assign.apply(Object,Kt(["ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod"].map(function(n){return tr({},n,OQ.linkProp(n))}))),IQ=Br("labelsLayer",bS),kQ=Object.assign.apply(Object,Kt(["labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration"].map(function(n){return tr({},n,IQ.linkProp(n))}))),UQ=Br("htmlElementsLayer",vS),qQ=Object.assign.apply(Object,Kt(["htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration"].map(function(n){return tr({},n,UQ.linkProp(n))}))),GQ=Br("objectsLayer",xS),VQ=Object.assign.apply(Object,Kt(["objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject"].map(function(n){return tr({},n,GQ.linkProp(n))}))),zQ=Br("customLayer",TS),jQ=Object.assign.apply(Object,Kt(["customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(n){return tr({},n,zQ.linkProp(n))}))),$Q=Hn({props:Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt(Vt({onGlobeReady:{triggerUpdate:!1},rendererSize:{default:new c0.Vector2(window.innerWidth,window.innerHeight),onChange:function(e,t){t.pathsLayer.rendererSize(e)},triggerUpdate:!1}},pQ),yQ),bQ),xQ),wQ),NQ),EQ),MQ),BQ),LQ),FQ),kQ),qQ),VQ),jQ),methods:Vt({getGlobeRadius:Rv,getCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ci.apply(void 0,r)},toGeoCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return oS.apply(void 0,r)},setPointOfView:function(e,t){var r=t instanceof c0.Camera?t.position:t,i=Rv(),s=void 0;if(e.scene&&r){var o,a,c,f;s=function(g){o===void 0&&(o=r.clone().applyMatrix4(e.scene.matrixWorld.clone().invert())),a===void 0&&(a=o.length()),c===void 0&&(c=Math.sqrt(Math.pow(a,2)-Math.pow(i,2))),f===void 0&&(f=Math.acos(c/a));var b=o.distanceTo(g);if(b<c)return!1;var x=g.length(),T=Math.acos((Math.pow(a,2)+Math.pow(b,2)-Math.pow(x,2))/(2*a*b));return T<f}}e.layersThatNeedUpdatePov.forEach(function(p){return p.updatePov(t)}),e.layersThatNeedBehindGlobeChecker.forEach(function(p){return p.isBehindGlobe(s)})},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),e.pausableLayers.forEach(function(t){var r;return(r=t.pauseAnimation)===null||r===void 0?void 0:r.call(t)}),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),e.pausableLayers.forEach(function(t){var r;return(r=t.resumeAnimation)===null||r===void 0?void 0:r.call(t)}),this},_animationCycle:function(e){e.animationFrameRequestId=requestAnimationFrame(this._animationCycle),e.tweenGroup.update()},_destructor:function(e){this.pauseAnimation(),e.destructableLayers.forEach(function(t){return t._destructor()})}},mQ),stateInit:function(){var e=new lf,t={tweenGroup:e},r={globeLayer:aS(t),pointsLayer:lS(t),arcsLayer:AS(t),hexBinLayer:cS(t),heatmapsLayer:fS(t),polygonsLayer:dS(t),hexedPolygonsLayer:pS(t),pathsLayer:mS(t),tilesLayer:gS(t),particlesLayer:yS(t),ringsLayer:_S(t),labelsLayer:bS(t),htmlElementsLayer:vS(t),objectsLayer:xS(t),customLayer:TS(t)};return Vt(Vt({tweenGroup:e},r),{},{layersThatNeedUpdatePov:Object.values(r).filter(function(i){return i.hasOwnProperty("updatePov")}),layersThatNeedBehindGlobeChecker:Object.values(r).filter(function(i){return i.hasOwnProperty("isBehindGlobe")}),destructableLayers:Object.values(r).filter(function(i){return i.hasOwnProperty("_destructor")}),pausableLayers:Object.values(r).filter(function(i){return i.hasOwnProperty("pauseAnimation")})})},init:function(e,t,r){var i=r.animateIn,s=i===void 0?!0:i,o=r.waitForGlobeReady,a=o===void 0?!0:o;tn(e),t.scene=e,t.scene.visible=!1,dQ.forEach(function(f){var p=new c0.Group;t.scene.add(p),t[f](p)});var c=function(){if(s){t.scene.scale.set(1e-6,1e-6,1e-6),t.tweenGroup.add(new br({k:1e-6}).to({k:1},600).easing(qn.Quadratic.Out).onUpdate(function(g){var b=g.k;return t.scene.scale.set(b,b,b)}).start());var p=new c0.Vector3(0,1,0);t.tweenGroup.add(new br({rot:Math.PI*2}).to({rot:0},1200).easing(qn.Quintic.Out).onUpdate(function(g){var b=g.rot;return t.scene.setRotationFromAxisAngle(p,b)}).start())}t.scene.visible=!0,t.onGlobeReady&&t.onGlobeReady()};a?t.globeLayer.onReady(c):c(),this._animationCycle()},update:function(e){}});function HQ(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=function(i){function s(){var o;Hf(this,s);for(var a=arguments.length,c=new Array(a),f=0;f<a;f++)c[f]=arguments[f];return o=$f(this,s,[].concat(c)),o.__kapsuleInstance=ny(n,[].concat(Kt(t?[o]:[]),c)),o}return Qf(s,i),Wf(s)}(e);return Object.keys(n()).forEach(function(i){return r.prototype[i]=function(){var s,o=(s=this.__kapsuleInstance)[i].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),r}var WQ=window.THREE?window.THREE:{Group:Ls},SS=HQ($Q,WQ.Group,!0);const Lp={type:"change"},oy={type:"start"},ay={type:"end"},Fv=1e-6,Ut={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},h0=new _t,Mo=new _t,QQ=new ge,f0=new ge,Op=new ge,Cl=new Ql,Iv=new ge,d0=new ge,Fp=new ge,p0=new ge;class XQ extends s1{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:xi.ROTATE,MIDDLE:xi.DOLLY,RIGHT:xi.PAN},this.target=new ge,this.state=Ut.NONE,this.keyState=Ut.NONE,this._lastPosition=new ge,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new ge,this._movePrev=new _t,this._moveCurr=new _t,this._lastAxis=new ge,this._zoomStart=new _t,this._zoomEnd=new _t,this._panStart=new _t,this._panEnd=new _t,this._pointers=[],this._pointerPositions={},this._onPointerMove=KQ.bind(this),this._onPointerDown=YQ.bind(this),this._onPointerUp=ZQ.bind(this),this._onPointerCancel=JQ.bind(this),this._onContextMenu=oX.bind(this),this._onMouseWheel=sX.bind(this),this._onKeyDown=tX.bind(this),this._onKeyUp=eX.bind(this),this._onTouchStart=aX.bind(this),this._onTouchMove=lX.bind(this),this._onTouchEnd=uX.bind(this),this._onMouseDown=nX.bind(this),this._onMouseMove=rX.bind(this),this._onMouseUp=iX.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>Fv&&(this.dispatchEvent(Lp),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>Fv||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Lp),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Ut.NONE,this.keyState=Ut.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Lp),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Mo.copy(this._panEnd).sub(this._panStart),Mo.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Mo.x*=e,Mo.y*=t}Mo.multiplyScalar(this._eye.length()*this.panSpeed),f0.copy(this._eye).cross(this.object.up).setLength(Mo.x),f0.add(QQ.copy(this.object.up).setLength(Mo.y)),this.object.position.add(f0),this.target.add(f0),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Mo.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){p0.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=p0.length();e?(this._eye.copy(this.object.position).sub(this.target),Iv.copy(this._eye).normalize(),d0.copy(this.object.up).normalize(),Fp.crossVectors(d0,Iv).normalize(),d0.setLength(this._moveCurr.y-this._movePrev.y),Fp.setLength(this._moveCurr.x-this._movePrev.x),p0.copy(d0.add(Fp)),Op.crossVectors(p0,this._eye).normalize(),e*=this.rotateSpeed,Cl.setFromAxisAngle(Op,e),this._eye.applyQuaternion(Cl),this.object.up.applyQuaternion(Cl),this._lastAxis.copy(Op),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Cl.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Cl),this.object.up.applyQuaternion(Cl)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Ut.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Kl.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Kl.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return h0.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),h0}_getMouseOnCircle(e,t){return h0.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),h0}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new _t,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function YQ(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function KQ(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function ZQ(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp)))}function JQ(n){this._removePointer(n)}function eX(){this.enabled!==!1&&(this.keyState=Ut.NONE,window.addEventListener("keydown",this._onKeyDown))}function tX(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Ut.NONE&&(n.code===this.keys[Ut.ROTATE]&&!this.noRotate?this.keyState=Ut.ROTATE:n.code===this.keys[Ut.ZOOM]&&!this.noZoom?this.keyState=Ut.ZOOM:n.code===this.keys[Ut.PAN]&&!this.noPan&&(this.keyState=Ut.PAN)))}function nX(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case xi.DOLLY:this.state=Ut.ZOOM;break;case xi.ROTATE:this.state=Ut.ROTATE;break;case xi.PAN:this.state=Ut.PAN;break;default:this.state=Ut.NONE}const t=this.keyState!==Ut.NONE?this.keyState:this.state;t===Ut.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Ut.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Ut.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(oy)}function rX(n){const e=this.keyState!==Ut.NONE?this.keyState:this.state;e===Ut.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Ut.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Ut.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function iX(){this.state=Ut.NONE,this.dispatchEvent(ay)}function sX(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(oy),this.dispatchEvent(ay)}}function oX(n){this.enabled!==!1&&n.preventDefault()}function aX(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Ut.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Ut.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(oy)}function lX(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,r=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const i=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s));break}}function uX(n){switch(this._pointers.length){case 0:this.state=Ut.NONE;break;case 1:this.state=Ut.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Ut.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(ay)}const kv={type:"change"},ly={type:"start"},ES={type:"end"},m0=new QN,Uv=new Qg,AX=Math.cos(70*Kl.DEG2RAD),jn=new ge,Or=2*Math.PI,Jt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Ip=1e-6;class cX extends s1{constructor(e,t=null){super(e,t),this.state=Jt.NONE,this.target=new ge,this.cursor=new ge,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:xi.ROTATE,MIDDLE:xi.DOLLY,RIGHT:xi.PAN},this.touches={ONE:Dl.ROTATE,TWO:Dl.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ge,this._lastQuaternion=new Ql,this._lastTargetPosition=new ge,this._quat=new Ql().setFromUnitVectors(e.up,new ge(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new v_,this._sphericalDelta=new v_,this._scale=1,this._panOffset=new ge,this._rotateStart=new _t,this._rotateEnd=new _t,this._rotateDelta=new _t,this._panStart=new _t,this._panEnd=new _t,this._panDelta=new _t,this._dollyStart=new _t,this._dollyEnd=new _t,this._dollyDelta=new _t,this._dollyDirection=new ge,this._mouse=new _t,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=fX.bind(this),this._onPointerDown=hX.bind(this),this._onPointerUp=dX.bind(this),this._onContextMenu=vX.bind(this),this._onMouseWheel=gX.bind(this),this._onKeyDown=yX.bind(this),this._onTouchStart=_X.bind(this),this._onTouchMove=bX.bind(this),this._onMouseDown=pX.bind(this),this._onMouseMove=mX.bind(this),this._interceptControlDown=xX.bind(this),this._interceptControlUp=TX.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(kv),this.update(),this.state=Jt.NONE}update(e=null){const t=this.object.position;jn.copy(t).sub(this.target),jn.applyQuaternion(this._quat),this._spherical.setFromVector3(jn),this.autoRotate&&this.state===Jt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=Or:r>Math.PI&&(r-=Or),i<-Math.PI?i+=Or:i>Math.PI&&(i-=Or),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(jn.setFromSpherical(this._spherical),jn.applyQuaternion(this._quatInverse),t.copy(this.target).add(jn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=jn.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new ge(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const f=new ge(this._mouse.x,this._mouse.y,0);f.unproject(this.object),this.object.position.sub(f).add(a),this.object.updateMatrixWorld(),o=jn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(m0.origin.copy(this.object.position),m0.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(m0.direction))<AX?this.object.lookAt(this.target):(Uv.setFromNormalAndCoplanarPoint(this.object.up,this.target),m0.intersectPlane(Uv,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Ip||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Ip||this._lastTargetPosition.distanceToSquared(this.target)>Ip?(this.dispatchEvent(kv),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Or/60*this.autoRotateSpeed*e:Or/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){jn.setFromMatrixColumn(t,0),jn.multiplyScalar(-e),this._panOffset.add(jn)}_panUp(e,t){this.screenSpacePanning===!0?jn.setFromMatrixColumn(t,1):(jn.setFromMatrixColumn(t,0),jn.crossVectors(this.object.up,jn)),jn.multiplyScalar(e),this._panOffset.add(jn)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;jn.copy(i).sub(this.target);let s=jn.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/r.clientHeight,this.object.matrix),this._panUp(2*t*s/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,o=r.width,a=r.height;this._mouse.x=i/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Or*this._rotateDelta.x/t.clientHeight),this._rotateUp(Or*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Or*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Or*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Or*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Or*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),s=.5*(e.pageY+r.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Or*this._rotateDelta.x/t.clientHeight),this._rotateUp(Or*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new _t,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function hX(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function fX(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function dX(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(ES),this.state=Jt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function pX(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case xi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Jt.DOLLY;break;case xi.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Jt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Jt.ROTATE}break;case xi.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Jt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Jt.PAN}break;default:this.state=Jt.NONE}this.state!==Jt.NONE&&this.dispatchEvent(ly)}function mX(n){switch(this.state){case Jt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Jt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Jt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function gX(n){this.enabled===!1||this.enableZoom===!1||this.state!==Jt.NONE||(n.preventDefault(),this.dispatchEvent(ly),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(ES))}function yX(n){this.enabled!==!1&&this._handleKeyDown(n)}function _X(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Dl.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Jt.TOUCH_ROTATE;break;case Dl.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Jt.TOUCH_PAN;break;default:this.state=Jt.NONE}break;case 2:switch(this.touches.TWO){case Dl.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Jt.TOUCH_DOLLY_PAN;break;case Dl.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Jt.TOUCH_DOLLY_ROTATE;break;default:this.state=Jt.NONE}break;default:this.state=Jt.NONE}this.state!==Jt.NONE&&this.dispatchEvent(ly)}function bX(n){switch(this._trackPointer(n),this.state){case Jt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Jt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Jt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Jt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Jt.NONE}}function vX(n){this.enabled!==!1&&n.preventDefault()}function xX(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function TX(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const wX={type:"change"},qv=1e-6,Gv=new Ql;class SX extends s1{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new ge(0,0,0),this._rotationVector=new ge(0,0,0),this._lastQuaternion=new Ql,this._lastPosition=new ge,this._status=0,this._onKeyDown=EX.bind(this),this._onKeyUp=RX.bind(this),this._onPointerMove=CX.bind(this),this._onPointerDown=NX.bind(this),this._onPointerUp=MX.bind(this),this._onPointerCancel=PX.bind(this),this._onContextMenu=BX.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,r=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),Gv.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(Gv),(this._lastPosition.distanceToSquared(t.position)>qv||8*(1-this._lastQuaternion.dot(t.quaternion))>qv)&&(this.dispatchEvent(wX),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function EX(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function RX(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function NX(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function CX(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function MX(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function PX(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function BX(n){this.enabled!==!1&&n.preventDefault()}const DX={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Xf{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const LX=new zg(-1,1,1,-1,0,1);class OX extends $r{constructor(){super(),this.setAttribute("position",new Ns([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ns([0,2,0,0,2,0],2))}}const FX=new OX;class IX{constructor(e){this._mesh=new gn(FX,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,LX)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class kX extends Xf{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Zl?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=r1.clone(e.uniforms),this.material=new Zl({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new IX(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class Vv extends Xf{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class UX extends Xf{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class qX{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new _t);this._width=r.width,this._height=r.height,t=new XN(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:or}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new kX(DX),this.copyPass.material.blending=Yl,this.clock=new zx}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Vv!==void 0&&(o instanceof Vv?r=!0:o instanceof UX&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new _t);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class GX extends Xf{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this.isRenderPass=!0,this._oldClearColor=new $n}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=i}}function VX(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function jA(n,e){return jA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},jA(n,e)}function zX(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,jA(n,e)}function Cg(n){return Cg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Cg(n)}function jX(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function RS(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(RS=function(){return!!n})()}function $X(n,e,t){if(RS())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&jA(i,t.prototype),i}function Mg(n){var e=typeof Map=="function"?new Map:void 0;return Mg=function(r){if(r===null||!jX(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return $X(r,arguments,Cg(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),jA(i,r)},Mg(n)}var ys=function(n){zX(e,n);function e(t){var r;return r=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,VX(r)}return e}(Mg(Error));function kp(n){return Math.round(n*255)}function HX(n,e,t){return kp(n)+","+kp(e)+","+kp(t)}function Qh(n,e,t,r){if(r===void 0&&(r=HX),e===0)return r(t,t,t);var i=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,c=0,f=0;i>=0&&i<1?(a=s,c=o):i>=1&&i<2?(a=o,c=s):i>=2&&i<3?(c=s,f=o):i>=3&&i<4?(c=o,f=s):i>=4&&i<5?(a=o,f=s):i>=5&&i<6&&(a=s,f=o);var p=t-s/2,g=a+p,b=c+p,x=f+p;return r(g,b,x)}var zv={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function WX(n){if(typeof n!="string")return n;var e=n.toLowerCase();return zv[e]?"#"+zv[e]:n}var QX=/^#[a-fA-F0-9]{6}$/,XX=/^#[a-fA-F0-9]{8}$/,YX=/^#[a-fA-F0-9]{3}$/,KX=/^#[a-fA-F0-9]{4}$/,Up=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,ZX=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,JX=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,eY=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function cu(n){if(typeof n!="string")throw new ys(3);var e=WX(n);if(e.match(QX))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(XX)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(YX))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(KX)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=Up.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=ZX.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=JX.exec(e);if(o){var a=parseInt(""+o[1],10),c=parseInt(""+o[2],10)/100,f=parseInt(""+o[3],10)/100,p="rgb("+Qh(a,c,f)+")",g=Up.exec(p);if(!g)throw new ys(4,e,p);return{red:parseInt(""+g[1],10),green:parseInt(""+g[2],10),blue:parseInt(""+g[3],10)}}var b=eY.exec(e.substring(0,50));if(b){var x=parseInt(""+b[1],10),T=parseInt(""+b[2],10)/100,S=parseInt(""+b[3],10)/100,E="rgb("+Qh(x,T,S)+")",C=Up.exec(E);if(!C)throw new ys(4,e,E);return{red:parseInt(""+C[1],10),green:parseInt(""+C[2],10),blue:parseInt(""+C[3],10),alpha:parseFloat(""+b[4])>1?parseFloat(""+b[4])/100:parseFloat(""+b[4])}}throw new ys(5)}function tY(n){var e=n.red/255,t=n.green/255,r=n.blue/255,i=Math.max(e,t,r),s=Math.min(e,t,r),o=(i+s)/2;if(i===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,c=i-s,f=o>.5?c/(2-i-s):c/(i+s);switch(i){case e:a=(t-r)/c+(t<r?6:0);break;case t:a=(r-e)/c+2;break;default:a=(e-t)/c+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:f,lightness:o,alpha:n.alpha}:{hue:a,saturation:f,lightness:o}}function sa(n){return tY(cu(n))}var nY=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},Pg=nY;function wa(n){var e=n.toString(16);return e.length===1?"0"+e:e}function qp(n){return wa(Math.round(n*255))}function rY(n,e,t){return Pg("#"+qp(n)+qp(e)+qp(t))}function NS(n,e,t){return Qh(n,e,t,rY)}function iY(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return NS(n.hue,n.saturation,n.lightness);throw new ys(1)}function sY(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?NS(n.hue,n.saturation,n.lightness):"rgba("+Qh(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new ys(2)}function CS(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return Pg("#"+wa(n)+wa(e)+wa(t));if(typeof n=="object"&&e===void 0&&t===void 0)return Pg("#"+wa(n.red)+wa(n.green)+wa(n.blue));throw new ys(6)}function Yf(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?CS(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new ys(7)}var oY=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},aY=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},lY=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},uY=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function oa(n){if(typeof n!="object")throw new ys(8);if(aY(n))return Yf(n);if(oY(n))return CS(n);if(uY(n))return sY(n);if(lY(n))return iY(n);throw new ys(8)}function MS(n,e,t){return function(){var i=t.concat(Array.prototype.slice.call(arguments));return i.length>=e?n.apply(this,i):MS(n,e,i)}}function ai(n){return MS(n,n.length,[])}function AY(n,e){if(e==="transparent")return e;var t=sa(e);return oa(wi({},t,{hue:t.hue+parseFloat(n)}))}ai(AY);function yu(n,e,t){return Math.max(n,Math.min(e,t))}function cY(n,e){if(e==="transparent")return e;var t=sa(e);return oa(wi({},t,{lightness:yu(0,1,t.lightness-parseFloat(n))}))}ai(cY);function hY(n,e){if(e==="transparent")return e;var t=sa(e);return oa(wi({},t,{saturation:yu(0,1,t.saturation-parseFloat(n))}))}ai(hY);function fY(n,e){if(e==="transparent")return e;var t=sa(e);return oa(wi({},t,{lightness:yu(0,1,t.lightness+parseFloat(n))}))}ai(fY);function dY(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var r=cu(e),i=wi({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),s=cu(t),o=wi({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),a=i.alpha-o.alpha,c=parseFloat(n)*2-1,f=c*a===-1?c:c+a,p=1+c*a,g=(f/p+1)/2,b=1-g,x={red:Math.floor(i.red*g+o.red*b),green:Math.floor(i.green*g+o.green*b),blue:Math.floor(i.blue*g+o.blue*b),alpha:i.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return Yf(x)}var pY=ai(dY),PS=pY;function mY(n,e){if(e==="transparent")return e;var t=cu(e),r=typeof t.alpha=="number"?t.alpha:1,i=wi({},t,{alpha:yu(0,1,(r*100+parseFloat(n)*100)/100)});return Yf(i)}var gY=ai(mY),yY=gY;function _Y(n,e){if(e==="transparent")return e;var t=sa(e);return oa(wi({},t,{saturation:yu(0,1,t.saturation+parseFloat(n))}))}ai(_Y);function bY(n,e){return e==="transparent"?e:oa(wi({},sa(e),{hue:parseFloat(n)}))}ai(bY);function vY(n,e){return e==="transparent"?e:oa(wi({},sa(e),{lightness:parseFloat(n)}))}ai(vY);function xY(n,e){return e==="transparent"?e:oa(wi({},sa(e),{saturation:parseFloat(n)}))}ai(xY);function TY(n,e){return e==="transparent"?e:PS(parseFloat(n),"rgb(0, 0, 0)",e)}ai(TY);function wY(n,e){return e==="transparent"?e:PS(parseFloat(n),"rgb(255, 255, 255)",e)}ai(wY);function SY(n,e){if(e==="transparent")return e;var t=cu(e),r=typeof t.alpha=="number"?t.alpha:1,i=wi({},t,{alpha:yu(0,1,+(r*100-parseFloat(n)*100).toFixed(2)/100)});return Yf(i)}ai(SY);var Bg="http://www.w3.org/1999/xhtml";const jv={svg:"http://www.w3.org/2000/svg",xhtml:Bg,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function BS(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),jv.hasOwnProperty(e)?{space:jv[e],local:n}:n}function EY(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Bg&&e.documentElement.namespaceURI===Bg?e.createElement(n):e.createElementNS(t,n)}}function RY(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function DS(n){var e=BS(n);return(e.local?RY:EY)(e)}function NY(){}function LS(n){return n==null?NY:function(){return this.querySelector(n)}}function CY(n){typeof n!="function"&&(n=LS(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),c,f,p=0;p<o;++p)(c=s[p])&&(f=n.call(c,c.__data__,p,s))&&("__data__"in c&&(f.__data__=c.__data__),a[p]=f);return new Mi(r,this._parents)}function MY(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function PY(){return[]}function BY(n){return n==null?PY:function(){return this.querySelectorAll(n)}}function DY(n){return function(){return MY(n.apply(this,arguments))}}function LY(n){typeof n=="function"?n=DY(n):n=BY(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,c,f=0;f<a;++f)(c=o[f])&&(r.push(n.call(c,c.__data__,f,o)),i.push(c));return new Mi(r,i)}function OY(n){return function(){return this.matches(n)}}function OS(n){return function(e){return e.matches(n)}}var FY=Array.prototype.find;function IY(n){return function(){return FY.call(this.children,n)}}function kY(){return this.firstElementChild}function UY(n){return this.select(n==null?kY:IY(typeof n=="function"?n:OS(n)))}var qY=Array.prototype.filter;function GY(){return Array.from(this.children)}function VY(n){return function(){return qY.call(this.children,n)}}function zY(n){return this.selectAll(n==null?GY:VY(typeof n=="function"?n:OS(n)))}function jY(n){typeof n!="function"&&(n=OY(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,f=0;f<o;++f)(c=s[f])&&n.call(c,c.__data__,f,s)&&a.push(c);return new Mi(r,this._parents)}function FS(n){return new Array(n.length)}function $Y(){return new Mi(this._enter||this._groups.map(FS),this._parents)}function Xh(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Xh.prototype={constructor:Xh,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function HY(n){return function(){return n}}function WY(n,e,t,r,i,s){for(var o=0,a,c=e.length,f=s.length;o<f;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new Xh(n,s[o]);for(;o<c;++o)(a=e[o])&&(i[o]=a)}function QY(n,e,t,r,i,s,o){var a,c,f=new Map,p=e.length,g=s.length,b=new Array(p),x;for(a=0;a<p;++a)(c=e[a])&&(b[a]=x=o.call(c,c.__data__,a,e)+"",f.has(x)?i[a]=c:f.set(x,c));for(a=0;a<g;++a)x=o.call(n,s[a],a,s)+"",(c=f.get(x))?(r[a]=c,c.__data__=s[a],f.delete(x)):t[a]=new Xh(n,s[a]);for(a=0;a<p;++a)(c=e[a])&&f.get(b[a])===c&&(i[a]=c)}function XY(n){return n.__data__}function YY(n,e){if(!arguments.length)return Array.from(this,XY);var t=e?QY:WY,r=this._parents,i=this._groups;typeof n!="function"&&(n=HY(n));for(var s=i.length,o=new Array(s),a=new Array(s),c=new Array(s),f=0;f<s;++f){var p=r[f],g=i[f],b=g.length,x=KY(n.call(p,p&&p.__data__,f,r)),T=x.length,S=a[f]=new Array(T),E=o[f]=new Array(T),C=c[f]=new Array(b);t(p,g,S,E,C,x,e);for(var P=0,D=0,L,k;P<T;++P)if(L=S[P]){for(P>=D&&(D=P+1);!(k=E[D])&&++D<T;);L._next=k||null}}return o=new Mi(o,r),o._enter=a,o._exit=c,o}function KY(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function ZY(){return new Mi(this._exit||this._groups.map(FS),this._parents)}function JY(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function eK(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),a=new Array(i),c=0;c<o;++c)for(var f=t[c],p=r[c],g=f.length,b=a[c]=new Array(g),x,T=0;T<g;++T)(x=f[T]||p[T])&&(b[T]=x);for(;c<i;++c)a[c]=t[c];return new Mi(a,this._parents)}function tK(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function nK(n){n||(n=rK);function e(g,b){return g&&b?n(g.__data__,b.__data__):!g-!b}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,c=i[s]=new Array(a),f,p=0;p<a;++p)(f=o[p])&&(c[p]=f);c.sort(e)}return new Mi(i,this._parents).order()}function rK(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function iK(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function sK(){return Array.from(this)}function oK(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function aK(){let n=0;for(const e of this)++n;return n}function lK(){return!this.node()}function uK(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function AK(n){return function(){this.removeAttribute(n)}}function cK(n){return function(){this.removeAttributeNS(n.space,n.local)}}function hK(n,e){return function(){this.setAttribute(n,e)}}function fK(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function dK(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function pK(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function mK(n,e){var t=BS(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?cK:AK:typeof e=="function"?t.local?pK:dK:t.local?fK:hK)(t,e))}function IS(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function gK(n){return function(){this.style.removeProperty(n)}}function yK(n,e,t){return function(){this.style.setProperty(n,e,t)}}function _K(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function bK(n,e,t){return arguments.length>1?this.each((e==null?gK:typeof e=="function"?_K:yK)(n,e,t??"")):vK(this.node(),n)}function vK(n,e){return n.style.getPropertyValue(e)||IS(n).getComputedStyle(n,null).getPropertyValue(e)}function xK(n){return function(){delete this[n]}}function TK(n,e){return function(){this[n]=e}}function wK(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function SK(n,e){return arguments.length>1?this.each((e==null?xK:typeof e=="function"?wK:TK)(n,e)):this.node()[n]}function kS(n){return n.trim().split(/^|\s+/)}function uy(n){return n.classList||new US(n)}function US(n){this._node=n,this._names=kS(n.getAttribute("class")||"")}US.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function qS(n,e){for(var t=uy(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function GS(n,e){for(var t=uy(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function EK(n){return function(){qS(this,n)}}function RK(n){return function(){GS(this,n)}}function NK(n,e){return function(){(e.apply(this,arguments)?qS:GS)(this,n)}}function CK(n,e){var t=kS(n+"");if(arguments.length<2){for(var r=uy(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?NK:e?EK:RK)(t,e))}function MK(){this.textContent=""}function PK(n){return function(){this.textContent=n}}function BK(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function DK(n){return arguments.length?this.each(n==null?MK:(typeof n=="function"?BK:PK)(n)):this.node().textContent}function LK(){this.innerHTML=""}function OK(n){return function(){this.innerHTML=n}}function FK(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function IK(n){return arguments.length?this.each(n==null?LK:(typeof n=="function"?FK:OK)(n)):this.node().innerHTML}function kK(){this.nextSibling&&this.parentNode.appendChild(this)}function UK(){return this.each(kK)}function qK(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function GK(){return this.each(qK)}function VK(n){var e=typeof n=="function"?n:DS(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function zK(){return null}function jK(n,e){var t=typeof n=="function"?n:DS(n),r=e==null?zK:typeof e=="function"?e:LS(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function $K(){var n=this.parentNode;n&&n.removeChild(this)}function HK(){return this.each($K)}function WK(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function QK(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function XK(n){return this.select(n?QK:WK)}function YK(n){return arguments.length?this.property("__data__",n):this.node().__data__}function KK(n){return function(e){n.call(this,e,this.__data__)}}function ZK(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function JK(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function eZ(n,e,t){return function(){var r=this.__on,i,s=KK(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function tZ(n,e,t){var r=ZK(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,f=a.length,p;c<f;++c)for(i=0,p=a[c];i<s;++i)if((o=r[i]).type===p.type&&o.name===p.name)return p.value}return}for(a=e?eZ:JK,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function VS(n,e,t){var r=IS(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function nZ(n,e){return function(){return VS(this,n,e)}}function rZ(n,e){return function(){return VS(this,n,e.apply(this,arguments))}}function iZ(n,e){return this.each((typeof e=="function"?rZ:nZ)(n,e))}function*sZ(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var oZ=[null];function Mi(n,e){this._groups=n,this._parents=e}function aZ(){return this}Mi.prototype={constructor:Mi,select:CY,selectAll:LY,selectChild:UY,selectChildren:zY,filter:jY,data:YY,enter:$Y,exit:ZY,join:JY,merge:eK,selection:aZ,order:tK,sort:nK,call:iK,nodes:sK,node:oK,size:aK,empty:lK,each:uK,attr:mK,style:bK,property:SK,classed:CK,text:DK,html:IK,raise:UK,lower:GK,append:VK,insert:jK,remove:HK,clone:XK,datum:YK,on:tZ,dispatch:iZ,[Symbol.iterator]:sZ};function lZ(n){return typeof n=="string"?new Mi([[document.querySelector(n)]],[document.documentElement]):new Mi([[n]],oZ)}function uZ(n){let e;for(;e=n.sourceEvent;)n=e;return n}function AZ(n,e){if(n=uZ(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}var lc,mn,zS,jS,Ca,$v,$S,HS,WS,Ay,Dg,Lg,$A={},QS=[],cZ=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Kf=Array.isArray;function _s(n,e){for(var t in e)n[t]=e[t];return n}function cy(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function hZ(n,e,t){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?lc.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)o[s]===void 0&&(o[s]=n.defaultProps[s]);return bA(n,o,r,i,null)}function bA(n,e,t,r,i){var s={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++zS,__i:-1,__u:0};return i==null&&mn.vnode!=null&&mn.vnode(s),s}function Zf(n){return n.children}function q0(n,e){this.props=n,this.context=e}function hu(n,e){if(e==null)return n.__?hu(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?hu(n):null}function XS(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return XS(n)}}function Hv(n){(!n.__d&&(n.__d=!0)&&Ca.push(n)&&!Yh.__r++||$v!=mn.debounceRendering)&&(($v=mn.debounceRendering)||$S)(Yh)}function Yh(){for(var n,e,t,r,i,s,o,a=1;Ca.length;)Ca.length>a&&Ca.sort(HS),n=Ca.shift(),a=Ca.length,n.__d&&(t=void 0,r=void 0,i=(r=(e=n).__v).__e,s=[],o=[],e.__P&&((t=_s({},r)).__v=r.__v+1,mn.vnode&&mn.vnode(t),hy(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??hu(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,ZS(s,t,o),r.__e=r.__=null,t.__e!=i&&XS(t)));Yh.__r=0}function YS(n,e,t,r,i,s,o,a,c,f,p){var g,b,x,T,S,E,C,P=r&&r.__k||QS,D=e.length;for(c=fZ(t,e,P,c,D),g=0;g<D;g++)(x=t.__k[g])!=null&&(b=x.__i==-1?$A:P[x.__i]||$A,x.__i=g,E=hy(n,x,b,i,s,o,a,c,f,p),T=x.__e,x.ref&&b.ref!=x.ref&&(b.ref&&fy(b.ref,null,x),p.push(x.ref,x.__c||T,x)),S==null&&T!=null&&(S=T),(C=!!(4&x.__u))||b.__k===x.__k?c=KS(x,c,n,C):typeof x.type=="function"&&E!==void 0?c=E:T&&(c=T.nextSibling),x.__u&=-7);return t.__e=S,c}function fZ(n,e,t,r,i){var s,o,a,c,f,p=t.length,g=p,b=0;for(n.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[s]=bA(null,o,null,null,null):Kf(o)?o=n.__k[s]=bA(Zf,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=n.__k[s]=bA(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[s]=o,c=s+b,o.__=n,o.__b=n.__b+1,a=null,(f=o.__i=dZ(o,t,c,g))!=-1&&(g--,(a=t[f])&&(a.__u|=2)),a==null||a.__v==null?(f==-1&&(i>p?b--:i<p&&b++),typeof o.type!="function"&&(o.__u|=4)):f!=c&&(f==c-1?b--:f==c+1?b++:(f>c?b--:b++,o.__u|=4))):n.__k[s]=null;if(g)for(s=0;s<p;s++)(a=t[s])!=null&&!(2&a.__u)&&(a.__e==r&&(r=hu(a)),e7(a,a));return r}function KS(n,e,t,r){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=KS(i[s],e,t,r));return e}n.__e!=e&&(r&&(e&&n.type&&!e.parentNode&&(e=hu(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function dZ(n,e,t,r){var i,s,o,a=n.key,c=n.type,f=e[t],p=f!=null&&(2&f.__u)==0;if(f===null&&a==null||p&&a==f.key&&c==f.type)return t;if(r>(p?1:0)){for(i=t-1,s=t+1;i>=0||s<e.length;)if((f=e[o=i>=0?i--:s++])!=null&&!(2&f.__u)&&a==f.key&&c==f.type)return o}return-1}function Wv(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||cZ.test(e)?t:t+"px"}function g0(n,e,t,r,i){var s,o;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||Wv(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||Wv(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(WS,"$1")),o=e.toLowerCase(),e=o in n||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?r?t.u=r.u:(t.u=Ay,n.addEventListener(e,s?Lg:Dg,s)):n.removeEventListener(e,s?Lg:Dg,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Qv(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Ay++;else if(e.t<t.u)return;return t(mn.event?mn.event(e):e)}}}function hy(n,e,t,r,i,s,o,a,c,f){var p,g,b,x,T,S,E,C,P,D,L,k,q,I,U,j,J,Q=e.type;if(e.constructor!=null)return null;128&t.__u&&(c=!!(32&t.__u),s=[a=e.__e=t.__e]),(p=mn.__b)&&p(e);e:if(typeof Q=="function")try{if(C=e.props,P="prototype"in Q&&Q.prototype.render,D=(p=Q.contextType)&&r[p.__c],L=p?D?D.props.value:p.__:r,t.__c?E=(g=e.__c=t.__c).__=g.__E:(P?e.__c=g=new Q(C,L):(e.__c=g=new q0(C,L),g.constructor=Q,g.render=mZ),D&&D.sub(g),g.state||(g.state={}),g.__n=r,b=g.__d=!0,g.__h=[],g._sb=[]),P&&g.__s==null&&(g.__s=g.state),P&&Q.getDerivedStateFromProps!=null&&(g.__s==g.state&&(g.__s=_s({},g.__s)),_s(g.__s,Q.getDerivedStateFromProps(C,g.__s))),x=g.props,T=g.state,g.__v=e,b)P&&Q.getDerivedStateFromProps==null&&g.componentWillMount!=null&&g.componentWillMount(),P&&g.componentDidMount!=null&&g.__h.push(g.componentDidMount);else{if(P&&Q.getDerivedStateFromProps==null&&C!==x&&g.componentWillReceiveProps!=null&&g.componentWillReceiveProps(C,L),e.__v==t.__v||!g.__e&&g.shouldComponentUpdate!=null&&g.shouldComponentUpdate(C,g.__s,L)===!1){for(e.__v!=t.__v&&(g.props=C,g.state=g.__s,g.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(K){K&&(K.__=e)}),k=0;k<g._sb.length;k++)g.__h.push(g._sb[k]);g._sb=[],g.__h.length&&o.push(g);break e}g.componentWillUpdate!=null&&g.componentWillUpdate(C,g.__s,L),P&&g.componentDidUpdate!=null&&g.__h.push(function(){g.componentDidUpdate(x,T,S)})}if(g.context=L,g.props=C,g.__P=n,g.__e=!1,q=mn.__r,I=0,P){for(g.state=g.__s,g.__d=!1,q&&q(e),p=g.render(g.props,g.state,g.context),U=0;U<g._sb.length;U++)g.__h.push(g._sb[U]);g._sb=[]}else do g.__d=!1,q&&q(e),p=g.render(g.props,g.state,g.context),g.state=g.__s;while(g.__d&&++I<25);g.state=g.__s,g.getChildContext!=null&&(r=_s(_s({},r),g.getChildContext())),P&&!b&&g.getSnapshotBeforeUpdate!=null&&(S=g.getSnapshotBeforeUpdate(x,T)),j=p,p!=null&&p.type===Zf&&p.key==null&&(j=JS(p.props.children)),a=YS(n,Kf(j)?j:[j],e,t,r,i,s,o,a,c,f),g.base=e.__e,e.__u&=-161,g.__h.length&&o.push(g),E&&(g.__E=g.__=null)}catch(K){if(e.__v=null,c||s!=null)if(K.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(J=s.length;J--;)cy(s[J]);Og(e)}else e.__e=t.__e,e.__k=t.__k,K.then||Og(e);mn.__e(K,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=pZ(t.__e,e,t,r,i,s,o,c,f);return(p=mn.diffed)&&p(e),128&e.__u?void 0:a}function Og(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Og)}function ZS(n,e,t){for(var r=0;r<t.length;r++)fy(t[r],t[++r],t[++r]);mn.__c&&mn.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(s){s.call(i)})}catch(s){mn.__e(s,i.__v)}})}function JS(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:Kf(n)?n.map(JS):_s({},n)}function pZ(n,e,t,r,i,s,o,a,c){var f,p,g,b,x,T,S,E=t.props||$A,C=e.props,P=e.type;if(P=="svg"?i="http://www.w3.org/2000/svg":P=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(f=0;f<s.length;f++)if((x=s[f])&&"setAttribute"in x==!!P&&(P?x.localName==P:x.nodeType==3)){n=x,s[f]=null;break}}if(n==null){if(P==null)return document.createTextNode(C);n=document.createElementNS(i,P,C.is&&C),a&&(mn.__m&&mn.__m(e,s),a=!1),s=null}if(P==null)E===C||a&&n.data==C||(n.data=C);else{if(s=s&&lc.call(n.childNodes),!a&&s!=null)for(E={},f=0;f<n.attributes.length;f++)E[(x=n.attributes[f]).name]=x.value;for(f in E)if(x=E[f],f!="children"){if(f=="dangerouslySetInnerHTML")g=x;else if(!(f in C)){if(f=="value"&&"defaultValue"in C||f=="checked"&&"defaultChecked"in C)continue;g0(n,f,null,x,i)}}for(f in C)x=C[f],f=="children"?b=x:f=="dangerouslySetInnerHTML"?p=x:f=="value"?T=x:f=="checked"?S=x:a&&typeof x!="function"||E[f]===x||g0(n,f,x,E[f],i);if(p)a||g&&(p.__html==g.__html||p.__html==n.innerHTML)||(n.innerHTML=p.__html),e.__k=[];else if(g&&(n.innerHTML=""),YS(e.type=="template"?n.content:n,Kf(b)?b:[b],e,t,r,P=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:t.__k&&hu(t,0),a,c),s!=null)for(f=s.length;f--;)cy(s[f]);a||(f="value",P=="progress"&&T==null?n.removeAttribute("value"):T!=null&&(T!==n[f]||P=="progress"&&!T||P=="option"&&T!=E[f])&&g0(n,f,T,E[f],i),f="checked",S!=null&&S!=n[f]&&g0(n,f,S,E[f],i))}return n}function fy(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(i){mn.__e(i,t)}}function e7(n,e,t){var r,i;if(mn.unmount&&mn.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||fy(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){mn.__e(s,e)}r.base=r.__P=null}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&e7(r[i],e,t||typeof n.type!="function");t||cy(n.__e),n.__c=n.__=n.__e=void 0}function mZ(n,e,t){return this.constructor(n,t)}function gZ(n,e,t){var r,i,s,o;e==document&&(e=document.documentElement),mn.__&&mn.__(n,e),i=(r=!1)?null:e.__k,s=[],o=[],hy(e,n=e.__k=hZ(Zf,null,[n]),i||$A,$A,e.namespaceURI,i?null:e.firstChild?lc.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,o),ZS(s,n,o)}function t7(n,e,t){var r,i,s,o,a=_s({},n.props);for(s in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)s=="key"?r=e[s]:s=="ref"?i=e[s]:a[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?lc.call(arguments,2):t),bA(n.type,a,r||n.key,i||n.ref,null)}lc=QS.slice,mn={__e:function(n,e,t,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(n)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),o=i.__d),o)return i.__E=i}catch(a){n=a}throw n}},zS=0,jS=function(n){return n!=null&&n.constructor==null},q0.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=_s({},this.state),typeof n=="function"&&(n=n(_s({},t),this.props)),n&&_s(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),Hv(this))},q0.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Hv(this))},q0.prototype.render=Zf,Ca=[],$S=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,HS=function(n,e){return n.__v.__b-e.__v.__b},Yh.__r=0,WS=/(PointerCapture)$|Capture$/i,Ay=0,Dg=Qv(!1),Lg=Qv(!0);function Xv(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function yZ(n){if(Array.isArray(n))return n}function _Z(n,e,t){return(e=SZ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function bZ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function vZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function xZ(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Yv(Object(t),!0).forEach(function(r){_Z(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Yv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function TZ(n,e){return yZ(n)||bZ(n,e)||EZ(n,e)||vZ()}function wZ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function SZ(n){var e=wZ(n,"string");return typeof e=="symbol"?e:e+""}function Kh(n){"@babel/helpers - typeof";return Kh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kh(n)}function EZ(n,e){if(n){if(typeof n=="string")return Xv(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Xv(n,e):void 0}}var Fg=function(e){if(Kh(e)!=="object")return e;var t=t7(e);if(t.props){var r;t.props=xZ({},t.props),t!=null&&(r=t.props)!==null&&r!==void 0&&r.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(Fg):Fg(t.props.children))}return t},RZ=function(e){return jS(t7(e))},NZ=function(e,t){delete t.__k,gZ(Fg(e),t)};function CZ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var MZ=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;CZ(MZ);var PZ=Hn({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.style,s=i===void 0?{}:i,o=!!e&&Kh(e)==="object"&&!!e.node&&typeof e.node=="function",a=lZ(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(f){var p=TZ(f,2),g=p[0],b=p[1];return t.tooltipEl.style(g,b)}),t.tooltipEl.style("left","-10000px").style("display","none");var c="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(c),function(f){t.mouseInside=!0;var p=AZ(f),g=a.node(),b=g.offsetWidth,x=g.offsetHeight,T=[t.offsetX===null||t.offsetX===void 0?"-".concat(p[0]/b*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?x>130&&x-p[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",p[0]+"px").style("top",p[1]+"px").style("transform","translate(".concat(T.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(c),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(c),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):RZ(e.content)?(e.tooltipEl.text(""),NZ(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function BZ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var DZ=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;BZ(DZ);function Ig(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function LZ(n){if(Array.isArray(n))return n}function OZ(n){if(Array.isArray(n))return Ig(n)}function FZ(n,e,t){return(e=zZ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function IZ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function kZ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function UZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GZ(n,e){return LZ(n)||kZ(n,e)||n7(n,e)||UZ()}function xa(n){return OZ(n)||IZ(n)||n7(n)||qZ()}function VZ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function zZ(n){var e=VZ(n,"string");return typeof e=="symbol"?e:e+""}function n7(n,e){if(n){if(typeof n=="string")return Ig(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ig(n,e):void 0}}var cn=window.THREE?window.THREE:{WebGLRenderer:YN,Scene:Jh,PerspectiveCamera:vA,Raycaster:KN,SRGBColorSpace:HA,TextureLoader:qg,Vector2:_t,Vector3:ge,Box3:af,Color:$n,Mesh:gn,SphereGeometry:Zo,MeshBasicMaterial:ds,BackSide:yr,Clock:zx},r7=Hn({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(o,a){return e.hoverOrderComparator(o.object,a.object)});var s=i.find(function(o){return e.hoverFilter(o.object)})||null;r=s?s.object:null,e.intersection=s||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&ve(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,r=t.x,i=t.y;return{x:r,y:i}},cameraPosition:function(e,t,r,i){var s=e.camera;if(t&&e.initialised){var o=t,a=r||{x:0,y:0,z:0};if(!i)p(o),g(a);else{var c=Object.assign({},s.position),f=b();e.tweenGroup.add(new br(c).to(o,i).easing(qn.Quadratic.Out).onUpdate(p).start()),e.tweenGroup.add(new br(f).to(a,i/3).easing(qn.Quadratic.Out).onUpdate(g).start())}return this}return Object.assign({},s.position,{lookAt:b()});function p(x){var T=x.x,S=x.y,E=x.z;T!==void 0&&(s.position.x=T),S!==void 0&&(s.position.y=S),E!==void 0&&(s.position.z=E)}function g(x){var T=new cn.Vector3(x.x,x.y,x.z);e.controls.enabled&&e.controls.target?e.controls.target=T:s.lookAt(T)}function b(){return Object.assign(new cn.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new cn.Vector3(0,0,0),a=Math.max.apply(Math,xa(Object.entries(t).map(function(x){var T=GZ(x,2),S=T[0],E=T[1];return Math.max.apply(Math,xa(E.map(function(C){return Math.abs(o[S]-C)})))})))*2,c=(1-i*2/e.height)*s.fov,f=a/Math.atan(c*Math.PI/180),p=f/s.aspect,g=Math.max(f,p);if(g>0){var b=o.clone().sub(s.position).normalize().multiplyScalar(-g);this.cameraPosition(b,o,r)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},r=new cn.Box3(new cn.Vector3(0,0,0),new cn.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach(function(s){return r.expandByObject(s)}),Object.assign.apply(Object,xa(["x","y","z"].map(function(s){return FZ({},s,[r.min[s],r.max[s]])})))):null},getScreenCoords:function(e,t,r,i){var s=new cn.Vector3(t,r,i);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new cn.Vector2(t/e.width*2-1,-(r/e.height)*2+1),o=new cn.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(i,new cn.Vector3))},intersectingObjects:function(e,t,r){var i=new cn.Vector2(t/e.width*2-1,-(r/e.height)*2+1),s=new cn.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(i,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new cn.Scene,camera:new cn.PerspectiveCamera,clock:new cn.Clock,tweenGroup:new lf,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.controlType,s=i===void 0?"trackball":i,o=r.useWebGPU,a=o===void 0?!1:o,c=r.rendererConfig,f=c===void 0?{}:c,p=r.extraRenderers,g=p===void 0?[]:p,b=r.waitForLoadComplete,x=b===void 0?!0:b;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new PZ(t.container),t.pointerPos=new cn.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(T){return t.container.addEventListener(T,function(S){if(T==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&S.type==="pointermove"&&(S.pressure>0||t.isPointerPressed)&&(S.pointerType==="mouse"||S.movementX===void 0||[S.movementX,S.movementY].some(function(P){return Math.abs(P)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var E=C(t.container);t.pointerPos.x=S.pageX-E.left,t.pointerPos.y=S.pageY-E.top}function C(P){var D=P.getBoundingClientRect(),L=window.pageXOffset||document.documentElement.scrollLeft,k=window.pageYOffset||document.documentElement.scrollTop;return{top:D.top+k,left:D.left+L}}},{passive:!0})}),t.container.addEventListener("pointerup",function(T){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){T.button===0&&t.onClick(t.hoverObj||null,T,t.intersection),T.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,T,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(T){t.onRightClick&&T.preventDefault()}),t.renderer=new(a?J5:cn.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},f)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=g,t.extraRenderers.forEach(function(T){T.domElement.style.position="absolute",T.domElement.style.top="0px",T.domElement.style.pointerEvents="none",t.container.appendChild(T.domElement)}),t.postProcessingComposer=new qX(t.renderer),t.postProcessingComposer.addPass(new GX(t.scene,t.camera)),t.controls=new{trackball:XQ,orbit:cX,fly:SX}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(xa(t.extraRenderers)).forEach(function(T){return T.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new cn.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!x,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,i=e.width,s=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(xa(e.extraRenderers)).forEach(function(x){return x.setSize(i,s)}),e.camera.aspect=i/s;var o=e.viewOffset.slice(0,2);o.some(function(x){return x})&&(r=e.camera).setViewOffset.apply(r,[i,s].concat(xa(o),[i,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var a,c=e.width,f=e.height,p=e.viewOffset.slice(0,2);p.some(function(x){return x})?(a=e.camera).setViewOffset.apply(a,[c,f].concat(xa(p),[c,f])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new cn.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var g=cu(e.backgroundColor).alpha;g===void 0&&(g=1),e.renderer.setClearColor(new cn.Color(yY(1,e.backgroundColor)),g)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new cn.TextureLoader().load(e.backgroundImageUrl,function(x){x.colorSpace=cn.SRGBColorSpace,e.skysphere.material=new cn.MeshBasicMaterial({map:x,side:cn.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&b()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&b())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(x){return e.scene.remove(x)}),e.lights.forEach(function(x){return e.scene.add(x)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(x){return e.scene.remove(x)}),e.objects.forEach(function(x){return e.scene.add(x)}));function b(){e.loadComplete=e.scene.visible=!0}}});function jZ(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var $Z=`.scene-container .clickable {
  cursor: pointer;
}`;jZ($Z);function kg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function HZ(n){if(Array.isArray(n))return kg(n)}function uc(n,e,t){return(e=ZZ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function WZ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function QZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ma(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Kv(Object(t),!0).forEach(function(r){uc(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Kv(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function XZ(n,e){if(n==null)return{};var t,r,i=YZ(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function YZ(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function Jf(n){return HZ(n)||WZ(n)||JZ(n)||QZ()}function KZ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ZZ(n){var e=KZ(n,"string");return typeof e=="symbol"?e:e+""}function JZ(n,e){if(n){if(typeof n=="string")return kg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?kg(n,e):void 0}}function i7(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),f=1;f<a;f++)c[f-1]=arguments[f];var p=o[i].apply(o,c);return p===o?this:p}}}}var eJ=["rendererConfig","waitForGlobeReady"],Yu=Ma(Ma({},window.THREE?window.THREE:{AmbientLight:nx,DirectionalLight:tx,Vector2:_t,REVISION:tf}),{},{CSS2DRenderer:yC}),s7=i7("globe",SS),tJ=Object.assign.apply(Object,Jf(["globeImageUrl","bumpImageUrl","globeTileEngineUrl","globeTileEngineMaxLevel","globeCurvatureResolution","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude","onGlobeReady","pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration","arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration","polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration","pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration","heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration","hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration","hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration","tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration","particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture","ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod","labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration","htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration","objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject","customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(n){return uc({},n,s7.linkProp(n))}))),nJ=Object.assign.apply(Object,Jf(["globeMaterial","globeTileEngineClearCache","getGlobeRadius","getCoords","toGeoCoords"].map(function(n){return uc({},n,s7.linkMethod(n))}))),o7=i7("renderObjs",r7),rJ=Object.assign.apply(Object,Jf(["width","height","backgroundColor","backgroundImageUrl","enablePointerInteraction"].map(function(n){return uc({},n,o7.linkProp(n))}))),iJ=Object.assign.apply(Object,Jf(["lights","postProcessingComposer"].map(function(n){return uc({},n,o7.linkMethod(n))}))),sJ=Hn({props:Ma(Ma({onZoom:{triggerUpdate:!1},onGlobeClick:{triggerUpdate:!1},onGlobeRightClick:{triggerUpdate:!1},pointLabel:{default:"name",triggerUpdate:!1},onPointClick:{triggerUpdate:!1},onPointRightClick:{triggerUpdate:!1},onPointHover:{triggerUpdate:!1},arcLabel:{default:"name",triggerUpdate:!1},onArcClick:{triggerUpdate:!1},onArcRightClick:{triggerUpdate:!1},onArcHover:{triggerUpdate:!1},polygonLabel:{default:"name",triggerUpdate:!1},onPolygonClick:{triggerUpdate:!1},onPolygonRightClick:{triggerUpdate:!1},onPolygonHover:{triggerUpdate:!1},pathLabel:{default:"name",triggerUpdate:!1},onPathClick:{triggerUpdate:!1},onPathRightClick:{triggerUpdate:!1},onPathHover:{triggerUpdate:!1},onHeatmapClick:{triggerUpdate:!1},onHeatmapRightClick:{triggerUpdate:!1},onHeatmapHover:{triggerUpdate:!1},hexLabel:{triggerUpdate:!1},onHexClick:{triggerUpdate:!1},onHexRightClick:{triggerUpdate:!1},onHexHover:{triggerUpdate:!1},hexPolygonLabel:{triggerUpdate:!1},onHexPolygonClick:{triggerUpdate:!1},onHexPolygonRightClick:{triggerUpdate:!1},onHexPolygonHover:{triggerUpdate:!1},tileLabel:{default:"name",triggerUpdate:!1},onTileClick:{triggerUpdate:!1},onTileRightClick:{triggerUpdate:!1},onTileHover:{triggerUpdate:!1},particleLabel:{default:"name",triggerUpdate:!1},onParticleClick:{triggerUpdate:!1},onParticleRightClick:{triggerUpdate:!1},onParticleHover:{triggerUpdate:!1},labelLabel:{triggerUpdate:!1},onLabelClick:{triggerUpdate:!1},onLabelRightClick:{triggerUpdate:!1},onLabelHover:{triggerUpdate:!1},objectLabel:{default:"name",triggerUpdate:!1},onObjectClick:{triggerUpdate:!1},onObjectRightClick:{triggerUpdate:!1},onObjectHover:{triggerUpdate:!1},customLayerLabel:{default:"name",triggerUpdate:!1},onCustomLayerClick:{triggerUpdate:!1},onCustomLayerRightClick:{triggerUpdate:!1},onCustomLayerHover:{triggerUpdate:!1},pointerEventsFilter:{default:function(){return!0},triggerUpdate:!1},lineHoverPrecision:{default:.2,triggerUpdate:!1,onChange:function(e,t){t.renderObjs.lineHoverPrecision(e),t.renderObjs.pointsHoverPrecision(e)}},showPointerCursor:{default:!0,triggerUpdate:!1},globeOffset:{default:[0,0],triggerUpdate:!1,onChange:function(e,t){return Array.isArray(e)&&e.length===2&&t.renderObjs.viewOffset(e.map(function(r){return-r}))}}},tJ),rJ),methods:Ma(Ma({pauseAnimation:function(e){var t;return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),(t=e.globe)===null||t===void 0||t.pauseAnimation(),this},resumeAnimation:function(e){var t;return e.animationFrameRequestId===null&&this._animationCycle(),(t=e.globe)===null||t===void 0||t.resumeAnimation(),this},_animationCycle:function(e){e.renderObjs.tick(),e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},pointOfView:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=o();if(t.lat===void 0&&t.lng===void 0&&t.altitude===void 0)return i;var s=Object.assign({},i,t);if(["lat","lng","altitude"].forEach(function(c){return s[c]=+s[c]}),!r)a(s);else{for(;i.lng-s.lng>180;)i.lng-=360;for(;i.lng-s.lng<-180;)i.lng+=360;e.tweenGroup.add(new br(i).to(s,r).easing(qn.Cubic.InOut).onUpdate(a).start())}return this;function o(){return e.globe.toGeoCoords(e.renderObjs.cameraPosition())}function a(c){var f=c.lat,p=c.lng,g=c.altitude;e.renderObjs.cameraPosition(e.globe.getCoords(f,p,g)),e.globe.setPointOfView(e.renderObjs.camera())}},getScreenCoords:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=(t=e.globe).getCoords.apply(t,i);return e.renderObjs.getScreenCoords(o.x,o.y,o.z)},toGlobeCoords:function(e,t,r){var i=e.renderObjs.intersectingObjects(t,r).find(function(c){return(c.object.__globeObjType||c.object.parent.__globeObjType)==="globe"});if(!i)return null;var s=e.globe.toGeoCoords(i.point),o=s.lat,a=s.lng;return{lat:o,lng:a}},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},_destructor:function(e){e.globe._destructor(),this.pauseAnimation(),this.pointsData([]),this.arcsData([]),this.polygonsData([]),this.pathsData([]),this.heatmapsData([]),this.hexBinPointsData([]),this.hexPolygonsData([]),this.tilesData([]),this.particlesData([]),this.labelsData([]),this.htmlElementsData([]),this.objectsData([]),this.customLayerData([])}},nJ),iJ),stateInit:function(e){var t=e.rendererConfig,r=e.waitForGlobeReady,i=r===void 0?!0:r,s=XZ(e,eJ),o=new SS(Ma({waitForGlobeReady:i},s));return{globe:o,renderObjs:r7({controlType:"orbit",rendererConfig:t,waitForLoadComplete:i,extraRenderers:[new Yu.CSS2DRenderer]}).skyRadius(o.getGlobeRadius()*500).showNavInfo(!1).objects([o]).lights([new Yu.AmbientLight(13421772,Math.PI),new Yu.DirectionalLight(16777215,.6*Math.PI)]),tweenGroup:new lf}},init:function(e,t){var r=this;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var i=document.createElement("div");t.container.appendChild(i),t.renderObjs(i),t.globe.rendererSize(t.renderObjs.renderer().getSize(new Yu.Vector2)),this.pointOfView({altitude:2.5});var s=t.globe.getGlobeRadius(),o=t.renderObjs.controls();t.renderObjs.camera().near=.05,o.minDistance=s+Math.max(.001,t.renderObjs.camera().near*1.1),o.maxDistance=s*100,o.enablePan=!1,o.enableDamping=!0,o.dampingFactor=.1,o.rotateSpeed=.3,o.zoomSpeed=.3,o.zoomToCursor=!0,o.addEventListener("change",function(){o.target.setScalar(0);var f=r.pointOfView();o.rotateSpeed=f.altitude*.3,o.zoomSpeed=Math.sqrt(f.altitude)*.5,t.globe.setPointOfView(t.renderObjs.camera()),t.onZoom&&t.onZoom(f)});var a=function(p){for(var g=p;g&&!g.hasOwnProperty("__globeObjType");)g=g.parent;return g},c={point:function(p){return p},arc:function(p){return p},polygon:function(p){return p.data},path:function(p){return p},heatmap:function(p){return p},hexbin:function(p){return p},hexPolygon:function(p){return p},tile:function(p){return p},particles:function(p,g){return!g||!g.hasOwnProperty("index")||p.length<=g.index?p:p[g.index]},label:function(p){return p},object:function(p){return p},custom:function(p){return p}};Yu.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverFilter(function(f){var p=a(f);if(!p)return!1;var g=p.__globeObjType;if(g!=="globe"&&!c.hasOwnProperty(g))return!1;var b=c.hasOwnProperty(g)&&p.__data?c[g](p.__data):null;return["points","hexBinPoints"].some(function(x){return x===g})&&Array.isArray(b)?!1:t.pointerEventsFilter(p,b)}).tooltipContent(function(f,p){var g={point:t.pointLabel,arc:t.arcLabel,polygon:t.polygonLabel,path:t.pathLabel,hexbin:t.hexLabel,hexPolygon:t.hexPolygonLabel,tile:t.tileLabel,particles:t.particleLabel,label:t.labelLabel,object:t.objectLabel,custom:t.customLayerLabel},b=a(f),x=b&&b.__globeObjType;return b&&x&&g.hasOwnProperty(x)&&c.hasOwnProperty(x)&&ve(g[x])(c[x](b.__data,p))||""}).onHover(function(f,p,g){var b={point:t.onPointHover,arc:t.onArcHover,polygon:t.onPolygonHover,path:t.onPathHover,heatmap:t.onHeatmapHover,hexbin:t.onHexHover,hexPolygon:t.onHexPolygonHover,tile:t.onTileHover,particles:t.onParticleHover,label:t.onLabelHover,object:t.onObjectHover,custom:t.onCustomLayerHover},x={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},T=a(f);if(T&&!b.hasOwnProperty(T.__globeObjType)&&(T=null),T!==t.hoverObj){var S,E=t.hoverObj?t.hoverObj.__globeObjType:null,C=t.hoverData,P=T?T.__globeObjType:null,D=(S=T)!==null&&S!==void 0&&S.__data?c[P](T.__data,g):null;E&&E!==P&&b[E]&&b[E](null,C||null),P&&b[P]&&b[P](D,E===P?C:null),t.renderObjs.renderer().domElement.classList[P&&x[P]&&ve(t.showPointerCursor)(P,D)?"add":"remove"]("clickable"),t.hoverObj=T,t.hoverData=D}}).onClick(function(f,p,g){if(f){var b={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},x=a(f),T=x.__globeObjType;if(x&&b.hasOwnProperty(T)&&b[T]){var S=[p],E=g!=null&&g.isVector3?g:g==null?void 0:g.point;if(T==="globe"){var C=r.toGeoCoords(E),P=C.lat,D=C.lng;S.unshift({lat:P,lng:D})}else S.push(r.toGeoCoords(E));c.hasOwnProperty(T)&&S.unshift(c[T](x.__data,g)),b[T].apply(b,S)}}}).onRightClick(function(f,p,g){if(f){var b={globe:t.onGlobeRightClick,point:t.onPointRightClick,arc:t.onArcRightClick,polygon:t.onPolygonRightClick,path:t.onPathRightClick,heatmap:t.onHeatmapRightClick,hexbin:t.onHexRightClick,hexPolygon:t.onHexPolygonRightClick,tile:t.onTileRightClick,particles:t.onParticleRightClick,label:t.onLabelRightClick,object:t.onObjectRightClick,custom:t.onCustomLayerRightClick},x=a(f),T=x.__globeObjType;if(x&&b.hasOwnProperty(T)&&b[T]){var S=[p],E=g!=null&&g.isVector3?g:g==null?void 0:g.point;if(T==="globe"){var C=r.toGeoCoords(E),P=C.lat,D=C.lng;S.unshift({lat:P,lng:D})}else S.push(r.toGeoCoords(E));c.hasOwnProperty(T)&&S.unshift(c[T](x.__data,g)),b[T].apply(b,S)}}}),this._animationCycle()}}),a7={exports:{}},oJ="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",aJ=oJ,lJ=aJ;function l7(){}function u7(){}u7.resetWarningCache=l7;var uJ=function(){function n(r,i,s,o,a,c){if(c!==lJ){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:u7,resetWarningCache:l7};return t.PropTypes=t,t};a7.exports=uJ();var AJ=a7.exports;const B=Zv(AJ);var cJ={width:B.number,height:B.number,globeOffset:B.arrayOf(B.number),backgroundColor:B.string,backgroundImageUrl:B.string,globeImageUrl:B.string,bumpImageUrl:B.string,globeTileEngineUrl:B.func,showGlobe:B.bool,showGraticules:B.bool,showAtmosphere:B.bool,atmosphereColor:B.string,atmosphereAltitude:B.number,globeMaterial:B.object,onGlobeReady:B.func,onGlobeClick:B.func,onGlobeRightClick:B.func,pointsData:B.arrayOf(B.object),pointLat:B.oneOfType([B.number,B.string,B.func]),pointLng:B.oneOfType([B.number,B.string,B.func]),pointColor:B.oneOfType([B.string,B.func]),pointAltitude:B.oneOfType([B.number,B.string,B.func]),pointRadius:B.oneOfType([B.number,B.string,B.func]),pointResolution:B.number,pointsMerge:B.bool,pointsTransitionDuration:B.number,pointLabel:B.oneOfType([B.string,B.func]),onPointClick:B.func,onPointRightClick:B.func,onPointHover:B.func,arcsData:B.arrayOf(B.object),arcStartLat:B.oneOfType([B.number,B.string,B.func]),arcStartLng:B.oneOfType([B.number,B.string,B.func]),arcEndLat:B.oneOfType([B.number,B.string,B.func]),arcEndLng:B.oneOfType([B.number,B.string,B.func]),arcColor:B.oneOfType([B.string,B.arrayOf(B.string),B.func]),arcAltitude:B.oneOfType([B.number,B.string,B.func]),arcAltitudeAutoScale:B.oneOfType([B.number,B.string,B.func]),arcStroke:B.oneOfType([B.number,B.string,B.func]),arcCurveResolution:B.number,arcCircularResolution:B.number,arcDashLength:B.oneOfType([B.number,B.string,B.func]),arcDashGap:B.oneOfType([B.number,B.string,B.func]),arcDashInitialGap:B.oneOfType([B.number,B.string,B.func]),arcDashAnimateTime:B.oneOfType([B.number,B.string,B.func]),arcsTransitionDuration:B.number,arcLabel:B.oneOfType([B.string,B.func]),onArcClick:B.func,onArcRightClick:B.func,onArcHover:B.func,polygonsData:B.arrayOf(B.object),polygonGeoJsonGeometry:B.oneOfType([B.string,B.func]),polygonCapColor:B.oneOfType([B.string,B.func]),polygonCapMaterial:B.oneOfType([B.object,B.string,B.func]),polygonSideColor:B.oneOfType([B.string,B.func]),polygonSideMaterial:B.oneOfType([B.object,B.string,B.func]),polygonStrokeColor:B.oneOfType([B.string,B.func]),polygonAltitude:B.oneOfType([B.number,B.string,B.func]),polygonCapCurvatureResolution:B.oneOfType([B.number,B.string,B.func]),polygonsTransitionDuration:B.number,polygonLabel:B.oneOfType([B.string,B.func]),onPolygonClick:B.func,onPolygonRightClick:B.func,onPolygonHover:B.func,pathsData:B.array,pathPoints:B.oneOfType([B.array,B.string,B.func]),pathPointLat:B.oneOfType([B.number,B.string,B.func]),pathPointLng:B.oneOfType([B.number,B.string,B.func]),pathPointAlt:B.oneOfType([B.number,B.string,B.func]),pathResolution:B.number,pathColor:B.oneOfType([B.string,B.arrayOf(B.string),B.func]),pathStroke:B.oneOfType([B.number,B.string,B.func]),pathDashLength:B.oneOfType([B.number,B.string,B.func]),pathDashGap:B.oneOfType([B.number,B.string,B.func]),pathDashInitialGap:B.oneOfType([B.number,B.string,B.func]),pathDashAnimateTime:B.oneOfType([B.number,B.string,B.func]),pathTransitionDuration:B.number,pathLabel:B.oneOfType([B.string,B.func]),onPathClick:B.func,onPathRightClick:B.func,onPathHover:B.func,heatmapsData:B.array,heatmapPoints:B.oneOfType([B.array,B.string,B.func]),heatmapPointLat:B.oneOfType([B.number,B.string,B.func]),heatmapPointLng:B.oneOfType([B.number,B.string,B.func]),heatmapPointWeight:B.oneOfType([B.number,B.string,B.func]),heatmapBandwidth:B.oneOfType([B.number,B.string,B.func]),heatmapColorFn:B.oneOfType([B.string,B.func]),heatmapColorSaturation:B.oneOfType([B.number,B.string,B.func]),heatmapBaseAltitude:B.oneOfType([B.number,B.string,B.func]),heatmapTopAltitude:B.oneOfType([B.number,B.string,B.func]),heatmapsTransitionDuration:B.number,onHeatmapClick:B.func,onHeatmapRightClick:B.func,onHeatmapHover:B.func,hexBinPointsData:B.arrayOf(B.object),hexBinPointLat:B.oneOfType([B.number,B.string,B.func]),hexBinPointLng:B.oneOfType([B.number,B.string,B.func]),hexBinPointWeight:B.oneOfType([B.number,B.string,B.func]),hexBinResolution:B.number,hexMargin:B.oneOfType([B.number,B.func]),hexTopColor:B.func,hexSideColor:B.func,hexAltitude:B.oneOfType([B.number,B.func]),hexTopCurvatureResolution:B.number,hexBinMerge:B.bool,hexTransitionDuration:B.number,hexLabel:B.oneOfType([B.string,B.func]),onHexClick:B.func,onHexRightClick:B.func,onHexHover:B.func,hexPolygonsData:B.arrayOf(B.object),hexPolygonGeoJsonGeometry:B.oneOfType([B.string,B.func]),hexPolygonColor:B.oneOfType([B.string,B.func]),hexPolygonAltitude:B.oneOfType([B.number,B.string,B.func]),hexPolygonResolution:B.oneOfType([B.number,B.string,B.func]),hexPolygonMargin:B.oneOfType([B.number,B.string,B.func]),hexPolygonUseDots:B.oneOfType([B.bool,B.string,B.func]),hexPolygonCurvatureResolution:B.oneOfType([B.number,B.string,B.func]),hexPolygonDotResolution:B.oneOfType([B.number,B.string,B.func]),hexPolygonsTransitionDuration:B.number,hexPolygonLabel:B.oneOfType([B.string,B.func]),onHexPolygonClick:B.func,onHexPolygonRightClick:B.func,onHexPolygonHover:B.func,tilesData:B.arrayOf(B.object),tileLat:B.oneOfType([B.number,B.string,B.func]),tileLng:B.oneOfType([B.number,B.string,B.func]),tileAltitude:B.oneOfType([B.number,B.string,B.func]),tileWidth:B.oneOfType([B.number,B.string,B.func]),tileHeight:B.oneOfType([B.number,B.string,B.func]),tileUseGlobeProjection:B.oneOfType([B.bool,B.string,B.func]),tileMaterial:B.oneOfType([B.object,B.string,B.func]),tileCurvatureResolution:B.oneOfType([B.number,B.string,B.func]),tilesTransitionDuration:B.number,tileLabel:B.oneOfType([B.string,B.func]),onTileClick:B.func,onTileRightClick:B.func,onTileHover:B.func,particlesData:B.arrayOf(B.object),particlesList:B.oneOfType([B.string,B.func]),particleLat:B.oneOfType([B.number,B.string,B.func]),particleLng:B.oneOfType([B.number,B.string,B.func]),particleAltitude:B.oneOfType([B.number,B.string,B.func]),particlesSize:B.oneOfType([B.number,B.string,B.func]),particlesSizeAttenuation:B.oneOfType([B.bool,B.string,B.func]),particlesColor:B.oneOfType([B.string,B.func]),particlesTexture:B.oneOfType([B.string,B.func]),particleLabel:B.oneOfType([B.string,B.func]),onParticleClick:B.func,onParticleRightClick:B.func,onParticleHover:B.func,ringsData:B.arrayOf(B.object),ringLat:B.oneOfType([B.number,B.string,B.func]),ringLng:B.oneOfType([B.number,B.string,B.func]),ringAltitude:B.oneOfType([B.number,B.string,B.func]),ringColor:B.oneOfType([B.string,B.arrayOf(B.string),B.func]),ringResolution:B.number,ringMaxRadius:B.oneOfType([B.number,B.string,B.func]),ringPropagationSpeed:B.oneOfType([B.number,B.string,B.func]),ringRepeatPeriod:B.oneOfType([B.number,B.string,B.func]),labelsData:B.arrayOf(B.object),labelLat:B.oneOfType([B.number,B.string,B.func]),labelLng:B.oneOfType([B.number,B.string,B.func]),labelAltitude:B.oneOfType([B.number,B.string,B.func]),labelRotation:B.oneOfType([B.number,B.string,B.func]),labelText:B.oneOfType([B.string,B.func]),labelSize:B.oneOfType([B.number,B.string,B.func]),labelTypeFace:B.object,labelColor:B.oneOfType([B.string,B.func]),labelResolution:B.number,labelIncludeDot:B.oneOfType([B.bool,B.string,B.func]),labelDotRadius:B.oneOfType([B.number,B.string,B.func]),labelDotOrientation:B.oneOfType([B.string,B.func]),labelsTransitionDuration:B.number,labelLabel:B.oneOfType([B.string,B.func]),onLabelClick:B.func,onLabelRightClick:B.func,onLabelHover:B.func,htmlElementsData:B.arrayOf(B.object),htmlLat:B.oneOfType([B.number,B.string,B.func]),htmlLng:B.oneOfType([B.number,B.string,B.func]),htmlAltitude:B.oneOfType([B.number,B.string,B.func]),htmlElement:B.oneOfType([B.string,B.func]),htmlElementVisibilityModifier:B.func,htmlTransitionDuration:B.number,objectsData:B.arrayOf(B.object),objectLat:B.oneOfType([B.number,B.string,B.func]),objectLng:B.oneOfType([B.number,B.string,B.func]),objectAltitude:B.oneOfType([B.number,B.string,B.func]),objectRotation:B.oneOfType([B.shape({x:B.number,y:B.number,z:B.number}),B.string,B.func]),objectFacesSurface:B.oneOfType([B.bool,B.string,B.func]),objectThreeObject:B.oneOfType([B.object,B.string,B.func]),objectLabel:B.oneOfType([B.string,B.func]),onObjectClick:B.func,onObjectRightClick:B.func,onObjectHover:B.func,customLayerData:B.arrayOf(B.object),customThreeObject:B.oneOfType([B.object,B.string,B.func]),customThreeObjectUpdate:B.oneOfType([B.string,B.func]),customLayerLabel:B.oneOfType([B.string,B.func]),onCustomLayerClick:B.func,onCustomLayerRightClick:B.func,onCustomLayerHover:B.func,enablePointerInteraction:B.bool,pointerEventsFilter:B.func,lineHoverPrecision:B.number,showPointerCursor:B.oneOfType([B.bool,B.func]),onZoom:B.func},A7=mC(sJ,{methodNames:["pauseAnimation","resumeAnimation","pointOfView","lights","scene","camera","renderer","postProcessingComposer","controls","getGlobeRadius","getCoords","getScreenCoords","toGeoCoords","toGlobeCoords","globeTileEngineClearCache"],initPropNames:["animateIn","waitForGlobeReady","rendererConfig"]});A7.displayName="Globe";A7.propTypes=cJ;export{A7 as G,f1 as g};
